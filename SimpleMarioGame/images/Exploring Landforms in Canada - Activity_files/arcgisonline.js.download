// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.35/esri/copyright.txt for details.
//>>built
/*
 Calcite Web - Calcite Design Components in CSS, JS and HTML
 @version v1.2.5
 @license Apache-2.0
 @copyright 2018 Esri
 @link https://github.com/Esri/calcite-web
*/
require({cache:{"dijit/form/VerticalRule":function(){define(["dojo/_base/declare","./HorizontalRule"],function(k,g){return k("dijit.form.VerticalRule",g,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkV" style\x3d"top:',_isHorizontal:!1})})},"dijit/form/VerticalRuleLabels":function(){define(["dojo/_base/declare","./HorizontalRuleLabels"],function(k,g){return k("dijit.form.VerticalRuleLabels",
g,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV dijitRuleLabelsContainer dijitRuleLabelsContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerV" style\x3d"top:',_labelPrefix:'"\x3e\x3cspan class\x3d"dijitRuleLabel dijitRuleLabelV"\x3e',_calcPosition:function(p){return 100-p},_isHorizontal:!1})})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da,J,M,K,R,X,Q){var W=k([q,l],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:Q,onLoad:function(){},constructor:function(I,T){I=I||{};this._settings=I.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var I=this._settings.layerInfos;this.featureReductionEnabledLayers=[];p.forEach(I,function(Y){Y=Y.featureLayer;
Y.isFeatureReductionEnabled()&&(Y.disableFeatureReduction(),this.featureReductionEnabledLayers.push(Y))},this);if(p.every(I,function(Y){return Y.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var T=I.length;p.forEach(I,function(Y){Y=Y.featureLayer;if(Y.loaded)T--;else var ca=b.connect(Y,"onLoad",this,function(V){b.disconnect(ca);ca=null;T--;T||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=
!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(I){this._updateCurrentFeature(g.hitch(this,function(){this._clearSelection(!1);I&&I()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();
this._disableMapClickHandler();p.forEach(this._eConnects,b.disconnect);b.disconnect(this._dtConnect);b.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();p.forEach(this.featureReductionEnabledLayers,
function(I){I.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new B(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new C(this._settings.map,{textSymbolEditorHolder:this.domNode});this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=g.mixin({reshapeVisible:!1,cutVisible:!1,
mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=g.mixin({polylineDrawTools:[W.CREATE_TOOL_POLYLINE],polygonDrawTools:[W.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?
!0:!1;this._datePackage=this._settings.datePackage;var I=R.defaults;this._settings.geometryService=this._settings.geometryService||I.geometryService;I.geometryService=I.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};p.forEach(this._settings.layerInfos,function(I){if(I.featureLayer&&I.featureLayer.loaded){this._settings.layers.push(I.featureLayer);var T=I.featureLayer.id;I.featureLayer.credential&&
(this._settings.userIds[T]=I.featureLayer.credential.userId);I.userId&&(this._settings.userIds[T]=I.userId);var Y=I.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[T]=Y.canCreate&&!Y.canUpdate?!0:!1;this._isTextSymbolPointLayer(I.featureLayer)&&(I.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=
!1},_saveFeatureOnClient:function(I){var T=this.templatePicker.getSelected();var Y=T.template?T.featureLayer.renderer.getSymbol(T.template.prototype):T.symbolInfo.symbol;this._tempGraphic=new w(I,Y,null,null);this._tempGraphic.setAttributes(g.mixin({},T.template.prototype.attributes));Y=this._settings.map;Y.graphics.add(this._tempGraphic);I=this._findCenterPoint(I);this._createAttributeInspector();Y.infoWindow.setTitle(T.featureLayer?T.featureLayer.name:X.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,
T.featureLayer);this._showInfoWindow(I,Y.getInfoWindowAnchor(I));if(this._settings.createOnlyLayer[T.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=b.connect(Y.infoWindow,"onHide",this,"_infoWindowHide");b.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=b.connect(this.templatePicker,
"onSelectionChange",g.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(I,T,Y){this._tempGraphic.attributes[T]="number"===typeof Y&&isNaN(Y)?null:Y},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);b.disconnect(this._infoWindowHideEvent)},_createFeature:function(I,T){this._editClickPoint=this._findCenterPoint(I);I.rings?this._simplify(I,g.hitch(this,function(Y){this._drawingTool!==z.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(Y,T)]}],g.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(Y,g.hitch(this,function(ca){ca&&ca.length&&this._applyEdits([{layer:this._layer,adds:p.map(ca,g.hitch(this,function(V){return this._createGraphic(V,T)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(I,T)]}],g.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(I,T){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(I,T)},_updateCurrentFeature:function(I){var T=
this._isModified();T?this._updateFeature(T,I):I&&I(!1)},_updateFeature:function(I,T,Y){var ca=I.geometry,V=I.getLayer();V.hasZ&&!V.enableZDefaults||V.hasM&&!V.allowUpdateWithoutMValues||Y&&!this._isModified()?(Y=new w,Y.setAttributes(I.attributes),this._applyEdits([{layer:I.getLayer(),updates:[Y]}],T)):ca.rings?this._simplify(ca,g.hitch(this,function(Z){this._applyEdits([{layer:I.getLayer(),updates:[g.mixin(I,{geometry:Z})]}],T)})):this._applyEdits([{layer:I.getLayer(),updates:[I]}],T)},_deleteFeature:function(I,
T){if(this._settings.invalidTemplate&&I===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var Y=[];I?Y.push({layer:I.getLayer(),deletes:[I]}):(Y=p.map(p.filter(this._settings.layers,function(ca){return 0<ca.getSelectedFeatures().length}),function(ca){return{layer:ca,deletes:ca.getSelectedFeatures()}}))&&Y.length||!this._currentGraphic||Y.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(Y,T)}},_stopEditing:function(I,
T,Y,ca){e.hide(this.progressBar.domNode);this._settings.createOnlyLayer[I.id]||this._undoRedoAdd();if(!0===I._isSelOnly||1===I.mode||6===I.mode){if(T&&T.length){this.templatePicker.clearSelection();var V=new v;V.objectIds=[T[0].objectId];this._settings.createOnlyLayer[I.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([I],V,g.hitch(this,"_onEditFeature"))}}else(V=this._selectionHelper.findMapService(this._settings.map,I))&&V.refresh(),
T&&T.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[I.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):D.findFeatures(T,I,g.hitch(this,"_onEditFeature")));ca&&ca.length&&(this._clearSelection(!0),this._undoRedo&&(V=this._selectionHelper.findMapService(I,this._settings.map))&&V.refresh());this._undoRedo&&Y&&Y.length&&((V=this._selectionHelper.findMapService(I,this._settings.map))&&V.refresh(),this.attributeInspector.refresh(),this._undoRedo=
!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var I=this._edits&&this._edits.length?this._edits[0]:null;if(I){var T=I.adds||[],Y=I.updates||[],ca=I.deletes||[],V=I.preUpdates||[];I={featureLayer:I.layer};"CUT"===this._activeTool?T.length&&Y.length&&V.length&&this.undoManager.add(new O(g.mixin(I,{preUpdatedGraphics:V,addedGraphics:T,postUpdatedGraphics:Y}))):
"UNION"===this._activeTool?ca.length&&Y.length&&V.length&&this.undoManager.add(new S(g.mixin(I,{preUpdatedGraphics:V,deletedGraphics:ca,postUpdatedGraphics:Y}))):T.length?this.undoManager.add(new G(g.mixin(I,{addedGraphics:T}))):ca.length?this.undoManager.add(new N(g.mixin(I,{deletedGraphics:ca}))):Y.length&&(this._rollbackGraphic||V.length)&&this.undoManager.add(new H(g.mixin(I,{preUpdatedGraphics:V.length?V:[this._rollbackGraphic],postUpdatedGraphics:Y})));this._rollbackGraphic=this._edits=null}}},
_activateDrawToolbar:function(I){this._layer=I.featureLayer;this._activeType=I.type;this._drawingTool=(this._activeTemplate=I.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,I.featureLayer);b.disconnect(this._dtConnect);var T=this._layer.fields;this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var Y=g.mixin({},this._activeTemplate.prototype.attributes);T=T.filter(function(ca){return!1===ca.nullable&&!0===ca.editable});
this._settings.invalidTemplate=T.some(function(ca){ca=Y[ca.name];return null===ca||void 0===ca})}this._dtConnect=this._settings.createOnlyLayer[I.featureLayer.id]||this._settings.invalidTemplate?b.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):b.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},
_activateEditToolbar:function(I,T){var Y=I.getLayer(),ca=Y?Y.geometryType:null,V=this._isTextSymbolPoint(I),Z=C.MOVE;"esriGeometryPoint"!==ca&&!0===this._isNotesFeature(I)?(Z=Z|C.ROTATE|C.SCALE,this._editVertices=!1):"esriGeometryPoint"!==ca&&!0===this._editVertices?(Z=Z|C.ROTATE|C.SCALE,this._editVertices=!1):V?(Z=Z|C.ROTATE|C.SCALE|C.EDIT_TEXT,this._editVertices=!1):(Z|=C.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new w(I.toJson());ca=Y.getEditCapabilities({feature:I,
userId:this._settings.userIds[Y.id]});var ja=p.filter(this._settings.layerInfos,function(la){return la.featureLayer.layerId===Y.layerId})[0];ca.canUpdate&&!ja.disableGeometryUpdate&&ca.canUpdateGeometry&&(this.editToolbar.activate(Z,I),V&&(this.editToolbar._textEditor._addTextBox(I),this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(I)||(I=T&&T.screenPoint||this._findCenterPoint(I),this._showInfoWindow(I,
this._settings.map.getInfoWindowAnchor(I)))},_createGraphic:function(I,T){var Y=new w(I,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,T);this._activeTemplate||T?Y.attributes=T||g.mixin({},this._activeTemplate.prototype.attributes):(Y.attributes=Y.attributes||[],p.forEach(this._layer.fields,function(ca){Y.attributes[ca.name]=null},this));return Y},_connectEvents:function(){var I=this._settings.layers;p.forEach(I,function(T){this._connect(T,"onEditsComplete",g.hitch(this,"_stopEditing",
T))},this);p.forEach(I,function(T){this._connect(T,"onBeforeApplyEdits",g.hitch(this,function(){e.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",g.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",g.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",g.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",g.hitch(this,
"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",g.hitch(this,"_hideAttributeInspector"))},_connect:function(I,T,Y){this._eConnects.push(b.connect(I,T,Y))},_createWidgets:function(){this._selectionHelper=new J(this._settings);this._createTemplatePicker();this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,e.hide(this.templatePickerDiv);
else{var I=p.filter(this._settings.layers,function(T){return T.getEditCapabilities().canCreate});this.templatePicker=new M({"class":"esriTemplatePicker",featureLayers:I,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=b.connect(this.templatePicker,"onSelectionChange",g.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var I=
this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new E({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,datePackage:this._datePackage},n.create("div")),this.attributeInspector.startup(),I.infoWindow.setContent(this.attributeInspector.domNode),I.infoWindow.setTitle(X.widgets.attributeInspector.NLS_title),I.infoWindow.resize(350,
375),h.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",g.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",g.hitch(this,function(T){this._updateCurrentFeature(g.hitch(this,function(){this._attributeChanged=!1;this._onEditFeature(T)}))}));this._usePopup&&I.infoWindow._setPagerCallbacks(this.attributeInspector,g.hitch(this.attributeInspector,"previous"),g.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,
"onAttributeChange",g.hitch(this,function(T,Y,ca){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(T,Y,ca);else{var V=T.getLayer();(V=p.filter(V.fields,function(Z){return Z.name===Y})[0])&&""===ca&&(ca=null);this._rollbackGraphic=new w(g.clone(T.toJson()));this.attributeInspector._rollbackInfo={field:V,graphic:this._rollbackGraphic};this._currentGraphic.attributes[Y]="number"===typeof ca&&isNaN(ca)?null:ca;this._currentGraphic.setAttributes(this._currentGraphic.attributes);
this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new da({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,settings:this._settings,onDelete:g.hitch(this,"_deleteFeature"),onApplyEdits:g.hitch(this,"_applyEdits"),onShowAttributeInspector:g.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||
this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new u({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,"onUndoComplete",g.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",g.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",g.hitch(this,function(I){if(I.metaKey||I.ctrlKey)"z"===
I.charOrCode&&this._undo(),"y"===I.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(I){if(I&&I.addedIds){var T;for(T=0;T<this.undoManager.length;T++){var Y=this.undoManager.get(T);Y&&I.layer===Y._featureLayer&&Y.updateObjectIds(I.oldIds,I.addedIds)}}I&&"Update Features"===I.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=b.connect(this._settings.map,"onClick",g.hitch(this,function(I){this._drawToolbar._geometryType||("SELECT"===
this._activeTool?this._activeTool="":this._updateCurrentFeature(g.hitch(this,function(){this._reset();this._updateSelection(I)})))}))},_disableMapClickHandler:function(){b.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var I=this.templatePicker.getSelected();I?this._updateCurrentFeature(g.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(I)})):(this._reset(),b.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),
this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(I){if("point"===I.geometry.type||"multipoint"===I.geometry.type){var T=I.getLayer(),Y=T.renderer;I=I.symbol||T._getSymbol(I);!I&&(Y.hasVisualVariables("sizeInfo",!1)||Y.hasVisualVariables("colorInfo",!1)||Y.hasVisualVariables("opacityInfo",!1))&&Y.addBreak&&Y.infos&&1===Y.infos.length&&(I=Y.infos[0].symbol||Y.defaultSymbol);if(I&&"textsymbol"===I.type)return!0}return!1},_isTextSymbolPointLayer:function(I){return"esriGeometryPoint"===
I.geometryType&&I.renderer&&I.renderer._symbols&&I.renderer._symbols[0]&&I.renderer._symbols[0].symbol&&"textsymbol"===I.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(I){I=I.getLayer();if(!I)return!1;var T,Y=!1;for(T=0;T<this._settings.layerInfos.length;T++){var ca=this._settings.layerInfos[T];if(ca.featureLayer==I){Y=ca.disableAttributeUpdate;break}}return Y},_onEditFeature:function(I,T){if(I=(g.isArray(I)?I[0]:I)||null){this._layer=I.getLayer();if(!this._customAttributeInspector&&
!this._updateAttributeDisabled(I)){T=T||this._editClickPoint||this._findCenterPoint(I);if(1<this._currentFeatureCount){var Y=this._popupFeatures.indexOf(I);Y=m.substitute(X.widgets.popup.NLS_pagingInfo,{index:Y+1,total:this._currentFeatureCount})}else Y=this._layer?this._layer.name:X.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(Y);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(T,this._settings.map.getInfoWindowAnchor(T));
this._editClickPoint=null}I!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=I,I.getDojoShape()&&I.getDojoShape().moveToFront(),T=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||T&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(I))}},_applyEdits:function(I,T){I=I||[];if(!(0>=I.length)){this._edits=this._oEdits=I;var Y=[];p.forEach(I,function(ca){ca.layer&&Y.push(ca.layer.applyEdits(ca.adds,ca.updates,ca.deletes))});0<Y.length&&(this._deferredsList=
(new a(Y)).addCallback(g.hitch(this,function(){e.hide(this.progressBar.domNode);T&&T();var ca=this._settings.map;ca&&ca.infoWindow.reposition&&ca.infoWindow.isShowing&&ca.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},
_simplify:function(I,T){r.prototype.isSelfIntersecting(I)?this._settings.geometryService.simplify([I],function(Y){var ca=Y&&Y.length?Y[0]:ca;T&&T(ca)}):T&&T(I)},_autoComplete:function(I,T){var Y=this._getLayers("esriGeometryPolygon"),ca=new v;ca.geometry=I;ca.returnGeometry=!0;this._selectFeatures(Y,ca,g.hitch(this,function(V){!V||0>=V.length?T&&T([I]):this._settings.geometryService.autoComplete(t.getGeometries(V),this._toPolylines([ca.geometry]),function(Z){T&&T(Z)})}))},_getLayers:function(I){return p.filter(this._settings.layers,
function(T){return T.geometryType===I})},_selectFeatures:function(I,T,Y,ca){this._selectionHelper.selectFeatures(I,T,ca||y.SELECTION_NEW,Y)},_updateSelection:function(I){var T=I.mapPoint,Y=I.graphic,ca=this._settings.layerInfos,V;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,T,y.SELECTION_NEW,g.hitch(this,function(Z){var ja=p.some(Z,g.hitch(this,function(ba){return ba==Y}));if(Y&&!ja)if(ja=Y.getLayer(),this._isValidLayer(ja)){var la=new v;la.objectIds=[Y.attributes[ja.objectIdField]];
this._selectionHelper.selectFeatures([ja],la,y.SELECTION_ADD,g.hitch(this,function(ba){ba&&ba.length&&(ba=ba.concat(Z),V=D.sortFeaturesById(ca,ba),this._updatePopupButtons(V),this._onEditFeature(V,T))}))}else Z&&Z.length?(V=D.sortFeaturesById(ca,Z),this._updatePopupButtons(V),this._onEditFeature(V,T)):this._clearSelection();else Z&&Z.length?(V=D.sortFeaturesById(ca,Z),this._updatePopupButtons(V),this._onEditFeature(V,T)):this._clearSelection()}));Y&&this._isTextSymbolPoint(Y)&&this._isValidLayer(Y.getLayer())&&
this.editToolbar.activate(0|C.MOVE|C.ROTATE|C.SCALE|C.EDIT_TEXT,Y)},_updatePopupButtons:function(I){if(this._usePopup&&I){var T=I.length;p.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],g.hitch(this,function(ca){1<T?c.remove(ca,"hidden"):c.add(ca,"hidden")}));var Y=1<T?"block":"none";h.query(".esriAttributeInspector .atiLayerName").style({display:Y});this._currentFeatureCount=T;this._popupFeatures=I}else this._currentFeatureCount=this._popupFeatures=
null},_clearSelection:function(I){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(I||!1);this._reset()},_findCenterPoint:function(I){I=I.geometry||I;switch(I.type){case "point":var T=I;break;case "polyline":T=I.getPoint(0,Math.ceil(I.paths[0].length/2));break;case "polygon":T=I.rings.length-1,T=I.getPoint(T,I.rings[T].length-1)}return this._settings.map.toScreen(T)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&
this._settings.map.infoWindow.hide()},_toPolylines:function(I){return p.map(I,function(T){var Y=new x(T.spatialReference);p.forEach(T.rings,function(ca){Y.addPath(ca)});return Y})},_isNotesFeature:function(I){var T=I.getLayer(),Y=T?T.types||null:null;if(!Y)return!1;var ca=I.attributes[T.typeIdField],V;p.some(Y,function(Z){return Z.id===ca?(V=Z.templates,!0):!1});return V?(I=V[0]||null)?this._isShapeTool(I.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(I){var T,Y=this._settings.layerInfos;for(T=
0;T<Y.length;T++){var ca=Y[T];if(I.id==(ca.featureLayer?ca.featureLayer.id:ca.layerId))return!0}return!1},_isShapeTool:function(I){switch(I){case z.TOOL_ARROW:return B.ARROW;case z.TOOL_LEFT_ARROW:return B.LEFT_ARROW;case z.TOOL_RIGHT_ARROW:return B.RIGHT_ARROW;case z.TOOL_UP_ARROW:return B.UP_ARROW;case z.TOOL_DOWN_ARROW:return B.DOWN_ARROW;case z.TOOL_CIRCLE:return B.CIRCLE;case z.TOOL_ELLIPSE:return B.ELLIPSE;case z.TOOL_TRIANGLE:return B.TRIANGLE;case z.TOOL_RECTANGLE:return B.RECTANGLE;default:return null}},
_toDrawTool:function(I,T){T=T.geometryType;switch(I){case z.TOOL_POINT:return B.POINT;case z.TOOL_ARROW:return B.ARROW;case z.TOOL_LEFT_ARROW:return B.LEFT_ARROW;case z.TOOL_RIGHT_ARROW:return B.RIGHT_ARROW;case z.TOOL_UP_ARROW:return B.UP_ARROW;case z.TOOL_DOWN_ARROW:return B.DOWN_ARROW;case z.TOOL_CIRCLE:return B.CIRCLE;case z.TOOL_ELLIPSE:return B.ELLIPSE;case z.TOOL_TRIANGLE:return B.TRIANGLE;case z.TOOL_RECTANGLE:return B.RECTANGLE;case z.TOOL_LINE:return B.POLYLINE;case z.TOOL_POLYGON:return B.POLYGON;
case z.TOOL_FREEHAND:return"esriGeometryPolyline"===T?B.FREEHAND_POLYLINE:B.FREEHAND_POLYGON;default:return I=B.POINT,"esriGeometryPolyline"===T?(I=B.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===W.CREATE_TOOL_FREEHAND_POLYLINE&&(I=B.FREEHAND_POLYLINE)):"esriGeometryPolygon"===T&&(I=B.POLYGON,this._settings.createOptions.polygonDrawTools[0]===W.CREATE_TOOL_FREEHAND_POLYGON&&(I=B.FREEHAND_POLYGON)),I}},_isModified:function(){var I=this.editToolbar.getCurrentState();return(I.isModified||
this._attributeChanged)&&I.graphic?I.graphic:null},_showInfoWindow:function(I,T){this._customAttributeInspector||this._settings.map.infoWindow.show(I,T)}});g.mixin(W,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",
CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});g.setObject("dijit.editing.Editor",W,K);return W})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented ./OperationBase".split(" "),function(k,g,p,b,h,f){k=k([f],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},
onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(d){d=d||{};d.maxOperations&&(this.maxOperations=d.maxOperations);this._historyStack=[]},add:function(d){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,d);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var d=this.peekUndo();this.position--;
d?(d=d.performUndo(),this.onUndo(),this._checkAvailability(),b(d).then(g.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var d=this.peekRedo();this.position++;d?(d=d.performRedo(),this.onRedo(),this._checkAvailability(),b(d).then(g.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=
this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&
0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(d){return this._historyStack[d]},remove:function(d){0<this._historyStack.length&&(this._historyStack.splice(d,1),0<this.position&&d<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});return h.UndoManager=k})},"esri/OperationBase":function(){define(["dojo/_base/declare",
"dojo/has","./kernel"],function(k,g,p){k=k(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(b){b=b||{};b.label&&(this.label=b.label)},performUndo:function(){},performRedo:function(){}});return p.OperationBase=k})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y){var z=g(l,{declaredClass:"esri.toolbars.Edit",constructor:function(B,C){this._map=B;this._tool=0;if(this._map.loaded)this._scratchGL=B.graphics;else var E=b.connect(this._map,"onLoad",this,function(){b.disconnect(E);E=null;this._scratchGL=this._map.graphics});B=d("esri-mobile");this._defaultOptions=p.mixin({vertexSymbol:new w(w.STYLE_CIRCLE,B?20:12,new u(u.STYLE_SOLID,new f([0,0,0,.5]),1),new f([128,128,128])),ghostVertexSymbol:new w(w.STYLE_CIRCLE,
B?18:10,new u(u.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),ghostLineSymbol:new u(u.STYLE_DOT,new f([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:B?24:16,boxLineSymbol:new u(u.STYLE_DASH,new f([64,64,64]),1),boxHandleSymbol:new w(w.STYLE_SQUARE,B?16:9,new u(u.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),textAnchorSymbol:new w(w.STYLE_CIRCLE,10,null,new f([255,0,0]))},C||{})},activate:function(B,C,E){this.deactivate();this._graphic=C;this._options=
p.mixin(p.mixin({},this._defaultOptions),E||{});var D=z.MOVE;E=z.EDIT_VERTICES;var G=z.SCALE,H=z.ROTATE,N=z.EDIT_TEXT,O=!1,S=!1,da=!1,J=this._map,M=J.spatialReference,K=C.geometry.spatialReference;this._geo=!(!M||!K||M.equals(K)||!M.isWebMercator()||4326!==K.wkid);this._isTextPoint=this._prepareTextSymbolEditing(C,B);(B&D)===D&&(O=this._enableMove(C));D=(B&G)===G;H=(B&H)===H;if(D||H)da=this._enableBoxEditing(C,D,H);(B&E)===E&&(S=this._enableVertexEditing(C));(B&N)===N&&this._enableTextEditing(C);
if(!(O||S||da))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=B)this._mapPanEndHandle=b.connect(J,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=b.connect(J,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,C);J.snappingManager&&(O||S)&&J.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var B=this._tool,C=this._graphic;
if(B){var E=!!this._modified;this._clear();b.disconnect(this._mapPanEndHandle);b.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(B,C,{isModified:E});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(B,C){},onDeactivate:function(B,
C,E){},onGraphicMoveStart:function(B){},onGraphicFirstMove:function(B){this._modified=!0},onGraphicMove:function(B,C){},onGraphicMoveStop:function(B,C){},onGraphicClick:function(B,C){},onVertexMoveStart:function(B,C){},onVertexFirstMove:function(B,C){this._modified=!0},onVertexMove:function(B,C,E){},onVertexMoveStop:function(B,C,E){},onVertexAdd:function(B,C){this._modified=!0},onVertexClick:function(B,C){},onVertexMouseOver:function(B,C){},onVertexMouseOut:function(B,C){},onVertexDelete:function(B,
C){this._modified=!0},onTextEditStart:function(B,C){},onTextEditEnd:function(B){},onScaleStart:function(B){},onScaleFirstMove:function(B){this._modified=!0},onScale:function(B,C){},onScaleStop:function(B,C){},onRotateStart:function(B){},onRotateFirstMove:function(B){this._modified=!0},onRotate:function(B,C){},onRotateStop:function(B,C){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic",
"transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(B,C){if("point"===B.geometry.type||"multipoint"===B.geometry.type){var E=B.getLayer(),D=E.renderer;E=B.symbol||E._getSymbol(B);!E&&(D.hasVisualVariables("sizeInfo",!1)||D.hasVisualVariables("colorInfo",!1)||D.hasVisualVariables("opacityInfo",!1))&&D.addBreak&&
D.infos&&1===D.infos.length&&(E=D.infos[0].symbol||D.defaultSymbol);if(E&&"textsymbol"===E.type){if((C&z.SCALE)===z.SCALE||(C&z.ROTATE)===z.ROTATE||(C&z.EDIT_TEXT)===z.EDIT_TEXT){B.setSymbol(new v(E.toJson()));var G=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(B),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){G._boxEditor&&G._boxEditor.refresh()})):
k(["../dijit/SymbolEditor"],function(H){if(!G._textSymbolEditor){var N=G._options.textSymbolEditorHolder?a.create("div",null,G._options.textSymbolEditorHolder):a.create("div",null,G._map.root);G._textSymbolEditor=new H({graphic:B},N);H=G._textSymbolEditor.domNode.parentNode.id;c.set(G._textSymbolEditor.domNode,{position:"map_root"===H?"absolute":"relative",left:"map_root"===H?G._map.width/2-100+"px":"5px",top:"20px","z-index":50});G._textSymbolEditor.startup();G._textSymbolEditor.createForm(B);G._textSymbolEditor.show();
G._textSymbolEditor.on("symbol-change",function(){G._boxEditor&&G._boxEditor.refresh()})}})}if((C&z.MOVE)===z.MOVE||(C&z.ROTATE)===z.ROTATE||(C&z.SCALE)===z.SCALE)this._textAnchor=new y(B.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(B){var C=this._map;switch(B.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new t(B,C,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(B){var C=
this._map;switch(B.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=x.create(B,C,this),!0}return!1},_enableBoxEditing:function(B,C,E){var D=this._map,G=B.geometry.type;return"polyline"===G||"polygon"===G||this._isTextPoint?(this._boxEditor=new e(B,D,this,C,E,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(B){return this._isTextPoint?(this._textEditor=new r(B,this._map,this),b.connect(this._textEditor,"onEditStart",p.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var B=this._graphicMover;B&&(B.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var B=this._vertexEditor;B&&(B.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var B=this._boxEditor;B&&(B.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(B,C,E){E&&this._refreshMoveables()},_refreshMoveables:function(B){var C=h.filter([this._graphicMover,this._vertexEditor,this._boxEditor],m.isDefined);h.forEach(C,function(E){E.refresh(B)})},_beginOperation:function(B){h.forEach(this._getAffectedTools(B),function(C){C.suspend()})},_endOperation:function(B){h.forEach(this._getAffectedTools(B),function(C){C.resume()})},_getAffectedTools:function(B){var C=[];switch(B){case "MOVE":C=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":C=[this._boxEditor];break;case "BOX":C=[this._vertexEditor]}return C=h.filter(C,m.isDefined)}});p.mixin(z,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});p.setObject("toolbars.Edit",z,n);return z})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r){k=k(null,{declaredClass:"esri.toolbars._Box",constructor:function(w,u,v,y,z,B,C){this._graphic=w;this._map=u;this._toolbar=v;this._scale=y;this._rotate=z;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=B;w=v._options;this._markerSymbol=w.boxHandleSymbol;this._lineSymbol=w.boxLineSymbol;this._moveStartHandler=g.hitch(this,this._moveStartHandler);this._firstMoveHandler=g.hitch(this,this._firstMoveHandler);
this._moveStopHandler=g.hitch(this,this._moveStopHandler);this._moveHandler=g.hitch(this,this._moveHandler);this._isTextPoint=C;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){p.forEach(this._getAllGraphics(),function(w){w.hide()})},resume:function(){p.forEach(this._getAllGraphics(),function(w){w.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
p.forEach(this._connects,b.disconnect);var w=this._toolbar._scratchGL;this._anchors&&p.forEach(this._anchors,function(u){w.remove(u.graphic);(u=u.moveable)&&u.destroy()});this._box&&w.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var w=this._map,u=this._toolbar._scratchGL,v=this._getBoxCoords(),y=new l(w.spatialReference),z=g.clone(p.filter(v,function(B,C){return 8!==C&&0===C%2}));z[0]&&z.push([z[0][0],z[0][1]]);y.addPath(z);this._rotate&&
y.addPath([v[1],v[8]]);this._box?this._box.setGeometry(y):(this._box=new r(y,this._lineSymbol),u.add(this._box));this._anchors?p.forEach(this._anchors,function(B,C){this._scale||(C=8);var E=new q(v[C],w.spatialReference);B.graphic.setGeometry(E);E=B.moveable;var D=B.graphic.getDojoShape();D&&(E?D!==E.shape&&(E.destroy(),B.moveable=this._getMoveable(B.graphic,C)):B.moveable=this._getMoveable(B.graphic,C))},this):(this._anchors=[],this._connects=[],p.forEach(v,function(B,C){!this._scale&&8>C||(B=new q(B,
w.spatialReference),B=new r(B,this._markerSymbol),this._isTextPoint&&1===C%2&&B.hide(),u.add(B),this._anchors.push({graphic:B,moveable:this._getMoveable(B,C)}))},this))}else this._cleanUp()},_getBoxCoords:function(w){var u=this._map,v=[],y,z,B;if(this._isTextPoint){var C=this._graphic.getNode().getBoundingClientRect();var E=u.__container.getBoundingClientRect();C=[{x:C.left-E.left,y:C.top-E.top},{x:C.right-E.left,y:C.top-E.top},{x:C.right-E.left,y:C.bottom-E.top},{x:C.left-E.left,y:C.bottom-E.top}]}else C=
this._getTransformedBoundingBox(this._graphic);p.forEach(C,function(D,G,H){y=D;(z=H[G+1])||(z=H[0]);B={x:(y.x+z.x)/2,y:(y.y+z.y)/2};w||(y=u.toMap(y),B=u.toMap(B));v.push([y.x,y.y]);v.push([B.x,B.y])});this._rotate&&(C=g.clone(v[1]),C=w?{x:C[0],y:C[1]}:u.toScreen({x:C[0],y:C[1],spatialReference:u.spatialReference}),C.y-=this._toolbar._options.rotateHandleOffset,w||(C=u.toMap(C)),v.push([C.x,C.y]));return v},_getTransformedBoundingBox:function(w){var u=this._map,v=w.geometry.getExtent(),y=w.geometry.spatialReference;
w=new q(v.xmin,v.ymax,y);v=new q(v.xmax,v.ymin,y);w=u.toScreen(w);v=u.toScreen(v);return[{x:w.x,y:w.y},{x:v.x,y:w.y},{x:v.x,y:v.y},{x:w.x,y:v.y}]},_getAllGraphics:function(){var w=[this._box];this._anchors&&p.forEach(this._anchors,function(u){w.push(u.graphic)});return w=p.filter(w,m.isDefined)},_getMoveable:function(w,u){var v=w.getDojoShape();if(v)return w=new a(v),w._index=u,this._connects.push(b.connect(w,"onMoveStart",this._moveStartHandler)),this._connects.push(b.connect(w,"onFirstMove",this._firstMoveHandler)),
this._connects.push(b.connect(w,"onMoveStop",this._moveStopHandler)),w.onMove=this._moveHandler,(v=v.getEventSource())&&d.set(v,"cursor",this._toolbar._cursors["box"+u]),w},_moveStartHandler:function(w){this._toolbar["on"+(8===w.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(w){this._toolbar._deactivateScrollWheel();var u=w.host._index,v=this._wrapOffset=w.host.shape._wrapOffsets[0]||0,y=this._graphic.getLayer().getNavigationTransform();w=p.map(this._getBoxCoords(!0),
function(B){return{x:B[0]+v,y:B[1]}});var z=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:w[1].x,y:w[3].y};this._centerCoord=c.multiplyPoint(c.invert(y),z);if(8===u)z=c.multiplyPoint(c.invert(y),w[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,z)),this._startLine=[this._centerCoord,z],this._moveLine=g.clone(this._startLine);else if(z=c.multiplyPoint(c.invert(y),w[u]),y=c.multiplyPoint(c.invert(y),w[(u+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,z)),this._firstMoverToAnchor=Math.sqrt((z.x-this._centerCoord.x)*(z.x-this._centerCoord.x)+(z.y-this._centerCoord.y)*(z.y-this._centerCoord.y)),this._startBox=y,this._startBox.width=w[4].x-w[0].x,this._startBox.height=w[4].y-w[0].y,this._moveBox=g.clone(this._startBox),this._xfactor=z.x>y.x?1:-1,this._yfactor=z.y>y.y?1:-1,1===u||5===u)this._xfactor=0;else if(3===u||7===u)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===u?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(w,u){w=w.host._index;var v=this._defaultEventArgs;v.angle=0;v.scaleX=1;v.scaleY=1;if(8===w){var y=this._startLine;var z=this._moveLine;var B=z[1];B.x+=u.dx;B.y+=u.dy;u=this._getAngle(y,z);this._isTextPoint&&(u+=this._graphic.symbol.angle);z=c.rotategAt(u,y[0]);this._graphic.getDojoShape().setTransform(z);v.transform=z;v.angle=u;v.around=y[0]}else{y=this._startBox;z=this._moveBox;z.width+=u.dx*this._xfactor;z.height+=u.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(y=z.x+this._xfactor*z.width,z=z.y+this._yfactor*z.height,y=Math.sqrt((y-this._centerCoord.x)*(y-this._centerCoord.x)+(z-this._centerCoord.y)*(z-this._centerCoord.y)),this._scaleRatio=u=B=y/this._firstMoverToAnchor,y=this._centerCoord):(u=z.width/y.width,B=z.height/y.height,y={x:y.x,y:y.y});if(isNaN(u)||Infinity===u||-Infinity===u)u=1;if(isNaN(B)||Infinity===B||-Infinity===B)B=1;z=c.scaleAt(u,B,y);if(this._isTextPoint){var C=c.rotategAt(this._graphic.symbol.angle,
y);this._graphic.getDojoShape().setTransform([C,z])}else this._graphic.getDojoShape().setTransform(z);v.transform=z;v.scaleX=u;v.scaleY=B;v.around=y}this._toolbar["on"+(8===w?this._rotateEvent:this._scaleEvent)](this._graphic,v)},_moveStopHandler:function(w){this._toolbar._activateScrollWheel();var u=this._graphic,v=this._toolbar,y=v._geo?t.geographicToWebMercator(u.geometry):u.geometry,z=y.spatialReference,B=u.getDojoShape(),C=B.getTransform(),E=u.getLayer().getNavigationTransform();this._isTextPoint?
(u=this._graphic.symbol,8===w.host._index?u.angle+=this._getAngle(this._startLine,this._moveLine):u.font.setSize(Math.round(u.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(u)):(y=y.toJson(),this._updateSegments(y.paths||y.rings,C,E,z),B.setTransform(null),y=x.fromJson(y),u.setGeometry(v._geo?t.webMercatorToGeographic(y,!0):y));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;v._endOperation("BOX");this._defaultEventArgs.transform=
C;v["on"+(8===w.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(w,u,v,y){var z=this._map,B=this._wrapOffset||0;p.forEach(w,function(C){p.forEach(C,function(E){this._updatePoint(E,y,B,c,z,v,u)},this)},this)},_updatePoint:function(w,u,v,y,z,B,C){u=z.toScreen({x:w[0],y:w[1],spatialReference:u},!0);u.x+=v;u=y.multiplyPoint([B,C,y.invert(B)],u);u.x-=v;v=z.toMap(u);w[0]=v.x;w[1]=v.y},_getAngle:function(w,u){return 180*Math.atan2(u[0].y-
u[1].y,u[0].x-u[1].x)/Math.PI-180*Math.atan2(w[0].y-w[1].y,w[0].x-w[1].x)/Math.PI},_deNormalizePoint:function(w,u){var v=this._map._getFrameWidth();if(-1===v)return w;for(w={x:w.x,y:w.y};Math.abs(w.x-u.x)>=v;)w.x=w.x<u.x?w.x+v:w.x-v;var y=Math.abs(w.x-u.x);Math.abs(w.x-u.x+v)<y?w.x+=v:Math.abs(w.x-u.x-v)<y&&(w.x-=v);return w}});g.setObject("toolbars._Box",k,n);return k})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(k,g,p,b,h,f,d,a,c,n){return g("dojox.gfx.Moveable",null,{constructor:function(m,q){this.shape=m;this.delay=q&&0<q.delay?q.delay:0;this.mover=q&&q.mover?q.mover:c;this.leftButtonOnly=q&&q.leftButtonOnly;this.events=[this.shape.on(f.press,k.hitch(this,"onMouseDown"))]},destroy:function(){p.forEach(this.events,function(m){m.remove()});this.events=this.shape=null},onMouseDown:function(m){this.delay?(this.events.push(this.shape.on(f.move,k.hitch(this,"onMouseMove")),this.shape.on(f.release,k.hitch(this,
"onMouseUp"))),this._lastX=m.clientX,this._lastY=m.clientY):this.leftButtonOnly&&!n.isLeft(m)||new this.mover(this.shape,m,this);b.stop(m)},onMouseMove:function(m){var q=m.clientY;if(Math.abs(m.clientX-this._lastX)>this.delay||Math.abs(q-this._lastY)>this.delay)this.onMouseUp(m),new this.mover(this.shape,m,this);b.stop(m)},onMouseUp:function(m){this.events.pop().remove()},onMoveStart:function(m){h.publish("/gfx/move/start",m);d.add(a.body(),"dojoMove")},onMoveStop:function(m){h.publish("/gfx/move/stop",
m);d.remove(a.body(),"dojoMove")},onFirstMove:function(m){},onMove:function(m,q,l){this.onMoving(m,q,l);this.shape.applyLeftTransform(q);this.onMoved(m,q)},onMoving:function(m,q){},onMoved:function(m,q){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(k,g,p,b,h,f){return p("dojox.gfx.Mover",null,{constructor:function(d,a,c){this.shape=d;this.lastX=a.clientX;this.lastY=a.clientY;d=this.host=c;a=
document;c=b(a,h.move,k.hitch(this,"onFirstMove"));this.events=[b(a,h.move,k.hitch(this,"onMouseMove")),b(a,h.release,k.hitch(this,"destroy")),b(a,"dragstart",k.hitch(f,"stop")),b(a,"selectstart",k.hitch(f,"stop")),c];if(d&&d.onMoveStart)d.onMoveStart(this)},onMouseMove:function(d){var a=d.clientX,c=d.clientY;this.host.onMove(this,{dx:a-this.lastX,dy:c-this.lastY},d);this.lastX=a;this.lastY=c;f.stop(d)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){g.forEach(this.events,
function(a){a.remove()});var d=this.host;if(d&&d.onMoveStop)d.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l,e){var t=k(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(x,r,w,u){this.graphic=x;this.map=r;this.toolbar=w;this.tempPt=u;this._enableGraphicMover();this._moved=!1},refresh:function(x){var r=this.graphic.getDojoShape();!r||!x&&r._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var x=this.graphic,r=x.getDojoShape();r&&(r._hostGraphic=x,this._moveable=new f(r,{mover:t.Mover}),this._moveStartHandle=
p.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=p.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=p.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=p.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(x=r.getEventSource())&&h.set(x,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var x=this._moveable;if(x){p.disconnect(this._moveStartHandle);p.disconnect(this._firstMoveHandle);
p.disconnect(this._movingHandle);p.disconnect(this._moveStopHandle);var r=x.shape;r&&(r._hostGraphic=null,(r=r.getEventSource())&&h.set(r,"cursor","inherit"));x.destroy()}this._moveable=null},_moveStartHandler:function(){var x=this.graphic,r=this.map;this._startTx=x.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&r.snappingManager&&r.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(x)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(x,r,w){x=x.shape.getTransform();r=this.map;var u;m("esri-pointer")?u=r.navigationManager.pointerEvents._processTouchEvent(w,w):w&&"pointermove"===w.type&&(u=n.prototype._processTouchEvent.call({map:r},w,w));u&&r.snappingManager&&r.snappingManager._onSnappingMouseMoveHandler(u);this.tempPt&&this.tempPt.getDojoShape().setTransform(x);this.toolbar.onGraphicMove(this.graphic,x)},_moveStopHandler:function(x){var r=this.graphic,w=this.toolbar,u=this.map,v=w._geo?q.geographicToWebMercator(r.geometry):
r.geometry,y=v.type,z=r.getDojoShape(),B=z.getTransform();if(b.toJson(B)!==b.toJson(this._startTx)){this._moved=!0;switch(y){case "point":y=[B,a.invert(this._startTx)];if(u.snappingManager)var C=u.snappingManager._snappingPoint;v=C||u.toMap(a.multiplyPoint(y,u.toScreen(v,!0)));u.snappingManager&&u.snappingManager._killOffSnapping();break;case "polyline":v=this._updatePolyGeometry(v,v.paths,B);break;case "polygon":v=this._updatePolyGeometry(v,v.rings,B)}z.setTransform(null);r.setGeometry(w._geo?q.webMercatorToGeographic(v,
!0):v);this.tempPt&&this.tempPt.setGeometry(new e(r.geometry.toJson()))}else this._moved=!1;w._endOperation("MOVE");w.onGraphicMoveStop(r,B);this._moved||(x=x.__e,u=this.map.position,x=new l(x.pageX-u.x,x.pageY-u.y),w.onGraphicClick(r,{screenPoint:x,mapPoint:this.map.toMap(x)}))},_updatePolyGeometry:function(x,r,w){var u=this.map,v=x.getPoint(0,0);u=u.toMap(u.toScreen(v).offset(w.dx,w.dy));w=u.x-v.x;v=u.y-v.y;var y;for(u=0;u<r.length;u++){var z=r[u];for(y=0;y<z.length;y++){var B=x.getPoint(u,y);x.setPoint(u,
y,B.offset(w,v))}}return x}});t.Mover=k(d,{declaredClass:"esri.toolbars._Mover",constructor:function(x,r,w){this.__e=r}});g.setObject("toolbars._GraphicMover",t,c);g.setObject("toolbars._Mover",t.Mover,c);return t})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(k,g,p,b,h,f,d,a,c,n,
m,q){var l=k(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(e,t,x){this.graphic=e;this.map=t;this.toolbar=x;e=x._options;this._symbol1=e.vertexSymbol;this._symbol2=e.ghostVertexSymbol;t=e.ghostLineSymbol;this._lineStroke={style:t.style,width:t.width,color:t.color};this._canDel=e.allowDeleteVertices;this._canAdd=e.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(e){e?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=p.connect(c,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=p.connect(c,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var e=this._getGraphicsLayer();this._mouseOverHandle=p.connect(e,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=p.connect(e,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new f({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),e=this._ctxDelete=new d({label:q.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
p.connect(e,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(e),this._ctxMenu.startup())},_removeControllers:function(){p.disconnect(this._firstMoveHandle);p.disconnect(this._moveStopHandle);p.disconnect(this._mouseOverHandle);p.disconnect(this._mouseOutHandle);p.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(e,t,x){var r,w,u=this.graphic,v=[];for(r=0;r<e.length;r++){var y=e[r],z=[];for(w=0;w<y.length;w++)z.push(new c(y[w],t,u,r,w,y.length,this,x));v.push(z)}return v},_remove:function(e){e&&b.forEach(e,function(t){b.forEach(t,function(x){x.destroy()})})},_refresh:function(e){e&&b.forEach(e,function(t){b.forEach(t,function(x){x.refresh()})})},_isNew:function(e){return-1===b.indexOf(this._vertexMovers[e.segIndex],e)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(e){e=this._selectedMover;this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(e);this._deleteVertex(e);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(e){e=e.graphic;var t=this._findMover(e);t&&(this.toolbar.onVertexMouseOver(this.graphic,t._getInfo()),t._placeholder||(this._selectedMover=t,this._canDel&&this._bindCtxNode(e.getDojoShape().getNode())))},_mouseOutHandler:function(e){if(e=
this._findMover(e.graphic))this.toolbar.onVertexMouseOut(this.graphic,e._getInfo())},_bindCtxNode:function(e){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(e);this._bindNode=e},_unbindCtxNode:function(){var e=this._bindNode;e&&this._ctxMenu.unBindDomNode(e)},_findMover:function(e){var t=[];var x=this._mpVertexMovers;b.forEach(this._vertexMovers,function(w){t=t.concat(w)});x&&b.forEach(x,function(w){t=t.concat(w)});
for(x=0;x<t.length;x++){var r=t[x];if(r.graphic===e)return r}},_firstMoveHandler:function(e){!this._isNew(e)&&this._canAdd&&this._hideRelatedMidpoints(e);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(e,t){var x=this._isNew(e);t&&(t.dx||t.dy)?(this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,x),this._canAdd&&(x?this._addMidpoints(e):(this._repositionRelatedMidpoints(e),this._showRelatedMidpoints(e))),this.toolbar._endOperation("VERTICES")):
!x&&this._canAdd&&this._showRelatedMidpoints(e)},_showRelatedMidpoints:function(e){var t=this._getAdjacentMidpoints(e.ptIndex,e.segLength),x=this._mpVertexMovers[e.segIndex];for(e=0;e<t.length;e++){var r=x[t[e]];r.graphic.show();r.refresh()}},_hideRelatedMidpoints:function(e){var t=this._getAdjacentMidpoints(e.ptIndex,e.segLength),x=this._mpVertexMovers[e.segIndex];for(e=0;e<t.length;e++)x[t[e]].graphic.hide()},_repositionRelatedMidpoints:function(e){var t,x=this._getAdjacentMidpoints(e.ptIndex,e.segLength),
r=this._mpVertexMovers[e.segIndex];for(t=0;t<x.length;t++){var w=this._getAdjacentVertices(x[t],e.segLength),u=e.relatedGraphic.geometry.getPoint(e.segIndex,w[0]);w=e.relatedGraphic.geometry.getPoint(e.segIndex,w[1]);u=new n({x:(u.x+w.x)/2,y:(u.y+w.y)/2,spatialReference:u.spatialReference.toJson()});r[x[t]].graphic.setGeometry(u)}},_addMidpoints:function(e){var t=e.segIndex,x=e.ptIndex,r=e.segLength,w=x+1,u,v=r+1;this._mpVertexMovers[t].splice(x,1);var y=this._vertexMovers[t];for(u=0;u<w;u++)y[u].segLength+=
1;for(u=w;u<y.length;u++)y[u].ptIndex+=1,y[u].segLength+=1;e.ptIndex=w;e.segLength=y.length+1;y.splice(w,0,e);e.graphic.setSymbol(this._symbol1);y=this._mpVertexMovers[t];for(u=0;u<x;u++)y[u].segLength+=1;for(u=x;u<r-1;u++)y[u].ptIndex+=1,y[u].segLength+=1;w=this._getAdjacentVertices(x,v);t=this._getAdjacentVertices(x+1,v);r=e.relatedGraphic.geometry.getPoint(e.segIndex,w[0]);u=e.relatedGraphic.geometry.getPoint(e.segIndex,w[1]);w=new n({x:(r.x+u.x)/2,y:(r.y+u.y)/2,spatialReference:r.spatialReference.toJson()});
r=e.relatedGraphic.geometry.getPoint(e.segIndex,t[0]);u=e.relatedGraphic.geometry.getPoint(e.segIndex,t[1]);t=new n({x:(r.x+u.x)/2,y:(r.y+u.y)/2,spatialReference:r.spatialReference.toJson()});r=new c(w,this._symbol2,this.graphic,e.segIndex,x,v,this,!0);e=new c(t,this._symbol2,this.graphic,e.segIndex,x+1,v,this,!0);y.splice(x,0,r,e)},_deleteVertex:function(e){var t,x=e.ptIndex,r=this._vertexMovers[e.segIndex];for(t=0;t<x;t++)--r[t].segLength;for(t=x+1;t<r.length;t++){var w=r[t];--w.ptIndex;--w.segLength}r.splice(x,
1);t=e._getInfo();e.destroy();this.toolbar.onVertexDelete(this.graphic,t)}});g.mixin(l,{create:function(e,t,x){switch(e.geometry.type){case "multipoint":return new l.MultipointVertexEditor(e,t,x);case "polyline":return new l.PolylineVertexEditor(e,t,x);case "polygon":return new l.PolygonVertexEditor(e,t,x)}}});l.MultipointVertexEditor=k(l,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=p.connect(c,"onMoveStart",this,this._moveStartHandler);
p.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);p.disconnect(this._moveStartHandle)},_getSegments:function(e){var t=e.points,x=[],r=e.spatialReference;for(e=0;e<t.length;e++){var w=t[e];x.push(new n({x:w[0],y:w[1],spatialReference:r.toJson()}))}return[x]},_getMidpointSegments:function(e){return[]},_getControlPoints:function(e,t,x,r,w){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(e){var t=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOver(t,
e._getInfo()),this._selectedMover=e,this._canDel&&this._bindCtxNode(e.graphic.getDojoShape().getNode())},_mouseOutHandler:function(e){var t=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOut(t,e._getInfo())},_findMover:function(e){var t=[].concat(this._vertexMovers[0]),x=e.target;for(e=0;e<t.length;e++){var r=t[e];if(r.graphic.getDojoShape().getNode()===x)return r}},_moveStartHandler:function(e){var t=e.ptIndex,x=e.segLength-1,r=e.relatedGraphic.geometry.points;e=r.splice(t,1);r.push(e[0]);
r=this._vertexMovers[0];for(e=x;e>t;e--)--r[e].ptIndex;e=r.splice(t,1);r.push(e[0]);e[0].ptIndex=x},_moveStopHandler:function(e){this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(e,t,x,r,w,u,v,y){e=t.geometry;y?e.removePoint(w):e.setPoint(w,x);t.setGeometry(e)},_deleteMidpoints:function(e){}});l.PolylineVertexEditor=k(l,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(e){var t,x,r=e.paths,w=[];for(t=0;t<r.length;t++){var u=r[t],v=[];for(x=0;x<u.length;x++)v.push(e.getPoint(t,x));w.push(v)}return w},_getMidpointSegments:function(e){var t,x,r=e.paths,w=[],u=e.spatialReference;for(t=0;t<r.length;t++){var v=r[t],y=[];for(x=0;x<v.length-1;x++){var z=e.getPoint(t,x),B=e.getPoint(t,x+1);z=new n({x:(z.x+B.x)/2,y:(z.y+B.y)/2,spatialReference:u.toJson()});y.push(z)}w.push(y)}return w},_getControlPoints:function(e,t,x,r,w){var u=this.map,v,y;this._isNew(e)?
(e=r,r+=1,0<=e&&(v=u.toScreen(t.getPoint(x,e))),r<=w&&(y=u.toScreen(t.getPoint(x,r)))):(e=r-1,r+=1,0<=e&&(v=u.toScreen(t.getPoint(x,e))),r<w&&(y=u.toScreen(t.getPoint(x,r))));return[v,y]},_getAdjacentMidpoints:function(e,t){var x=[],r=e-1;0<=r&&x.push(r);e<t-1&&x.push(e);return x},_getAdjacentVertices:function(e,t){return[e,e+1]},_deleteMidpoints:function(e){var t=this._mpVertexMovers[e.segIndex],x=t.length-1,r=this._getAdjacentMidpoints(e.ptIndex,e.segLength).sort(),w,u=r[0];for(w=0;w<u;w++)--t[w].segLength;
for(w=u+1;w<t.length;w++){var v=t[w];--v.ptIndex;--v.segLength}if(1===r.length)t.splice(u,1)[0].destroy();else for(v=this._getAdjacentVertices(u,x),w=e.relatedGraphic.geometry.getPoint(e.segIndex,v[0]),v=e.relatedGraphic.geometry.getPoint(e.segIndex,v[1]),w=new n({x:(w.x+v.x)/2,y:(w.y+v.y)/2,spatialReference:w.spatialReference.toJson()}),e=new c(w,this._symbol2,this.graphic,e.segIndex,u,x,this,!0),t=t.splice(u,r.length,e),w=0;w<t.length;w++)t[w].destroy()},_updateRelatedGraphic:function(e,t,x,r,w,
u,v,y){e=t.geometry;v?e.insertPoint(r,w+1,m.fromJson(x.toJson())):y?e.removePoint(r,w):e.setPoint(r,w,m.fromJson(x.toJson()));t.setGeometry(e)}});l.PolygonVertexEditor=k(l,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(e){var t,x,r=e.rings,w=[];for(t=0;t<r.length;t++){var u=r[t],v=[];for(x=0;x<u.length-1;x++)v.push(e.getPoint(t,x));w.push(v)}return w},_getMidpointSegments:function(e){var t,x,r=e.rings,w=[],u=e.spatialReference;for(t=0;t<r.length;t++){var v=r[t],
y=[];for(x=0;x<v.length-1;x++){var z=e.getPoint(t,x),B=e.getPoint(t,x+1);z=new n({x:(z.x+B.x)/2,y:(z.y+B.y)/2,spatialReference:u.toJson()});y.push(z)}w.push(y)}return w},_getControlPoints:function(e,t,x,r,w){var u=this.map;this._isNew(e)?e=r:(e=r-1,e=0>e?(w+e)%w:e);r=(r+1)%w;w=u.toScreen(t.getPoint(x,e));t=u.toScreen(t.getPoint(x,r));return[w,t]},_getAdjacentMidpoints:function(e,t){var x=e-1;return[0>x?(t+x)%t:x,e]},_getAdjacentVertices:function(e,t){return[e,(e+1)%t]},_deleteMidpoints:function(e){var t=
e.ptIndex,x=this._mpVertexMovers[e.segIndex],r=x.length-1,w=this._getAdjacentMidpoints(t,e.segLength).sort();var u=w[0];var v=w[w.length-1];if(0===t){var y=this._getAdjacentVertices(r-1,r);t=e.relatedGraphic.geometry.getPoint(e.segIndex,y[0]);y=e.relatedGraphic.geometry.getPoint(e.segIndex,y[1]);t=new n({x:(t.x+y.x)/2,y:(t.y+y.y)/2,spatialReference:t.spatialReference.toJson()});e=new c(t,this._symbol2,this.graphic,e.segIndex,r-1,r,this,!0);x.splice(v,1,e)[0].destroy();x.splice(u,1)[0].destroy();for(w=
0;w<x.length-1;w++)u=x[w],--u.ptIndex,--u.segLength}else{y=this._getAdjacentVertices(u,r);t=e.relatedGraphic.geometry.getPoint(e.segIndex,y[0]);y=e.relatedGraphic.geometry.getPoint(e.segIndex,y[1]);t=new n({x:(t.x+y.x)/2,y:(t.y+y.y)/2,spatialReference:t.spatialReference.toJson()});e=new c(t,this._symbol2,this.graphic,e.segIndex,u,r,this,!0);v=x.splice(u,w.length,e);for(w=0;w<v.length;w++)v[w].destroy();for(w=0;w<u;w++)--x[w].segLength;for(w=u+1;w<x.length;w++)u=x[w],--u.ptIndex,--u.segLength}},_updateRelatedGraphic:function(e,
t,x,r,w,u,v,y){e=t.geometry;v?e.insertPoint(r,w+1,m.fromJson(x.toJson())):y?(e.removePoint(r,w),0===w&&e.setPoint(r,u-1,m.fromJson(e.getPoint(r,0).toJson()))):(e.setPoint(r,w,m.fromJson(x.toJson())),0===w&&e.setPoint(r,u,m.fromJson(x.toJson())));t.setGeometry(e)}});g.setObject("toolbars._GraphicVertexEditor",l,a);g.setObject("toolbars._MultipointVertexEditor",l.MultipointVertexEditor,a);g.setObject("toolbars._PolylineVertexEditor",l.PolylineVertexEditor,a);g.setObject("toolbars._PolygonVertexEditor",
l.PolygonVertexEditor,a);return l})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l){k=k(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(e,t,x,r,w,u,v,y){this.point=e;this.symbol=t;this.relatedGraphic=x;this.segIndex=r;this.ptIndex=
w;this.segLength=u;this.editor=v;this.map=v.map;this._scratchGL=v.toolbar._scratchGL;this._placeholder=y||!1;this._type=x.geometry.type;this._init();this._enable()},refresh:function(e){if(e||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var e=new m(this.point.toJson());
e=new q(e,this.symbol);switch(this._type){case "multipoint":e._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(e)}this.graphic=e},_enable:function(){var e=this.graphic.getDojoShape();e&&(e._hasMover=!0,this._moveable=this._getMoveable(e),(e=e.getEventSource())&&h.set(e,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var e=this._moveable;if(e){p.disconnect(this._startHandle);
p.disconnect(this._firstHandle);p.disconnect(this._movingHandle);p.disconnect(this._stopHandle);var t=e.shape;t&&(t=t.getEventSource())&&h.set(t,"cursor","inherit");e.destroy();this._moveable=null}},_needRefresh:function(){var e=this.graphic.getDojoShape(),t=!1;if(e)switch(this._type){case "multipoint":var x=this.relatedGraphic.getDojoShape();x&&(x=x.children[this.ptIndex],e!==x&&(this.graphic._shape=x,t=!0));break;case "polyline":case "polygon":t=!e._hasMover}return t},_getMoveable:function(e){e=
new f(e,b("mac")&&b("ff")&&!n("esri-touch")&&{leftButtonOnly:!0});this._startHandle=p.connect(e,"onMoveStart",this,this._moveStartHandler);this._firstHandle=p.connect(e,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=p.connect(e,"onMoving",this,this._movingHandler);this._stopHandle=p.connect(e,"onMoveStop",this,this._moveStopHandler);return e},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(e){var t=this.map;t.snappingManager&&t.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();e.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(e){var t=e.shape,x=this._getControlEdges(),r=this._scratchGL._div,w,u=[],v=e.host.shape._wrapOffsets[0]||
0;for(w=0;w<x.length;w++){var y=x[w];y.x1+=v;y.x2+=v;u.push([r.createLine({x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2}).setStroke(this.editor._lineStroke),y.x1,y.y1,y.x2,y.y2])}t._lines=u;e.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(e,t,x){t=this.map;var r;n("esri-pointer")?r=t.navigationManager.pointerEvents._processTouchEvent(x,x):x&&"pointermove"===x.type&&(r=c.prototype._processTouchEvent.call({map:t},
x,x));r&&t.snappingManager&&t.snappingManager._onSnappingMouseMoveHandler(r);x=e.shape;e=x.getTransform();x=x._lines;for(r=0;r<x.length;r++)t=x[r],t[0].setShape({x1:t[1]+e.dx,y1:t[2]+e.dy,x2:t[3],y2:t[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),e)},_moveStopHandler:function(e){e=e.shape;var t=this.editor.toolbar,x=e.getTransform(),r=this.map,w=this.graphic,u=t._geo?l.geographicToWebMercator(w.geometry):w.geometry;t._activateScrollWheel();var v,y=e._lines;if(y){for(v=
0;v<y.length;v++)y[v][0].removeShape();e._lines=null}v=!1;y=!0;var z=this._getInfo();x&&(x.dx||x.dy)?this._placeholder&&(this._placeholder=!1,v=!0):y=!1;if(r.snappingManager)var B=r.snappingManager._snappingPoint;var C=[x,d.invert(this._startTx)];B=B||r.toMap(d.multiplyPoint(C,r.toScreen(u,!0)));r.snappingManager&&r.snappingManager._killOffSnapping();e.setTransform(null);w.setGeometry(t._geo?l.webMercatorToGeographic(B,!0):B);this.constructor.onMoveStop(this,x);t.onVertexMoveStop(this.relatedGraphic,
z,x);if(!y)t.onVertexClick(this.relatedGraphic,z);if(v)t.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var e=this.map,t=this.relatedGraphic.geometry,x=this.segIndex,r=this.ptIndex,w=this.segLength,u=this._scratchGL.getNavigationTransform(),v=u.dx;u=u.dy;var y=e.toScreen(this.graphic.geometry);e=y.x-v;y=y.y-u;var z=[];t=this.editor._getControlPoints(this,t,x,r,w);t[0]&&z.push({x1:e,y1:y,x2:t[0].x-v,y2:t[0].y-u});t[1]&&z.push({x1:e,y1:y,x2:t[1].x-v,y2:t[1].y-u});return z}});
g.setObject("toolbars.VertexMover",k,a);g.mixin(k,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return k})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(k,g,p,b,h,f,d,a,c,n){k=k(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(m,q,l){this._graphic=m;this._map=q;this._toolbar=l;this._enable(this._graphic)},
destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(m){this._editBox?(p.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=p.connect(m.getLayer(),"onDblClick",this,function(q){this._map.navigationManager.setImmediateClick(!1);q.graphic==m&&(b.stop(q),p.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(m))}))},_disable:function(){this._applyEdit();
this._addEditBoxHandler&&(p.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(m,q){if(!this._editBox){if(!m.symbol.text){m.symbol.text="Tempt text";m.setSymbol(m.symbol);var l=""}var e=this._createInputTextStyle(m,this._map);""!==l&&(l=q||m.symbol.text);this._editBox=f.create("input",{type:"text",value:l});a.set(this._editBox,e);d.add(this._editBox,"esriTextEditorInput");
this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=p.connect(this._editBox,"onkeyup",g.hitch(this,function(x){x.keyCode!=c.ENTER&&x.keyCode!==c.TAB||this._disable()}));this._editBoxBlurHandler=p.connect(this._editBox,"onblur",g.hitch(this,function(x){this._disable()}));m.symbol.text="";m.setSymbol(m.symbol);m.hide();var t=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",g.hitch(this,function(){this._disable()})));this._moveBoxHandler=
this._map.on("pan",function(x){a.set(t,{left:this._editBoxLeft+x.delta.x+"px",top:this._editBoxTop+x.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(a.get(t,"left"));this._editBoxTop=parseFloat(a.get(t,"top"))});this.onEditStart(m,this._editBox);this._toolbar.onTextEditStart(m,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(p.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),
this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(p.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(m,q){q=m.getDojoShape().getTransformedBoundingBox();var l=m.getLayer();l=l.hasLocalNavigationTransform()?
{dx:0,dy:0}:l.getNavigationTransform();var e=m.symbol.font;return{"font-family":e.family,"font-size":e.size+"px","font-style":e.style,"font-variant":e.variant,"font-weight":e.weight,left:q[0].x+l.dx+"px",top:q[0].y+l.dy+"px",width:Math.abs(q[0].x-q[1].x)/Math.cos(m.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var m=this._graphic.symbol;m.text=this._editBox.value;this._graphic.setSymbol(m)}else this._graphic.getLayer().remove(this._graphic)}});
g.setObject("toolbars.TextEditor",k,n);return k})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(k,g,p,b,h,f){g=g(f,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(d){d=d||{};d.featureLayer&&(this._featureLayer=d.featureLayer,d.addedGraphics&&(this._addedGraphics=d.addedGraphics))},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,
this._addedGraphics,d,a)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(p.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var d=k.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(p.hitch(this,function(a,c,n){a=k.map(a,function(m){return m.objectId});return{oldIds:d,addedIds:a,layer:this._featureLayer,
operation:this}}))}});p.setObject("dijit.editing.Add",g,h);return g})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(k,g,p,b,h){g=g(h,{declaredClass:"esri.EditOperationBase",updateIds:function(f,d,a,c){k.forEach(d,function(n,m){var q=n[f.objectIdField];k.forEach(a,function(l,e){q===l&&(n[f.objectIdField]=c[e])})})}});return b.EditOperationBase=g})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(k,g,p,b,h,f,d){k=g(d,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(a){var c;a=a||{};if(a.featureLayer&&(this._featureLayer=a.featureLayer,a.preUpdatedGraphics)){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);
if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],c=0;c<a.postUpdatedGraphics.length;c++)a.postUpdatedGraphics[c].geometry?this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry),this._postUpdatedGraphicsAttributes.push(p.clone(a.postUpdatedGraphics[c].attributes))}},updateObjectIds:function(a,
c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._preUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._preUpdatedGraphicsGeometries[a]),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(p.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._postUpdatedGraphicsGeometries[a]),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(p.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});p.setObject("dijit.editing.Update",k,h);return k})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(k,g,p,b,h,f){g=g(f,{declaredClass:"esri.dijit.editing.Delete",type:"edit",label:"Delete Features",constructor:function(d){d=d||{};
d.featureLayer&&(this._featureLayer=d.featureLayer,d.deletedGraphics&&(this._deletedGraphics=d.deletedGraphics))},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,this._deletedGraphics,d,a)},performUndo:function(){var d=k.map(this._deletedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(p.hitch(this,function(a,c,n){a=k.map(a,function(m){return m.objectId});return{oldIds:d,addedIds:a,
layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(p.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});p.setObject("dijit.editing.Delete",g,h);return g})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(k,g,p,b,h,f,d){g=g(d,{declaredClass:"esri.dijit.editing.Cut",
type:"edit",label:"Cut Features",constructor:function(a){var c;a=a||{};if(a.featureLayer&&(this._featureLayer=a.featureLayer,a.addedGraphics&&(this._addedGraphics=a.addedGraphics,a.preUpdatedGraphics))){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=
a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],c=0;c<a.postUpdatedGraphics.length;c++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(p.clone(a.postUpdatedGraphics[c].attributes))}},updateObjectIds:function(a,c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,
this._addedGraphics,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._addedGraphics).then(p.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])),
this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);var c=k.map(this._addedGraphics,function(n){return n.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,this._postUpdatedGraphics,null).then(p.hitch(this,function(n,m,q){n=k.map(n,function(l){return l.objectId});return{oldIds:c,addedIds:n,layer:this._featureLayer,operation:this}}))}});p.setObject("dijit.editing.Cut",g,h);return g})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(k,g,p,b,h,f,d){g=g(d,{declaredClass:"esri.dijit.editing.Union",type:"edit",label:"Union Features",constructor:function(a){a=a||{};this._featureLayer=a.featureLayer;this._deletedGraphics=a.deletedGraphics;this._preUpdatedGraphics=a.preUpdatedGraphics;this._postUpdatedGraphics=a.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var c;for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);for(c=0;c<a.postUpdatedGraphics.length;c++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(p.clone(a.postUpdatedGraphics[c].attributes))},updateObjectIds:function(a,c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,
this._deletedGraphics,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);var c=k.map(this._deletedGraphics,function(n){return n.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(p.hitch(this,function(n,
m,q){n=k.map(n,function(l){return l.objectId});return{oldIds:c,addedIds:n,layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(p.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});p.setObject("dijit.editing.Union",g,h);return g})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r){k=k([a,f],{declaredClass:"esri.dijit.editing.toolbars.Drawing",
onShowAttributeInspector:function(){},_activateTool:function(w,u){this._settings.editor._activeTool=w;"EDITING"!==w&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==w&&this._settings.editor._hideAttributeInspector();"CLEAR"!==w&&this.inherited(arguments)},_initializeToolbar:function(){p.forEach(this._settings.layers,function(w){this._tbConnects.push(b.connect(w,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(w,u){this._tools.EDITING._activateTool(w,u.geometryType);
this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=d.getSelection(this._settings.layers);var w=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=w);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",0>=w);this._tools.ATTRIBUTES&&
this._tools.ATTRIBUTES.set("disabled",0>=w);this._tools.UNION&&this._tools.UNION.set("disabled",2>w)},_toolFinished:function(w){if("ATTRIBUTES"===w&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===w||"CUT"===w||"RESHAPING"===w||"EDITING"===w)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===w)this.onDelete();this._settings.editor._activeTool=null;this._updateUI()},_createTools:function(){this._tools.SELECT=
new t({settings:this._settings,onClick:g.hitch(this,"_activateTool","SELECT",!0),onFinished:g.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new c(g.mixin(x.selectClear,{settings:this._settings,onClick:g.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new c(g.mixin(e.attributes,{settings:this._settings,onClick:g.hitch(this,"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);
this._createSeparator();this._tools.EDITING=new l({settings:this._settings,onClick:g.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:g.hitch(this,"onApplyEdits"),onFinished:g.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new c(g.mixin(e.del,{settings:this._settings,onClick:g.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||
this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new n({settings:this._settings,onFinished:g.hitch(this,"_toolFinished","CUT"),onClick:g.hitch(this,"_activateTool","CUT",!0),onApplyEdits:g.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new m({settings:this._settings,onFinished:g.hitch(this,"_toolFinished","UNION"),onApplyEdits:g.hitch(this,"onApplyEdits")}),
this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new q({settings:this._settings,onClick:g.hitch(this,"_activateTool","RESHAPING",!0),onFinished:g.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:g.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new c(g.mixin(e.undo,{settings:this._settings,disabled:!0,onClick:g.hitch(this,function(){this._tools.UNDO.set("disabled",
!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new c(g.mixin(e.redo,{settings:this._settings,disabled:!0,onClick:g.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});g.setObject("dijit.editing.toolbars.Drawing",k,r);return k})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),
function(k,g,p,b,h,f,d,a,c){k=k([f],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(n,m){n&&n.settings&&(this._tools=[],this._tbConnects=[],this._initialize(n.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var n,m=this._tools;for(n in m)m.hasOwnProperty(n)&&c.isDefined(this._tools[n])&&this._tools[n].destroy();p.forEach(this._tbConnects,
b.disconnect);this.inherited(arguments)},activate:function(n){this._enabled=!0},deactivate:function(){var n;this._enabled=!1;this._geometryType=this._layer=null;var m=this._tools;for(n in m)m.hasOwnProperty(n)&&(this._tools[n].deactivate(),this._tools[n].setChecked(!1))},isEnabled:function(){return this._enabled},setActiveSymbol:function(n){this._activeSymbol=n},_getSymbol:function(){},_createTools:function(){},_initialize:function(n){this._settings=n;this._toolbar=n.drawToolbar;this._editToolbar=
n.editToolbar;this._initializeToolbar()},_activateTool:function(n,m){this._activeTool&&this._activeTool.deactivate();!0===m&&this._activeTool==this._tools[n]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[n],this._activeTool.setChecked(!0),this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new d)}});g.setObject("dijit.editing.toolbars.ToolbarBase",k,a);return k})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),
function(k,g,p,b,h,f){k=k([b,h],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){b.prototype.destroy.apply(this,arguments);h.prototype.destroy.apply(this,arguments)}});g.setObject("dijit.editing.tools.ButtonToolBase",k,f);return k})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],
function(k,g,p,b,h){k=k(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(f,d){f=f||{};g.mixin(this,f);this.label=this._label?h.widgets.editor.tools[this._label]:"";this._settings=f.settings;this._toolbar=f.settings.drawToolbar;this._editToolbar=f.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},
activate:function(f){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=f,this._toolbar&&this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(f){this._enabled=f;this._updateUI()},setChecked:function(f){this._checked=f},enable:function(f){this._updateUI()},
isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});g.setObject("dijit.editing.tools.ToolBase",k,b);return k})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e){k=k([l],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:m.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);p.forEach(this._cutConnects,b.disconnect);this._cutConnects=[];this._edits=[]},
_onDrawEnd:function(t){var x=this._cutLayers=p.filter(this._settings.layers,function(w){return"esriGeometryPolygon"===w.geometryType||"esriGeometryPolyline"===w.geometryType&&w.visible&&w._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(p.map(x,g.hitch(this,function(w){return b.connect(w,"onEditsComplete",g.hitch(this,function(u,v,y){if(this._settings.undoRedoManager){var z=this._settings.undoRedoManager;p.forEach(this._edits,g.hitch(this,function(B){z.add(new q({featureLayer:B.layer,
addedGraphics:B.adds,preUpdatedGraphics:B.preUpdates,postUpdatedGraphics:B.updates}))}),this)}this.onFinished()}))})));var r=new c;r.geometry=t;p.forEach(x,function(w,u){this._settings.editor._selectionHelper.selectFeatures([w],r,n.SELECTION_NEW,g.hitch(this,"_cutFeatures",w,r))},this)},_cutFeatures:function(t,x,r){if(r&&r.length){this._edits=[];var w=[];w.push(this._settings.geometryService.cut(d.getGeometries(r),x.geometry,g.hitch(this,"_cutHandler",t,r)));(new f(w)).addCallback(g.hitch(this,function(){this.onApplyEdits(this._edits)}))}},
_cutHandler:function(t,x,r){var w=[],u=[],v=p.map(x,function(B){return new a(g.clone(B.toJson()))}),y,z;p.forEach(r.cutIndexes,function(B,C){y!=B?(y=B,u.push(x[B].setGeometry(r.geometries[C]))):(z=new a(r.geometries[C],null,g.mixin({},x[B].attributes),null),z.attributes[x[0].getLayer().objectIdField]=null,w.push(z))},this);this._edits.push({layer:t,adds:w,updates:u,preUpdates:v})}});g.setObject("dijit.editing.tools.Cut",k,e);return k})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(k,g,p,b,h,f){k=k([b,h],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){b.prototype.destroy.apply(this,arguments);h.prototype.destroy.apply(this,arguments)},setChecked:function(d){b.prototype.setChecked.apply(this,arguments)}});g.setObject("dijit.editing.tools.ToggleToolBase",k,f);return k})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(k,g,p,b,h,f,d,a,c,n){k=k([c],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:d.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(m){this._settings.editor._activeTool="UNION";m=p.filter(this._settings.layers,function(e){return"esriGeometryPolygon"===e.geometryType&&e.visible&&e._isMapAtVisibleScale()});var q=[],l=0;p.forEach(m,function(e,t){var x=e.getSelectedFeatures();2<=
x.length&&(l++,this._settings.geometryService.union(h.getGeometries(x),g.hitch(this,function(r){var w=x.shift(),u=[],v=[];u.push(new f(w.toJson()));v.push(w.setGeometry(r));q.push({layer:e,updates:v,deletes:x,preUpdates:u});l--;if(0>=l)this.onApplyEdits(q,g.hitch(this,function(){if(this._settings.undoRedoManager){var y=this._settings.undoRedoManager;p.forEach(this._edits,g.hitch(this,function(z){y.add(new a({featureLayer:z.layer,deletedGraphics:z.deletes,preUpdatedGraphics:z.preUpdates,postUpdatedGraphics:z.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});g.setObject("dijit.editing.tools.Union",k,n);return k})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(k,g,p,b,h,f,d,a,c,n,m){k=k([n],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:c.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){b.disconnect(this._rConnect);this._rConnect=b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);b.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(q){var l=this._settings.layers,e=new a;e.geometry=q;q=this._reshapeLayers=p.filter(l,
function(t){return"esriGeometryPolygon"===t.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(q,e,d.SELECTION_NEW,g.hitch(this,"_reshape",e))},_reshape:function(q,l){if(1===l.length){var e=[],t=[],x=[],r=l[0],w=r.getLayer();this._settings.geometryService.reshape(r.geometry,q.geometry,g.hitch(this,function(u){"polyline"===u.type&&u.paths&&0===u.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===u.type&&u.rings&&
0===u.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(x.push(new f(r.toJson())),t.push(r.setGeometry(u)),e.push({layer:w,updates:t,preUpdates:x}),this.onApplyEdits(e,g.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});g.setObject("dijit.editing.tools.Reshape",k,m);return k})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(k,g,p,b,h,f,d,a,c,n){k=k([a],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(m,q){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=h.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(m,q){var l;this.enable(q);for(l in this._tools)this._tools.hasOwnProperty(l)&&(this.dropDown.removeChild(this._tools[l]),
!0===this._tools[l]._enabled&&this.dropDown.addChild(this._tools[l]));if(this._geometryType!==q||!1===this._activeTool._enabled)this._activeTool=this._tools[m.toUpperCase()];this._geometryType=q;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(m){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var m=this._settings.layers,q=this._settings.editor,l=!1,e=!1,t=!1,x=this._toolTypes=[],r;p.forEach(m,function(w){r=w.geometryType;
l=l||"esriGeometryPoint"===r;e=e||"esriGeometryPolyline"===r;t=t||"esriGeometryPolygon"===r;x=x.concat(p.map(this._getTemplatesFromLayer(w),g.hitch(this,function(u){return q._toDrawTool(u.drawingTool,w)})))},this);m=this._settings.createOptions;l&&this._toolTypes.push("point");e&&(this._toolTypes=this._toolTypes.concat(m.polylineDrawTools));t&&(this._toolTypes=this._toolTypes.concat(m.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(x))},_toUnique:function(m){var q={};return p.filter(m,
function(l){return q[l]?!1:q[l]=!0})},_getTemplatesFromLayer:function(m){var q=m.templates||[];p.forEach(m.types,function(l){q=q.concat(l.templates)});return p.filter(q,n.isDefined)},_createTools:function(){p.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(m){var q=g.mixin(d[m],{settings:this._settings,onClick:g.hitch(this,"onItemClicked",d[m].id)});this._tools[m.toUpperCase()]=new f(q)}});g.setObject("dijit.editing.tools.Editing",k,c);return k})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(k,g,p,b,h){k=k([b],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(f){this._enabled=f===this._geomType;this.inherited(arguments)}});g.setObject("dijit.editing.tools.Edit",k,h);return k})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),function(k,g,p,b,h,f){k=k([b,h],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",
destroy:function(){b.prototype.destroy.apply(this,arguments);h.prototype.destroy.apply(this,arguments)}});g.setObject("dijit.editing.tools.MenuItemBase",k,f);return k})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(k,g,p,b){g={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",_drawType:p.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},
polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:p.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:p.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",
_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:p.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:p.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:p.POLYGON,
_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:p.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:p.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",
_drawType:p.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:p.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:p.LEFT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",
_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:p.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:p.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",_drawType:p.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},
triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:p.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",
_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};k.setObject("dijit.editing.tools.EditingTools",g,b);return g})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(k,g,p,b,h,f,d,a,c,n){k=k([d,a],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var m,q=this._tools;for(m in q)q.hasOwnProperty(m)&&n.isDefined(q[m])&&q[m].destroy();this.inherited(arguments)},_createTools:function(){var m,q=new f;this.dropDown=q;for(m in this._tools)this._tools.hasOwnProperty(m)&&q.addChild(this._tools[m]);
this._activeTool=q.getChildren()[0];this._updateUI()},activate:function(m){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(m){for(var q in this._tools)this._tools.hasOwnProperty(q)&&this._tools[q].enable(m);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(m){this._checked=m;this._updateUI()},_onDrawEnd:function(m){},
onLayerChange:function(m,q,l){this._activeTool=null;this._activeType=q;this._activeTemplate=l;this._activeLayer=m},onItemClicked:function(m,q){this._activeTool&&this._activeTool.deactivate();this._activeTool=h.byId(m);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(m){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
b.set(this.focusNode,{outline:"none"});b.set(this.titleNode,{padding:"0px",border:"none"});this._checked?b.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):b.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});g.setObject("dijit.editing.tools.DropDownToolBase",k,c);return k})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l){k=k([q],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);b.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(e){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var t=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(t,e,this._selectMethod,g.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new d(d.STYLE_CIRCLE,10,new a(a.STYLE_SOLID,new h([0,0,0]),1),new h([255,0,0,.5]));this._polylineSelectionSymbol=new a(a.STYLE_SOLID,new h([0,200,255]),2);this._polygonSelectionSymbol=new c(c.STYLE_SOLID,new a(a.STYLE_SOLID,
new h([0,0,0]),1),new h([0,200,255,.5]))},_initializeLayers:function(){p.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(e){var t=null;switch(e.geometryType){case "esriGeometryPoint":t=this._pointSelectionSymbol;break;case "esriGeometryPolyline":t=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":t=this._polygonSelectionSymbol}e.setSelectionSymbol(e._selectionSymbol||t)},_createTools:function(){p.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(e){var t=g.mixin(m[e],{settings:this._settings,onClick:g.hitch(this,"onItemClicked",m[e].id)});this._tools[e.toUpperCase()]=new n(t)}});g.setObject("dijit.editing.tools.Selection",k,l);return k})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(k,g,p,b,h){g={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:b.EXTENT,_selectMethod:p.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:b.EXTENT,_selectMethod:p.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:b.EXTENT,_selectMethod:p.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};k.setObject("dijit.editing.tools.SelectionTools",g,h);return g})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q){k=k(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(l){this._settings=l||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var l in this._sConnects)this._sConnects.hasOwnProperty(l)&&p.disconnect(this._sConnects[l])},selectFeatures:function(l,e,t,x){t===n.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(l));var r=[];b.forEach(l,function(w){if(!0===w.visible&&!0===w._isMapAtVisibleScale()){var u=t;w._isSelOnly&&u===n.SELECTION_NEW&&(u=n.SELECTION_ADD);r.push(w.selectFeatures(e,u))}});(new f(r)).addCallback(g.hitch(this,function(w){var u=[];b.forEach(w,function(v,y){b.forEach(v[1],function(z){(z=l[y]._mode._getFeature(z.attributes[l[y].objectIdField])||null)&&u.push(z)},this)},this);this._mapServiceCount?((w=t===n.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(l))):
this._createLayerDefs(this._getLayerInfosFromFeatures(u)),this._updateLayerDefs(this._mapServiceInfos,!1,!(u&&u.length||w),g.hitch(this,x,u))):x(u)}))},selectFeaturesByGeometry:function(l,e,t,x){var r=e;-1!==e.declaredClass.indexOf("Extent")&&e.xmax===e.xmin&&e.ymax===e.ymin&&(r=new a(e.xmax,e.ymax,e.spatialReference));r=-1!==r.declaredClass.indexOf("Point")?this._extentFromPoint(r):r;e=new m;e.geometry=r;this.selectFeatures(l,e,t,x)},clearSelection:function(l){b.forEach(this._nonSelOnlyLayers,function(t){t.clearSelection&&
t.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var e=this._getLayerInfosFromSelection(this._settings.layers);b.some(e,function(t){return t.oids&&t.oids.length})&&(this._createLayerDefs(e),this._updateLayerDefs(this._mapServiceInfos,!0,l||!1))}},findMapService:function(l){var e=this._map,t=e.layerIds;l=l&&l._url&&l._url.path?l._url.path.toLowerCase():"";var x;for(x in t)if(t.hasOwnProperty(x)){var r=e.getLayer(t[x]);var w=r._url?r._url.path?r._url.path.toLowerCase().replace("mapserver",
"featureserver"):r._url.toLowerCase().replace("mapserver","featureserver"):"";if(l.substr(0,w.length)===w&&"esri.layers.ArcGISDynamicMapServiceLayer"===r.declaredClass)return r}},getSelection:function(l){var e=[];b.forEach(l,function(t){t._isSelOnly&&e.push(this._createLayerInfo(t))},this);b.forEach(e,function(t){var x=this._createMapServiceInfo(this.findMapService(t.layer));x&&(x.layerInfos[t.layer.layerId]=t)},this)},_initMapServiceInfos:function(l){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];b.forEach(l,function(e){var t=this.findMapService(e);t?(this._mapServiceCount++,this._createMapServiceInfo(t),t&&t.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(e)},this)},_createMapServiceInfo:function(l){if(!l)return null;var e=this._mapServiceInfos,t=e[l.id];t||(t=e[l.id]={mapService:l,layerInfos:[],layerDefs:g.mixin([],l.layerDefinitions||[]),origLayerDefs:g.mixin([],l.layerDefinitions||[])});return t},_resetMapServiceInfo:function(l){b.forEach(l.layerInfos,this._resetLayerInfo);
l.layerDefs=g.mixin([],l.origLayerDefs||[])},_resetMapServiceInfos:function(){var l=this._mapServiceInfos,e;for(e in l)l.hasOwnProperty(e)&&this._resetMapServiceInfo(l[e])},_createLayerInfo:function(l,e){var t=l.objectIdField;e=e?[]:l.getSelectedFeatures();return{layer:l,selectedFeatures:e||[],oids:b.map(e,function(x){return x.attributes[t]})}},_resetLayerInfo:function(l){l&&(l.selectedFeatures=[],l.oids=[])},_updateLayerDefs:function(l,e,t,x){for(var r in l)if(l.hasOwnProperty(r)){var w=l[r],u=w.mapService,
v=w.layerDefs=e?g.mixin([],w.origLayerDefs||[]):w.layerDefs;v?(t?x&&x():this._sConnects[u.id]=p.connect(u,"onUpdateEnd",g.hitch(this,"_onMapServiceUpdate",w,e,x)),u.setLayerDefinitions(v,t||!1)):x&&x()}},_onMapServiceUpdate:function(l,e,t){p.disconnect(this._sConnects[l.mapService.id]);b.forEach(l.layerInfos,function(x){if(e)x&&x.layer.clearSelection();else{var r=new m;r.objectIds=x?x.oids:[];r.objectIds.length&&x.layer.selectFeatures(r,n.SELECTION_SUBTRACT)}},this);e&&this._resetMapServiceInfo(l);
t&&t()},_createLayerDefs:function(l){b.forEach(l,function(e){var t=e.layer,x=this._createMapServiceInfo(this.findMapService(e.layer));if(x){x=x.layerDefs;var r=t.layerId,w='("'+t.objectIdField+'" NOT IN (',u=e.oids;u&&u.length&&(b.forEach(e.oids,function(v,y){u=!0;y&&(w+=",");w+="'"+v+"'"}),w+="))",x[r]=x.length&&x[r]&&x[r].length?x[r]+(" AND"+w):w)}},this)},_getLayerInfosFromFeatures:function(l){var e=[];b.forEach(l,function(x){var r=x.getLayer();r&&r._isSelOnly&&(e[r.id]||(e[r.id]=this._createLayerInfo(r,
!0)),e[r.id].selectedFeatures.push(x),e[r.id].oids.push(x.attributes[r.objectIdField]))},this);l=[];for(var t in e)e.hasOwnProperty(t)&&l.push(e[t]);return l},_getLayerInfosFromSelection:function(l){var e=[];b.forEach(l,function(t){t._isSelOnly&&e.push(this._createLayerInfo(t,!1))},this);return e},_extentFromPoint:function(l){var e=this._tolerance,t=this._map,x=t.toScreen(l);l=new c(x.x-e,x.y+e);e=new c(x.x+e,x.y-e);l=t.toMap(l);e=t.toMap(e);return new d(l.x,l.y,e.x,e.y,t.spatialReference)}});g.setObject("dijit.editing.SelectionHelper",
k,q);return k})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u){var v=k([w,q,l,e,r],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,
templateString:u,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(y){this.inherited(arguments);n.place(this.domNode,y.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[v.ANCHOR_UPPERRIGHT,v.ANCHOR_LOWERRIGHT,v.ANCHOR_LOWERLEFT,v.ANCHOR_UPPERLEFT];if(7>f("ie")){var y="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
m.getComputedStyle(this._sprite).backgroundImage.replace(/url\("/i,"").replace(/"\)/,"")+"')",z=n.create("div",null,b.body());m.set(z,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:y});var B=setTimeout(function(){n.destroy(z);clearTimeout(B);B=z=null},100);h.query(".sprite",this.domNode).forEach(function(C){C.style.backgroundImage="none";C.style.filter=y})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(y,z){if(y&&z){var B=m.set;B(this._topleft,{height:z+"px",marginLeft:y+"px"});B(this._topright,{width:y+"px",height:z+"px"});B(this._user,"width",y-8+"px");B(this._hide,"marginLeft",y-22+"px");B(this._title,"width",y-25+"px");B(this._content,"height",z-37+"px");B(this._bottomleft,{marginLeft:y+"px",marginTop:z+"px"});B(this._bottomright,{width:y-
5+"px",marginTop:z+"px"});this.width=y;this.height=z;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(y,z)}},_adjustPosition:function(y,z){var B=m.set;B(this._infowindow,{left:Math.round(y.x)+"px",top:Math.round(y.y)+"px"});z===v.ANCHOR_UPPERLEFT?B(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):z===v.ANCHOR_UPPERRIGHT?B(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):z===v.ANCHOR_LOWERRIGHT?B(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):z===v.ANCHOR_LOWERLEFT&&B(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(y){var z=this.map;return z&&y?(y.y<z.height/2?"lower":"upper")+(y.x<z.width/2?"right":"left"):"upperright"},show:function(y,z,B){if(y){y.spatialReference?(this.mapCoords=y,y=this.coords=this.map.toScreen(y,!0)):(this.mapCoords=null,this.coords=y);var C=this.map._getFrameWidth();if(-1!==C&&(y.x%=C,0>y.x&&(y.x+=C),this.map.width>C))for(var E=(this.map.width-
C)/2;y.x<E;)y.x+=C;z&&-1!==p.indexOf(this._ANCHORS,z)||(z=this._getAnchor(y));c.remove(this._pointer,this.anchor);z=this.anchor=this.fixedAnchor||z;this._adjustPosition(y,z);c.add(this._pointer,z);x.show(this.domNode);this.isShowing=!0;if(!B)this.onShow()}},hide:function(y,z){x.hide(this.domNode);this.isShowing=!1;if(!z)this.onHide()},showTitleBar:function(){x.show(this._titlebar);x.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){x.hide(this._titlebar);x.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){x.show(this._content);x.show(this._border);this.isContentShowing=!0},hideContent:function(){x.hide(this._content);x.hide(this._border);this.isContentShowing=!1},move:function(y,z){z?y=this.coords.offset(y.x,y.y):(this.coords=y,this.mapCoords&&(this.mapCoords=this.map.toMap(y)));m.set(this._infowindow,{left:Math.round(y.x)+"px",top:Math.round(y.y)+"px"})},setFixedAnchor:function(y){y&&-1===p.indexOf(this._ANCHORS,y)||(this.fixedAnchor=y,this.isShowing&&this.show(this.mapCoords||
this.coords,y),this.onAnchorChange(y))},setTitle:function(y){this.destroyDijits(this._title);this.__setValue("_title",y);return this},setContent:function(y){this.destroyDijits(this._content);this.__setValue("_content",y);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});g.mixin(v,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});g.setObject("dijit.InfoWindow",v,t);return v})},"esri/dijit/OverviewMap":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/has dojo/dom-class dojo/dom-style dojo/dnd/Moveable dijit/_Widget dijit/_Templated ../map ../geometry/Point ../geometry/ScreenPoint ../layers/TiledMapServiceLayer ../layers/DynamicMapServiceLayer ../layers/VectorTileLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/RasterXLayer ../layers/OpenStreetMapLayer ../virtualearth/VETiledLayer ../kernel ../config ../domUtils dojo/text!./templates/OverviewMap.html dojo/i18n!../nls/jsapi".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G){k=k([c,n],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:D,constructor:function(H,N){g.mixin(this,G.widgets.overviewMap);H=H||{};if(H.map){var O={};N&&(this._detached=!0,O=b.coords(N,!0));this.map=H.map;this.baseLayer=H.baseLayer;this.width=H.width||O.w||this.map.width/4;this.height=H.height||O.h||this.map.height/4;this.attachTo=H.attachTo||"top-right";this.expandFactor=H.expandFactor||2;this.color=H.color||
"#000000";this.opacity=H.opacity||.5;this.maximizeButton=!!H.maximizeButton;this.visible=!!H.visible;if(this.map.loaded)this._initialSetup();else var S=p.connect(this.map,"onLoad",this,function(){p.disconnect(S);S=null;this._initialSetup()});this._detached&&(this.visible=!0);this._maximized=!1}},startup:function(){this.inherited(arguments);(!this.domNode.parentNode||9>h("ie")&&"DIV"!==this.domNode.parentNode.nodeName)&&this.map.container.appendChild(this.domNode);this._detached?(d.set(this._body,
"display","block"),d.set(this._controllerDiv,"display","none"),d.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():p.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||f.add(this._maximizerDiv,"ovwDisabledButton"),f.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),f.add(this._controllerDiv,
"ovwShow"),f.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));d.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(H){!H||0>=H.w||0>=H.h||this._resize(H.w,H.h)},show:function(){if(!this.visible){var H=this._controllerDiv;H.title=this.NLS_hide;f.remove(H,"ovwShow");f.add(H,"ovwHide");E.show(this._body);
E.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var H=this._controllerDiv;H.title=this.NLS_show;f.remove(H,"ovwHide");f.add(H,"ovwShow");this._maximized&&this._maximizeHandler();E.hide(this._body);E.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var H=this.baseLayer||this._mainMapLayer,N=this.map.spatialReference,O=H.spatialReference;if(O.wkid===N.wkid||
O.wkt===N.wkt){N=H.declaredClass;if(H instanceof e)if(-1!==N.indexOf("VETiledLayer"))this.baseLayer=new z({resourceInfo:H.getResourceInfo(),culture:H.culture,mapStyle:H.mapStyle,bingMapsKey:H.bingMapsKey});else if(-1!==N.indexOf("OpenStreetMapLayer"))this.baseLayer=new y({tileServers:H.tileServers});else if(-1!==N.indexOf("WebTiledLayer")){N=H.initialExtent;O=H.fullExtent;var S=H.tileInfo;this.baseLayer=new H.constructor(H.urlTemplate,{initialExtent:N&&new N.constructor(N.toJson()),fullExtent:O&&
new O.constructor(O.toJson()),tileInfo:S&&new S.constructor(S.toJson()),tileServers:H.tileServers&&H.tileServers.slice(0)})}else this.baseLayer=new r(H.url,{resourceInfo:H.getResourceInfo()});else if(H instanceof t)-1!==N.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new u(H.url):(this.baseLayer=new w(H.url),this.baseLayer.setImageFormat("png24"));else if(H instanceof v)this.baseLayer=new v(H.url);else if(H instanceof x)this.baseLayer=new r("https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer",
{});else return;!this._detached&&this.visible&&this._controllerDiv&&(H=function(){this.visible=!1;this.show()},this.baseLayer.loaded?H.call(this):p.connect(this.baseLayer,"onLoad",this,H))}}},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var H=this._maximizerDiv;this._maximized?(H.title=this.NLS_maximize,f.remove(H,"ovwRestore"),f.add(H,"ovwMaximize"),this._resize(this.width,this.height)):(H.title=this.NLS_restore,f.remove(H,"ovwMaximize"),f.add(H,
"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(H,N){d.set(this._body,{width:H+"px",height:N+"px"});H=C.defaults.map.panDuration;N=this.overviewMap;C.defaults.map.panDuration=0;N&&(N.resize(!0),N.centerAt(this._focusExtent.getCenter()));C.defaults.map.panDuration=H},_initialize:function(){if(this.overviewMap)this._activate();else{var H;var N=9>h("ie")?this._body.firstChild:this._body.firstElementChild;this.overviewMap=H=new m(N,{slider:!1,
showAttribution:!1,logo:!1,lods:this._overviewLods,wrapAround180:this.map.wrapAround180});p.connect(H,"onLoad",this,function(){this._map_resize_override=g.hitch(H,this._map_resize_override);H.disableMapNavigation();this._activate()});H.addLayer(this.baseLayer)}},_activate:function(){var H=this.map,N=this.overviewMap;this._moveableHandle=new a(this._focusDiv);this._soeConnect=p.connect(H,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=p.connect(H,"onPan",this,this._updateFocus);this._oecConnect=
p.connect(N,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=p.connect(N,"onPan",this,this._ovwPanHandler);this._ozsConnect=p.connect(N,"onZoomStart",this,function(){E.hide(this._focusDiv)});this._ozeConnect=p.connect(N,"onZoomEnd",this,function(){E.show(this._focusDiv)});this._omsConnect=p.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(H.extent,null,null,null)},_deactivate:function(){p.disconnect(this._soeConnect);p.disconnect(this._ufoConnect);
p.disconnect(this._oecConnect);p.disconnect(this._opaConnect);p.disconnect(this._ozsConnect);p.disconnect(this._ozeConnect);p.disconnect(this._omsConnect);this._moveableHandle&&(this._moveableHandle.destroy(),this._moveableHandle=null)},_syncOverviewMap:function(H,N,O,S){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=H,this.overviewMap.setExtent(H.expand(this.expandFactor),!0))},_updateFocus:function(H){this._suspendPanHandling||(this._focusExtent=H,this._drawFocusDiv(H))},
_drawFocusDiv:function(H,N){var O=this.overviewMap,S=O.toScreen(new q(H.xmin,H.ymax,O.spatialReference));O=O.toScreen(new q(H.xmax,H.ymin,O.spatialReference));H=O.x-S.x;O=O.y-S.y;var da=!0;H>this.overviewMap.width&&O>this.overviewMap.height&&(da=!1);d.set(this._focusDiv,{left:S.x+(N?N.x:0)+"px",top:S.y+(N?N.y:0)+"px",width:H+"px",height:O+"px",display:da?"block":"none"})},_moveStopHandler:function(H){var N=this._moveableHandle.node.style;H=this._focusExtent;var O=this.overviewMap;N=O.toMap(new l(parseInt(N.left,
10),parseInt(N.top,10)));var S=new q(H.xmin,H.ymax,O.spatialReference);this._focusExtent=H.offset(N.x-S.x,N.y-S.y);this._maximized?this._maximizeHandler():O.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(H,N){this._drawFocusDiv(this._focusExtent,N)}});g.setObject("dijit.OverviewMap",k,B);return k})},"esri/layers/VectorTileLayer":function(){(function(){var k=
function(){try{var p=window.WebGLRenderingContext}catch(c){p=!1}try{for(var b=document.createElement("canvas"),h=["webgl","experimental-webgl","webkit-3d","moz-webgl"],f=null,d=0;d<h.length;++d){try{f=b.getContext(h[d])}catch(c){}if(f)break}var a=f}catch(c){a=!1}return p&&a?!0:!1}(),g=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];k&&g.push("./VectorTileLayerImpl");define(g,function(p,b,h,f,d,a){b=a?a:d.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var c=
new h;c.reject(Error("esri.layers.VectorTileLayer is not supported"));c.promise.otherwise(p.hitch(this,function(n){this._errorHandler(n)}))}});b.ACCESS_TOKEN=null;b.supported=function(){return k};p.setObject("layers.VectorTileLayer",b,f);return b})})()},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r){k={customDrivers:[],create:function(w){if(w){if(w.url){var u=l.urlToObject(w.url);var v=u.path;var y=u.query}u=w.serviceInfo;var z=w.rasterFxArgs||{},B=new b,C=p.hitch(this,function(H){this._trycustomDrivers(p.mixin({url:v},w),0,B)});if(v)if(-1===v.toLowerCase().indexOf("imageserver")&&-1===v.toLowerCase().indexOf("mapserver")){var E=new x(p.mixin({},w,{url:v}));w.rasterFx&&(E=new r({rasterFx:w.rasterFx,rasterFxArgs:p.mixin({},z,{raster:E})}));var D=E}else{D=
new b;u=u||this._getServiceInfo(v,y);var G=p.hitch(this,function(H){H.bandCount?E=H.capabilities&&-1<H.capabilities.toLowerCase().indexOf("tileonly")?new t(p.mixin({},{serviceInfo:H},y,w,{url:v})):new e(p.mixin({},{serviceInfo:H},y,w,{url:v})):H.tileInfo&&(E=new t(p.mixin({},{serviceInfo:H},y,this._options,{url:v})));w.rasterFx&&(E=new r({rasterFx:w.rasterFx,rasterFxArgs:p.mixin({},z,{raster:E})}));D.resolve(E)});a(u,G,C)}else D=E=new r({rasterFx:w.rasterFx,rasterFxArgs:p.mixin({},z,{raster:E})});
a(D,p.hitch(this,function(H){H?H.open().then(p.hitch(this,function(N){B.resolve(H)}),C):C(Error("There is no raster to open"))}),C);return B.promise}},register:function(w){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(u){return u.sourceType===w.prototype.sourceType}).length||this.customDrivers.push(w)},_trycustomDrivers:function(w,u,v){v=v||new b;var y=this.customDrivers[u];if(y){var z=new y(w);z.open().then(p.hitch(this,function(B){v.resolve(z)}),p.hitch(this,function(B){this._trycustomDrivers(w,
u+1,v)}))}else v.reject("cannot load layer "+(w&&w.url||""));return v.promise},_getServiceInfo:function(w,u){u=u||{};var v=u.bandIds;u=u.renderingRule;var y=new b(q._dfdCanceller),z={f:"json"};v&&(z.bandIds=v);u&&(z.renderingRule=u.toJson?JSON.stringify(u.toJson()):JSON.stringify(u));y._pendingDfd=m({url:w,content:z,handleAs:"json",callbackParamName:"callback"});y._pendingDfd.then(function(B){y.callback(B)},function(B){y.errback(B)});return y.promise}};p.setObject("layers.rasterLib.raster.rasterFactory",
k,c);return k})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E){k=g([B],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(D){D&&(this._imageServiceParams=D.imageServiceParameters,this._commonReqParams=D._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:D.interpolation,pixelType:D.pixelType,format:D.format||"lerc",compressionQuality:D.compressionQuality,bandIds:D.bandIds,noDataInterpretation:D.noDataInterpretation,
adjustAspectRatio:D.adjustAspectRatio,mosaicRule:D.mosaicRule,renderingRule:D.interpolation}))},open:function(){var D=new b;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),D.resolve(this),D.promise;var G=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),H=p.hitch(this,function(O){this.serviceInfo=O;this._findCredential();var S=this._parseRasterInfo(O),da=
{};O.defaultMosaicMethod?(da.method=O.defaultMosaicMethod,da.operation=O.mosaicOperator,da.sortField=O.sortField,da.sortValue=O.sortValue):da.method=u.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new u(da);this.serviceInfo.defaultMosaicRule.ascending=!0;O=this._getColormap(this);da=this._getHistograms(this);var J=this._getRasterAttributeTable(this),M=this._getKeyProperties(this),K=this._getMultidimensionalInfo(),R=this._getSlices();(new c([O,da,J,M,K,R])).then(p.hitch(this,function(X){X[0][0]&&
(S.colormap=X[0][1]);X[1][0]&&(S.histograms=X[1][1]);X[2][0]&&(S.vat=X[2][1]);X[3][0]&&(S.keyProperties=X[3][1]);X[4][0]&&(S.multidimensionalInfo=X[4][1]);this._slices=X[5][0]?X[5][1]:null;S.keyProperties&&S.keyProperties.DataType&&(this.dataType=S.keyProperties.DataType);this.loaded=!0;this.rasterInfo=S;this.setFetchParameters(this._imageServiceParams);D.resolve(this)}))}),N=p.hitch(this,function(O){this.loaded=!0;D.reject(O)});n(G,H,N);return D.promise},setFetchParameters:function(D,G){if(G)this.imageServiceParams=
D;else{var H=this.imageServiceParams;H&&D?Object.keys(D).forEach(function(N){H[N]=D[N]}):this.imageServiceParams=D}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(D){if(D.pixelBlock||D.texture){var G=new b;G.resolve(D);return G.promise}if(!1===D.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(D);var H=D.extent,N=H.spatialReference.wkid||d.toJson(H.spatialReference.toJson(!1)),O=D.timeExtent?D.timeExtent.toJson().join(","):null;G=this.url+"/exportImage";
var S={};this._slices&&(S.sliceid=this.sliceId||0);this.disableClientCaching&&(S._ts=(new Date).getTime());H=p.mixin({},this._commonReqParams,{bbox:H.xmin+","+H.ymin+","+H.xmax+","+H.ymax,imageSR:N,bboxSR:N,size:D.width+","+D.height,time:O},S);return this._requestPixels({url:G,payload:H,decodeParams:{width:D.width,height:D.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:D})},readTile:function(D){var G=this.tileBoundary&&this.tileBoundary[D.level];if(G&&(G.minRow>
D.row||G.maxRow<D.row||G.minCol>D.col||G.maxCol<D.col))return G=new b,G.resolve(D),G.promise;G=this.url+"/tile/"+D.level+"/"+D.row+"/"+D.col;var H={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===D.tileType.toLowerCase()?!0:!1},N=this._slices?"sliceid\x3d"+(this.sliceId||0)+"\x26":"";N=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():N.replace(/&$/,"");return this._requestPixels({url:G+(0<N.length?"?"+N:""),payload:{},
decodeParams:H,tileOptions:D})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},getSliceIndex:function(D){var G=null;if(null==this._slices||null==D)return 0;for(var H=0;H<this._slices.length;H++){var N=this._slices[H].multidimensionalDefinition;if(N.length===D.length&&!N.some(function(O){var S=D.filter(function(J){return O.variableName===
J.variableName&&J.dimensionName===O.dimensionName})[0];if(!S)return!0;var da=Array.isArray(O.values[0])?O.values[0][0]:O.values[0];S=Array.isArray(S.values[0])?S.values[0][0]:S.values[0];return da!==S})){G=H;break}}return G},_generateServiceInfo:function(D){var G=this.url,H=new b(r._dfdCanceller);H._pendingDfd=l({url:G,content:{f:"json",renderingRule:D?d.toJson(D.toJson()):null},handleAs:"json",callbackParamName:"callback"});H._pendingDfd.then(function(N){H.callback(N)},function(N){H.errback(N)});
return H},_parseRasterInfo:function(D){var G=new z;G.bandCount=D.bandCount;G.extent=new e(D.fullExtent);G.spatialReference=D.spatialReference;G.pixelType=D.pixelType;G.width=Math.floor((D.fullExtent.xmax-D.fullExtent.xmin)/D.pixelSizeX+.5);G.height=Math.floor((D.fullExtent.ymax-D.fullExtent.ymin)/D.pixelSizeY+.5);G.cellSize=new t({x:D.pixelSizeX,y:D.pixelSizeY,spatialReference:D.spatialReference});var H;if(D.minValues&&0<D.minValues.length&&D.maxValues&&D.stdvValues&&D.meanValues){var N=[];for(H=
0;H<D.minValues.length;H++)N.push({min:D.minValues[H],max:D.maxValues[H],mean:D.meanValues[H],stddev:D.stdvValues[H]});D.bandCount!==N.length&&(N=null)}this.dataType=D.serviceDataType?D.serviceDataType.replace("esriImageServiceDataType",""):"Generic";G.statistics=N;D.objectIdField&&D.fields&&(G.catalogInfo={objectIdField:D.objectIdField,fields:D.fields});G.timeInfo=D.timeInfo;if(D.tileInfo){this.tileInfo=new E(D.tileInfo);this.tileInfo.tileType=D.cacheType||"Map";G.tileInfo=this.tileInfo;var O=G.extent,
S=this.tileInfo.origin,da=this.tileInfo.cols,J=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(M){return{minCol:Math.floor((O.xmin-S.x+.1*M.resolution)/da/M.resolution),maxCol:Math.floor((O.xmax-S.x-.1*M.resolution)/da/M.resolution),minRow:Math.floor((S.y-O.ymax+.1*M.resolution)/J/M.resolution),maxRow:Math.floor((S.y-O.ymin-.1*M.resolution)/J/M.resolution)}})}return G},_getColormap:function(D){D=this.url+"/colormap";var G=new b(r._dfdCanceller),H={f:"json"},N=this.serviceInfo.hasColormap||
this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&N?(G._pendingDfd=l({url:D,content:H,handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(function(O){G.callback(O.colormap)},function(O){G.errback(O)})):G.callback(null);return G},_getHistograms:function(D){var G=this.url+"/histograms",H=new b(r._dfdCanceller),N={f:"json"},O=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;D&&D.renderingRule&&(N.renderingRule=d.toJson(D.renderingRule.toJson()),
O=!0);10<this.serviceInfo.currentVersion&&O?(H._pendingDfd=l({url:G,content:N,handleAs:"json",callbackParamName:"callback"}),H._pendingDfd.then(function(S){H.callback(S.histograms)},function(S){H.errback(S)})):H.callback(null);return H},_getRasterAttributeTable:function(D){var G=this.url+"/rasterAttributeTable",H=new b(r._dfdCanceller),N={f:"json"},O=this.serviceInfo.hasRasterAttributeTable;D&&D.renderingRule&&(N.renderingRule=d.toJson(D.renderingRule.toJson()),O=!0);10<this.serviceInfo.currentVersion&&
O?(H._pendingDfd=l({url:G,content:N,handleAs:"json",callbackParamName:"callback"}),H._pendingDfd.then(function(S){H.callback(S)},function(S){H.errback(S)})):H.callback(null);return H},_getKeyProperties:function(D){var G=this.url+"/keyProperties",H=new b(r._dfdCanceller),N={f:"json"};D&&D.renderingRule&&(N.renderingRule=d.toJson(D.renderingRule.toJson()));10<this.serviceInfo.currentVersion?(H._pendingDfd=l({url:G,content:N,handleAs:"json",callbackParamName:"callback"}),H._pendingDfd.then(function(O){H.callback(O)},
function(O){H.errback(O)})):H.callback(null);return H},_getMultidimensionalInfo:function(){var D=this.url+"/multidimensionalInfo",G=new b(r._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(G._pendingDfd=l({url:D,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(p.hitch(this,function(H){G.callback(H.multidimensionalInfo)}),function(H){G.errback(H)})):G.callback(null);return G},_getSlices:function(){var D=this.url+"/slices",
G=new b(r._dfdCanceller);this.serviceInfo.hasMultidimensions?(G._pendingDfd=l({url:D,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),G._pendingDfd.then(p.hitch(this,function(H){G.callback(H.slices)}),function(H){G.errback(H)})):G.callback(null);return G},_initializationFailed:function(){},_constructGetImageParams:function(){var D=this.imageServiceParams||{},G=p.mixin({},this._query,{f:"image",interpolation:D.interpolation,pixelType:D.pixelType,format:D.format||"lerc",compressionQuality:D.compressionQuality,
bandIds:D.bandIds?D.bandIds.join(","):null,noData:null!=D.noData?D.noData.join(","):null,noDataInterpretation:D.noDataInterpretation,adjustAspectRatio:null==D.adjustAspectRatio?null:D.adjustAspectRatio,mosaicRule:D.mosaicRule?d.toJson(D.mosaicRule.toJson()):null,renderingRule:D.renderingRule?d.toJson(D.renderingRule.toJson()):null,token:this.credential&&this.credential.token||null});"lerc"===G.format.toLowerCase()?(G.compressionTolerance=D.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&
(G.lercVersion=D.lercVersion||2)):"tiff"===G.format.toLowerCase()?G.compression=D.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(G.format.toLowerCase())&&(G.compression=D.compression);this._commonReqParams=G},_getRasterIdentifier:function(D){if(this._rasterId)return this._rasterId;D=this.url.replace("http:","").replace("https:","");var G=[],H=this.imageServiceParams||{};G.push(D);G.push(H.interpolation);G.push(H.pixelType);G.push(H.compressionQuality);G.push(H.bandIds?H.bandIds.join(","):"");
G.push(H.mosaicRule?d.toJson(H.mosaicRule.toJson()):"");G.push(H.renderingRule?d.toJson(H.renderingRule.toJson()):"");D=G.join("|");return this._rasterId=this._computeSignature(D)},_wrapExtent:function(D){var G=D.spatialReference._getInfo();if(G){var H=G.valid[0];G=G.valid[1];if(D.xmin<H-this.resolution.x||D.xmax>G+this.resolution.y){var N=new e((D.xmin-H)%(G-H),D.ymin,(D.xmax-G)%(G-H),D.ymax,D.spatialReference);N.xmax<N.xmin&&(N=null)}}return N||D}});p.setObject("layers.rasterLib.raster.ImageServiceRaster",
k,m);return k})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(k,g,p,b,h){return k(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,
cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(f){g.mixin(this,f);this.extent=this.extent?this.extent.toJson?this.extent:new p(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new b(this.spatialReference):null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new h(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,
extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?g.clone(this.colormap):null,attributeTable:this.attributeTable?g.clone(this.attributeTable):null,multiDimensionalInfo:this.multiDimensionalInfo?g.clone(this.multiDimensionalInfo):null,statistics:this.statistics?g.clone(this.statistics):null,histograms:this.histograms?
g.clone(this.histograms):null,catalogInfo:this.catalogInfo?g.clone(this.catalogInfo):null,keyProperties:this.keyProperties?g.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?g.clone(this.geodataXform):null}},
clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),function(k,g,p,b,h,f,d){return k([d],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,
c){if(a||c){var n=c&&c.refTileInfo;a?this.virtual=!1:(this.virtual=!0,g.mixin(this,{rows:c.rows||this.rows,cols:c.cols||this.cols,compressionQuality:c.compressionQuality||95,lercError:c.compressionTolerance||.01,spatialReference:c.spatialReference,origin:c.origin}),this.width=this.cols,this.height=this.rows,this.origin||(n?this.origin=n.origin:c.spatialReference.isWebMercator()||c.extent&&360<=Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:
-1<[4326,4269].indexOf(c.spatialReference.wkid)||360>Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:c.extent.xmin,y:c.extent.ymax}))}},toJson:function(){var a=d.prototype.toJson.apply(this);a.tileType=this.tileType;a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E){return g([q],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(D){if(D){var G=D.url;G&&(G=w.urlToObject(G),this.url=G.path,this._query=G.query);this.dataType=D.dataType;this.serviceInfo=D.serviceInfo;this.rasterInfo=D.rasterInfo;this.tileInfo=D.tileInfo;this.serviceInfo=D.serviceInfo}},open:function(){},read:function(D){},identify:function(D){var G=new b,H=this.rasterInfo.extent;if(C.requirePE(H.spatialReference,
D.spatialReference))C.load().then(p.hitch(this,function(){N=C.project(D,H.spatialReference);G.resolve(N)}),function(){G.reject(Error("cannot project into this spatial reference"))});else{var N=C.project(D,H.spatialReference);G.resolve(N)}return G.then(p.hitch(this,function(O){var S=this.tileInfo,da=S.origin,J=S.lods[S.lods.length-1],M=(O.x-da.x)/S.cols/J.resolution;O=(da.y-O.y)/S.rows/J.resolution;var K=Math.round((O-Math.floor(O))*S.rows)*S.cols+Math.round((M-Math.floor(M))*S.cols);da=new e(da.x+
J.resolution*S.cols*M,da.y-J.resolution*S.rows*(O+1),da.x+J.resolution*S.cols*(M+1),da.y-J.resolution*S.rows*O,H.spatialReference);var R=this.getMemberRasters?this.getMemberRasters()[0]:this;return R.read({level:J.level,row:Math.floor(O),col:Math.floor(M),extent:da,width:S.cols,height:S.rows,virtual:R.tileInfo.virtual,tileType:R.tileInfo.tileType}).then(function(X){return(X=X&&X.pixelBlock)&&X.pixels&&0<X.pixels.length&&(!X.mask||X.mask[K])?{pixelValue:X.pixels.map(function(Q){return Q[K]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(D,G){var H=new b;if(this.projectedFullExtent&&!G)return H.resolve(this.projectedFullExtent),H.promise;var N=this.rasterInfo.extent;if(C.requirePE(this.rasterInfo.extent.spatialReference,D))C.load().then(p.hitch(this,function(){O=C.project(N,D);this.projectedFullExtent=O=new e(O.toJson());H.resolve(O)}),function(){H.reject(Error("cannot project into this spatial reference"))});else{var O=C.project(N,D);this.projectedFullExtent=O=new e(O.toJson());H.resolve(O)}return H.promise},
setFetchParameters:function(D,G){},_setRasterHandler:function(D){this._rasterHandler=D;this.getMemberRasters&&this.getMemberRasters().forEach(p.hitch(this,function(G){G._rasterHandler=D}))},_findCredential:function(){this.url&&((this._credential=m.id&&m.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new B;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(D){var G=D.url,H=D.payload,N=D.decodeParams,O=D.tileOptions,S=new b(r._dfdCanceller);this._rasterHandler||this._initWorker();var da=this._rasterHandler,J={};G={url:G,handleAs:"arraybuffer",content:H};D.headers&&(G.headers=D.headers);S._pendingDfd=l(G).then(p.hitch(this,function(M){(da&&this._rasterHandlerInitialized?da.decode({encodedData:M,decodeParams:N}):z.decode(M,N)).then(function(K){J.pixelBlock=new y(K);J.extent=O.extent;J.level=O.level;J.row=O.row;
J.col=O.col;J.width=O.width;J.height=O.height;r._resDfd(S,[J])},function(K){r._resDfd(S,[K],!0)})}),function(M){r._resDfd(S,[M],!0)});return S},_computeSignature:function(D){if("string"===typeof D){for(var G=new Uint8Array(D.length),H=0;H<D.length;H++)G[H]=D.charCodeAt(H);D=G}H=G=65535;for(var N=D.length,O=Math.floor(N/2),S=0;O;){var da=359<=O?359:O;O-=da;do G+=D[S++]<<8,H+=G+=D[S++];while(--da);G=(G&65535)+(G>>>16);H=(H&65535)+(H>>>16)}N&1&&(H+=G+=D[S]<<8);return((H&65535)+(H>>>16)<<16|(G&65535)+
(G>>>16))>>>0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(k,g,p,b,h,f,d,a,c,n,m){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var q=new ArrayBuffer(4),l=new Uint8Array(q);(new Uint32Array(q))[0]=
1;return 1===l[0]}(),decode:function(q,l){if(void 0===l||null===l)throw"missing decode options";var e;l.format&&(e=l.format.toUpperCase());"BSQ"!==e&&"BIP"!==e&&(e=this._getFormat(q));var t=l.decodeFunc;if(void 0===t||null===t)t=this._getFormatDecoderDfd(e);return t(q,l)},_getFormatDecoderDfd:function(q){var l=null;switch(q){case "LERC":l=this._decodeLerc;break;case "LERC2":l=this._decodeLerc2;break;case "JPEG":l=this._decodeJpeg;break;case "PNG":l=this._decodePng;break;case "BSQ":l=this._decodeBsq;
break;case "BIP":l=this._decodeBip;break;case "TIFF":l=this._decodeTiff;break;default:l=function(e,t){throw"The raster format is not supported";}}l=p.hitch(this,l);return function(e,t){var x=new b;t.isPoint&&t.width&&(t.width++,t.height++);e=l(e,t);t.isPoint&&t.width&&(this._interpolatePointGrid(e),t.width--,t.height--);x.resolve(e);return x}.bind(this)},_getFormat:function(q){q=new Uint8Array(q,0,10);var l="";if(255===q[0]&&216===q[1])l="JPEG";else if(137===q[0]&&80===q[1]&&78===q[2]&&71===q[3])l=
"PNG";else if(67===q[0]&&110===q[1]&&116===q[2]&&90===q[3]&&73===q[4]&&109===q[5]&&97===q[6]&&103===q[7]&&101===q[8]&&32===q[9])l="LERC";else if(76===q[0]&&101===q[1]&&114===q[2]&&99===q[3]&&50===q[4]&&32===q[5])l="LERC2";else if(-1<String.fromCharCode.apply(null,q).toLowerCase().indexOf("error"))l="ERROR";else if(73===q[0]&&73===q[1]&&42===q[2]&&0===q[3]||77===q[0]&&77===q[1]&&0===q[2]&&42===q[3])l="TIFF";return l},_validateDecodeParams:function(q){if(!q.height||Math.floor(q.height)!==q.height)throw"Height not provided.";
if(!q.width||Math.floor(q.width)!==q.width)throw"Width not provided.";},_decodeJpeg:function(q,l){if(!a)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(l);q=(new a).decode(q);if(!this._verifyResult(q,l))throw"The decoded image dimensions are incorrect.";l=new h({width:q.width,height:q.height,pixels:q.pixels,pixelType:"U8",mask:q.mask,statistics:null});l.calculateStatistics();return l},_decodePng:function(q,l){if(!c)throw"The png decoder module is not loaded.";this._validateDecodeParams(l);
q=new Uint8Array(q);var e=new c(q);q=new Uint8Array(l.width*l.height*4);e.copyToImageData(q,e.decodePixels());var t=e=0;t=new Uint8Array(l.width*l.height);for(e=0;e<l.width*l.height;e++)t[e]=q[4*e+3];var x=new h({width:l.width,height:l.height,pixels:[],pixelType:"U8",mask:t,statistics:[]});for(e=0;3>e;e++){var r=new Uint8Array(l.width*l.height);for(t=0;t<l.width*l.height;t++)r[t]=q[4*t+e];x.addData({pixels:r})}x.calculateStatistics();return x},_decodeBsq:function(q,l){if(!n)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(l);var e=l.noDataValue;l.pixelType=this._getpixelTypeAndNoData(l.pixelType);q=n.decodeBSQ(q,{bandCount:l.planes,width:l.width,height:l.height,pixelType:l.pixelType,noDataValue:e});l=new h({width:l.width,height:l.height,pixels:q.pixels,pixelType:l.pixelType,mask:q.maskData,statistics:null});l.calculateStatistics();return l},_decodeBip:function(q,l){this._validateDecodeParams(l);var e=l.noDataValue;l.pixelType=this._getpixelTypeAndNoData(l.pixelType);q=n.decodeBIP(q,{bandCount:l.planes,
width:l.width,height:l.height,pixelType:l.pixelType,noDataValue:e});l=new h({width:l.width,height:l.height,pixels:q.pixels,pixelType:l.pixelType,mask:q.maskData,statistics:null});l.calculateStatistics();return l},_decodeTiff:function(q,l){this._validateDecodeParams(l);l.pixelType=this._getpixelTypeAndNoData(l.pixelType);q=m.decode(q);q=new h({width:q.width,height:q.height,pixels:q.pixels,pixelType:q.pixelType,mask:q.maskData,statistics:null});q.calculateStatistics();return q},_decodeLerc:function(q,
l){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(l);var e=l.noDataValue;l.pixelType=this._getpixelTypeAndNoData(l.pixelType);for(var t=0,x,r=0,w,u=q.byteLength-10;r<u;){var v=f.decode(q,{inputOffset:r,encodedMaskData:x,returnMask:0===t?!0:!1,returnEncodedMask:0===t?!0:!1,returnFileInfo:!0,pixelType:l.pixelType,noDataValue:e});r=v.fileInfo.eofOffset;0===t&&(x=v.encodedMaskData,w=new h({width:l.width,height:l.height,pixels:[],
pixelType:l.pixelType,mask:v.maskData,statistics:[]}));t++;if(!this._verifyResult(v,l))throw"The decoded image dimensions are incorrect";w.addData({pixels:v.pixelData,statistics:{minValue:v.minValue,maxValue:v.maxValue,noDataValue:v.noDataValue}})}return w},_decodeLerc2:function(q,l){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(l);l.pixelType=this._getpixelTypeAndNoData(l.pixelType);for(var e=0,t,x,r,w=0,u,v=q.byteLength-
10,y=[],z;w<v;){x=d.decode(q,{inputOffset:w,maskData:t,returnFileInfo:!0});w=x.fileInfo.eofOffset;0===e&&(r=x.fileInfo.numValidPixel,t=x.maskData,u=new h({width:l.width,height:l.height,pixels:[],dimCount:x.dimCount||1,pixelType:x.fileInfo.pixelType,mask:x.maskData,statistics:[]}));x.fileInfo.mask&&0<x.fileInfo.mask.numBytes&&y.push(x.maskData);e++;if(!this._verifyResult(x,l))throw"The decoded image dimensions are incorrect";u.addData({pixels:x.pixelData,statistics:{minValue:x.minValue,maxValue:x.maxValue,
noDataValue:x.noDataValue,dimStats:x.dimStats}})}if(1<y.length){l=u.width*u.height;u.bandMasks=y;t=new Uint8Array(l);t.set(y[0]);for(r=1;r<y.length;r++)for(z=y[r],q=0;q<l;q++)t[q]&=z[q];for(q=r=0;q<l;q++)r+=z[q];u.mask=t}u.validPixelCount=r;return u},_interpolatePointGrid:function(q,l){var e=q.pixels;if(e&&0!==e.length){var t=e.length,x=q.width,r=q.mask,w=x-1,u=q.height-1,v=[],y,z;if(0===(null==l?1:l)){for(l=0;l<t;l++){var B=e[l];var C=new B.constructor(w*u);for(y=0;y<u;y++){var E=y*x;for(z=0;z<w;z++)C[y*
w+z]=B[E+z]}v.push(C)}if(r){var D=new Uint8Array(w*u);for(y=0;y<u;y++)for(E=y*x,z=0;z<w;z++)D[y*w+z]=r[E+z]}}else{for(l=0;l<t;l++){B=e[l];C=new B.constructor(w*u);for(y=0;y<u;y++)for(E=y*x,z=0;z<w;z++)C[y*w+z]=(B[E+z]+B[E+z+1]+B[E+x+z]+B[E+x+z+1])/4;v.push(C)}if(r)for(D=new Uint8Array(w*u),y=0;y<u;y++)for(E=y*x,z=0;z<w;z++)D[y*w+z]=Math.min.apply(null,[r[E+z],r[E+z+1],r[E+x+z],r[E+x+z+1]])}q.width=w;q.height=u;q.mask=D;q.pixels=v;return q}},_getpixelTypeAndNoData:function(q){return"U1"===q||"U2"===
q||"U4"===q||"U8"===q?"U8":q},_verifyResult:function(q,l){return q.height!==l.height||q.width!==l.width?!1:!0}}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(k,g,p){return k(null,{constructor:function(){},decode:function(b){var h=new Uint8Array(b);b=new p;b.parse(h);var f=b.numComponents,d=b.getData(b.width,b.height,!0),a=b.width*b.height,c=b.eof,n=0,m=0,q=0;if(c<h.length-1){m=(new g(h.subarray(c))).getBytes();var l=new Uint8Array(a);for(n=
h=0;n<m.length;n++)for(q=7;0<=q;q--)l[h++]=m[n]>>q&1}h=[];if(1===f)h=[d,d,d];else{for(n=0;3>n;n++)f=new Uint8Array(a),h.push(f);for(m=q=0;m<a;m++)for(n=0;3>n;n++)h[n][m]=d[q++]}return{width:b.width,height:b.height,pixels:h,mask:l}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var k=function(){function g(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}g.prototype={ensureBuffer:function(p){var b=this.buffer,h=b?b.byteLength:0;if(p<h)return b;for(var f=512;f<p;)f<<=
1;p=new Uint8Array(f);for(f=0;f<h;++f)p[f]=b[f];return this.buffer=p},getByte:function(){for(var p=this.pos;this.bufferLength<=p;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(p){var b=this.pos;if(p){this.ensureBuffer(b+p);for(p=b+p;!this.eof&&this.bufferLength<p;)this.readBlock();var h=this.bufferLength;p>h&&(p=h)}else{for(;!this.eof;)this.readBlock();p=this.bufferLength}this.pos=p;return this.buffer.subarray(b,p)},lookChar:function(){for(var p=this.pos;this.bufferLength<=
p;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var p=this.pos;this.bufferLength<=p;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(p,b,h){for(var f=p+b;this.bufferLength<=f&&!this.eof;)this.readBlock();return new Stream(this.buffer,p,b,h)},skip:function(p){p||(p=1);this.pos+=p},reset:function(){this.pos=0}};return g}();return function(){function g(c){throw Error(c);
}function p(c){var n=0,m=c[n++],q=c[n++];-1!=m&&-1!=q||g("Invalid header in flate stream");8!=(m&15)&&g("Unknown compression method in flate stream");0!=((m<<8)+q)%31&&g("Bad FCHECK in flate stream");q&32&&g("FDICT bit set in flate stream");this.bytes=c;this.bytesPos=n;this.codeBuf=this.codeSize=0;k.call(this)}if(!self||!self.Uint32Array)return null;var b=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,
131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),f=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),d=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,
459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,
459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,
459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,
459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,
459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,
459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,
459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,
327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];p.prototype=Object.create(k.prototype);p.prototype.getBits=function(c){for(var n=this.codeSize,m=this.codeBuf,q=this.bytes,l=this.bytesPos,e;n<c;)"undefined"==typeof(e=q[l++])&&g("Bad encoding in flate stream"),m|=e<<n,n+=8;this.codeBuf=m>>c;this.codeSize=n-=c;this.bytesPos=l;return m&(1<<c)-1};p.prototype.getCode=function(c){var n=c[0],m=c[1];c=this.codeSize;for(var q=
this.codeBuf,l=this.bytes,e=this.bytesPos;c<m;){var t;"undefined"==typeof(t=l[e++])&&g("Bad encoding in flate stream");q|=t<<c;c+=8}m=n[q&(1<<m)-1];n=m>>16;m&=65535;(0==c||c<n||0==n)&&g("Bad encoding in flate stream");this.codeBuf=q>>n;this.codeSize=c-n;this.bytesPos=e;return m};p.prototype.generateHuffmanTable=function(c){for(var n=c.length,m=0,q=0;q<n;++q)c[q]>m&&(m=c[q]);for(var l=1<<m,e=new Uint32Array(l),t=1,x=0,r=2;t<=m;++t,x<<=1,r<<=1)for(var w=0;w<n;++w)if(c[w]==t){var u=0,v=x;for(q=0;q<t;++q)u=
u<<1|v&1,v>>=1;for(q=u;q<l;q+=r)e[q]=t<<16|w;++x}return[e,m]};p.prototype.readBlock=function(){function c(u,v,y,z,B){for(u=u.getBits(y)+z;0<u--;)v[x++]=B}var n=this.getBits(3);n&1&&(this.eof=!0);n>>=1;if(0==n){var m=this.bytes,q=this.bytesPos,l;"undefined"==typeof(l=m[q++])&&g("Bad block header in flate stream");var e=l;"undefined"==typeof(l=m[q++])&&g("Bad block header in flate stream");e|=l<<8;"undefined"==typeof(l=m[q++])&&g("Bad block header in flate stream");n=l;"undefined"==typeof(l=m[q++])&&
g("Bad block header in flate stream");(n|l<<8)!=(~e&65535)&&g("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;l=this.bufferLength;n=this.ensureBuffer(l+e);this.bufferLength=e=l+e;for(var t=l;t<e;++t){if("undefined"==typeof(l=m[q++])){this.eof=!0;break}n[t]=l}this.bytesPos=q}else{if(1==n)q=d,l=a;else if(2==n){n=this.getBits(5)+257;l=this.getBits(5)+1;m=this.getBits(4)+4;q=Array(b.length);for(var x=0;x<m;)q[b[x++]]=this.getBits(3);q=this.generateHuffmanTable(q);x=m=0;l=
n+l;for(e=Array(l);x<l;)t=this.getCode(q),16==t?c(this,e,2,3,m):17==t?c(this,e,3,3,m=0):18==t?c(this,e,7,11,m=0):e[x++]=m=t;q=this.generateHuffmanTable(e.slice(0,n));l=this.generateHuffmanTable(e.slice(n,l))}else g("Unknown block type in flate stream");e=(n=this.buffer)?n.length:0;for(t=this.bufferLength;;){var r=this.getCode(q);if(256>r)t+1>=e&&(n=this.ensureBuffer(t+1),e=n.length),n[t++]=r;else{if(256==r){this.bufferLength=t;break}r-=257;r=h[r];var w=r>>16;0<w&&(w=this.getBits(w));m=(r&65535)+w;
r=this.getCode(l);r=f[r];w=r>>16;0<w&&(w=this.getBits(w));r=(r&65535)+w;t+m>=e&&(n=this.ensureBuffer(t+m),e=n.length);for(w=0;w<m;++w,++t)n[t]=n[t-r]}}}};return p}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var k=function(){function g(p){this.message="JPEG error: "+p}g.prototype=Error();g.prototype.name="JpegError";return g.constructor=g}();return function(){function g(){this.decodeTransform=null;this.colorTransform=-1}function p(a,c){for(var n=0,m=[],q,l,e=16;0<e&&!a[e-
1];)e--;m.push({children:[],index:0});var t=m[0],x;for(q=0;q<e;q++){for(l=0;l<a[q];l++){t=m.pop();for(t.children[t.index]=c[n];0<t.index;)t=m.pop();t.index++;for(m.push(t);m.length<=q;)m.push(x={children:[],index:0}),t.children[t.index]=x.children,t=x;n++}q+1<e&&(m.push(x={children:[],index:0}),t.children[t.index]=x.children,t=x)}return m[0].children}function b(a,c,n,m,q,l,e,t,x){function r(){if(0<N)return N--,H>>N&1;H=a[c++];if(255===H){var ca=a[c++];if(ca)throw new k("unexpected marker "+(H<<8|
ca).toString(16));}N=7;return H>>>7}function w(ca){for(;;){ca=ca[r()];if("number"===typeof ca)return ca;if("object"!==typeof ca)throw new k("invalid huffman sequence");}}function u(ca){for(var V=0;0<ca;)V=V<<1|r(),ca--;return V}function v(ca){if(1===ca)return 1===r()?1:-1;var V=u(ca);return V>=1<<ca-1?V:V+(-1<<ca)+1}function y(ca,V){var Z=w(ca.huffmanTableDC);Z=0===Z?0:v(Z);ca.blockData[V]=ca.pred+=Z;for(Z=1;64>Z;){var ja=w(ca.huffmanTableAC),la=ja&15;ja>>=4;if(0===la){if(15>ja)break;Z+=16}else Z+=
ja,ca.blockData[V+d[Z]]=v(la),Z++}}function z(ca,V){var Z=w(ca.huffmanTableDC);Z=0===Z?0:v(Z)<<x;ca.blockData[V]=ca.pred+=Z}function B(ca,V){ca.blockData[V]|=r()<<x}function C(ca,V){if(0<O)O--;else for(var Z=l;Z<=e;){var ja=w(ca.huffmanTableAC),la=ja&15;ja>>=4;if(0===la){if(15>ja){O=u(ja)+(1<<ja)-1;break}Z+=16}else Z+=ja,ca.blockData[V+d[Z]]=v(la)*(1<<x),Z++}}function E(ca,V){for(var Z=l,ja=0,la;Z<=e;){la=d[Z];switch(S){case 0:ja=w(ca.huffmanTableAC);la=ja&15;ja>>=4;if(0===la)15>ja?(O=u(ja)+(1<<ja),
S=4):(ja=16,S=1);else{if(1!==la)throw new k("invalid ACn encoding");da=v(la);S=ja?2:3}continue;case 1:case 2:ca.blockData[V+la]?ca.blockData[V+la]+=r()<<x:(ja--,0===ja&&(S=2===S?3:0));break;case 3:ca.blockData[V+la]?ca.blockData[V+la]+=r()<<x:(ca.blockData[V+la]=da<<x,S=0);break;case 4:ca.blockData[V+la]&&(ca.blockData[V+la]+=r()<<x)}Z++}4===S&&(O--,0===O&&(S=0))}var D=n.mcusPerLine,G=c,H=0,N=0,O=0,S=0,da,J=m.length,M,K,R,X;t=n.progressive?0===l?0===t?z:B:0===t?C:E:y;var Q=0;n=1===J?m[0].blocksPerLine*
m[0].blocksPerColumn:D*n.mcusPerColumn;for(var W,I;Q<n;){var T=q?Math.min(n-Q,q):n;for(M=0;M<J;M++)m[M].pred=0;O=0;if(1===J){var Y=m[0];for(X=0;X<T;X++)t(Y,64*((Y.blocksPerLine+1)*(Q/Y.blocksPerLine|0)+Q%Y.blocksPerLine)),Q++}else for(X=0;X<T;X++){for(M=0;M<J;M++)for(Y=m[M],W=Y.h,I=Y.v,K=0;K<I;K++)for(R=0;R<W;R++)t(Y,64*((Y.blocksPerLine+1)*((Q/D|0)*Y.v+K)+(Q%D*Y.h+R)));Q++}N=0;(Y=f(a,c))&&Y.invalid&&(c=Y.offset);Y=Y&&Y.marker;if(!Y||65280>=Y)throw new k("marker was not found");if(65488<=Y&&65495>=
Y)c+=2;else break}(Y=f(a,c))&&Y.invalid&&(c=Y.offset);return c-G}function h(a,c){a=c.blocksPerLine;for(var n=c.blocksPerColumn,m=new Int16Array(64),q=0;q<n;q++)for(var l=0;l<a;l++){var e=void 0,t=void 0,x=void 0,r=void 0,w=void 0,u=void 0,v=void 0,y=void 0,z=w=u=r=t=e=void 0,B=void 0,C=void 0,E=void 0,D=64*((c.blocksPerLine+1)*q+l),G=m,H=c.quantizationTable,N=c.blockData;if(!H)throw new k("missing required Quantization Table.");for(var O=0;64>O;O+=8)e=N[D+O],y=N[D+O+1],v=N[D+O+2],u=N[D+O+3],w=N[D+
O+4],r=N[D+O+5],x=N[D+O+6],t=N[D+O+7],e*=H[O],0===(y|v|u|w|r|x|t)?(e=5793*e+512>>10,G[O]=e,G[O+1]=e,G[O+2]=e,G[O+3]=e,G[O+4]=e,G[O+5]=e,G[O+6]=e,G[O+7]=e):(y*=H[O+1],v*=H[O+2],u*=H[O+3],w*=H[O+4],r*=H[O+5],x*=H[O+6],t*=H[O+7],E=5793*e+128>>8,C=5793*w+128>>8,B=v,z=x,w=2896*(y-t)+128>>8,t=2896*(y+t)+128>>8,u<<=4,r<<=4,E=E+C+1>>1,C=E-C,e=3784*B+1567*z+128>>8,B=1567*B-3784*z+128>>8,z=e,w=w+r+1>>1,r=w-r,t=t+u+1>>1,u=t-u,E=E+z+1>>1,z=E-z,C=C+B+1>>1,B=C-B,e=2276*w+3406*t+2048>>12,w=3406*w-2276*t+2048>>12,
t=e,e=799*u+4017*r+2048>>12,u=4017*u-799*r+2048>>12,r=e,G[O]=E+t,G[O+7]=E-t,G[O+1]=C+r,G[O+6]=C-r,G[O+2]=B+u,G[O+5]=B-u,G[O+3]=z+w,G[O+4]=z-w);for(H=0;8>H;++H)e=G[H],y=G[H+8],v=G[H+16],u=G[H+24],w=G[H+32],r=G[H+40],x=G[H+48],t=G[H+56],0===(y|v|u|w|r|x|t)?(e=5793*e+8192>>14,e=-2040>e?0:2024<=e?255:e+2056>>4,N[D+H]=e,N[D+H+8]=e,N[D+H+16]=e,N[D+H+24]=e,N[D+H+32]=e,N[D+H+40]=e,N[D+H+48]=e,N[D+H+56]=e):(E=5793*e+2048>>12,C=5793*w+2048>>12,B=v,z=x,w=2896*(y-t)+2048>>12,t=2896*(y+t)+2048>>12,E=(E+C+1>>1)+
4112,C=E-C,e=3784*B+1567*z+2048>>12,B=1567*B-3784*z+2048>>12,z=e,w=w+r+1>>1,r=w-r,t=t+u+1>>1,u=t-u,E=E+z+1>>1,z=E-z,C=C+B+1>>1,B=C-B,e=2276*w+3406*t+2048>>12,w=3406*w-2276*t+2048>>12,t=e,e=799*u+4017*r+2048>>12,u=4017*u-799*r+2048>>12,r=e,e=E+t,t=E-t,y=C+r,x=C-r,v=B+u,r=B-u,u=z+w,w=z-w,e=16>e?0:4080<=e?255:e>>4,y=16>y?0:4080<=y?255:y>>4,v=16>v?0:4080<=v?255:v>>4,u=16>u?0:4080<=u?255:u>>4,w=16>w?0:4080<=w?255:w>>4,r=16>r?0:4080<=r?255:r>>4,x=16>x?0:4080<=x?255:x>>4,t=16>t?0:4080<=t?255:t>>4,N[D+H]=
e,N[D+H+8]=y,N[D+H+16]=v,N[D+H+24]=u,N[D+H+32]=w,N[D+H+40]=r,N[D+H+48]=x,N[D+H+56]=t)}return c.blockData}function f(a,c,n){var m=a.length-1;n=n<c?n:c;if(c>=m)return null;var q=a[c]<<8|a[c+1];if(65472<=q&&65534>=q)return{invalid:null,marker:q,offset:c};for(c=a[n]<<8|a[n+1];!(65472<=c&&65534>=c);){if(++n>=m)return null;c=a[n]<<8|a[n+1]}return{invalid:q.toString(16),marker:c,offset:n}}if(!self||!self.Uint8ClampedArray)return null;var d=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,
33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);g.prototype={parse:function(a){function c(){var H=a[q]<<8|a[q+1];q+=2;return H}function n(){var H=c();H=q+H-2;var N=f(a,H,q);N&&N.invalid&&(H=N.offset);H=a.subarray(q,H);q+=H.length;return H}function m(H){for(var N=Math.ceil(H.samplesPerLine/8/H.maxH),O=Math.ceil(H.scanLines/8/H.maxV),S=0;S<H.components.length;S++){G=H.components[S];var da=Math.ceil(Math.ceil(H.samplesPerLine/
8)*G.h/H.maxH),J=Math.ceil(Math.ceil(H.scanLines/8)*G.v/H.maxV);G.blockData=new Int16Array(64*O*G.v*(N*G.h+1));G.blocksPerLine=da;G.blocksPerColumn=J}H.mcusPerLine=N;H.mcusPerColumn=O}var q=0,l=null,e=null,t=[],x=[],r=[],w=c();if(65496!==w)throw new k("SOI not found");for(w=c();65497!==w;){switch(w){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var u=n();65504===
w&&74===u[0]&&70===u[1]&&73===u[2]&&70===u[3]&&0===u[4]&&(l={version:{major:u[5],minor:u[6]},densityUnits:u[7],xDensity:u[8]<<8|u[9],yDensity:u[10]<<8|u[11],thumbWidth:u[12],thumbHeight:u[13],thumbData:u.subarray(14,14+3*u[12]*u[13])});65518===w&&65===u[0]&&100===u[1]&&111===u[2]&&98===u[3]&&101===u[4]&&(e={version:u[5]<<8|u[6],flags0:u[7]<<8|u[8],flags1:u[9]<<8|u[10],transformCode:u[11]});break;case 65499:w=c()+q-2;for(var v;q<w;){var y=a[q++],z=new Uint16Array(64);if(0===y>>4)for(u=0;64>u;u++)v=
d[u],z[v]=a[q++];else if(1===y>>4)for(u=0;64>u;u++)v=d[u],z[v]=c();else throw new k("DQT - invalid table spec");t[y&15]=z}break;case 65472:case 65473:case 65474:if(B)throw new k("Only single frame JPEGs supported");c();var B={};B.extended=65473===w;B.progressive=65474===w;B.precision=a[q++];B.scanLines=c();B.samplesPerLine=c();B.components=[];B.componentIds={};u=a[q++];for(w=z=y=0;w<u;w++){v=a[q];var C=a[q+1]>>4;var E=a[q+1]&15;y<C&&(y=C);z<E&&(z=E);C=B.components.push({h:C,v:E,quantizationId:a[q+
2],quantizationTable:null});B.componentIds[v]=C-1;q+=3}B.maxH=y;B.maxV=z;m(B);break;case 65476:v=c();for(w=2;w<v;){y=a[q++];z=new Uint8Array(16);for(u=C=0;16>u;u++,q++)C+=z[u]=a[q];E=new Uint8Array(C);for(u=0;u<C;u++,q++)E[u]=a[q];w+=17+C;(0===y>>4?r:x)[y&15]=p(z,E)}break;case 65501:c();var D=c();break;case 65498:c();v=a[q++];u=[];for(w=0;w<v;w++){y=B.componentIds[a[q++]];var G=B.components[y];y=a[q++];G.huffmanTableDC=r[y>>4];G.huffmanTableAC=x[y&15];u.push(G)}w=a[q++];v=a[q++];y=a[q++];w=b(a,q,
B,u,D,w,v,y>>4,y&15);q+=w;break;case 65535:255!==a[q]&&q--;break;default:if(255===a[q-3]&&192<=a[q-2]&&254>=a[q-2])q-=3;else throw new k("unknown marker "+w.toString(16));}w=c()}this.width=B.samplesPerLine;this.height=B.scanLines;this.jfif=l;this.eof=q;this.adobe=e;this.components=[];for(w=0;w<B.components.length;w++){G=B.components[w];if(l=t[G.quantizationId])G.quantizationTable=l;this.components.push({output:h(B,G),scaleX:G.h/B.maxH,scaleY:G.v/B.maxV,blocksPerLine:G.blocksPerLine,blocksPerColumn:G.blocksPerColumn})}this.numComponents=
this.components.length},_getLinearizedBlockData:function(a,c){var n=this.width/a,m=this.height/c,q,l,e=0,t=this.components.length,x=a*c*t,r=new Uint8ClampedArray(x),w=new Uint32Array(a);for(l=0;l<t;l++){var u=this.components[l];var v=u.scaleX*n;var y=u.scaleY*m;e=l;var z=u.output;var B=u.blocksPerLine+1<<3;for(q=0;q<a;q++)u=0|q*v,w[q]=(u&4294967288)<<3|u&7;for(v=0;v<c;v++)for(u=0|v*y,u=B*(u&4294967288)|(u&7)<<3,q=0;q<a;q++)r[e]=z[u+w[q]],e+=t}if(c=this.decodeTransform)for(l=0;l<x;)for(a=u=0;u<t;u++,
l++,a+=2)r[l]=(r[l]*c[a]>>8)+c[a+1];return r},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var c,n,m,q=0,l=a.length;q<l;q+=3)c=a[q],n=a[q+1],m=a[q+2],a[q]=c-179.456+1.402*m,a[q+1]=c+135.459-.344*n-.714*m,a[q+2]=c-226.816+1.772*n;return a},_convertYcckToRgb:function(a){for(var c,n,m,q,l=0,e=0,t=a.length;e<t;e+=4)c=a[e],n=a[e+1],m=a[e+2],q=a[e+3],a[l++]=
-122.67195406894+n*(-6.60635669420364E-5*n+4.37130475926232E-4*m-5.4080610064599E-5*c+4.8449797120281E-4*q-.154362151871126)+m*(-9.57964378445773E-4*m+8.17076911346625E-4*c-.00477271405408747*q+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*q+.48357088451265)+q*(-3.36197177618394E-4*q+.484791561490776),a[l++]=107.268039397724+n*(2.19927104525741E-5*n-6.40992018297945E-4*m+6.59397001245577E-4*c+4.26105652938837E-4*q-.176491792462875)+m*(-7.78269941513683E-4*m+.00130872261408275*c+7.70482631801132E-4*
q-.151051492775562)+c*(.00126935368114843*c-.00265090189010898*q+.25802910206845)+q*(-3.18913117588328E-4*q-.213742400323665),a[l++]=-20.810012546947+n*(-5.70115196973677E-4*n-2.63409051004589E-5*m+.0020741088115012*c-.00288260236853442*q+.814272968359295)+m*(-1.53496057440975E-5*m-1.32689043961446E-4*c+5.60833691242812E-4*q-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*q+.116935020465145)+q*(-3.43531996510555E-4*q+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var c,
n,m,q=0,l=a.length;q<l;q+=4)c=a[q],n=a[q+1],m=a[q+2],a[q]=434.456-c-1.402*m,a[q+1]=119.541-c+.344*n+.714*m,a[q+2]=481.816-c-1.772*n;return a},_convertCmykToRgb:function(a){for(var c,n,m,q,l=0,e=1/255,t=0,x=a.length;t<x;t+=4)c=a[t]*e,n=a[t+1]*e,m=a[t+2]*e,q=a[t+3]*e,a[l++]=255+c*(-4.387332384609988*c+54.48615194189176*n+18.82290502165302*m+212.25662451639585*q-285.2331026137004)+n*(1.7149763477362134*n-5.6096736904047315*m-17.873870861415444*q-5.497006427196366)+m*(-2.5217340131683033*m-21.248923337353073*
q+17.5119270841813)-q*(21.86122147463605*q+189.48180835922747),a[l++]=255+c*(8.841041422036149*c+60.118027045597366*n+6.871425592049007*m+31.159100130055922*q-79.2970844816548)+n*(-15.310361306967817*n+17.575251261109482*m+131.35250912493976*q-190.9453302588951)+m*(4.444339102852739*m+9.8632861493405*q-24.86741582555878)-q*(20.737325471181034*q+187.80453709719578),a[l++]=255+c*(.8842522430003296*c+8.078677503112928*n+30.89978309703729*m-.23883238689178934*q-14.183576799673286)+n*(10.49593273432072*
n+63.02378494754052*m+50.606957656360734*q-112.23884253719248)+m*(.03296041114873217*m+115.60384449646641*q-193.58209356861505)-q*(22.33816807309886*q+180.12613974708367);return a},getData:function(a,c,n){if(4<this.numComponents)throw new k("Unsupported color mode");a=this._getLinearizedBlockData(a,c);if(1===this.numComponents&&n){n=a.length;c=new Uint8ClampedArray(3*n);for(var m=0,q=0;q<n;q++){var l=a[q];c[m++]=l;c[m++]=l;c[m++]=l}return c}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);
if(4===this.numComponents){if(this._isColorConversionNeeded())return n?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(n)return this._convertCmykToRgb(a)}return a}};return g}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(k){return function(){function g(b){var h,f;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(f=null;;){var d=this.readUInt32();var a=b=void 0;b=[];for(a=0;4>a;++a)b.push(String.fromCharCode(this.data[this.pos++]));
b=b.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(d);break;case "fcTL":f&&this.animation.frames.push(f);this.pos+=
4;f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();d=this.readUInt16()||100;f.delay=1E3*b/d;f.disposeOp=this.data[this.pos++];f.blendOp=this.data[this.pos++];f.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,d-=4);b=(null!=f?f.data:void 0)||this.imgData;for(a=0;0<=d?a<d:a>d;0<=d?++a:--a)b.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=
this.read(d);d=255-this.transparency.indexed.length;if(0<d)for(b=0;0<=d?b<d:b>d;0<=d?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(d)[0];break;case 2:this.transparency.rgb=this.read(d)}break;case "tEXt":a=this.read(d);d=a.indexOf(0);b=String.fromCharCode.apply(String,a.slice(0,d));this.text[b]=String.fromCharCode.apply(String,a.slice(d+1));break;case "IEND":f&&this.animation.frames.push(f);a:{switch(this.colorType){case 0:case 3:case 4:f=1;break a;
case 2:case 6:f=3;break a}f=void 0}this.colors=f;this.hasAlphaChannel=4===(h=this.colorType)||6===h;h=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*h;a:{switch(this.colors){case 1:h="DeviceGray";break a;case 3:h="DeviceRGB";break a}h=void 0}this.colorSpace=h;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=d}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}g.load=function(b,h,f){"function"===typeof h&&(f=h);var d=new XMLHttpRequest;
d.open("GET",b,!0);d.responseType="arraybuffer";d.onload=function(){var a=new Uint8Array(d.response||d.mozResponseArrayBuffer);a=new g(a);"function"===typeof(null!=h?h.getContext:void 0)&&a.render(h);return"function"===typeof f?f(a):void 0};return d.send(null)};g.prototype.read=function(b){var h;var f=[];for(h=0;0<=b?h<b:h>b;0<=b?++h:--h)f.push(this.data[this.pos++]);return f};g.prototype.readUInt32=function(){var b=this.data[this.pos++]<<24;var h=this.data[this.pos++]<<16;var f=this.data[this.pos++]<<
8;var d=this.data[this.pos++];return b|h|f|d};g.prototype.readUInt16=function(){var b=this.data[this.pos++]<<8;var h=this.data[this.pos++];return b|h};g.prototype.decodePixels=function(b){var h,f,d,a,c,n,m,q;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new k(b);b=b.getBytes();var l=this.pixelBitlength/8;var e=l*this.width;var t=new Uint8Array(e*this.height);var x=b.length;for(f=a=c=0;a<x;){switch(b[a++]){case 0:for(d=h=0;h<e;d=h+=1)t[f++]=b[a++];break;case 1:for(d=n=0;n<e;d=
n+=1){h=b[a++];var r=d<l?0:t[f-l];t[f++]=(h+r)%256}break;case 2:for(d=r=0;r<e;d=r+=1){h=b[a++];var w=(d-d%l)/l;n=c&&t[(c-1)*e+w*l+d%l];t[f++]=(n+h)%256}break;case 3:for(d=q=0;q<e;d=q+=1)h=b[a++],w=(d-d%l)/l,r=d<l?0:t[f-l],n=c&&t[(c-1)*e+w*l+d%l],t[f++]=(h+Math.floor((r+n)/2))%256;break;case 4:for(d=q=0;q<e;d=q+=1){h=b[a++];w=(d-d%l)/l;r=d<l?0:t[f-l];0===c?n=m=0:(n=t[(c-1)*e+w*l+d%l],m=w&&t[(c-1)*e+(w-1)*l+d%l]);var u=r+n-m;d=Math.abs(u-r);w=Math.abs(u-n);u=Math.abs(u-m);r=d<=w&&d<=u?r:w<=u?n:m;t[f++]=
(h+r)%256}break;default:throw Error("Invalid filter algorithm: "+b[a-1]);}c++}return t};g.prototype.decodePalette=function(){var b,h,f,d,a;var c=this.palette;var n=this.transparency.indexed||[];var m=new Uint8Array((n.length||0)+c.length);var q=f=b=h=0;for(d=c.length;f<d;q=f+=3)m[h++]=c[q],m[h++]=c[q+1],m[h++]=c[q+2],m[h++]=null!=(a=n[b++])?a:255;return m};g.prototype.copyToImageData=function(b,h){var f,d;var a=this.colors;var c=null;var n=this.hasAlphaChannel;this.palette.length&&(c=null!=(f=this._decodedPalette)?
f:this._decodedPalette=this.decodePalette(),a=4,n=!0);b=b.data||b;var m=b.length;var q=c||h;f=d=0;if(1===a)for(;f<m;)a=c?4*h[f/4]:d,d=q[a++],b[f++]=d,b[f++]=d,b[f++]=d,b[f++]=n?q[a++]:this.transparency.grayscale&&this.transparency.grayscale===d?0:255,d=a;else for(;f<m;)a=c?4*h[f/4]:d,b[f++]=q[a++],b[f++]=q[a++],b[f++]=q[a++],b[f++]=n?q[a++]:this.transparency.rgb&&this.transparency.rgb[1]===q[a-3]&&this.transparency.rgb[3]===q[a-2]&&this.transparency.rgb[5]===q[a-1]?0:255,d=a};g.prototype.decode=function(){var b=
new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};var p=function(b){(void 0).clearRect(0,0,b.width,b.height);(void 0).putImageData(b,0,0);b=new Image;b.src=(void 0).toDataURL();return b};g.prototype.decodeFrames=function(b){var h,f;if(this.animation){var d=this.animation.frames;var a=[];var c=h=0;for(f=d.length;h<f;c=++h){c=d[c];var n=b.createImageData(c.width,c.height);var m=this.decodePixels(new Uint8Array(c.data));this.copyToImageData(n,m);c.imageData=
n;a.push(c.image=p(n))}return a}};g.prototype.renderFrame=function(b,h){var f=this.animation.frames;var d=f[h];f=f[h-1];0===h&&b.clearRect(0,0,this.width,this.height);1===(null!=f?f.disposeOp:void 0)?b.clearRect(f.xOffset,f.yOffset,f.width,f.height):2===(null!=f?f.disposeOp:void 0)&&b.putImageData(f.imageData,f.xOffset,f.yOffset);0===d.blendOp&&b.clearRect(d.xOffset,d.yOffset,d.width,d.height);return b.drawImage(d.image,d.xOffset,d.yOffset)};g.prototype.animate=function(b){var h,f=this;var d=0;var a=
this.animation;var c=a.numFrames;var n=a.frames;var m=a.numPlays;return(h=function(){var q=d++%c;var l=n[q];f.renderFrame(b,q);if(1<c&&d/c<m)return f.animation._timeout=setTimeout(h,l.delay)})()};g.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};g.prototype.render=function(b){b._png&&b._png.stopAnimation();b._png=this;b.width=this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),this.animate(b);
var h=b.createImageData(this.width,this.height);this.copyToImageData(h,this.decodePixels());return b.putImageData(h,0,0)};return g}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(k,g){var p=g.pixelType,b=g.bandCount,h=[],f=g.width*g.height,d=this.getBandCount(k,g);b=b||d;var a=k.byteLength-k.byteLength%(f*this._getPixelLength(p)),c=new p(k,0,f*d),n,m,q;for(n=0;n<b;n++){var l=new p(f);for(m=0;m<f;m++)l[m]=c[m*d+n];h.push(l)}a<k.byteLength-1&&(q=this._decodeMask(k.slice(a),
g));return{pixels:h,maskData:q}},decodeBSQ:function(k,g){var p=g.pixelType,b=g.bandCount;if(void 0===b||null===b)b=this.getBandCount(k,g);var h=[],f=g.width*g.height,d=f*b,a=k.byteLength-k.byteLength%(f*this._getPixelLength(p));p=new p(k,0,d);var c;for(d=0;d<b;d++)h.push(p.subarray(d*f,(d+1)*f));a<k.byteLength-1&&(c=this._decodeMask(k.slice(a),g));return{pixels:h,maskData:c}},getBandCount:function(k,g){return Math.floor(k.byteLength/(g.width*g.height*this._getPixelLength(g.pixelType)))},_getPixelLength:function(k){var g=
1;switch(k){case Uint8Array:case Int8Array:case Uint8ClampedArray:g=1;break;case Uint16Array:case Int16Array:g=2;break;case Uint32Array:case Int32Array:case Float32Array:g=4;break;case Float64Array:g=8}return g},_decodeMask:function(k,g){var p=g.width*g.height;if(8*k.byteLength<p)return null;k=new Uint8Array(k,0,Math.ceil(p/8));g=new Uint8Array(g.width*g.height);var b=0,h=0,f=0,d=0;for(f=0;f<k.length-1;f++)for(h=k[f],d=7;0<=d;d--)g[b++]=h>>d&1;for(d=7;b<p-1;)h=k[k.length-1],g[b++]=h>>d&1,d--;return g}}})},
"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(k,g){var p=function(){var d=new ArrayBuffer(4),a=new Uint8Array(d);d=new Uint32Array(d);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===d[0]},b=function(){var d=[];d[254]="NEWSUBFILETYPE";d[255]="SUBFILETYPE";d[256]="IMAGEWIDTH";d[257]="IMAGELENGTH";d[258]="BITSPERSAMPLE";d[259]="COMPRESSION";d[262]="PHOTOMETRICINTERPRETATION";d[263]="THRESHHOLDING";d[264]="CELLWIDTH";d[265]="CELLLENGTH";d[266]="FILLORDER";d[269]=
"DOCUMENTNAME";d[270]="IMAGEDESCRIPTION";d[271]="MAKE";d[272]="MODEL";d[273]="STRIPOFFSETS";d[274]="ORIENTATION";d[277]="SAMPLESPERPIXEL";d[278]="ROWSPERSTRIP";d[279]="STRIPBYTECOUNTS";d[280]="MINSAMPLEVALUE";d[281]="MAXSAMPLEVALUE";d[282]="XRESOLUTION";d[283]="YRESOLUTION";d[284]="PLANARCONFIGURATION";d[285]="PAGENAME";d[286]="XPOSITION";d[287]="YPOSITION";d[288]="FREEOFFSETS";d[289]="FREEBYTECOUNTS";d[290]="GRAYRESPONSEUNIT";d[291]="GRAYRESPONSECURVE";d[292]="T4OPTIONS";d[293]="T6OPTIONS";d[296]=
"RESOLUTIONUNIT";d[297]="PAGENUMBER";d[300]="COLORRESPONSEUNIT";d[301]="TRANSFERFUNCTION";d[305]="SOFTWARE";d[306]="DATETIME";d[315]="ARTIST";d[316]="HOSTCOMPUTER";d[317]="PREDICTOR";d[318]="WHITEPOINT";d[319]="PRIMARYCHROMATICITIES";d[320]="COLORMAP";d[321]="HALFTONEHINTS";d[322]="TILEWIDTH";d[323]="TILELENGTH";d[324]="TILEOFFSETS";d[325]="TILEBYTECOUNTS";d[326]="BADFAXLINES";d[327]="CLEANFAXDATA";d[328]="CONSECUTIVEBADFAXLINES";d[330]="SUBIFD";d[332]="INKSET";d[333]="INKNAMES";d[334]="NUMBEROFINKS";
d[336]="DOTRANGE";d[337]="TARGETPRINTER";d[338]="EXTRASAMPLES";d[339]="SAMPLEFORMAT";d[340]="SMINSAMPLEVALUE";d[341]="SMAXSAMPLEVALUE";d[342]="TRANSFERRANGE";d[347]="JPEGTABLES";d[512]="JPEGPROC";d[513]="JPEGIFOFFSET";d[514]="JPEGIFBYTECOUNT";d[515]="JPEGRESTARTINTERVAL";d[517]="JPEGLOSSLESSPREDICTORS";d[518]="JPEGPOINTTRANSFORM";d[519]="JPEGQTABLES";d[520]="JPEGDCTABLES";d[521]="JPEGACTABLES";d[529]="YCBCRCOEFFICIENTS";d[530]="YCBCRSUBSAMPLING";d[531]="YCBCRPOSITIONING";d[532]="REFERENCEBLACKWHITE";
d[33550]="GEOPIXELSCALE";d[33922]="GEOTIEPOINTS";d[33432]="COPYRIGHT";d[42112]="GDAL_METADATA";d[42113]="GDAL_NODATA";d[50844]="RPCCOEFFICIENT";d[34735]="GEOKEYDIRECTORY";d[34736]="GEODOUBLEPARAMS";d[34737]="GEOASCIIPARAMS";return d}(),h=[0,1,1,2,4,8,1,1,2,4,8,4,8],f=function(d,a){var c="UNKNOWN";3===d?c="F32":1===d?8>=a?c="U8":16>=a?c="U16":32>=a&&(c="U32"):2===d&&(8>=a?c="S8":16>=a?c="S16":32>=a&&(c="S32"));return c};return{decode:function(d){var a=new DataView(d,0,8),c=a.getUint16(0,!1);if(18761===
c)var n=!0;else if(19789===c)n=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,n))throw"unexpected tiff identifier";var m=a.getUint32(4,n);var q=n;var l,e;var t=m;for(var x=[];t;){var r=(new DataView(d,t,2)).getUint16(0,q);var w=t+2;t=(new DataView(d,w+12*r,4)).getUint32(0,q);var u={};for(l=0;l<r;l++){var v=new DataView(d,w,12);var y=v.getUint16(0,q);var z=v.getUint16(2,q);var B=v.getUint32(4,q);var C=v.getUint32(8,q);w+=12;if(!(7===z||12<z)){var E=e={fieldTag:y,fieldType:z,fieldValueCount:B,
fieldValueOffset:C},D=void 0,G=void 0,H=d,N=q,O=[],S=e.fieldType,da=e.fieldValueCount,J=e.fieldValueOffset,M=J,K=h[S],R=8*K,X=da*K,Q=da*h[S]*8;if(32>=Q)if(N||(J>>>=32-Q),1===da)O=[J];else for(D=0;D<da;D++)O.push(J<<R*D>>>32-R);else for(M=J;M<J+X;M+=K){switch(S){case 1:G=(new DataView(H,M,1)).getUint8(0);break;case 2:G=(new DataView(H,M,1)).getUint8(0);break;case 3:G=(new DataView(H,M,2)).getUint16(0,N);break;case 4:G=(new DataView(H,M,4)).getUint32(0,N);break;case 5:G=(new DataView(H,M,4)).getUint32(0,
N)/(new DataView(H,M+4,4)).getUint32(0,N);break;case 6:G=(new DataView(H,M,1)).getInt8(0);break;case 8:G=(new DataView(H,M,2)).getInt16(0,N);break;case 9:G=(new DataView(H,M,4)).getInt32(0,N);break;case 10:G=(new DataView(H,M,4)).getInt32(0,N)/(new DataView(H,M+4,4)).getInt32(0,N);break;case 11:G=(new DataView(H,M,4)).getFloat32(0,N);break;case 12:G=(new DataView(H,M,8)).getFloat64(0,N);break;case 7:G=null;break;default:G=null}O.push(G)}if(2===S){var W="",I=O;O=[];for(D=0;D<I.length;D++)0===I[D]&&
""!==W?(O.push(W),W=""):W+=String.fromCharCode(I[D]);""===W&&0!==O.length||O.push(W)}E.fieldValues=O;var T=u,Y=b[y];void 0===Y&&(Y="unknown"+y);T[Y]={type:z,values:e.fieldValues}}}x.push(u)}if(0===x.length)throw"no valid image file directory";var ca,V=x[0],Z=void 0===V.GDAL_NODATA||null===V.GDAL_NODATA?null:parseFloat(V.GDAL_NODATA.values[0]);if(V.TILEOFFSETS){var ja=p()===q,la=V.TILEOFFSETS?V.TILEOFFSETS.values:void 0;if(void 0===la)var ba=void 0;else{var ka=V.TILEBYTECOUNTS.values,qa=V.TILEWIDTH.values[0],
wa=V.TILELENGTH.values[0],za=V.IMAGEWIDTH.values[0],Fa=V.IMAGELENGTH.values[0],Ba=za*Fa,Ca=V.BITSPERSAMPLE.values[0],ra=V.SAMPLESPERPIXEL.values[0],Va=V.SAMPLEFORMAT?V.SAMPLEFORMAT.values[0]:1,Sa=f(Va,Ca);if(1!==(V.PLANARCONFIGURATION?V.PLANARCONFIGURATION.values[0]:1))throw"can only handle PLANARCONFIGURATION\x3d1";var Ra=V.COMPRESSION?V.COMPRESSION.values[0]:1;if(1!==Ra&&6!==Ra&&8!==Ra&&32946!==Ra)throw"this compression is not supported at this moment";if(3<Va)ba=void 0;else{if(3===Va){var Ta=new Float32Array(Ba*
ra);var Wa=Float32Array}else 1===Va?8>=Ca?(Ta=new Uint8Array(Ba*ra),Wa=Uint8Array):16>=Ca?(Ta=new Uint16Array(Ba*ra),Wa=Uint16Array):32>=Ca&&(Ta=new Uint32Array(Ba*ra),Wa=Uint32Array):2===Va&&(8>=Ca?(Ta=new Int8Array(Ba*ra),Wa=Int8Array):16>=Ca?(Ta=new Int16Array(Ba*ra),Wa=Int16Array):32>=Ca&&(Ta=new Int32Array(Ba*ra),Wa=Int32Array));var La,$a,ya,Xa,bb,cb=Math.ceil(za/qa);if(0===Ca%8)for(La=0;La<la.length;La++){var ab=Math.floor(La/cb)*wa;var Ua=La%cb*qa;var db=(ab*za+Ua)*ra;if("U8"===Sa||"S8"===
Sa||ja)if(8===Ra||32946===Ra){var A=new Uint8Array(d,la[La],ka[La]);var F=new g(A);var L=F.getBytes();var U=new ArrayBuffer(L.length);A=new Uint8Array(U);A.set(L)}else if(6===Ra){A=new Uint8Array(d,la[La],ka[La]);var P=new k;P.parse(A);var aa=P.getData(P.width,P.height);U=new ArrayBuffer(aa.length);A=new Uint8Array(U);A.set(aa)}else 1===Ra&&(U=d.slice(la[La],la[La]+ka[La]));else{if(8===Ra||32946===Ra){A=new Uint8Array(d,la[La],ka[La]);F=new g(A);A=F.getBytes();U=new ArrayBuffer(A.length);var ea=new Uint8Array(U)}else 1===
Ra&&(U=new ArrayBuffer(ka[La]),A=new Uint8Array(d,la[La],ka[La]),ea=new Uint8Array(U));switch(Sa){case "U16":case "S16":for(ya=0;ya<A.length;ya+=2)ea[ya]=A[ya+1],ea[ya+1]=A[ya];break;case "U32":case "S32":case "F32":for(ya=0;ya<A.length;ya+=4)ea[ya]=A[ya+3],ea[ya+1]=A[ya+2],ea[ya+2]=A[ya+1],ea[ya+3]=A[ya]}}var fa=new Wa(U);var ha=0;var ia=db;var ma=Math.min(qa,za-Ua);var oa=Math.min(wa,Fa-ab);for(Xa=0;Xa<oa;Xa++)for(ia=db+Xa*za*ra,ha=Xa*qa*ra,bb=0;bb<ma*ra;bb++,ia++,ha++)Ta[ia]=fa[ha]}var na={width:za,
height:Fa,pixelType:Sa};if(1===ra)na.pixels=[Ta];else for(na.pixels=[],La=0;La<ra;La++){var ta=new Wa(Ba);for($a=0;$a<Ba;$a++)ta[$a]=Ta[$a*ra+La];na.pixels.push(ta)}ba=na}}}else if(V.STRIPOFFSETS){var sa=p()===q,xa=V.STRIPOFFSETS?V.STRIPOFFSETS.values:void 0;if(void 0===xa)ba=void 0;else{var Da=V.STRIPBYTECOUNTS.values,Oa=V.ROWSPERSTRIP.values,Ha=V.IMAGEWIDTH.values[0],Ia=V.IMAGELENGTH.values[0],Aa=Ha*Ia,ua=V.BITSPERSAMPLE.values[0],va=V.SAMPLESPERPIXEL.values[0],Ka=V.SAMPLEFORMAT?V.SAMPLEFORMAT.values[0]:
1,Pa=f(Ka,ua);if(1!==(V.PLANARCONFIGURATION?V.PLANARCONFIGURATION.values[0]:1))throw"can only handle PLANARCONFIGURATION\x3d1";var Qa=V.COMPRESSION?V.COMPRESSION.values[0]:1;if(1!==Qa&&6!==Qa&&8!==Qa&&32946!==Qa)throw"compressed tiff is not supported at this moment";if(3<Ka)ba=void 0;else{if(3===Ka){var Ya=new Float32Array(Aa*va);var Za=Float32Array}else 1===Ka?8>=ua?(Ya=new Uint8Array(Aa*va),Za=Uint8Array):16>=ua?(Ya=new Uint16Array(Aa*va),Za=Uint16Array):32>=ua&&(Ya=new Uint32Array(Aa*va),Za=Uint32Array):
2===Ka&&(8>=ua?(Ya=new Int8Array(Aa*va),Za=Int8Array):16>=ua?(Ya=new Int16Array(Aa*va),Za=Int16Array):32>=ua&&(Ya=new Int32Array(Ha*Ia*va),Za=Int32Array));var Ma,eb,Na;if(0===ua%8)for(Ma=0;Ma<xa.length;Ma++){var ib=Ma*Oa*Ha*va;if("U8"===Pa||"S8"===Pa||sa)if(8===Qa||32946===Qa){var pa=new Uint8Array(d,xa[Ma],Da[Ma]);var Ea=new g(pa);var Ja=Ea.getBytes();var Ga=new ArrayBuffer(Ja.length);pa=new Uint8Array(Ga);pa.set(Ja)}else if(6===Qa){pa=new Uint8Array(d,xa[Ma],Da[Ma]);var fb=new k;fb.parse(pa);var jb=
fb.getData(fb.width,fb.height);Ga=new ArrayBuffer(jb.length);pa=new Uint8Array(Ga);pa.set(jb)}else 1===Qa&&(Ga=d.slice(xa[Ma],xa[Ma]+Da[Ma]));else{if(6===Qa||8===Qa||32946===Qa){pa=new Uint8Array(d,xa[Ma],Da[Ma]);Ea=new g(pa);pa=Ea.getBytes();Ga=new ArrayBuffer(pa.length);var gb=new Uint8Array(Ga)}else 1===Qa&&(Ga=new ArrayBuffer(Da[Ma]),pa=new Uint8Array(d,xa[Ma],Da[Ma]),gb=new Uint8Array(Ga));switch(Pa){case "U16":case "S16":for(Na=0;Na<pa.length;Na+=2)gb[Na]=pa[Na+1],gb[Na+1]=pa[Na];break;case "U32":case "S32":case "F32":for(Na=
0;Na<pa.length;Na+=4)gb[Na]=pa[Na+3],gb[Na+1]=pa[Na+2],gb[Na+2]=pa[Na+1],gb[Na+3]=pa[Na]}}var lb=new Za(Ga);Ya.set(lb,ib)}var hb={width:Ha,height:Ia,pixelType:Pa};if(1===va)hb.pixels=[Ya];else for(hb.pixels=[],Ma=0;Ma<va;Ma++){var kb=new Za(Aa);for(eb=0;eb<Aa;eb++)kb[eb]=Ya[eb*va+Ma];hb.pixels.push(kb)}ba=hb}}}if(null!==Z){ba.maskData=new Uint8Array(ba.width*ba.height);if(1E24<Math.abs(Z))for(ca=0;ca<ba.width*ba.height;ca++)ba.maskData[ca]=1E-6>Math.abs((ba.pixels[0][ca]-Z)/Z)?0:1;else for(ca=0;ca<
ba.width*ba.height;ca++)ba.maskData[ca]=ba.pixels[0][ca]===Z?0:1;ba.noDataValue=Z}return ba}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q){function l(e){var t=
new b;h(e).then(function(x){t.resolve()});return t.promise}return function(){function e(t){this.customModules=t&&t.customModules}e.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};e.prototype.start=function(){this.stop();var t=new b,x=0,r=this.customModules?this.customModules.length+1:1,w=c.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",k,p),u=d.open(w,{client:this}).then(function(v){this._connection=v;x++;x===r&&(this._connected=!0,t.resolve())}.bind(this));
this._openDL=[u];this.customModules&&this.customModules.forEach(function(v){u=d.open(v,{client:this}).then(function(y){x++;x===r&&(this._connected=!0,t.resolve())});this._openDL.push(u)}.bind(this));return this._connectionPromise=t.promise};e.prototype.stop=function(){this._openDL?this._openDL.forEach(function(t){t.isFulfilled()||t.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();this._connection&&(this._connection.close(),this._connection=
null)};e.prototype.decode=function(t){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var x={id:null};return this._connection.invoke("decode",t,[],x).then(function(r){r.targetWorker=x;return r})};e.prototype.process=function(t){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var x={id:null};t.layerId=this.rasterLayer.layerId;var r=new b;this._connection.invoke("process",t,[],x).then(function(w){w.targetWorker=
x;w.src?Object.keys(w.src).forEach(function(u){w.src[u].pixelBlock=new f(w.src[u].pixelBlock)}):w.src=null;w.pixelBlock&&(w.pixelBlock=new f(w.pixelBlock));r.resolve(w)});return r.promise};e.prototype.render=function(t){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var x={id:null};t.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",t,[],x).then(function(r){r.targetWorker=x;r.pixelBlock=r.pixelBlock?new f(r.pixelBlock):null;
return r})};e.prototype.setLayer=function(t){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));this.rasterLayer=t;t=this._connection.broadcast("setLayer",t,[],{id:null});return l(t)};e.prototype.setRasterFunction=function(t){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));t=this._connection.broadcast("setRasterFunction",t,[],{id:null});return l(t)};e.prototype.setRasterRenderer=function(t){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));t=this._connection.broadcast("setRasterRenderer",t,[],{id:null});return l(t)};return e}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(k,g,p){Object.defineProperty(g,"__esModule",{value:!0});for(var b in p)g.hasOwnProperty(b)||(g[b]=p[b])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),
function(k,g,p,b,h,f,d,a,c){function n(){if(x)return x;for(var r=m+q,w=[],u=function(y){var z=c.create(y).then(function(B){return t[y]=B});w.push(z)},v=0;v<r;v++)u(v);return x=b(w).then(function(){})}Object.defineProperty(g,"__esModule",{value:!0});g.Connection=d;g.RemoteClient=a;(d=navigator.hardwareConcurrency)||(d=p("safari")&&p("mac")||p("trident")?8:2);var m=p("esri-workers-debug")?1:Math.max(1,Math.ceil(d/2)),q=p("esri-workers-debug")?1:Math.max(1,Math.floor(d/2)),l=h.getLogger("esri.core.workers"),
e=0,t=[];g.initialize=function(){n()};g.open=function(r,w,u){void 0===w&&(w={});if(Array.isArray(r))return new g.Connection(r.map(function(z){return new g.RemoteClient(z,w.client)}));if("string"!==typeof r){l.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var v=r;r=w;w={client:v,strategy:u?"dedicated":"distributed"}}var y=w.strategy||"distributed";return"local"===y?f.create(function(z){k([r],function(B){z(g.RemoteClient.connect(B))})}).then(function(z){return new g.Connection([new g.RemoteClient(z,
w.client)])}):n().then(function(){if("dedicated"===y){var z=m+e++;e%=q;return t[z].open(r).then(function(B){return new g.Connection([new g.RemoteClient(B,w.client)])})}return f.all(t.map(function(B){return B.open(r)})).then(function(B){return new g.Connection(B.map(function(C){return new g.RemoteClient(C,w.client)}))})})};g.terminate=function(){for(var r=0;r<t.length;r++)t[r]&&t[r].terminate();t.length=0};var x})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(k,g,p){var b={info:0,warn:1,error:2};k=function(){function h(f){void 0===f&&(f={});this.module=f.module||"";this.writer=f.writer||null;this.level=f.level||null;null!=f.enabled&&(this.enabled=!!f.enabled);h._loggers[this.module]=this;f=this.module.lastIndexOf(".");-1!==f&&(this.parent=h.getLogger(this.module.slice(0,f)))}h.prototype.log=function(f){for(var d=[],a=1;a<arguments.length;a++)d[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(f)&&(a=this._inheritedWriter())&&a.apply(void 0,
[f,this.module].concat(d))};h.prototype.error=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["error"].concat(f))};h.prototype.warn=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["warn"].concat(f))};h.prototype.info=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["info"].concat(f))};h.prototype.getLogger=function(f){return h.getLogger(this.module+"."+f)};h.getLogger=function(f){var d=
h._loggers[f];d||(d=new h({module:f}));return d};h.prototype._parentWithMember=function(f,d){for(var a=this;a&&null==a[f];)a=a.parent;return a?a[f]:d};h.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};h.prototype._consoleWriter=function(f,d){for(var a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];console[f].apply(console,["["+d+"]"].concat(a))};h.prototype._matchLevel=function(f){return b[this._parentWithMember("level","error")]<=b[f]};h.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};h._loggers={};return h}();k.getLogger("esri").level="warn";return k})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(k,g,p,b,h,f){function d(a){if(a){if("function"!==typeof a.forEach){var c=Object.keys(a),n=c.map(function(e){return a[e]});return d(n).then(function(e){var t={};c.forEach(function(x,r){return t[x]=e[r]});return t})}var m=new p,
q=[],l=a.length;0===l&&m.resolve(q);a.forEach(function(e){var t={promise:e};q.push(t);e.then(function(x){t.value=x}).catch(function(x){t.error=x}).then(function(){--l;0===l&&m.resolve(q)})});return m.promise}}Object.defineProperty(g,"__esModule",{value:!0});g.all=function(a){return h(a)};g.filter=function(a,c){var n=a.slice();return h(a.map(function(m,q){return c(m,q)})).then(function(m){return n.filter(function(q,l){return m[l]})})};g.eachAlways=d;g.create=function(a,c){var n=new p(c);a(function(m){void 0===
m&&(m=null);return b(m).then(n.resolve)},n.reject);return n.promise};g.reject=function(a){var c=new p;c.reject(a);return c.promise};g.resolve=function(a){void 0===a&&(a=null);var c=new p;c.resolve(a);return c.promise};g.after=function(a,c){void 0===c&&(c=null);var n=0,m=new p(function(){n&&(clearTimeout(n),n=0)});n=setTimeout(function(){m.resolve(c)},a);return m.promise};g.timeout=function(a,c,n){var m=0,q=new p(a.cancel);a.then(function(l){q.isFulfilled()||(q.resolve(l),m&&(clearTimeout(m),m=0))});
a.catch(function(l){q.isFulfilled()||(q.reject(l),m&&(clearTimeout(m),m=0))});m=setTimeout(function(){var l=n||new f("promiseUtils:timeout","The wrapped promise did not resolve within "+c+" ms");q.reject(l)},c);return q.promise};g.wrapCallback=function(a){var c=!1,n=new p(function(){return c=!0});a(function(m){c||n.resolve(m)});return n.promise};g.isThenable=function(a){return a&&"function"===typeof a.then};g.when=function(a){return b(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(k,g,p,b,h){k=function(f){function d(a,c,n){var m=f.call(this,a,c,n)||this;return m instanceof d?m:new d(a,c,n)}p(d,f);d.prototype.toJSON=function(){return{name:this.name,message:this.message,details:b.clone(this.details),dojoType:this.dojoType}};d.fromJSON=function(a){var c=new d(a.name,a.message,a.details);null!=a.dojoType&&(c.dojoType=a.dojoType);return c};return d}(h);k.prototype.type="error";return k})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var b in p)p.hasOwnProperty(b)&&(g[b]=p[b])};return function(g,p){function b(){this.constructor=g}k(g,p);g.prototype=null===p?Object.create(p):(b.prototype=p.prototype,new b)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(k,g,p,b,
h,f){function d(e){return void 0!==e&&null!==e}function a(e){return d(e)?e:""}function c(e,t,x){var r=x.match(/([^\(]+)(\([^\)]+\))?/i),w=g.trim(r[1]);x=t[e];r=JSON.parse((r[2]?g.trim(r[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var u=r.utcOffset;if(-1===q.indexOf(w))w=g.getObject(w),g.isFunction(w)&&(x=w(x,e,t,r));else if("number"===typeof x||"string"===typeof x&&x&&!isNaN(Number(x)))switch(x=
Number(x),w){case "NumberFormat":e=g.mixin({},r);t=parseFloat(e.places);if(isNaN(t)||0>t)e.places=Infinity;return b.format(x,e);case "DateString":x=new Date(x);if(r.local||r.systemLocale)return r.systemLocale?x.toLocaleDateString()+(r.hideTime?"":" "+x.toLocaleTimeString()):x.toDateString()+(r.hideTime?"":" "+x.toTimeString());x=x.toUTCString();r.hideTime&&(x=x.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return x;case "DateFormat":return x=new Date(x),d(u)&&(x=p.add(x,"minute",x.getTimezoneOffset()-
u)),h.format(x,r)}return a(x)}function n(e,t){var x;if(t)for(x in e)e.hasOwnProperty(x)&&(void 0===e[x]?delete e[x]:e[x]instanceof Object&&n(e[x],!0));else for(x in e)e.hasOwnProperty(x)&&void 0===e[x]&&delete e[x];return e}function m(e){if(!e||"object"!=typeof e||g.isFunction(e))return e;if(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||
e instanceof Float64Array||e instanceof Date)return new e.constructor(e);if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if("function"===typeof e.clone)e=e.clone();else if("function"===typeof e.map&&"function"===typeof e.forEach)e=e.map(m);else if("function"===typeof e.notifyChange&&"function"===typeof e.watch)e=e.clone();else{var t={},x,r={};for(x in e){var w=e[x];var u=!(x in r)||r[x]!==w;if(!(x in t)||t[x]!==w&&u)t[x]=m?m(w):w}e=t}return e}var q=["NumberFormat","DateString","DateFormat"],
l=/<\/?[^>]+>/g;return{equals:function(e,t){return e===t||"number"===typeof e&&isNaN(e)&&"number"===typeof t&&isNaN(t)||g.isFunction((e||{}).getTime)&&g.isFunction((t||{}).getTime)&&e.getTime()==t.getTime()||g.isFunction((e||{}).equals)&&e.equals(t)||g.isFunction((t||{}).equals)&&t.equals(e)||!1},mixin:g.mixin,valueOf:function(e,t){for(var x in e)if(e[x]==t)return x;return null},stripTags:function(e){if(e){var t=typeof e;if("string"===t)e=e.replace(l,"");else if("object"===t)for(var x in e)(t=e[x])&&
"string"===typeof t&&(t=t.replace(l,"")),e[x]=t}return e},substitute:function(e,t,x){if(d(x))if(g.isObject(x)){var r=x.first;var w=x.dateFormat;var u=x.numberFormat}else r=x;if(t&&"{*}"!==t)return g.replace(t,g.hitch({obj:e},function(y,z){y=z.split(":");return 1<y.length?(z=y[0],y.shift(),c(z,this.obj,y.join(":"))):w&&-1!==(w.properties||[]).indexOf(z)?c(z,this.obj,w.formatter||"DateString"):u&&-1!==(u.properties||[]).indexOf(z)?c(z,this.obj,u.formatter||"NumberFormat"):a(this.obj[z])}));t=[];var v;
t.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+f.fieldsSummary+'"\x3e\x3ctbody\x3e');for(v in e)if(x=e[v],w&&-1!==(w.properties||[]).indexOf(v)?x=c(v,e,w.formatter||"DateString"):u&&-1!==(u.properties||[]).indexOf(v)&&(x=c(v,e,u.formatter||"NumberFormat")),t.push("\x3ctr\x3e\x3cth\x3e"+v+"\x3c/th\x3e\x3ctd\x3e"+a(x)+"\x3c/td\x3e\x3c/tr\x3e"),r)break;t.push("\x3c/tbody\x3e\x3c/table\x3e");return t.join("")},filter:function(e,t,x){t=[g.isString(e)?e.split(""):e,x||k.global,g.isString(t)?
new Function("item","index","array",t):t];x={};var r;e=t[0];for(r in e)t[2].call(t[r],e[r],r,e)&&(x[r]=e[r]);return x},startsWith:function(e,t,x){x=x||0;return e.indexOf(t,x)===x},endsWith:function(e,t,x){if("number"!==typeof x||!isFinite(x)||Math.floor(x)!==x||x>e.length)x=e.length;x-=t.length;e=e.indexOf(t,x);return-1!==e&&e===x},isDefined:d,fixJson:n,clone:m}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(k,g,p){return function(){function b(h,
f,d){this instanceof b&&(this.name=h,this.message=f&&p.substitute(f,d,function(a){return null==a?"":a})||"",this.details=d)}b.prototype.toString=function(){return"["+this.name+"]: "+this.message};return b}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(k,g,p){return function(){function b(h){this._clientIdx=0;this._clients=h}b.prototype.broadcast=function(h,f,d){for(var a=[],c=0,n=this._clients;c<n.length;c++)a.push(n[c].invoke(h,
f,d));return a};b.prototype.close=function(){for(var h=0,f=this._clients;h<f.length;h++)f[h].close();this._clients=[]};b.prototype.invoke=function(h,f,d,a){var c=a&&a.client;if(!this._clients||!this._clients.length)return p.reject(Error("Connection closed"));null!=c&&-1!==this._clients.indexOf(c)||this._clients.some(function(n){return n.isBusy()?!1:(c=n,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,c=this._clients[this._clientIdx]);h=c.invoke(h,f,d);a&&(a.client=c);return h};b.prototype.openPorts=
function(){return p.all(this._clients.map(function(h){return h.openPort()}))};return b}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(k,g,p,b,h,f){function d(e,t){e["delete"](t)}var a=f.MessageType.CLOSE,c=f.MessageType.CANCEL,n=f.MessageType.INVOKE,m=f.MessageType.RESPONSE,q=f.MessageType.OPEN_PORT,l=function(){function e(t){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=t;this._timer=null;this._process=this._process.bind(this)}e.prototype.push=function(t){t.type===f.MessageType.CANCEL?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),null===this._timer&&(this._timer=setTimeout(this._process,0)))};e.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};e.prototype._process=function(){this._timer=null;for(var t=0,x=this._invokeMessages;t<x.length;t++){var r=x[t];this._cancelledJobIds.has(r.jobId)||
this._invoke(r)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return e}();return function(){function e(t,x,r){this._outJobs=new Map;this._inJobs=new Map;this._queue=new l(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=x;this._port=t;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=r}e.connect=function(t){var x=new MessageChannel;t="function"===typeof t?new t:"default"in t&&"function"===typeof t.default?new t.default:
t;t.remoteClient=new e(x.port1,t,x);return x.port2};e.prototype.close=function(){this._post({type:a});this._close()};e.prototype.isBusy=function(){return 0<this._outJobs.size};e.prototype.invoke=function(t,x,r){var w=this;if(!this._port)return h.reject(new b("remote-client:port-closed","Can't invoke(), port is closed"));var u=f.newJobId(),v=new p(function(){d(w._outJobs,u);w._post({type:c,jobId:u})});this._outJobs.set(u,v);this._post({type:n,jobId:u,methodName:t},x,r);return v.promise};e.prototype.openPort=
function(){var t=this,x=f.newJobId(),r=new p(function(){d(t._outJobs,x);t._post({type:c,jobId:x})});this._outJobs.set(x,r);this._post({type:q,jobId:x});return r.promise};e.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(t){t.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};e.prototype._onMessage=function(t){if(t=f.receiveMessage(t))switch(t.type){case m:this._onResponse(t);
break;case n:this._queue.push(t);break;case c:this._onCancel(t);break;case a:this._close();break;case q:this._onOpenPort(t)}};e.prototype._onCancel=function(t){var x=this._inJobs,r=t.jobId,w=x.get(r);this._queue.push(t);w&&(d(x,r),w.cancel())};e.prototype._onInvoke=function(t){var x=this,r=t.methodName,w=t.jobId;t=t.data;var u=this._inJobs,v=this._client,y=v[r];try{if(!y&&r&&-1!==r.indexOf("."))for(var z=r.split("."),B=0;B<z.length-1;B++)v=v[z[B]],y=v[z[B+1]];if("function"!==typeof y)throw new TypeError(r+
" is not a function");var C=y.call(v,t,this)}catch(E){this._post({type:m,jobId:w,error:f.toInvokeError(E)});return}h.isThenable(C)?(u.set(w,C),C.then(function(E){u.has(w)&&(d(u,w),x._post({type:m,jobId:w},E))}).catch(function(E){u.has(w)&&(d(u,w),E&&"cancel"===E.dojoType||x._post({type:m,jobId:w,error:f.toInvokeError(E||{message:"Error encountered at method "+r})}))})):this._post({type:m,jobId:w},C)};e.prototype._onOpenPort=function(t){var x=new MessageChannel;new e(x.port1,this._client);this._post({type:m,
jobId:t.jobId},x.port2,[x.port2])};e.prototype._onResponse=function(t){var x=t.jobId,r=t.error;t=t.data;var w=this._outJobs;if(w.has(x)){var u=w.get(x);d(w,x);r?u.reject(b.fromJSON(JSON.parse(r))):u.resolve(t)}};e.prototype._post=function(t,x,r){return f.postMessage(this._port,t,x,r)};return e}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(k,g,p){function b(f){return f&&"object"===typeof f&&("result"in f||"transferList"in f)}Object.defineProperty(g,
"__esModule",{value:!0});(function(f){f[f.HANDSHAKE=0]="HANDSHAKE";f[f.CONFIGURE=1]="CONFIGURE";f[f.CONFIGURED=2]="CONFIGURED";f[f.OPEN=3]="OPEN";f[f.OPENED=4]="OPENED";f[f.RESPONSE=5]="RESPONSE";f[f.INVOKE=6]="INVOKE";f[f.CANCEL=7]="CANCEL";f[f.CLOSE=8]="CLOSE";f[f.OPEN_PORT=9]="OPEN_PORT"})(g.MessageType||(g.MessageType={}));var h=0;g.newJobId=function(){return h++};g.isTranferableResult=b;g.toInvokeError=function(f){return f?f.toJSON?JSON.stringify(f):JSON.stringify({name:f.name,message:f.message,
details:f.details,stack:f.stack}):null};g.postMessage=function(f,d,a,c){2===arguments.length||void 0===a&&void 0===c?f.postMessage(d):(p("esri-workers-supports-transfer-arraybuffer")||(c?(c=c.filter(function(n){return!(n instanceof ArrayBuffer)}),c.length||(c=null)):b(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(n){return!(n instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),c?(d.data=a,f.postMessage(d,c)):b(a)?(d.data=a.result,a.transferList?f.postMessage(d,
a.transferList):f.postMessage(d)):(d.data=a,f.postMessage(d)))};g.receiveMessage=function(f){return f?(f=f.data)?"string"===typeof f?JSON.parse(f):f:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(k,g,p,b,h,f,d,a,c){var n=f.getLogger("esri.core.workers"),m=a.MessageType.CANCEL,q=a.MessageType.INVOKE,l=a.MessageType.OPEN,e=a.MessageType.OPENED,
t=a.MessageType.RESPONSE;return function(){function x(r,w){this._outJobs=new Map;this._inJobs=new Map;this.worker=r;this.id=w;r.addEventListener("message",this._onMessage.bind(this));r.addEventListener("error",function(u){u.preventDefault();n.error(u)})}x.create=function(r){return c.createWorker().then(function(w){return new x(w,r)})};x.prototype.terminate=function(){this.worker.terminate()};x.prototype.open=function(r){var w=this,u=a.newJobId(),v=new p(function(y){w._outJobs["delete"](u);w._post({type:m,
jobId:u})});this._outJobs.set(u,v);this._post({type:l,jobId:u,modulePath:r});return v.promise};x.prototype._onMessage=function(r){if(r=a.receiveMessage(r))switch(r.type){case e:case t:this._onResponse(r);break;case m:this._onCancel(r);break;case q:this._onInvoke(r)}};x.prototype._onCancel=function(r){(r=this._inJobs.get(r.jobId))&&r.cancel()};x.prototype._onInvoke=function(r){var w=this,u=r.methodName,v=r.jobId;r=r.data;var y=this._inJobs,z=b.workerMessages[u];try{if("function"!==typeof z)throw new TypeError(u+
" is not a function");var B=z.call(null,r)}catch(C){this._post({type:t,jobId:v,error:a.toInvokeError(C)});return}d.isThenable(B)?(y.set(v,B),B.then(function(C){y["delete"](v);w._post({type:t,jobId:v},C)}).catch(function(C){y["delete"](v);C||(C={message:"Error encountered at method"+u});C.dojoType&&"cancel"===C.dojoType||w._post({type:t,jobId:v,error:a.toInvokeError(C)})})):this._post({type:t,jobId:v},B)};x.prototype._onResponse=function(r){var w=r.jobId,u=r.error;r=r.data;var v=this._outJobs.get(w);
v&&(this._outJobs["delete"](w),u?v.reject(h.fromJSON(JSON.parse(u))):v.resolve(r))};x.prototype._post=function(r,w,u){return a.postMessage(this.worker,r,w,u)};return x}()})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(k,g,p,b){return function(){function h(){}Object.defineProperty(h,"id",{get:function(){return p.id?b:null},enumerable:!0,configurable:!0});h.workerMessages={};return h}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require",
"exports","esri/IdentityManager"],function(k,g,p){Object.defineProperty(g,"__esModule",{value:!0});g.findCredential=function(b){return p.findCredential(b)}})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l){function e(z){return a.create(function(B){function C(D){if(D=
q.receiveMessage(D))switch(D.type){case y:D=z;var G=h.workers.loaderUrl||m.DEFAULT_LOADER_URL;if(null!=h["default"]){var H=p({},h);delete H["default"];H=JSON.parse(JSON.stringify(H))}else H=JSON.parse(JSON.stringify(h));var N=h.workers.loaderConfig;N=m.default({baseUrl:N.baseUrl,locale:b.locale,has:p({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":c("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":c("esri-workers-supports-transfer-arraybuffer"),
"events-keypress-typed":0,"host-webworker":1},N.has),map:p({},N.map),paths:p({},N.paths),packages:N.packages||[]});D.postMessage({type:v,configure:{esriConfig:H,loaderUrl:G,loaderConfig:N}});break;case u:z.removeEventListener("message",C),z.removeEventListener("error",E),B(z)}}function E(D){D.preventDefault();z.removeEventListener("message",C);z.removeEventListener("error",E);r.warn("Failed to create Worker. Fallback to execute module in main thread",D);z=new l;z.addEventListener("message",C);z.addEventListener("error",
E)}z.addEventListener("message",C);z.addEventListener("error",E)})}Object.defineProperty(g,"__esModule",{value:!0});var t=n.normalize(k.toUrl("./worker.js")),x=!n.hasSameOrigin(t,location.href),r=d.getLogger("esri.core.workers"),w=null,u=q.MessageType.CONFIGURED,v=q.MessageType.CONFIGURE,y=q.MessageType.HANDSHAKE;g.createWorker=function(){if(!c("esri-workers"))return e(new l);if(!x){var z=void 0;try{z=new Worker(t)}catch(B){r.warn("Failed to create Worker. Fallback to execute module in main thread",
event),z=new l}return e(z)}w||(w=f(t,{responseType:"text"}));return w.then(function(B){return new Worker(URL.createObjectURL(new Blob([B.data],{type:"text/javascript"})))}).catch(function(B){r.warn("Failed to create Worker. Fallback to execute module in main thread",B);return new l}).then(function(B){return e(B)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(k){for(var g,p=1,b=arguments.length;p<b;p++){g=arguments[p];for(var h in g)Object.prototype.hasOwnProperty.call(g,
h)&&(k[h]=g[h])}return k}})},"esri/layers/vectorTiles/config":function(){define(["require","exports","esri/config"],function(k,g,p){Object.defineProperty(p,"workers",{get:function(){return p.defaults.workers},set:function(b){return p.defaults.workers=b}});return p})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(k,g,p,b,h){return function(f,d){f=b.mixin({},{url:f,failOk:!0},d);"array-buffer"===d.responseType?(f.handleAs=
"arraybuffer",delete f.responseType):d.responseType&&(f.handleAs=d.responseType,delete f.responseType);null!==d.query&&(f.content=f.query,delete f.query);if(d.hasOwnProperty("allowImageDataAccess")){var a={allowImageDataAccess:d.allowImageDataAccess};delete f.allowImageDataAccess}var c=new h(function(){n.isFulfilled()||n.cancel()});var n=p(f,a).then(function(m){c.resolve({data:m})}).catch(function(m){m&&null!=m.httpCode&&(m.details=m.details||{},m.details.httpStatus=m.httpCode);c.reject(m)});return c.promise}})},
"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(k,g,p,b,h){function f(){var n={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},m=document.createElement("canvas");if(!m)return n;var q=h.createContext(m,{failIfMajorPerformanceCaveat:!0},"webgl");!q&&(q=h.createContext(m,{},"webgl"))&&
(n.majorPerformanceCaveat=!0);if(!q)return n;m=q.getParameter(q.VERSION);if(!m)return n;if(m=m.match(/^WebGL\s+([\d.]*)/))n.version=parseFloat(m[1]),n.available=.94<=n.version,m=q.getShaderPrecisionFormat(q.FRAGMENT_SHADER,q.HIGH_FLOAT),n.supportsHighPrecisionFragment=m&&0<m.precision,n.supportsVertexShaderSamplers=0<q.getParameter(q.MAX_VERTEX_TEXTURE_IMAGE_UNITS),n.supportsElementIndexUint=null!==q.getExtension("OES_element_index_uint"),n.supportsStandardDerivatives=null!==q.getExtension("OES_standard_derivatives");
return n}function d(){var n={available:!1,version:0},m=document.createElement("canvas");if(!m)return n;m=h.createContext(m,{},"webgl2");if(!m)return n;n.available=!0;m=m.getParameter(m.VERSION);if(!m)return n;if(m=m.match(/^WebGL\s+([\d.]*)/))n.version=parseFloat(m[1]);return n}(function(){var n=navigator.userAgent,m=n.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);n=n.match(/iPhone/i);m&&p.add("esri-mobile",m);n&&p.add("esri-iPhone",n);p.add("esri-phonegap",!!b.cordova);
p.add("esri-cors",p("esri-phonegap")||"XMLHttpRequest"in b&&"withCredentials"in new XMLHttpRequest);p.add("esri-geolocation",function(){return!!navigator.geolocation});p.add("esri-canvas-svg-support",function(){return!(p("trident")||p("ie"))});p.add("esri-secure-context",function(){if("isSecureContext"in b)return b.isSecureContext;if(b.location&&b.location.origin)return 0===b.location.origin.indexOf("https:")});p.add("esri-wasm","WebAssembly"in b);p("host-webworker")||(p.add("esri-workers","Worker"in
b),p.add("esri-script-sandbox",function(){return"MessageChannel"in b&&"HTMLIFrameElement"in b&&"sandbox"in HTMLIFrameElement.prototype}),p.add("esri-url-encodes-apostrophe",function(){var q=b.document.createElement("a");q.href="?'";return-1<q.href.indexOf("?%27")}),a||(a=f()),p.add("esri-webgl",a.available),p.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),p.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),p.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),
p.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),p.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),p.add("esri-featurelayer-webgl-labeling",!0),c||(c=d()),p.add("esri-webgl2",c.available))})();var a=null,c=null;return p})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(k,g){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},
"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require","exports"],function(k,g){function p(d,a,c){void 0===a&&(a={});switch(c){case "webgl":var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":n=["webgl2"];break;default:n=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}c=null;for(var m=0;m<n.length;m++){var q=n[m];try{c=d.getContext(q,a)}catch(l){}if(c)break}return c}function b(d,a){(d=d.parentNode)&&(d.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(g,"__esModule",{value:!0});g.createContextOrErrorHTML=function(d,a,c){void 0===a&&(a={});if(!window.WebGLRenderingContext)return b(d,h),null;a=p(d,a,c);return a?a:(b(d,f),null)};g.createContext=p;var h='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',f='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(k,g,p,b){function h(v){return p.normalize(v)}function f(v){return"data:"===v.slice(0,5)}function d(v){return a(v)||w.test(v)}function a(v){return v&&"/"===v[0]&&"/"===v[1]}function c(v){return p.urlToObject(v)}function n(v){if("string"===typeof v)return new b(q(v));v.scheme||(v.scheme=g.appUrl.scheme);return v}function m(v){if(f(v))return null;var y=v.indexOf("://");if(-1===y&&
a(v))y=2;else if(-1!==y)y+=3;else return null;y=v.indexOf("/",y);return-1===y?v:v.slice(0,y)}function q(v,y,z){void 0===y&&(y=g.appBaseUrl);if(a(v))return z&&z.preserveProtocolRelative?v:"http"===g.appUrl.scheme&&g.appUrl.authority===m(v).slice(2)?"http:"+v:"https:"+v;if(w.test(v))return v;"/"===v[0]&&(z=y.indexOf("//"),z=y.indexOf("/",z+2),y=-1===z?y:y.slice(0,z));return e(y,v)}function l(v,y,z){void 0===z&&(z=!1);v=n(v);y=n(y);return z||v.scheme===y.scheme?v.host.toLowerCase()===y.host.toLowerCase()&&
v.port===y.port:!1}function e(){for(var v=[],y=0;y<arguments.length;y++)v[y]=arguments[y];if(v&&v.length){y=[];if(d(v[0])){var z=v[0],B=z.indexOf("//");y.push(z.slice(0,B+1));r.test(v[0])&&(y[0]+="/");v[0]=z.slice(B+2)}else"/"===v[0][0]&&y.push("");v=v.reduce(function(C,E){return E?C.concat(E.split("/")):C},[]);for(z=0;z<v.length;z++)B=v[z],".."===B&&0<y.length?y.pop():!B||"."===B&&0!==y.length||y.push(B);return y.join("/")}}function t(v,y,z){if(!(y&&z&&v&&d(v)))return v;var B=v.indexOf("//"),C=v.indexOf("/",
B+2),E=v.indexOf(":",B+2);C=Math.min(0>C?v.length:C,0>E?v.length:E);if(v.slice(B+2,C).toLowerCase()!==y.toLowerCase())return v;y=v.slice(0,B+2);v=v.slice(C);return""+y+z+v}function x(v,y,z){void 0===y&&(y=g.appBaseUrl);if(!d(v))return v;var B=h(v),C=B.toLowerCase();y=h(y).toLowerCase().replace(/\/+$/,"");if((z=z?h(z).toLowerCase().replace(/\/+$/,""):null)&&0!==y.indexOf(z))return v;for(var E=function(H,N,O){O=H.indexOf(N,O);return-1===O?H.length:O},D=E(C,"/",C.indexOf("//")+2),G=-1;C.slice(0,D+1)===
y.slice(0,D)+"/";){G=D+1;if(D===C.length)break;D=E(C,"/",D+1)}if(-1===G||z&&G<z.length)return v;v=B.slice(G);B=y.slice(G-1).replace(/[^/]+/g,"").length;if(0<B)for(C=0;C<B;C++)v="../"+v;else v="./"+v;return v}Object.defineProperty(g,"__esModule",{value:!0});g.normalize=h;g.canUseXhr=function(v){return p.canUseXhr(v)};g.removeTrailingSlash=function(v){return v.replace(/\/+$/,"")};k=Function("return this")();g.appUrl=new b(k.location);g.appBaseUrl=function(){var v=g.appUrl.path;v=v.substring(0,v.lastIndexOf(v.split("/")[v.split("/").length-
1]));return g.appUrl.scheme+"://"+g.appUrl.host+(null!=g.appUrl.port?":"+g.appUrl.port:"")+v}();var r=/^\s*file:/i,w=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;g.isDataProtocol=f;g.isAbsolute=d;g.isProtocolRelative=a;g.urlToObject=c;g.getOrigin=m;g.makeAbsolute=q;g.hasSameOrigin=l;g.join=e;g.removeFile=function(v){var y=0;if(d(v)){var z=v.indexOf("//");-1!==z&&(y=z+2)}z=v.lastIndexOf("/");return z<y?v:v.slice(0,z+1)};g.addProxy=function(v){return p.addProxy(v)};g.makeData=function(v){return v.isBase64?"data:"+
v.mediaType+";base64,"+v.data:"data:"+v.mediaType+","+v.data};var u=/^data:(.*?)(;base64)?,(.*)$/;g.dataComponents=function(v){return(v=v.match(u))?{mediaType:v[1],isBase64:!!v[2],data:v[3]}:null};g.changeDomain=t;g.read=function(v,y){var z=y&&y.url&&y.url.path;v&&z&&(v=q(v,z,{preserveProtocolRelative:!0}));(y=y&&y.portal)&&!y.isPortal&&y.urlKey&&y.customBaseUrl?(z=y.urlKey+"."+y.customBaseUrl,y=l(g.appUrl,g.appUrl.scheme+"://"+z)?t(v,y.portalHostname,z):t(v,z,y.portalHostname)):y=v;return y};g.write=
function(v,y){if(!v)return v;!d(v)&&y&&y.blockedRelativeUrls&&y.blockedRelativeUrls.push(v);var z=q(v);if(y){var B=y.verifyItemRelativeUrls&&y.verifyItemRelativeUrls.rootPath||y.url&&y.url.path;B&&(z=x(z,B,B),z!==v&&y.verifyItemRelativeUrls&&y.verifyItemRelativeUrls.writtenUrls.push(z))}v=z;z=(y=y&&y.portal)&&!y.isPortal&&y.urlKey&&y.customBaseUrl?t(v,y.urlKey+"."+y.customBaseUrl,y.portalHostname):v;return z};g.makeRelative=x;g.removeQueryParameters=function(v){v=c(v);Object.keys(v.query||{});return v.path}})},
"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(k,g,p,b,h){Object.defineProperty(g,"__esModule",{value:!0});g.DEFAULT_LOADER_URL=h.makeAbsolute(h.removeQueryParameters(k.toUrl("./worker-init.js")));g.DEFAULT_CONFIG={baseUrl:function(){var f=h.removeQueryParameters(k.toUrl("dojo/x.js"));return h.makeAbsolute(f.slice(0,f.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},
{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};g.default=
function(f){var d={async:f.async,isDebug:f.isDebug,locale:f.locale,baseUrl:f.baseUrl,has:p({},f.has),map:p({},f.map),packages:f.packages&&f.packages.concat()||[],paths:p({},f.paths)};f.hasOwnProperty("async")||(d.async=!0);f.hasOwnProperty("isDebug")||(d.isDebug=!1);f.baseUrl||(d.baseUrl=g.DEFAULT_CONFIG.baseUrl);g.DEFAULT_CONFIG.packages.forEach(function(m){a:{for(var q=d.packages,l=0;l<q.length;l++)if(q[l].name===m.name)break a;m=p({},m);l=h.removeQueryParameters(k.toUrl(m.name+"/x.js"));l=l.slice(0,
l.length-5);m.location=h.makeAbsolute(l);q.push(m)}});f=d.map=d.map||{};for(var a=0,c=Object.keys(g.DEFAULT_CONFIG.map);a<c.length;a++){var n=c[a];f[n]||(f[n]=g.DEFAULT_CONFIG.map[n])}return d}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(k,g,p,b,h){var f=function(){return function(){var c=this,n=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(m){c[m]=
function(){for(var q=[],l=0;l<arguments.length;l++)q[l]=arguments[l];return n[m].apply(n,q)}})}}(),d=b.MutationObserver||b.WebKitMutationObserver,a=function(){if(b.process&&b.process.nextTick)var c=function(q){b.process.nextTick(q)};else if(b.Promise)c=function(q){b.Promise.resolve().then(q)};else if(d){var n=[],m=document.createElement("div");(new d(function(){for(;0<n.length;)n.shift()()})).observe(m,{attributes:!0});c=function(q){n.push(q);m.setAttribute("queueStatus","1")}}return c}();return function(){function c(){this._dispatcher=
new f;this._isInitialized=!1;this._workerPostMessage({type:h.MessageType.HANDSHAKE})}c.prototype.terminate=function(){};Object.defineProperty(c.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(n){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=n)&&this.addEventListener("message",n)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(n){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=n)&&this.addEventListener("error",n)},enumerable:!0,configurable:!0});c.prototype.postMessage=function(n,m){var q=this;a(function(){q._workerMessageHandler(new MessageEvent("message",{data:n}))})};c.prototype.dispatchEvent=function(n){return this._dispatcher.dispatchEvent(n)};c.prototype.addEventListener=function(n,m,q){this._dispatcher.addEventListener(n,m,q)};c.prototype.removeEventListener=function(n,m,q){this._dispatcher.removeEventListener(n,
m,q)};c.prototype._workerPostMessage=function(n,m){var q=this;a(function(){q.dispatchEvent(new MessageEvent("message",{data:n}))})};c.prototype._workerMessageHandler=function(n){var m=this;if(n=h.receiveMessage(n)){var q=n.jobId;switch(n.type){case h.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:h.MessageType.CONFIGURED});break;case h.MessageType.OPEN:n=n.modulePath,p("esri-webpack")?k(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",n],function(l,e,t,x,r,w,u,v){switch(v){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":e=t;break;case "esri/views/3d/layers/PointCloudWorker":e=x;break;case "esri/views/3d/layers/SceneLayerWorker":e=r;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":e=
w;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":e=u;break;default:e=v}l=l.connect(e);m._workerPostMessage({type:h.MessageType.OPENED,jobId:q,data:l})}):k(["./RemoteClient",n],function(l,e){l=l.connect(e);m._workerPostMessage({type:h.MessageType.OPENED,jobId:q,data:l})})}}};return c}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(k,g,p){function b(h,f){if(Array.isArray(f)){var d=new p;h(f,function(){for(var a=
[],c=0;c<arguments.length;c++)a[c]=arguments[c];d.resolve(a)});return d.promise}return b(h,[f]).then(function(a){return a[0]})}Object.defineProperty(g,"__esModule",{value:!0});g.when=b;g.getAbsMid=function(h,f,d){return f.toAbsMid?f.toAbsMid(h):d.id.replace(/\/[^\/]*$/gi,"/")+h}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(k,g,p){return{create:function(b,h){if(b){var f=b.renderTexture,d=Object.keys(b);
if(b.read&&!h)return b;b.read&&h&&(b=b.toJson());-1<d.indexOf("name")&&d.indexOf(!1)?(b=g.mixin({},b),h=this._parseV2(b,h)):(b="esri.layers.RasterFunction"===b.declaredClass?b.toJson():g.mixin({},b),h=this._parseV1(b,h));h.branchCount=h.updateBranchStructure();h.renderTexture||(h.renderTexture=!!f);return h}},_parseV1:function(b,h){var f=b.rasterFunction,d=b.rasterFunctionArguments,a=b.renderTexture||b.rasterFunctionArguments.renderTexture||!1,c,n,m,q,l,e,t;(q=d.raster||d.Raster)&&q.rasterFunction&&
(c=this._parseV1(q,h));(q=d.raster2||d.Raster2)&&q.rasterFunction&&(n=this._parseV1(q,h));(q=d.rasters||d.Rasters)&&0<q.length&&(m=q.map(g.hitch(this,function(x){return x&&x.rasterFunction?this._parseV1(x,h):x})));(q=d.dem||d.DEM)&&(q.functionName||q.rasterFunction)&&(l=this._parseV1(q,h));(q=d.fillRaster||d.FillRaster)&&(q.functionName||q.rasterFunction)&&(e=this._parseV1(q,h));q=p.functions[f];if(!q)return null;f=new q(d);f.variableName&&(q=d[f.variableName])&&(q.functionName||q.rasterFunction)&&
(t=this._parseV1(q,h));b.outputPixelType&&(f.pixelType=b.outputPixelType);"$$"===c?f.functionArguments.raster=h&&h.raster:null!=c?f.functionArguments.raster=c:f.functionArguments.raster||(f.functionArguments.raster=h&&h.raster);null!=n&&(f.functionArguments.raster2=n);null!=m&&(f.functionArguments.rasters=m.map(function(x){"$$"===x&&(x=h&&h.raster);return x}));null!=l&&(f.functionArguments.dem=l);null!=e&&(f.functionArguments.fillRaster=e);null!=t&&(f.functionArguments[f.variableName]=t);f.renderTexture=
a;return f},_parseV2:function(b,h){if(!b)return null;b=g.clone(b);this._bindV2Args(b,h);var f={};this._convertTov1(b,f);return this._parseV1(f,h)},_bindV2Args:function(b,h){(b||h)&&Object.keys(b).forEach(function(f){b[f]["function"]&&b[f].arguments?this._bindV2Args(b[f].arguments,h):null!=h[b[f].name]&&(b[f].value=h[b[f].name])}.bind(this))},_convertV2Types:function(b){if(!b)return null;"ArgumentArray"===b.type?b.elements&&"RasterStatistics"===b.elements[0].type&&(b=b.elements):b instanceof Array&&
0===b.length&&(b=null);return b},_convertTov1:function(b,h){if((b||h)&&b["function"]){var f=b["function"],d=b.arguments;h.rasterFunction=f.type.replace("Function","");h.outputPixelType="UNKNOWN"===f.pixelType?"Unknown":f.pixelType;h.rasterFunctionArguments={};var a;Object.keys(d).forEach(function(c){d[c]["function"]&&d[c].arguments?(h.rasterFunctionArguments[c]={},this._convertTov1(d[c],h.rasterFunctionArguments[c])):(a=d[c].value,h.rasterFunctionArguments[c]="object"!==typeof a||a.functionArguments?
a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w){return function(){function u(B){B.prototype.supportWebGL&&(y[B.prototype.functionName]=B);B.prototype.support2D&&(v[B.prototype.functionName]=B);z[B.prototype.functionName]=B}var v={},y={},z={};u(p);u(b);u(h);u(f);u(d);u(a);u(c);u(n);u(m);u(q);u(l);u(e);u(t);u(x);u(r);u(w);return{cpu:v,gpu:y,functions:z,register:u,getFunction:function(B){return z[B]},support:function(B,C){return!!("gpu"===C?y:"cpu"===C?v:z)[B]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(k,g,p,b,h,f,d,a){return k([p,d],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({raster:null},c)},bind:function(){var c=this.getSourceRasterInfo();if(!c.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=a.aspect(c.raster);this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.aspect,fragmentName:"Aspect"});var n=this._setupTextureData(c.raster),m=this.bindFrameBuffer(),q=this.gl,l=q.drawingBufferWidth;q=q.drawingBufferHeight;var e=n.extent;
this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/l,1/q],u_cellSize:[(e.xmax-e.xmin)/l,(e.ymax-e.ymin)/q]});this._bindTexture(n.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:n.extent,texture:m.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(k,g,p,b,h,f){return k(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(d){d&&(this.pixelType=d.outputPixelType||d.OutputPixelType||this.pixelType,this.renderTexture=d.renderTexture,this._initFunction())},mixinIgnoreCase:function(d,a){var c=Object.keys(d),n=Object.keys(a),m,q,l=c.length;for(m=0;m<n.length;m++){var e=a[n[m]];if(null!=e)for(q=0;q<l;q++)if(c[q].toLowerCase()===n[m].toLowerCase()){d[c[q]]=e;break}}return d},bind:function(d){},
setProcessingContext:function(d){if(!d)throw"cannot bind to layer without options";this.useWebGL=!!d.useWebGL;this._tileMode=!!d.tileMode;this._glSetting=d.glSetting;this._rawRasterInfo=d.rawRasterInfo;this._xformSetting=d.xformSetting||this._xformSetting;this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,c=this.functionArguments.raster2,n=this.functionArguments.dem,m=this.functionArguments.fillRaster,
q=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(d);c&&c.functionArguments&&c.setProcessingContext(d);n&&n.functionArguments&&n.setProcessingContext(d);m&&m.functionArguments&&m.setProcessingContext(d);if(q)for(a=0;a<q.length;a++)q[a]&&q[a].functionArguments&&q[a].setProcessingContext(d);this.bind()},updateBranchStructure:function(){var d=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&(d+=a.raster.updateBranchStructure());a.raster2&&
a.raster2.read&&a.raster2.functionArguments&&(d+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(d=a.rasters.length,a.rasters.forEach(function(c){c.read&&c.functionArguments&&(c.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(d+=a.dem.updateBranchStructure());return 1===d?0:d},read:function(d){d=this.processRasterArgument(d);return this.useWebGL?this.readGL(d):this.read2D(d)},hasTilingEffects:function(){return!1},read2D:function(){},
readGL:function(){},getSourceRasterInfo:function(){var d,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],d=0;d<this.functionArguments.rasters.length;d++)a.rasters[d]=this._bindRaster(this.functionArguments.rasters[d]);else a.raster=this._bindRaster(this.functionArguments.raster);return this.sourceRasterInfo=
a},processRasterArgument:function(d){var a=this.bind();if(!0!==a)throw a;var c={};if(this.functionArguments.raster2)c.raster=this._readRaster(this.functionArguments.raster,d),c.raster2=this._readRaster(this.functionArguments.raster2,d);else if(this.functionArguments.rasters)for(c.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)c.rasters[a]=this._readRaster(this.functionArguments.rasters[a],d);else c.raster=this._readRaster(this.functionArguments.raster,d);return c},toJson:function(){var d=
this.functionArguments,a=d.raster,c=d.raster2;d=d.rasters;a=a?a.toJson?a.toJson():a:null;c=c?c.toJson?c.toJson():c:null;var n;d&&0<d.length&&(n=d.map(function(m){return m.toJson?m.toJson():m}));d=g.mixin({},this.functionArguments);d.raster=a;d.raster2=c;d.rasters=n;d=this._fixRasterFunctionJson(d);return{rasterFunction:this.functionName,rasterFunctionArguments:d,outputPixelType:this.pixelType}},_initFunction:function(d){},_getIntegerRange:function(d){switch(d){case "U8":var a=[0,255];break;case "U16":a=
[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(d,a){return d&&"unknown"!==d.toLowerCase()?d:a},_clonePixelData:function(d){if(null==d)return d;var a={};d.extent&&(a.extent=new h(d.extent.xmin,d.extent.ymin,d.extent.xmax,d.extent.ymax,d.extent.spatialReference));d=d.pixelBlock;if(null==d)return a;a.pixelBlock=d.clone?d.clone():f.prototype.clone(d);return a},
_readRaster:function(d,a){if(null==d||"$$"===d)var c=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else d&&d.rasterInfo&&!d.functionArguments?c=this._clonePixelData(a.src[d._rasterId]):isNaN(d)?d.read&&(c=d.functionArguments?d.read(a):this._clonePixelData(a)):(c=a.src?a.src[Object.keys(a.src)[0]]:a,a=c.pixelBlock,a=new Float32Array(a.width*a.height),a.fill(parseFloat(d)),c=this._clonePixelData(c),c.pixelBlock.pixels=[a],c.isConstant=!0);return c},_bindRaster:function(d){if(d&&"$$"!==d)isNaN(d)?
d.rasterInfo?a=d.rasterInfo:d.bind&&d.bind()&&(a=d.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new b(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(d,a){switch(d){case "U8":d=new Uint8Array(a);break;case "U16":d=new Uint16Array(a);break;case "U32":d=new Uint32Array(a);break;case "S8":d=new Int8Array(a);break;case "S16":d=new Int16Array(a);break;case "S32":d=new Int32Array(a);break;case "U32":d=new Uint32Array(a);break;case "F32":d=new Float32Array(a);
break;case "F64":d=new Float64Array(a);break;default:d=new Float32Array(a)}return d},_clampBand:function(d,a,c){if(("F64"===a||"F32"===a)&&!c)return d;var n,m=this._getIntegerRange(a),q=d.length;if(m)for(c=m[1],m=m[0],a=this._getOutputBand(a,q),n=0;n<q;n++){var l=d[n];a[n]=l>c?c:l<m?m:l}else a=d;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},
_addPerformanceMetric:function(d){p.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(d),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(d){for(var a in d)d.hasOwnProperty(a)&&(null==d[a]?delete d[a]:d[a]instanceof Object&&!d[a].sourceType&&this._fixRasterFunctionJson(d[a],!0));return d}})})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaderScripts"],function(k,g,p){k={shaderType:"fragment",getShader:function(b,h){var f=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(f,h);b.compileShader(f);b.getShaderParameter(f,b.COMPILE_STATUS)||(f=null);return f}};g.mixin(k,p);return k})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(k,g,p,b,h,f,d){return k(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var c=this._glSetting;this.isBranch?(c.branchIndex=(c.branchIndex+1)%c.branchCount,c=c.branches[c.branchIndex]):(c.pingpongIndex=(c.pingpongIndex+1)%c.pingpong.length,c=c.pingpong[c.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return c},_initializeProgram:function(a){if(this.gl)try{var c=this.gl;c.viewport(0,
0,c.drawingBufferWidth,c.drawingBufferHeight);var n=this._glSetting.programUniforms,m="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,q=n[m];if(q)this._uniforms=q.uniforms,this.rasterProgram=q.program;else{var l=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?h.mesh:h.basic,e=h.getShader(c,a.vertex||l),t=b.getShader(c,a.fragment),x=this._loadProgram(e,t),r={rasterProgram:f.getUniforms(c,x)};n[m]={uniforms:r,program:x};this.rasterProgram=
x;this._uniforms=r}c.useProgram(this.rasterProgram);var w=c.getAttribLocation(this.rasterProgram,"a_texCoord"),u=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,u);var v=f.createMesh(this._xformSetting.meshSize);c.bufferData(c.ARRAY_BUFFER,v,c.STATIC_DRAW);c.enableVertexAttribArray(w);c.vertexAttribPointer(w,2,c.FLOAT,!1,0,0);c.disable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ZERO);c.disable(c.BLEND);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(y){}},_setUniform:function(a,c,n){null!=c&&(n&&!this._uniforms[n]&&(this._uniforms[n]=f.getUniforms(this.gl,this[n])),n=n?this._uniforms[n]:this._uniforms.rasterProgram,(a=n[a]||n[a+"[0]"])&&f.setUniform(this.gl,a,c))},_setUniforms:function(a,c){var n=Object.keys(a),m,q=n.length;for(m=0;m<q;m++)this._setUniform(n[m],a[n[m]],c);this.rawInput?this._setUniform("u_flipY",!0,c):this._setUniform("u_flipY",!1,c);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,n=
this._xformSetting.scale):(a=[0,0],n=[1,1]),this._setUniform("u_xformOffset",a,c),this._setUniform("u_xformScale",n,c),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,c),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,c),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,c),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]),
c)):this._setUniform("u_projection",!1,c))):(a=[0,0],n=[1,1],this._setUniform("u_xformOffset",a,c),this._setUniform("u_xformScale",n,c));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,c){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&(a=a.raster);this.rawInput=
!0;var n=c&&c.notOriginal,m=c&&c.bandIDs;c&&c.reCreate?c=!1:(c=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(c=m?this._originalBandIDs.join("")===m.join(""):!1);0<this._glSetting.branchCount&&(c=!1);if(c&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};c=this._createTexture();n||(this.originalTexture=c,this._originalBandIDs=m);n=this.gl;var q=a.pixelBlock;this._rawResolution=q?[1/a.pixelBlock.width,1/a.pixelBlock.height]:
[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var l=0;m&&0<m.length&&q&&(l=Math.max.apply(null,m),q.pixels.length>l&&m&&(q.pixels=m.map(function(t){return q.pixels[t]}),q.statistics&&(q.statistics=m.map(function(t){return q.statistics[t]}))));m=q.width;l=q.height;n.getExtension("OES_texture_float");var e=q.getAsRGBAFloat();n.texImage2D(n.TEXTURE_2D,0,n.RGBA,m,l,0,n.RGBA,n.FLOAT,e);return{extent:a.extent,texture:c}},_setupPingPongTextures:function(){var a=this._glSetting;if(!a||!a.pingpong){a.pingpong=
[];var c=f.createBufferTexture(this.gl,!1);a.pingpong.push(c);c=f.createBufferTexture(this.gl,!1);a.pingpong.push(c);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var c=0,n=a.branchCount;if(0<n){for(c=0;c<n;c++){var m=f.createBufferTexture(this.gl,!1);a.branches.push(m)}a.branchIndex=n-1}}},_setupXformTexture:function(a){for(var c=this._createTexture(),n=this.gl,m=4*this._xformSetting.gridConfig.size[0],q=this._xformSetting.gridConfig.size[1],
l=new Float32Array(m*q*4),e=0,t=0;t<this._xformSetting.gridConfig.coefficients.length;t++)l[e++]=this._xformSetting.gridConfig.coefficients[t],2===t%3&&(l[e++]=1);n.getExtension("OES_texture_float");n.texImage2D(n.TEXTURE_2D,0,n.RGBA,m,q,0,n.RGBA,n.FLOAT,l);this._bindTexture(c,"u_transformGrid",a)},_createTexture:function(a){return f.createTexture(this.gl,a)},_bindTexture:function(a,c,n){c=c||"u_image";n=this._uniforms[n||"rasterProgram"];var m=this._getTextureIndex(c);if(-1!==m){var q=this.gl;q.uniform1i(n[c].location,
m);q.activeTexture(q.TEXTURE0+m);q.bindTexture(q.TEXTURE_2D,a)}},_getTextureIndex:function(a,c){c=this._uniforms[c||"rasterProgram"];if(!c||!c[a]||c[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;a="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?a+1:a},_drawGL:function(a){var c=this.gl;this.renderTexture?(c.enable(c.BLEND),c.bindFramebuffer(c.FRAMEBUFFER,null)):c.disable(c.BLEND);a||c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);
a=this._xformSetting.meshSize||[1,1];c.drawArrays(c.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var c=a.getAttribLocation(this.meshProgram,"a_texCoord"),n=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,n);n=this._xformSetting.meshSize||[1,1];var m=f.createMesh(n,!0);a.bufferData(a.ARRAY_BUFFER,
m,a.STATIC_DRAW);a.enableVertexAttribArray(c);a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,n[0]*n[1]*10)}},_setupMeshProgram:function(){var a=h.getShader(this.gl,h.mesh),c=b.getShader(this.gl,b.constant);return this._loadProgram(a,c)},_loadProgram:function(a,c){return f.loadProgram(this.gl,a,c)},_getShaderScript:function(a,c){c=document.getElementById(c);if(!c)return null;
a="";for(c=c.firstChild;c;)3==c.nodeType&&(a+=c.textContent),c=c.nextSibling;return a}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(k,g,p){k={shaderType:"vertex",getShader:function(b,h){var f=b.createShader(b.VERTEX_SHADER);b.shaderSource(f,h);b.compileShader(f);b.getShaderParameter(f,b.COMPILE_STATUS)||(f=null);return f}};g.mixin(k,p);return k})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var k={getUniforms:function(g,p){var b=g.getProgramParameter(p,g.ACTIVE_UNIFORMS),h,f,d={};for(h=0;h<b;h++)(f=g.getActiveUniform(p,h))&&(d[f.name]={location:g.getUniformLocation(p,f.name),info:f});return d},setUniform:function(g,p,b){var h=p.info;p=p.location;var f=h.type;if(null!=b)switch(f){case g.FLOAT:1<h.size?0!==b.length&&g.uniform1fv(p,b):g.uniform1f(p,b);break;case g.FLOAT_VEC2:if(0===b.length)break;g.uniform2fv(p,
b);break;case g.FLOAT_VEC3:if(0===b.length)break;g.uniform3fv(p,b);break;case g.FLOAT_VEC4:if(0===b.length)break;g.uniform4fv(p,b);break;case g.INT:case g.BOOL:1<h.size?0!==b.length&&g.uniform1iv(p,b):g.uniform1i(p,b);break;case g.INT_VEC2:case g.BOOL_VEC2:if(0===b.length)break;g.uniform2iv(p,b);break;case g.INT_VEC3:case g.BOOL_VEC3:if(0===b.length)break;g.uniform3iv(p,b);break;case g.INT_VEC4:case g.BOOL_VEC4:0!==b.length&&g.uniform4iv(p,b)}},createTexture:function(g,p){var b=g.createTexture();
g.bindTexture(g.TEXTURE_2D,b);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,p?g.LINEAR:g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,p?g.LINEAR:g.NEAREST);return b},createBufferTexture:function(g,p,b){p=k.createTexture(g,p);g.getExtension("OES_texture_float");b=b||[g.drawingBufferWidth,g.drawingBufferHeight];g.texImage2D(g.TEXTURE_2D,0,g.RGBA,b[0],b[1],0,
g.RGBA,g.FLOAT,null);b=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,b);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,p,0);return{texture:p,frameBuffer:b}},getShader:function(g,p,b){b=b?g.createShader(g.VERTEX_SHADER):g.createShader(g.FRAGMENT_SHADER);g.shaderSource(b,p);g.compileShader(b);g.getShaderParameter(b,g.COMPILE_STATUS)||(b=null);return b},loadProgram:function(g,p,b){var h=g.createProgram();g.attachShader(h,p);g.attachShader(h,b);g.linkProgram(h);g.getProgramParameter(h,
g.LINK_STATUS)||(g.deleteProgram(h),h=null);return h},createMesh:function(g,p){if(!g||1===g[0]&&1===g[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var b=g&&p?new Float32Array(g[0]*g[1]*20):new Float32Array(g[0]*g[1]*12);var h=.9998/g[1],f=.9998/g[0],d,a,c=0;for(d=0;d<g[1];d++)for(a=0;a<g[0];a++){var n=1E-4+h*d;var m=1E-4+f*a;g&&!p?(b[c++]=n,b[c++]=m,b[c++]=n+h,b[c++]=m,b[c++]=n,b[c++]=m+f,b[c++]=n,b[c++]=m+f,b[c++]=n+h,b[c++]=m,b[c++]=n+h,b[c++]=m+f):(b[c++]=n,b[c++]=m,b[c++]=n,b[c++]=m+
f,b[c++]=n,b[c++]=m+f,b[c++]=n+h,b[c++]=m+f,b[c++]=n+h,b[c++]=m+f,b[c++]=n+h,b[c++]=m,b[c++]=n,b[c++]=m,b[c++]=n+h,b[c++]=m,b[c++]=n,b[c++]=m+f,b[c++]=n+h,b[c++]=m)}return b}};return k})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var k={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,
-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,
1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(g){switch(g){case 0:return k.LineDetectionHorizontal;
case 1:return k.LineDetectionVertical;case 2:return k.LineDetectionLeftDiagonal;case 3:return k.LineDetectionRightDiagonal;case 4:return k.GradientNorth;case 5:return k.GradientWest;case 6:return k.GradientEast;case 7:return k.GradientSouth;case 8:return k.GradientNorthEast;case 9:return k.GradientNorthWest;case 10:return k.SmoothArithmeticMean;case 11:return k.Smoothing3x3;case 12:return k.Smoothing5x5;case 13:return k.Sharpening3x3;case 14:return k.Sharpening5x5;case 15:return k.Laplacian3x3;case 16:return k.Laplacian5x5;
case 17:return k.SobelHorizontal;case 18:return k.SobelVertical;case 19:return k.Sharpen;case 20:return k.Sharpen2;case 21:return k.PointSpread;default:return k.Default}}};return k})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(k){return{hillshade:function(g,p){if(null!==g&&null!==g.pixelBlock&&null!==g.pixelBlock.pixels){var b=this._clonePixelBlock(g.pixelBlock),h=p.altitude,f=p.azimuth,d=p.zFactor,a=p.psPower,c=p.psFactor,n=p.hillshadeType,m=p.slopeType,
q=p.isGCS;1===n&&(d*=2);p=b.width;var l=b.height,e=b.pixels[0],t=b.mask,x=new Uint8Array(p*l);t&&x.set(t);var r=new Uint8Array(p*l),w=(g.extent.xmax-g.extent.xmin)/p,u=(g.extent.ymax-g.extent.ymin)/l,v=d/(8*w),y=d/(8*u);.001<d&&q&&(v/=111E3,y/=111E3);3===m&&(q?(v=111E3*w,y=111E3*u,v=(d+Math.pow(v,a)*c)/(8*v),y=(d+Math.pow(y,a)*c)/(8*y)):(v=(d+Math.pow(w,a)*c)/(8*w),y=(d+Math.pow(u,a)*c)/(8*u)));q=(90-h)*Math.PI/180;h=Math.cos(q);var z=(360-f+90)*Math.PI/180;f=Math.sin(q)*Math.cos(z);q=Math.sin(q)*
Math.sin(z);d=[];a=[];c=[];w=[315,270,225,360,180,0];var B=[60,60,60,60,60,90];m=[3,5,3,2,1,4];var C=m.reduce(function(J,M){return J+M});u=m.map(function(J){return J/C});if(1===n){var E=w.length;for(m=0;m<E;m++)h=B[m],f=w[m],q=(90-h)*Math.PI/180,h=Math.cos(q),z=(360-f+90)*Math.PI/180,f=Math.sin(q)*Math.cos(z),q=Math.sin(q)*Math.sin(z),d.push(h),a.push(f),c.push(q)}var D=0;for(m=1;m<l-1;m++)for(B=m*p,w=1;w<p-1;w++)if(t&&!t[B+w])r[B+w]=0;else{z=0;if(t&&(z=t[B-p+w-1]+t[B-p+w]+t[B-p+w+1]+t[B+w-1]+t[B+
w+1]+t[B+p+w-1]+t[B+p+w]+t[B+p+w+1],7>z)){r[B+w]=0;x[B+w]=0;continue}if(7===z){var G=t[B-p+w-1]?e[B-p+w-1]:e[B+w];var H=t[B-p+w]?e[B-p+w]:e[B+w];var N=t[B-p+w+1]?e[B-p+w+1]:e[B+w];z=t[B+w-1]?e[B+w-1]:e[B+w];var O=t[B+w+1]?e[B+w+1]:e[B+w];D=t[B+p+w-1]?e[B+p+w-1]:e[B+w];var S=t[B+p+w]?e[B+p+w]:e[B+w];var da=t[B+p+w+1]?e[B+p+w+1]:e[B+w]}else G=e[B-p+w-1],H=e[B-p+w],N=e[B-p+w+1],z=e[B+w-1],O=e[B+w+1],D=e[B+p+w-1],S=e[B+p+w],da=e[B+p+w+1];z=(N+O+O+da-(G+z+z+D))*v;H=(D+S+S+da-(G+H+H+N))*y;N=Math.sqrt(1+
z*z+H*H);D=0;if(0===n)S=q*H-f*z,S=255*(h+S)/N,0>S&&(S=0),D=S;else if(1===n)for(G=0;G<E;G++)S=c[G]*H-a[G]*z,S=255*(d[G]+S)/N,0>S&&(S=0),D+=S*u[G];r[B+w]=D}for(m=0;m<l;m++)r[m*p]=r[m*p+1],r[(m+1)*p-1]=r[(m+1)*p-2];for(m=1;m<p-1;m++)r[m]=r[m+p],r[m+(l-1)*p]=r[m+(l-2)*p];b.pixelType="U8";b.pixels=[r];b.statistics=[{minValue:0,maxValue:255}];t&&(b.mask=x);return{extent:g.extent,pixelBlock:b}}},slope:function(g,p){if(null!==g&&null!==g.pixelBlock&&null!==g.pixelBlock.pixels){var b=this._clonePixelBlock(g.pixelBlock),
h=p.zFactor,f=p.psPower,d=p.psFactor,a=p.slopeType,c=p.isGCS;p=b.width;var n=b.height,m=b.pixels[0],q=b.mask,l=new Uint8Array(p*n);q&&l.set(q);var e=new Float32Array(p*n),t=(g.extent.xmax-g.extent.xmin)/p,x=(g.extent.ymax-g.extent.ymin)/n,r=h/(8*t),w=h/(8*x);1E-4>Math.abs(h-1)&&c&&(r/=111E3,w/=111E3);3===a&&(c?(r=111E3*t,w=111E3*x,r=(h+Math.pow(r,f)*d)/(8*r),w=(h+Math.pow(w,f)*d)/(8*w)):(r=(h+Math.pow(t,f)*d)/(8*t),w=(h+Math.pow(x,f)*d)/(8*x)));for(h=1;h<n-1;h++)for(d=h*p,f=1;f<p-1;f++)if(q&&!q[d+
f])e[d+f]=0;else{x=0;if(q&&(x=q[d-p+f-1]+q[d-p+f]+q[d-p+f+1]+q[d+f-1]+q[d+f+1]+q[d+p+f-1]+q[d+p+f]+q[d+p+f+1],7>x)){e[d+f]=0;l[d+f]=0;continue}if(7===x){x=q[d-p+f-1]?m[d-p+f-1]:m[d+f];c=q[d-p+f]?m[d-p+f]:m[d+f];t=q[d-p+f+1]?m[d-p+f+1]:m[d+f];var u=q[d+f-1]?m[d+f-1]:m[d+f];var v=q[d+f+1]?m[d+f+1]:m[d+f];var y=q[d+p+f-1]?m[d+p+f-1]:m[d+f];var z=q[d+p+f]?m[d+p+f]:m[d+f];var B=q[d+p+f+1]?m[d+p+f+1]:m[d+f]}else x=m[d-p+f-1],c=m[d-p+f],t=m[d-p+f+1],u=m[d+f-1],v=m[d+f+1],y=m[d+p+f-1],z=m[d+p+f],B=m[d+p+
f+1];u=(t+v+v+B-(x+u+u+y))*r;x=(y+z+z+B-(x+c+c+t))*w;x=Math.sqrt(u*u+x*x);e[d+f]=1===a||3===a?57.2957795*Math.atan(x):100*x}for(h=0;h<n;h++)e[h*p]=e[h*p+1],e[(h+1)*p-1]=e[(h+1)*p-2];for(h=1;h<p-1;h++)e[h]=e[h+p],e[h+(n-1)*p]=e[h+(n-2)*p];b.pixelType="F32";b.pixels=[e];b.statistics=[{minValue:0,maxValue:255}];q&&(b.mask=l);return{extent:g.extent,pixelBlock:b}}},aspect:function(g){if(null!==g&&null!==g.pixelBlock&&null!==g.pixelBlock.pixels){var p=this._clonePixelBlock(g.pixelBlock),b=p.width,h=p.height,
f=p.pixels[0],d=p.mask,a=new Uint8Array(b*h);d&&a.set(d);var c=new Float32Array(b*h),n=1/((g.extent.xmax-g.extent.xmin)/b),m=1/((g.extent.ymax-g.extent.ymin)/h),q,l;for(q=1;q<h-1;q++){var e=q*b;for(l=1;l<b-1;l++)if(d&&!d[e+l])c[e+l]=0;else{var t=0;if(d&&(t=d[e-b+l-1]+d[e-b+l]+d[e-b+l+1]+d[e+l-1]+d[e+l+1]+d[e+b+l-1]+d[e+b+l]+d[e+b+l+1],7>t)){c[e+l]=0;a[e+l]=0;continue}if(7===t){t=d[e-b+l-1]?f[e-b+l-1]:f[e+l];var x=d[e-b+l]?f[e-b+l]:f[e+l];var r=d[e-b+l+1]?f[e-b+l+1]:f[e+l];var w=d[e+l-1]?f[e+l-1]:
f[e+l];var u=d[e+l+1]?f[e+l+1]:f[e+l];var v=d[e+b+l-1]?f[e+b+l-1]:f[e+l];var y=d[e+b+l]?f[e+b+l]:f[e+l];var z=d[e+b+l+1]?f[e+b+l+1]:f[e+l]}else t=f[e-b+l-1],x=f[e-b+l],r=f[e-b+l+1],w=f[e+l-1],u=f[e+l+1],v=f[e+b+l-1],y=f[e+b+l],z=f[e+b+l+1];w=(r+u+u+z-(t+w+w+v))*n;t=(v+y+y+z-(t+x+x+r))*m;0===w&&0===t?t=-1:(t=90-57.29578*Math.atan2(t,-w),0>t&&(t+=360),360===t?t=0:360<t&&(t%=360));c[e+l]=t}}for(q=0;q<h;q++)c[q*b]=c[q*b+1],c[(q+1)*b-1]=c[(q+1)*b-2];for(q=1;q<b-1;q++)c[q]=c[q+b],c[q+(h-1)*b]=c[q+(h-2)*
b];p.pixelType="F32";p.pixels=[c];p.statistics={minValue:0,maxValue:360};d&&(p.mask=a);return{extent:g.extent,pixelBlock:p}}},_clonePixelBlock:function(g){return g.clone?g.clone():k.clone(g)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(k,g,p,b,h,f,d){return k([p,f],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",
functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=g.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=
this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:h.bandArithmetic,
fragmentName:"bandArithmetic"});var c=this.functionArguments.bandIndexes.trim().split(" ").map(function(l){return parseInt(l,10)});this._infraredBandID=c[0]-1;this._visibleBandID=c[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==c.length?{bandIDs:[this._infraredBandID,this._visibleBandID,this._infraredBandID]}:{bandIDs:[c[0]-1,c[1]-1,c[2]-1]});var n=this.bindFrameBuffer(),m=this.functionArguments.method,q=2<c.length?
c.slice(2):null;this._alterBand?this._setUniforms({u_method:m,u_bandId_nir:0,u_bandId_red:1,u_constants:q}):this._setUniforms({u_method:m,u_bandId_nir:c[0]-1,u_bandId_red:c[1]-1,u_constants:q});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:n.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],function(k){return{calculate:function(g,p){if(g&&g.pixels&&g.pixels.length){var b=
p&&p.bandIndexes;p=p&&p.method;var h=b.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});g=this._clonePixelBlock(g);var f=g.pixels,d=g.mask;switch(p){case 1:f=this._calculateNDVI(d,f[h[0]-1],f[h[1]-1]);break;case 2:f=this._calculateSAVI(d,f[h[0]-1],f[h[1]-1],h[2]);break;case 3:f=this._calculateTSAVI(d,f[h[0]-1],f[h[1]-1],h[2],h[3],h[4]);break;case 4:f=this._calculateMSAVI(d,f[h[0]-1],f[h[1]-1]);break;case 5:f=this._calculateGEMI(d,f[h[0]-1],f[h[1]-1]);break;
case 6:f=this._calculatePVI(d,f[h[0]-1],f[h[1]-1],h[2],h[3]);break;case 7:f=this._calculateGVITM(d,f[h[0]-1],f[h[1]-1],f[h[2]-1],f[h[3]-1],f[h[4]-1],f[h[5]-1]);break;case 8:f=this._calculateSultan(d,f[h[0]-1],f[h[1]-1],f[h[2]-1],f[h[3]-1],f[h[4]-1],f[h[5]-1]);break;case 9:f=this._calculateVARI(d,f[h[0]-1],f[h[1]-1],f[h[2]-1]);break;case 0:f=this._calculateUserDefined(d,f,b)}g.pixels=f;g.pixelType="F32";g.calculateStatistics();return g}},_clonePixelBlock:function(g){return g.clone?g.clone():k.clone(g)},
_parseUserDefined:function(g,p){g=g.replace(" ","");0===g.indexOf("-")&&(g="0"+g);0===g.indexOf("+")&&(g=g.slice(1,g.length));g=g.split("");var b=[],h=[],f="+-*/()".split(""),d,a="";for(d=0;d<g.length;d++){var c=g[d];f.some(function(n){return n===c})?(""!==a&&h.push(parseFloat(a)),b.push(c),a=""):"b"===c.toLowerCase()?(d++,a=c.concat(g[d]),h.push(p[parseInt(a[1],10)-1]),a=""):(a=a.concat(c),d===g.length-1&&h.push(parseFloat(a)))}return{ops:b,nums:h}},_op:function(g,p,b,h){if(b.constructor===Number&&
h.constructor===Number)return b+h;var f;if(b.constructor===Number){var d=h.length;var a=b;b=new Float32Array(d);for(f=0;f<d;f++)b[f]=a}else if(d=b.length,h.constructor===Number)for(a=h,h=new Float32Array(d),f=0;f<d;f++)h[f]=a;a=new Float32Array(d);if(null==g)if("+"===p)for(f=0;f<d;f++)a[f]=b[f]+h[f];else if("-"===p)for(f=0;f<d;f++)a[f]=b[f]-h[f];else if("*"===p)for(f=0;f<d;f++)a[f]=b[f]*h[f];else{if("/"===p)for(f=0;f<d;f++)a[f]=b[f]/h[f]}else if("+"===p)for(f=0;f<d;f++)g[f]&&(a[f]=b[f]+h[f]);else if("-"===
p)for(f=0;f<d;f++)g[f]&&(a[f]=b[f]-h[f]);else if("*"===p)for(f=0;f<d;f++)g[f]&&(a[f]=b[f]*h[f]);else if("/"===p)for(f=0;f<d;f++)g[f]&&(a[f]=b[f]/h[f]);return a},_shrinkOp:function(g,p){g.splice(p,1);var b=p=0,h=0;do{for(p=h=b=0;p<g.length;p++)if("("===g[p])b=p;else if(")"===g[p]){h=p;break}h===b+1&&g.splice(b,2)}while(h===b+1);return g},_getPriorityOpIndex:function(g,p){if(1===g.length)return{opIndex:0,numIndex:0};var b=p=0,h=0,f=-1,d=0;for(p=0;p<g.length;p++)if("("===g[p])b=p;else if(")"===g[p]){h=
p;break}var a=0===h?g:g.slice(b+1,h);for(p=0;p<a.length;p++)if("*"===a[p]||"/"===a[p]){f=p;break}if(!(-1<f))for(p=0;p<a.length;p++)if("+"===a[p]||"-"===a[p]){f=p;break}0<h&&(f+=b+1);for(p=0;p<f;p++)"("===g[p]&&d++;return{opIndex:f,numIndex:f-d}},_calculateUserDefined:function(g,p,b){p=this._parseUserDefined(b,p);b=p.ops;for(var h=p.nums,f,d,a;0<b.length&&(p=this._getPriorityOpIndex(b,h),f=b[p.opIndex],d=h[p.numIndex],a=h[p.numIndex+1],f=this._op(g,f,d,a),1!==b.length);)b=this._shrinkOp(b,p.opIndex),
h.splice(p.numIndex,2,f);return[f]},_calculateNDVI:function(g,p,b){var h=b.length,f=new Float32Array(h),d;if(null==g)for(d=0;d<h;d++){var a=b[d];var c=p[d];f[d]=(c-a)/(c+a)}else for(d=0;d<h;d++)g[d]&&(a=b[d],c=p[d],f[d]=(c-a)/(c+a));return[f]},_calculateSAVI:function(g,p,b,h){var f=b.length,d=new Float32Array(f),a;if(null==g)for(a=0;a<f;a++){var c=b[a];var n=p[a];d[a]=(n-c)/(n+c+h)*(1+h)}else for(a=0;a<f;a++)g[a]&&(c=b[a],n=p[a],d[a]=(n-c)/(n+c+h)*(1+h));return[d]},_calculateTSAVI:function(g,p,b,
h,f,d){var a=b.length,c=new Float32Array(a),n=-f*h+d*(1+h*h);if(null==g)for(d=0;d<a;d++){var m=b[d];var q=p[d];c[d]=h*(q-h*m-f)/(f*q+m+n)}else for(d=0;d<a;d++)g[d]&&(m=b[d],q=p[d],c[d]=h*(q-h*m-f)/(f*q+m+n));return[c]},_calculateMSAVI:function(g,p,b){var h=b.length,f=new Float32Array(h),d;if(null==g)for(d=0;d<h;d++){var a=b[d];var c=p[d];f[d]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a)))}else for(d=0;d<h;d++)g[d]&&(f[d]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a))));return[f]},_calculateGEMI:function(g,
p,b){var h=b.length,f=new Float32Array(h),d;if(null==g)for(d=0;d<h;d++){var a=b[d];var c=p[d];c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5);f[d]=c*(1-.25*c)-(a-.125)/(1-a)}else for(d=0;d<h;d++)g[d]&&(a=b[d],c=p[d],c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5),f[d]=c*(1-.25*c)-(a-.125)/(1-a));return[f]},_calculatePVI:function(g,p,b,h,f){var d=b.length,a=new Float32Array(d),c,n=Math.sqrt(1+h*h);if(null==g)for(c=0;c<d;c++){var m=b[c];var q=p[c];a[c]=(q-h*m-f)/n}else for(c=0;c<d;c++)g[c]&&(m=b[c],q=p[c],a[c]=(q-h*m-f)/n);
return[a]},_calculateGVITM:function(g,p,b,h,f,d,a){var c=p.length,n=new Float32Array(c),m;if(null==g)for(m=0;m<c;m++)n[m]=-.2848*p[m]-.2435*b[m]-.5436*h[m]+.7243*f[m]+.084*d[m]-1.18*a[m];else for(m=0;m<c;m++)g[m]&&(n[m]=-.2848*p[m]-.2435*b[m]-.5436*h[m]+.7243*f[m]+.084*d[m]-1.18*a[m]);return[n]},_calculateSultan:function(g,p,b,h,f,d,a){b=p.length;var c=new Float32Array(b),n=new Float32Array(b),m=new Float32Array(b),q;if(null==g)for(q=0;q<b;q++)c[q]=d[q]/a[q]*100,n[q]=d[q]/p[q]*100,m[q]=h[q]/f[q]*
(d[q]/f[q])*100;else for(q=0;q<b;q++)g[q]&&(c[q]=d[q]/a[q]*100,n[q]=d[q]/p[q]*100,m[q]=h[q]/f[q]*(d[q]/f[q])*100);return[c,n,m]},_calculateVARI:function(g,p,b,h){var f=p.length,d=new Float32Array(f),a;if(null==g)for(a=0;a<f;a++){var c=p[a];var n=b[a];var m=h[a];d[a]=(n-c)/(n+c-m)}else for(a=0;a<f;a++)if(g[a])for(a=0;a<f;a++)c=p[a],n=b[a],m=h[a],d[a]=(n-c)/(n+c-m);return[d]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(k,g,p,b,h,f,d){return k([b,f],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var c=Object.keys(a[0].attributes);var n=c.filter(function(x){return"alpha"===
x.toLowerCase()})[0];var m=c.filter(function(x){return"value"===x.toLowerCase()})[0];var q=c.filter(function(x){return"red"===x.toLowerCase()})[0];var l=c.filter(function(x){return"green"===x.toLowerCase()})[0];var e=c.filter(function(x){return"blue"===x.toLowerCase()})[0];if(!(m&&q&&l&&e))throw"invalid colormap";a=a.map(function(x){return n?[x.attributes[m],x.attributes[q],x.attributes[l],x.attributes[e],x.attributes[n]]:[x.attributes[m],x.attributes[q],x.attributes[l],x.attributes[e]]});var t=1.1>
Math.max.apply(null,a.map(function(x){return x[1]}));c=n&&1.1>Math.max.apply(null,a.map(function(x){return x[4]}));if(t)for(t=0;t<a.length;t++)a[t][1]=Math.round(255*a[t][1]),a[t][2]=Math.round(255*a[t][2]),a[t][3]=Math.round(255*a[t][3]),c&&(a[t][4]=Math.round(255*a[t][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=g.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var c=d.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_binarySearchClr:function(a,c){for(var n=0,m=a.length-1,q=0,l=0;n<m;)if(q=Math.floor((n+m)/2),l=a[q],l[0]<c)n=q;else if(l[0]>c)m=q;else return l.slice(1);return null},_sortClr:function(a,c){var n,m=[];for(n=0;n<a.length;n++)m.push(a[n]);for(n=0;n<m.length-1;n++){var q=m[n];for(a=n+1;a<m.length;a++)q[0]>m[a][0]&&(q=m[a],m[a]=m[n],
m[n]=q)}if(c)for(n=0;n<m.length/2;n++)q=m[n],m[m.length-1-n]=m[n],m[n]=q;return m},_invertColorRamp:function(a){if(!a)return a;var c={type:a.type};"random"===a.type?c=a:"multipart"===a.type?c.colorRamps=a.colorRamps.map(function(n){return{fromColor:n.toColor,toColor:n.fromColor}}).reverse():(c.fromColor=a.toColor,c.toColor=a.fromColor);return c},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=d.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?p.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):p.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?p.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
p.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=p.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var c=0;0>a[0][0]&&(c=a[0][0]);var n=[],m=5===a[0].length,q;for(q=0;q<a.length;q++)n[a[q][0]-c]=m?a[q].slice(1):a[q].slice(1).concat([255]);return n},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:h.colormap,fragmentName:"Colormap"});var c=this._indexedColormap,n=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));var m=this._clrTexture,q=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:n,u_indexedColormapMaxIndex:c.length/4-1});this._bindTexture(m,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:q.texture}},_setupColormapTexture:function(a){var c=
this._createTexture(),n=this.gl,m=a.length/4,q=new Float32Array(a.length),l,e=this.renderTexture?255:1;for(l=0;l<a.length;l++)q[l]=a[l]/e;n.getExtension("OES_texture_float");n.texImage2D(n.TEXTURE_2D,0,n.RGBA,m,1,0,n.RGBA,n.FLOAT,q);return c}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(k,g,p){return{createAlgorithmicColorRamp:function(b,h){if(!b)return null;var f=b.fromColor,d=b.toColor;if(!f||!d)return null;
void 0===f.r&&3<=f.length&&(f={r:f[0],g:f[1],b:f[2]});void 0===d.r&&3<=d.length&&(d={r:d[0],g:d[1],b:d[2]});var a=b.size||256;b=b.algorithm||"cie-lab";if(-1<b.toLowerCase().indexOf("hsv")){var c=p.toHSV(f);d=p.toHSV(d);a=a||256;var n=0===c.s,m=0===d.s;f=c.h;b=d.h;n&&!m?f=c.h=b:m&&!n&&(b=d.h=f);n=Math.abs(b-f);180>n?b=(b-f)/(a-1):(n=360-n,b=f>b?n/(a-1):-n/(a-1));n=(d.s-c.s)/(a-1);m=(d.v-c.v)/(a-1);var q=c.s;c=c.v;var l,e=new Uint8Array(4*a);for(l=0;l<a-1;l++){var t=p.toRGB({h:f,s:q,v:c});e[4*l]=t.r;
e[4*l+1]=t.g;e[4*l+2]=t.b;e[4*l+3]=255;f+=b;q+=n;c+=m;360<f?f-=360:0>f&&(f+=360)}t=p.toRGB(d);e[4*(a-1)]=t.r;e[4*(a-1)+1]=t.g;e[4*(a-1)+2]=t.b;e[4*(a-1)+3]=255;c=e}else if(-1<b.toLowerCase().indexOf("lch")){q=p.toLCH(f);d=p.toLCH(d);a=a||256;c=(d.l-q.l)/(a-1);f=(d.c-q.c)/(a-1);b=(d.h-q.h)/(a-1);n=q.l;m=q.c;q=q.h;e=new Uint8Array(4*a);for(l=0;l<a-1;l++)t=p.toRGB({l:n,c:m,h:q}),e[4*l]=t.r,e[4*l+1]=t.g,e[4*l+2]=t.b,e[4*l+3]=255,n+=c,m+=f,q+=b;t=p.toRGB(d);e[4*(a-1)]=t.r;e[4*(a-1)+1]=t.g;e[4*(a-1)+2]=
t.b;e[4*(a-1)+3]=255;c=e}else if(-1<b.toLowerCase().indexOf("lab")){q=p.toLAB(f);d=p.toLAB(d);a=a||256;c=(d.l-q.l)/(a-1);f=(d.a-q.a)/(a-1);b=(d.b-q.b)/(a-1);n=q.l;m=q.a;q=q.b;e=new Uint8Array(4*a);for(l=0;l<a-1;l++)t=p.toRGB({l:n,a:m,b:q}),e[4*l]=t.r,e[4*l+1]=t.g,e[4*l+2]=t.b,e[4*l+3]=255,n+=c,m+=f,q+=b;t=p.toRGB(d);e[4*(a-1)]=t.r;e[4*(a-1)+1]=t.g;e[4*(a-1)+2]=t.b;e[4*(a-1)+3]=255;c=e}if(h&&!1===h.flattened)for(h=c,c=[],d=0;d<c/4;d++)c[d]=h.slice(4*d,4*d+4);return c},createMultiPartColorRamp:function(b,
h){if(!b)return null;h=h&&g.clone(h)||{flattened:!0};var f=b.colorRamps;if(!f||0===f.length)return null;var d=b.size||256;b=Math.max(Math.floor(d/f.length),3);var a=Math.max(b,d-(f.length-1)*b),c=!1!==h.flattened;h.flattened=!0;d=(f.length-1)*b+a;var n=new Uint8Array(4*d);for(d=0;d<f.length;d++){var m={fromColor:f[d].fromColor,toColor:f[d].toColor,size:d===f.length-1?a:b};n instanceof Array?n.concat(this.createAlgorithmicColorRamp(m,h)):n.set(this.createAlgorithmicColorRamp(m,h),b*d*4)}if(!c)for(h=
n,n=[],d=0;d<n/4;d++)n[d]=h.slice(4*d,4*d+4);return n},createRandomColorRamp:function(b){b=b||{};var h=b.size||256,f=!1===b.flattened;var d=f?new Uint8Array(4*h):[];for(b=0;b<h;b++)f?(d[4*b]=Math.round(255*Math.random()),d[4*b+1]=Math.round(255*Math.random()),d[4*b+2]=Math.round(255*Math.random()),d[4*b+3]=255):d[b]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return d}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(k){return{mask:function(g,p){if(g&&g.pixels&&g.pixels.length){g=this._clonePixelBlock(g);var b=p.includedRanges,h=p.noDataInterpretation;p=p.noDataValues;if(null===b&&null===p)return g;var f=g.pixels,d=g.mask,a=g.width*g.height,c=f.length,n;if(null!==p&&p.length!==c)throw"expect "+c+" elements in noDataValues";if(null!==b&&b.length!==2*c)throw"expect "+2*c+" elements in IncludeRanges";if(null==d){d=new Uint8Array(a);for(n=0;n<a;n++)d[n]=1;g.mask=d}if(0===h)for(h=0;h<c;h++){var m=f[h];var q=
null===b?null:b[2*h];var l=null===b?null:b[2*h+1];var e=null===p?null:parseFloat(p[h]);if(null===q||null===l)for(n=0;n<a;n++){if(d[n]){var t=m[n];t===e&&(d[n]=0)}}else if(null===e)for(n=0;n<a;n++)d[n]&&(t=m[n],t<q||t>l)&&(d[n]=0);else for(n=0;n<a;n++)d[n]&&(t=m[n],t<q||t>l||t===e)&&(d[n]=0)}else{var x=new Uint8Array(a);for(n=0;n<a;n++)x[n]=d[n];for(h=0;h<c;h++)if(m=f[h],q=null===b?null:b[2*h],l=null===b?null:b[2*h+1],e=null===p?null:parseFloat(p[h]),null===q||null===l)for(n=0;n<a;n++)x[n]&&(t=m[n],
t!==e&&(x=0));else if(null===e)for(n=0;n<a;n++)x[n]&&(t=m[n],t<=q&&t<=l&&(x=0));else for(n=0;n<a;n++)x[n]&&(t=m[n],t<=q&&t<=l&&t!==e&&(x=0));for(n=0;n<a;n++)d[n]&&x[n]&&(d[n]=0)}return g}},calculateStatisticsHistograms:function(g,p){g=this._clonePixelBlock(g);p=g.pixelType;var b=g.pixels,h=g.mask,f=b.length,d,a,c=[],n;for(d=0;d<f;d++){var m={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var q=m.counts;var l=b[d];if("U8"===p)if(h)for(a=0;a<g.width*g.height;a++)h[a]&&q[l[a]]++;else for(a=
0;a<g.width*g.height;a++)q[l[a]]++;else{var e=g.statistics[d].minValue;var t=g.statistics[d].maxValue;m.min=e;m.max=t;t=(t-e)/256;var x=new Uint32Array(257);if(h)for(a=0;a<g.width*g.height;a++)h[a]&&x[Math.floor((l[a]-e)/t)]++;else for(a=0;a<g.width*g.height;a++)x[Math.floor((l[a]-e)/t)]++;for(a=0;255>a;a++)q[a]=x[a];q[255]=x[255]+x[256]}c.push(m);e=g.statistics[d].minValue;t=g.statistics[d].maxValue;for(a=x=n=l=0;a<m.size;a++)l+=q[a],n+=a*q[a];n/=l;for(a=0;a<m.size;a++)x+=q[a]*Math.pow(a-n,2);q=
Math.sqrt(x/(l-1));a=(n+.5)*(m.max-m.min)/m.size+m.min;m=q*(m.max-m.min)/m.size;g.statistics[d]={min:e,minValue:e,max:t,maxValue:t,mean:a,stddev:m}}g.histograms=c;return g},buildIndexedColormap:function(g,p){if(!g)return null;var b=0;0>g[0][0]&&(b=g[0][0]);var h=Math.max(256,g[g.length-1][0]-b);if(65536<h)return null;var f=new Uint8Array(4*h),d=[],a=0,c=5===g[0].length;if(p)for(d=g[a],p=d[0]-b;p<h;p++)f[4*p]=d[1],f[4*p+1]=d[2],f[4*p+2]=d[3],f[4*p+3]=c?d[4]:255,p===d[0]-b&&(d=a===g.length-1?d:g[++a]);
else for(p=0;p<g.length;p++)d=g[p],a=4*(d[0]-b),f[a]=d[1],f[a+1]=d[2],f[a+2]=d[3],f[a+3]=c?d[4]:255;return{indexedColormap:f,offset:b,alphaSpecified:c}},colorize:function(g,p){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);var b=g.pixels,h=g.width*g.height,f=g.mask,d=p.indexedColormap,a=p.indexedColormapOffset,c=d&&d.length-1,n=p.indexed2DColormap;p=p.alphaSpecified;if(3<=b.length)throw"colormap only works on single band image";var m=b[0],q=new Uint8Array(m.length),l=new Uint8Array(m.length),
e=new Uint8Array(m.length),t=0;if(d)if(f)for(b=0;b<h;b++)f[b]&&(t=4*(m[b]-a),t<a||t>c?f[b]=0:(q[b]=d[t],l[b]=d[t+1],e[b]=d[t+2],f[b]=d[t+3]));else{f=new Uint8Array(h);for(b=0;b<h;b++)t=4*(m[b]-a),t<a||t>c?f[b]=0:(q[b]=d[t],l[b]=d[t+1],e[b]=d[t+2],f[b]=d[t+3]);g.mask=f}else if(f)for(b=0;b<h;b++)f[b]&&(d=n[m[b]],q[b]=d[0],l[b]=d[1],e[b]=d[2],f[b]=d[3]);else{f=new Uint8Array(h);for(b=0;b<h;b++)d=n[m[b]],q[b]=d[0],l[b]=d[1],e[b]=d[2],f[b]=d[3];g.mask=f}g.pixels=[q,l,e];g.statistics=null;g.pixelType="U8";
g.maskIsAlpha=p;return g}},convolute:function(g,p){g=this._clonePixelBlock(g);var b=g.pixels,h=g.width,f=g.height,d=h*f,a=b.length,c,n,m,q,l=[],e=[],t=p.normalizedKernel,x=p.kernelRows,r=p.kernelCols;for(p=0;p<a;p++){var w=b[p];var u=new Float32Array(d);u.set(w);for(m=1;m<f-1;m++){var v=m*h;for(q=1;q<h-1;q++){for(c=e=0;c<x;c++)for(n=0;n<r;n++)e+=w[v+q+(c-1)*h+n-1]*t[c*r+n];u[v+q]=e}}l.push(u)}g.pixels=l;return g},contrastBrightnessStretch:function(g,p){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);
var b=g.pixels,h=g.mask,f=g.width*g.height,d=b.length;var a=p&&p.contrastOffset;p=p&&p.brightnessOffset;if("U8"!==g.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var c=this._createContrastBrightnessLUT(a,p);if(null==h)for(a=0;a<f;a++)for(p=0;p<d;p++)b[p][a]=c[b[p][a]];else for(a=0;a<f;a++)if(h[a])for(p=0;p<d;p++)b[p][a]=c[b[p][a]];g.pixelType="U8";return g}},isNull:function(g,p){if(null!==g&&null!==g.pixels){g=this._clonePixelBlock(g);p=g.mask;var b=
g.pixels[0],h=b.length,f;if(p){for(f=0;f<h;f++)b[f]=p[f]?0:1;g.mask=null}else if(b.fill)b.fill(0);else for(f=0;f<h;f++)b[f]=0;return g}},setNull:function(g){if(null!==p&&null!==p.pixels){var p=this._clonePixelBlock(g);g=p.mask;var b=p.pixels[0],h=b.length,f;g=g||new Uint8Array(h);for(f=0;f<h;f++)g[f]=b[f]?0:1;p.mask=g;return p}},local:function(g,p){if(!p)return g[0];var b=p.rasterCountNeeded;p=p.functor;var h=this._clonePixelBlock(g[0]);if(null!==h&&null!==h.pixels){var f=h.width*h.height,d;g=(d=
g[1])&&d.pixels[0];var a=d&&d.mask,c=h.mask,n=h.pixels[0];if(2===b)if(!c&&a)c=a;else if(c&&a)for(d=0;d<f;d++)c[d]=c[d]&&a[d]?1:0;h.mask=c;if(1===b)if(null==c)for(d=0;d<f;d++)n[d]=p(n[d]);else for(d=0;d<f;d++)c[d]&&(n[d]=p(n[d]));else if(2===b)if(null==c)for(d=0;d<f;d++)n[d]=p(n[d],g[d]);else for(d=0;d<f;d++)c[d]&&(n[d]=p(n[d],g[d]));h.mask=c;h.calculateStatistics();return h}},remapColor:function(g,p){g=this._clonePixelBlock(g);var b=g.width*g.height,h=p.length,f=Math.floor(h/2),d=p[Math.floor(f)],
a=p[0].value,c=p[p.length-1].value,n=g.pixels[0],m,q,l=!1,e=new Uint8Array(b),t=new Uint8Array(b),x=new Uint8Array(b),r=g.mask,w=4===p[0].mappedColor.length;r&&0!==r.length||(r=new Uint8Array(b),r.fill(w?255:1),g.mask=r);for(q=0;q<b;q++)if(r[q]){var u=n[q];if(u<a||u>c)e[q]=t[q]=x[q]=r[q]=0;else{l=!1;var v=f;var y=d;var z=0;for(m=h-1;1<m-z;){if(u===y.value){l=!0;break}u>y.value?z=v:m=v;v=Math.floor((z+m)/2);y=p[Math.floor(v)]}l||(y=u===p[m].value?p[m]:p[z]);e[q]=y.mappedColor[0];t[q]=y.mappedColor[1];
x[q]=y.mappedColor[2];r[q]=y.mappedColor[3]}}g.pixels=[e,t,x];g.mask=r;g.pixelType="u8";g.maskIsAlpha=w;return g},_clonePixelBlock:function(g){if(g.clone)return g.clone();var p=k.clone(g),b;if(g.pixels&&g.pixels[0]&&0<g.pixels[0].length&&!(p.pixels&&p.pixels[0]&&0<p.pixels[0].length)){p.pixels=[];var h=g.pixels.length;for(b=0;b<h;b++)p.pixels[b]=new g.pixels[b].constructor(g.pixels[b])}if(g.statistics)for(p.statistics=[],h=g.statistics.length,b=0;b<h;b++)p.statistics[b]=k.clone(g.statistics[b]);g.mask&&
(p.mask=new Uint8Array(g.mask));return p},_createContrastBrightnessLUT:function(g,p){if(this._contrastCache&&this._contrastCache.contrastOffset===g&&this._contrastCache.brightnessOffset===p)return this._contrastCache.lut;var b=Math.min(Math.max(g,-100),100),h=Math.min(Math.max(p,-100),100),f,d=new Uint8Array(256);for(f=0;256>f;f++){if(0<b&&100>b)var a=(200*f-25500+510*h)/(2*(100-b))+128;else 0>=b&&-100<b?a=(200*f-25500+510*h)*(100+b)/2E4+128:100===b?(a=200*f-25500+256*(100-b)+510*h,a=0<a?255:0):-100===
b&&(a=128);d[f]=255<a?255:0>a?0:a}this._contrastCache={contrastOffset:g,brightnessOffset:p,lut:d};return d}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(k,g,p,b,h,f){return k([p,f],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=
this.mixinIgnoreCase({rasters:null},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],c=[],n=d.rasters.length,m;if(d.rasters[0].statistics)for(m=0;m<n;m++)a.push(d.rasters[m].statistics[0]);if(d.rasters[0].histograms)for(m=0;m<n;m++)c.push(d.rasters[m].histograms[0]);this.rasterInfo=g.mixin(d.rasters[0],{bandCount:n,pixelType:this._calculatePixelType(this.pixelType,d.rasters[0].pixelType),statistics:a,
histograms:c});return!0},read2D:function(d){d=d.rasters;if(null!=d&&0!==d.length){var a=this._clonePixelData(d[0]),c=a.pixelBlock,n=[],m=[];for(q=0;q<d.length;q++)n.push(d[q].pixelBlock.pixels[0]),m.push(d[q].pixelBlock.statistics[0]);c.pixels=n;c.stackedStatistics=m;c.planes=d.length;var q;m=c.width*c.height;for(q=0;q<d.length;q++)if(c=d[q].pixelBlock.mask,l&&c)for(n=0;n<m;n++)l[n]&=c[n];else var l=l||c;a.maks=l;return a}},readGL:function(d){this._performance.start();this._initializeProgram({fragment:h.compositeBand,
fragmentName:"CompositeBand"});var a=d.rasters;if(null!=a&&0!==a.length){a=a.length;var c,n=this.bindFrameBuffer();for(c=0;c<a;c++){var m=this._setupTextureData(d.rasters[c],{notOriginal:0<c});var q=0<c?c.toString():"";this._bindTexture(m.texture,"u_image"+q)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:m.extent,texture:n.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(k,g,p,b,h,f,d){return k([p,f],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=g.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=d.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(g.hitch(this,function(n){return this._clampBand(n,c.pixelType)})));return{extent:a.extent,pixelBlock:c}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:h.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var c=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(k,g,p,b,h,f,d,a){return k([p,
d],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:c.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),
statistics:c.raster.statistics,histograms:c.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;var n=this._analyzeKernel(),m=a.convolute(c.pixelBlock,{normalizedKernel:n.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(m.pixelType=this.pixelType);m.pixels=m.pixels.map(g.hitch(this,function(q){return this._clampBand(q,m.pixelType)}));return{extent:c.extent,pixelBlock:m}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.convolution,fragmentName:"Convolution"});var n=this._setupTextureData(c.raster),m=this.bindFrameBuffer(),q=this.gl,l=q.drawingBufferWidth;q=q.drawingBufferHeight;var e=this.functionArguments.kernel;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/
c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/l,1/q],u_kernel:e,u_kernelSize:e.length});this._bindTexture(n.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:n.extent,texture:m.texture}},_analyzeKernel:function(){var c=this.functionArguments.kernel,n=c.reduce(function(l,e){return l+e});0!==n&&1!==n&&(c=c.map(function(l){return l/n}));var m,q=[];for(m=0;m<c.length;m++)q.some(function(l){return l===c[m]})||q.push(c[m]);return{normalizedKernel:c,
distinctValues:q}},_analyzeKernelPattern:function(){var c=this.functionArguments.rows,n=this.functionArguments.columns,m=this.functionArguments.kernel,q=[],l,e;for(l=0;l<c;l++)q.push({weights:m.slice(l*n,(l+1)*n)});var t;for(l=1;l<c;l++){var x=q[l].weights;for(m=0;m<l;m++)if(t=q[m].weights){var r=x[0]/t[0];for(e=1;e<n;e++)x[e]/t[e]!==r&&(r=null);null!==r&&(q[l]={row:m,factor:r})}}return q}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(k,g,p,b,h,f){return k([p,f],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.raster)return Error("The raster input to extract band function is invalid.");var a=[],c=d.raster.statistics,n=[],m=d.raster.histograms,q=this.functionArguments.bandIDs.length||
d.raster.bandCount;this.functionArguments.bandIDs.forEach(g.hitch(this,function(l){if(l>=q-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+l);l=q-1}if(0>l)return Error("missing band "+l);void 0!==c&&null!==c&&0<c.length&&a.push(c[l]);void 0!==m&&null!==m&&0<m.length&&n.push(m[l])}));this.rasterInfo=g.mixin(d.raster,{bandCount:q,pixelType:this._calculatePixelType(this.pixelType,d.raster.pixelType),statistics:a,histograms:n});return!0},read2D:function(d){d=this._clonePixelData(d.raster);
if(null!==d&&null!==d.pixelBlock&&null!==d.pixelBlock.pixels){this._performance.start();var a=d.pixelBlock,c=a.statistics,n=a.pixels,m=n.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return d;var q=[],l=[];this.functionArguments.bandIDs.forEach(function(e){if(e>=m-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+e;e=m-1}if(0>e)throw"missing band "+e;q.push(n[e]);void 0!==c&&null!==c&&0<c.length&&
l.push(c[e])});a.pixels=q;a.statistics=l;a.planes=this.functionArguments.bandIDs.length;return d}},readGL:function(d){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:h.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var c=!!(this._alterBand&&d.raster&&d.raster.texture);d=this._setupTextureData(d.raster,{bandIDs:a});var n=this.bindFrameBuffer();c?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(d.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:d.extent,texture:n.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(k,g,p,b,h,f,d,a,c,n){return k([p,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(m){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},m);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var q=this._weights.reduce(function(l,
e){return l+e});this._weights=this._weights.map(function(l){return l/q})},bind:function(m){m=this.getSourceRasterInfo(m);if(!m.raster)return Error("The raster input to hillshade function is invalid.");m.raster.statistics&&(this.srcStatistics=m.raster.statistics);this.rasterInfo=g.mixin(m.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(m){this._performance.start();m=m.raster;m=c.hillshade(m,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:m.extent.spatialReference.wkid&&null==h[m.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return m},readGL:function(m){this._performance.start();this._initializeProgram({fragment:d.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var q=this._setupTextureData(m.raster),l=this.bindFrameBuffer(),e=this.gl,t=e.drawingBufferWidth;e=e.drawingBufferHeight;var x=q.extent,r=(x.xmax-x.xmin)/t,w=(x.ymax-x.ymin)/e,u=this.functionArguments.altitude,v=this.functionArguments.azimuth,
y=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(y*=2);var z=y/(8*r),B=y/(8*w);.001<y&&x.spatialReference.wkid&&null==h[x.spatialReference.wkid]&&(z/=111E3,B/=111E3);var C=this.functionArguments.psPower,E=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((z=x.spatialReference.wkid&&null==h[x.spatialReference.wkid])?(z=111E3*r,B=111E3*w,z=(y+Math.pow(z,C)*E)/(8*z),B=(y+Math.pow(B,C)*E)/(8*B)):(z=(y+Math.pow(r,C)*E)/(8*r),B=(y+Math.pow(w,C)*E)/(8*w)));
var D=(90-u)*Math.PI/180;u=Math.cos(D);var G=(360-v+90)*Math.PI/180;v=Math.sin(D)*Math.cos(G);D=Math.sin(D)*Math.sin(G);C=Array(6);E=Array(6);x=Array(6);var H=this._weights,N;if(1===this.functionArguments.hillshadeType){var O=this._azimuths.length;for(N=0;N<O;N++)u=this._altitudes[N],v=this._azimuths[N],D=(90-u)*Math.PI/180,u=Math.cos(D),G=(360-v+90)*Math.PI/180,v=Math.sin(D)*Math.cos(G),D=Math.sin(D)*Math.sin(G),C[N]=u,E[N]=v,x[N]=D}else C[0]=u,E[0]=v,x[0]=D;C=C.map(function(S){return parseFloat(S)});
E=E.map(function(S){return parseFloat(S)});x=x.map(function(S){return parseFloat(S)});this._setUniforms({u_cellSize:[r,w],u_zfactor:y,u_xFactor:z,u_yFactor:B,u_sinZcosA:v,u_sinZsinA:D,u_cosZ:u,u_sinZcosAs:E,u_sinZsinAs:x,u_cosZs:C,u_weights:H,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:m&&m.raster&&m.raster.pixelBlock?[1/m.raster.pixelBlock.width,1/m.raster.pixelBlock.height]:[1/t,1/e],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(q.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:q.extent,texture:l.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var m=this._indexedColormap,q=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(q=n.buildIndexedColormap(this.functionArguments.colormap))&&q.alphaSpecified,this._indexedColormap=q&&q.indexedColormap,this._indexedColormapOffset=q&&q.offset):q?(this._indexedColormap="multipart"===q.type?this.invert?b.createMultiPartColorRamp(this._invertColorRamp(q)):b.createMultiPartColorRamp(q):this.invert?b.createAlgorithmicColorRamp(this._invertColorRamp(q)):b.createAlgorithmicColorRamp(q),q.fromColor&&q.toColor&&"000"===q.fromColor.slice(0,
3).join("")&&"255255255"===q.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=b.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(m&&this._indexedColormap){q=!0;for(var l=0;l<m.length;l++)if(m[l]!==this._indexedColormap[l]){q=!1;break}q||(this._clrTexture=null)}},_setupColormapTexture:function(m){var q=this._createTexture(),l=this.gl,
e=m.length/4,t=new Float32Array(m.length),x;for(x=0;x<m.length;x++)t[x]=m[x]/255;l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,e,1,0,l.RGBA,l.FLOAT,t);return q}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(k,g,p,b,h,f,d){return k([p,f],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var c=0;a.raster?c=a.raster.bandCount:a.rasters&&(c=Math.max.apply(null,a.rasters.map(function(n){return n.bandCount})));if(0===c)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(n){return!!n.extent})[0];this.rasterInfo=g.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var c=[];c=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=c.map(function(e){return e.pixelBlock});var n=this.functionArguments.operation;if(null===n)return c[0];this._performance.start();var m=this._getOperations(),q=m.operators[n-1];m=m.functors[n-1];
if(!this.functionArguments.rasters){if(1!==q)throw"no sufficient rasters, require "+q;}else if(999!==q&&this.functionArguments.rasters.length!==q)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+q;var l=31===n?d.isNull(a[0]):50===n?d.setNull(a[0]):d.local(a,{rasterCountNeeded:q,functor:m});"Unknown"!==this.pixelType&&(l.pixelType=this.pixelType,l.pixels=l.pixels.map(g.hitch(this,function(e){return this._clampBand(e,l.pixelType)})));l.statistics||l.calculateStatistics();
return{extent:c[0].extent,pixelBlock:l}},readGL:function(a){this._performance.start();var c=this.functionArguments.operation,n=this._getWebGLOperations(),m=n.operators[c-1],q=h.local;n="result\x3d"+n.functors[c-1]+";";31!==c&&50!==c&&(n+="result \x3d vec4(result.rgb, a.a);");q=q.replace("vec4 replaceme"+m+";",n);n=this.gl.getParameter(this.gl.VERSION);var l="";if(-1<n.toLowerCase().indexOf("webgl 1.0")||-1<n.toLowerCase().indexOf("webgl 0."))l=this._getPolyfill(c);q=q.replace("vec4 polyfill;",l);
1<m&&(q=q.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",m.toString())));this._initializeProgram({fragment:q,fragmentName:"Local"});c=a.rasters;if(null!=c&&0!==c.length){c=c.length;n=this.bindFrameBuffer();for(m=0;m<c;m++){q=0<m?m.toString():"";var e=this._setupTextureData(a.rasters[m],{reCreate:!0});this._bindTexture(e.texture,"u_image"+q)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:n.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,c){return a+c},function(a,c){return a-c},function(a,c){return a*c},function(a){return Math.sqrt(a)},function(a,c){return Math.pow(a,c)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,c){return a&c},function(a,c){return a<<c},function(a){return~a},function(a,c){return a|c},function(a,c){return a>>c},function(a,c){return a^c},function(a,c){return a&&c},function(a){return!a},function(a,c){return a||c},function(a,c){return a!=c},function(a){return Math.cos(a)},function(a,c){return Math.cosh(a)},function(a,c){return a/c},function(a,c){return a==c},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,c){return a>c?1:0},function(a,c){return a>=c?1:0},function(a,c){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,c){return a<c?1:0},function(a,c){return a<=c?1:0},function(a){return Math.log(a)},function(a,c){return Math.log10(a)},function(a,c){return Math.log2(a)},999,999,999,999,999,999,function(a,c){return a%c},function(a){return-a},function(a,c){return a!=c?1:0},999,function(a,c){return Math.floor(a)},function(a,c){return Math.ceil(a)},function(a,c){return c?
0:a},function(a,c){return Math.sin(a)},function(a,c){return Math.sinh(a)},function(a,c){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,c){return Math.atan2(a,c)},function(a,c){return a/c},function(a,c){return Math.floor(a/c)},999,999,999,999,999,999,999,999,999,999,function(a,c,n){return a?c:n}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var c=
"";switch(a){case 9:c=this._polyfill.atanh;break;case 22:c=this._polyfill.cosh;break;case 52:c=this._polyfill.sinh;break;case 57:c=this._polyfill.tanh;break;case 59:c=this._polyfill.acosh;break;case 60:c=this._polyfill.asinh}return c},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(k,g,p,b,h,f,d){return k([p,f],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=g.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:h.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),n=this.functionArguments.includedRanges,m=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(q){return parseFloat(q,10)}):null;this._setUniforms({u_includedRanges:n,u_includedRanges_specified:n?!0:!1,u_noDataValues:m,u_noDataValues_specified:m?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(k,g,p,b,h,f,d){return k([p,f],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=g.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),n;if(this.functionArguments.scaled){var m=c.pixels[0];var q=c.mask;var l=m.length;var e=new Uint8Array(l);if(null==q)for(n=0;n<l;n++)e[n]=100*m[n]+100&255;else for(n=0;n<l;n++)q[n]&&(e[n]=100*m[n]+100&255);c.pixels[0]=e;c.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:h.ndvi,fragmentName:"NDVI"});var c=this.functionArguments.visibleBandID,n=this.functionArguments.infraredBandID,m=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(n,c)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[n,c,n]}:null});var q=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:m}):this._setUniforms({u_bandId_nir:n,u_bandId_red:c,u_scaled:m});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:q.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(k,g,p,b,h,f,
d,a){return k([p,d],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=g.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;c=a.slope(c,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:c.extent.spatialReference.wkid&&null==b[c.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.slope,fragmentName:"Slope"});var n=this._setupTextureData(c.raster),m=this.bindFrameBuffer(),q=this.gl,l=q.drawingBufferWidth;q=q.drawingBufferHeight;var e=n.extent;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/l,1/q],u_cellSize:[(e.xmax-e.xmin)/l,(e.ymax-e.ymin)/q],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(n.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:n.extent,texture:m.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(k,g,p,b,h,f,d){return k([p,d],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?
255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=a.raster.histograms);this.rasterInfo=g.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};
this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(c){return c&&null!=c.min?[c.min,c.max,c.mean,c.stddev]:c}):null},_updateStatistisHistograms:function(a){var c=this.functionArguments,n=c.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===
c.stretchType)this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=n;else{var m=a.pixelBlock,q=m.pixels.length,l=6===c.stretchType&&(c.dra||!n)||3===c.stretchType&&c.dra;l&&(m.statistics||m.calculateStatistics(),this._calculateStatisticsHistograms(a));if(c.dra)if(m.statistics||m.calculateStatistics(),l)this._statistics=m.statistics,this._histograms=m.histograms;else for(c=m.statistics,this._statistics=[],a=0;a<q;a++)this._statistics[a]=[c[a].minValue,
c[a].maxValue,0,0];else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=n}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=n,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},_getGammaCorrection:function(){var a=this.functionArguments.gamma;
if(a){var c=[],n;for(n=0;n<a.length;n++)c[n]=1<a[n]?2<a[n]?6.5+Math.pow(a[n]-2,2.5):6.5+100*Math.pow(2-a[n],4):1;return c}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var c=a.pixelBlock,n=c.pixels;c=c.width*c.height;var m=n.length,q,l;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var e=this.LUT,t=this.LUTOffset;for(q=0;q<m;q++){var x=e[q];for(l=0;l<c;l++){var r=n[q][l];
n[q][l]=x[r-t]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var c=a.pixelType,n=a.pixels,m=a.mask,q=n.length,l,e,t=function(E){this.min=-.5;this.max=255.5;this.size=256;g.mixin(this,E);this.counts=this.counts||new Uint32Array(this.size)},x=[],r,w;for(l=0;l<q;l++){var u=new t;var v=u.counts;var y=n[l];if("U8"===c)if(m)for(e=0;e<a.width*a.height;e++)m[e]&&v[y[e]]++;else for(e=0;e<a.width*a.height;e++)v[y[e]]++;else{var z=a.statistics[l].minValue;var B=a.statistics[l].maxValue;
u.min=z;u.max=B;B=(B-z)/256;var C=new Uint32Array(257);if(m)for(e=0;e<a.width*a.height;e++)m[e]&&C[Math.floor((y[e]-z)/B)]++;else for(e=0;e<a.width*a.height;e++)C[Math.floor((y[e]-z)/B)]++;for(e=0;255>e;e++)v[e]=C[e];v[255]=C[255]+C[256]}x.push(u);y=[];z=a.statistics[l].minValue;B=a.statistics[l].maxValue;for(e=w=r=C=0;e<u.size;e++)C+=v[e],r+=e*v[e];r/=C;for(e=0;e<u.size;e++)w+=v[e]*Math.pow(e-r,2);v=Math.sqrt(w/(C-1));e=(r+.5)*(u.max-u.min)/u.size+u.min;u=v*(u.max-u.min)/u.size;y.push(z);y.push(B);
y.push(e);y.push(u);a.statistics[l]={min:z,minValue:z,max:B,maxValue:B,mean:e,stddev:u}}a.histograms=x},_getCutOffPoints:function(a){var c=this.functionArguments,n=999;a&&a.pixelBlock?n=a.pixelBlock.pixels.length:a&&a.texture&&(n=3);a=Math.min(n,this._statistics.length);var m=[],q=[],l,e;switch(c.stretchType){case 5:for(l=0;l<a;l++)m[l]=this._statistics[l][0],q[l]=this._statistics[l][1];break;case 3:for(l=0;l<a;l++)m[l]=this._statistics[l][2]-c.numberOfStandardDeviations*this._statistics[l][3],q[l]=
this._statistics[l][2]+c.numberOfStandardDeviations*this._statistics[l][3],m[l]<this._statistics[l][0]&&(m[l]=this._statistics[l][0]),q[l]>this._statistics[l][1]&&(q[l]=this._statistics[l][1]);break;case 6:for(l=0;l<a;l++){n=this._histograms[l];var t=new Uint32Array(n.size);var x=n.counts;var r=0;var w=-.5===n.min&&1===(n.max-n.min)/x?.5:0;for(e=0;e<n.size;e++)r+=x[e],t[e]=r;x=c.minPercent*r/100;for(e=0;e<n.size;e++)if(t[e]>x){m[l]=n.min+(n.max-n.min)/n.size*(e+w);break}x=(1-c.maxPercent/100)*r;for(e=
n.size-2;0<=e;e--)if(t[e]<x){q[l]=n.min+(n.max-n.min)/n.size*(e+2-w);break}}break;default:for(l=0;l<n;l++)m[l]=0,q[l]=255}return{minCutOff:m,maxCutOff:q}},_createLUT:function(a){var c=this.functionArguments,n=a.pixelBlock,m=n.pixelType;if("U8"===m||"U16"===m||"S8"===m||"S16"===m){if(this._LUTSignature&&(m=this._computeLutSignature(),m.length===this._LUTSignature.length&&!m.some(function(D,G){return D!==this._LUTSignature[G]}.bind(this))))return;m=n.pixels.length;var q=[],l=[],e=c.max,t=c.min,x=c.gamma,
r=e-t,w=this._getCutOffPoints(a);a=w.minCutOff;w=w.maxCutOff;var u=0,v=256;"S8"===n.pixelType?u=-127:"S16"===n.pixelType&&(u=-32767);if("U16"===n.pixelType||"S16"===n.pixelType)v=65536;for(n=0;n<m;n++)q[n]=w[n]-a[n];var y=this._gammaCorrection;if(c.useGamma)for(n=0;n<m;n++){var z=[];for(c=0;c<v;c++){var B=c+u;var C=(B-a[n])/q[n];var E=1;1<x[n]&&(E-=Math.pow(1/r,C*y[n]));B<w[n]&&B>a[n]?z[c]=Math.floor(E*r*Math.pow(C,1/x[n]))+t:B>w[n]?z[c]=e:B<a[n]&&(z[c]=t)}l[n]=z}else for(n=0;n<m;n++){z=[];for(c=
0;c<v;c++)B=c+u,z[c]=B<a[n]?t:B>w[n]?e:Math.floor((B-a[n])/q[n]*r)+t;l[n]=z}this.LUT=l;this.LUTOffset=u;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,c=[],n,m;c.push(a.stretchType);c.push(a.min);c.push(a.max);c.push(a.numberOfStandardDeviations);if(this._statistics)for(n=0;n<this._statistics.length;n++)for(m=0;m<this._statistics[n].length;m++)c.push(this._statistics[n][m]);c.push(a.dra?1:0);c.push(a.minPercent);c.push(a.maxPercent);if(a.gamma)for(n=
0;n<this._statistics.length;n++)c.push(a.gamma[n]);c.push(a.useGamma?1:0);return c},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=this.functionArguments,n=a.pixelBlock,m=n.pixels,q=n.mask;n=n.width*n.height;var l=m.length,e=[],t=[],x=c.max,r=c.min,w=c.gamma,u=x-r;var v=this._getCutOffPoints(a);var y=v.minCutOff,z=v.maxCutOff;for(v=0;v<l;v++)e[v]=z[v]-y[v];if(c.useGamma&&null!==w&&w.length>=l)for(v=0;v<l;v++)t[v]=1<w[v]?2<w[v]?6.5+Math.pow(w[v]-2,2.5):
6.5+100*Math.pow(2-w[v],4):1;if(c.useGamma)if(void 0!==q&&null!==q)for(c=0;c<n;c++){if(q[c])for(v=0;v<l;v++){var B=m[v][c];var C=(B-y[v])/e[v];var E=1;1<w[v]&&(E-=Math.pow(1/u,C*t[v]));B<z[v]&&B>y[v]?m[v][c]=Math.floor(E*u*Math.pow(C,1/w[v]))+r:B>z[v]?m[v][c]=x:B<y[v]&&(m[v][c]=r)}}else for(c=0;c<n;c++)for(v=0;v<l;v++)B=m[v][c],C=(B-y[v])/e[v],E=1,1<w[v]&&(E-=Math.pow(1/u,C*t[v])),B<z[v]&&B>y[v]?m[v][c]=Math.floor(E*u*Math.pow(C,1/w[v]))+r:B>z[v]?m[v][c]=x:B<y[v]&&(m[v][c]=r);else if(void 0!==q&&
null!==q)for(c=0;c<n;c++){if(q[c])for(v=0;v<l;v++)B=m[v][c],B<z[v]&&B>y[v]?m[v][c]=Math.floor((B-y[v])/e[v]*u)+r:B>z[v]?m[v][c]=x:B<y[v]&&(m[v][c]=r)}else for(c=0;c<n;c++)for(v=0;v<l;v++)B=m[v][c],B<z[v]&&B>y[v]?m[v][c]=Math.floor((B-y[v])/e[v]*u)+r:B>z[v]?m[v][c]=x:B<y[v]&&(m[v][c]=r);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var c=this._statistics.length,n,m=[];for(n=0;n<c;n++){var q=this._statistics[n][2];"U8"!==a&&(q=255*(q-this._statistics[n][0])/(this._statistics[n][1]-
this._statistics[n][0]));m.push(this._computeGammaValue(q))}return m},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var c=0;0<a&&150!=a&&255>a&&(c=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));c=Math.log((a+c)/255);if(0!==c&&(a=Math.log(a/255)/c,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var c=this.renderTexture,n,m=a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||
this.sourceRasterInfo.raster.bandCount,q=a.pixelBlock,l=this.gl,e=l.drawingBufferWidth,t=l.drawingBufferHeight;if(!q&&this.functionArguments.dra){var x=new Float32Array(e*t*4),r=new Uint8Array(e*t);var w=new Float32Array(e*t);var u=new Float32Array(e*t);var v=new Float32Array(e*t);l.checkFramebufferStatus(l.FRAMEBUFFER)==l.FRAMEBUFFER_COMPLETE&&l.readPixels(0,0,e,t,l.RGBA,l.FLOAT,x);for(n=0;n<e*t;n++)w[n]=x[4*n],u[n]=x[4*n+1],v[n]=x[4*n+2],r[n]=x[4*n+3];a.pixelBlock=new b({width:e,height:t,pixels:[w,
u,v],mask:r});a.pixelBlock.calculateStatistics()}!q&&this.functionArguments.dra&&this._useGPUStats?(w=new Float32Array(m),u=new Float32Array(m)):(this._updateStatistisHistograms(a),x=this._getCutOffPoints(a),w=new Float32Array(m),u=new Float32Array(m),w.set(x.minCutOff.slice(0,m)),u.set(x.maxCutOff.slice(0,m)));this._initializeProgram({fragment:f.stretch,fragmentName:"Stretch"});x=this._setupTextureData(a);r=this.bindFrameBuffer();this.renderTexture=!1;this._performance.start();if(!q&&this.functionArguments.dra&&
this._useGPUStats){this._setUniforms({u_sourceDim:[e,t],u_bandCount:m});if(1===m)var y=this._readMinMax(x,2);else{y=this._readMinMax(x,0);var z=this._readMinMax(x,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)n=this._readHistogram(y,z,a),w=n.minCutOff||w,u=n.minCutOff||u}v=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(m);for(n=0;n<m;n++)a[n]=v/(u[n]-w[n]);this._useGPUStats&&this._initializeProgram({fragment:f.stretch,
fragmentName:"Stretch"});l.blendFunc(l.SRC_ALPHA,l.ZERO);v=new Float32Array(3);var B=new Float32Array(3);for(n=0;3>n;n++)v[n]=this.functionArguments.min,B[n]=this.functionArguments.max;n=this.functionArguments.useGamma;var C=this.functionArguments.gamma,E=this._gammaCorrection;Array.isArray(C)&&C.length>=m||(n=!1);this._setUniforms({u_sourceDim:[e,t],u_bandCount:m,u_minOutput:v,u_maxOutput:B,u_minCutOff:w,u_maxCutOff:u,u_factor:a,u_state:100,u_useGamma:n,u_gamma:C,u_scaled:!c,u_gammaCorrection:E,
u_minMaxTexture:!q&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=c;l.viewport(0,0,e,t);this._bindTexture(x.texture,"u_image");!q&&this.functionArguments.dra&&this._useGPUStats&&(c=l.getUniformLocation(this.rasterProgram,"u_image1"),l.uniform1i(c,1),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,y.texture),1<m&&(m=l.getUniformLocation(this.rasterProgram,"u_image2"),l.uniform1i(m,2),l.activeTexture(l.TEXTURE2),l.bindTexture(l.TEXTURE_2D,z.texture)));this._drawGL();
return{extent:x.extent,texture:r.texture}},_readMinMax:function(a,c){var n=this.gl,m=a.width||n.drawingBufferWidth,q=a.height||n.drawingBufferHeight;this._setUniforms({u_state:c});this.renderTexture=!1;var l=a.texture;for(n.activeTexture(n.TEXTURE0);1<m||1<q;){var e=this._createTexture();c=Math.max(Math.ceil(m/2),1);var t=Math.max(Math.ceil(q/2),1);n.getExtension("OES_texture_float");n.texImage2D(n.TEXTURE_2D,0,n.RGBA,c,t,0,n.RGBA,n.FLOAT,null);a=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,
a);n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);n.viewport(0,0,c,t);n.bindTexture(n.TEXTURE_2D,l);this._setUniforms({u_sourceDim:[m,q]});m=c;q=t;this._drawGL(!0);l=e}a=new Float32Array(m*q*4);n.checkFramebufferStatus(n.FRAMEBUFFER)==n.FRAMEBUFFER_COMPLETE&&n.readPixels(0,0,m,q,n.RGBA,n.FLOAT,a);return{texture:e,minmax:a}},_readHistogram:function(a,c,n){if(a)try{var m=this.gl,q=m.drawingBufferWidth,l=m.drawingBufferHeight,e,t,x;if(a.texture instanceof WebGLTexture){var r=
!0;var w=[1,0,0,1];if(c){var u=a.minmax;var v=c.minmax}else u=[a.minmax[0]],v=[a.minmax[1]]}else for(v=c,u=a,w=new Float32Array(v.length),e=0;e<v.length;e++)w[e]=256/(v[e]-u[e]);var y=new Float32Array(q*l);for(x=0;x<y.length;x++)y[x]=x;if(!this.histogramProgram){var z=h.getShader(m,h.histogram),B=f.getShader(m,f.constant);this.histogramProgram=this._loadProgram(z,B)}m.blendFunc(m.ONE,m.ONE);m.enable(m.BLEND);m.useProgram(this.histogramProgram);var C=m.getAttribLocation(this.histogramProgram,"a_pixelIndex"),
E=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,E);m.bufferData(m.ARRAY_BUFFER,y,m.STATIC_DRAW);m.enableVertexAttribArray(C);m.vertexAttribPointer(C,1,m.FLOAT,!1,0,0);var D=this._setupHistTexture(n),G=this._createTexture();m.getExtension("OES_texture_float");m.texImage2D(m.TEXTURE_2D,0,m.RGBA,257,1,0,m.RGBA,m.FLOAT,null);var H=m.createFramebuffer();m.bindFramebuffer(m.FRAMEBUFFER,H);m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,G,0);m.viewport(0,0,257,1);var N=m.getUniformLocation(this.histogramProgram,
"u_image");m.uniform1i(N,0);m.activeTexture(m.TEXTURE0);m.bindTexture(m.TEXTURE_2D,D);var O=m.getUniformLocation(this.histogramProgram,"u_sourceDim");m.uniform2f(O,q,l);var S=m.getUniformLocation(this.histogramProgram,"u_bandCount");m.uniform1i(S,3);var da=m.getUniformLocation(this.histogramProgram,"u_halfPixel");m.uniform2f(da,.5/q,.5/l);var J=m.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(r){m.uniform1i(J,1);var M=m.getUniformLocation(this.histogramProgram,"u_image1");m.uniform1i(M,
1);m.activeTexture(m.TEXTURE1);m.bindTexture(m.TEXTURE_2D,a.texture);if(c){var K=m.getUniformLocation(this.histogramProgram,"u_image2");m.uniform1i(K,2);m.activeTexture(m.TEXTURE2);m.bindTexture(m.TEXTURE_2D,c.texture)}}else{var R=m.getUniformLocation(this.histogramProgram,"u_mins");m.uniform4f(R,u[0],u[0],u[0],u[0]);m.uniform1i(J,0)}var X=m.getUniformLocation(this.histogramProgram,"u_color"),Q=m.getUniformLocation(this.histogramProgram,"u_factors"),W=m.getUniformLocation(this.histogramProgram,"u_size");
m.uniform1f(W,256);a=[];c=[];m.uniform4fv(X,[1,0,0,1]);m.uniform4fv(Q,[w[0],0,0,1]);m.drawArrays(m.POINTS,0,y.length);var I=this.sourceRasterInfo.raster.bandCount;1<I&&(m.uniform4fv(X,[0,1,0,1]),m.uniform4fv(Q,[0,w[0],0,1]),m.drawArrays(m.POINTS,0,y.length),m.uniform4fv(X,[0,0,1,1]),m.uniform4fv(Q,[0,0,w[0],1]),m.drawArrays(m.POINTS,0,y.length));if(m.checkFramebufferStatus(m.FRAMEBUFFER)==m.FRAMEBUFFER_COMPLETE){var T=new Float32Array(1028);m.readPixels(0,0,257,1,m.RGBA,m.FLOAT,T);m=0;var Y=-.5===
u[0]&&1===(v[0]-u[0])/256?.5:0;for(e=0;e<I;e++){var ca=new Float32Array(257);var V=new Float32Array(257);for(x=m=0;256>x;x++)m+=T[4*x+e],ca[x]=m,V[x]=T[4*x+e];V[256]=T[1024+e];ca[256]=m+T[1024+e];var Z=this.functionArguments.minPercent*m/100;if(v){for(t=0;256>t;t++)if(ca[t]>Z){a[e]=u[0]+(v[0]-u[0])/256*(t+Y);break}Z=(1-this.functionArguments.maxPercent/100)*m;for(t=254;0<=t;t--)if(ca[t]<Z){c[e]=u[0]+(v[0]-u[0])/256*(t+2-Y);break}}}}return{histogram:T,minCutOff:a,maxCutOff:c}}catch(ja){}},_setupHistTexture:function(a){if(a instanceof
WebGLTexture)return a;var c=this.originalHistTexture=this._createTexture(),n=this.gl;a=a.pixelBlock;var m=a.width,q=a.height;n.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();n.texImage2D(n.TEXTURE_2D,0,n.RGBA,m,q,0,n.RGBA,n.FLOAT,this.rgbaFloatData);return c}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(k,g,p,b,h,f,d){return k([b,f],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var c=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=g.mixin(a.raster,{bandCount:c?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=c?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var c=d.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,pixelBlock:c}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:h.remap,fragmentName:"Remap"});var c=new Uint8Array(64),n=this.functionArguments.colorBreaks;n.forEach(function(e,t){c[4*t]=e.mappedColor[0];c[4*t+1]=e.mappedColor[1];c[4*t+2]=e.mappedColor[2];c[4*t+3]=1>=e.mappedColor[3]?255*e.mappedColor[3]:e.mappedColor[3]});var m=n[n.length-1],q=m.mappedColor;c[60]=q[0];c[61]=q[1];c[62]=q[2];c[63]=1>=q[3]?255*q[3]:q[3];var l=new Float32Array(16);
n.forEach(function(e,t){l[t]=e.value});l[15]=m.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));n=this._clrTexture;m=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:c.length/4-1,u_breaks:l});this._bindTexture(n,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:m.texture}},_setupColormapTexture:function(a){var c=this._createTexture(),n=a.length/4,m=new Float32Array(a.length),
q=this.renderTexture?255:1,l,e=this.gl;for(l=0;l<a.length;l++)m[l]=a[l]/q;e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,1,0,e.RGBA,e.FLOAT,m);return c}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(k,g,p,b,h){return k([b,h],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(f){this.functionArguments={raster:null}},bind:function(f){f=this.getSourceRasterInfo(f);if(!f.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=g.mixin(f.raster,{});return!0},read2D:function(f){return f.raster},readGL:function(f){this._initializeProgram({fragment:p.identity,fragmentName:"identity"});f=this._setupTextureData(f.raster);var d=this.bindFrameBuffer();this._bindTexture(f.texture,"u_image");this._drawGL();return{extent:f.extent,
texture:d.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(k,g,p,b,h){return k([b,h],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(f){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
f)},bind:function(f){f=this.getSourceRasterInfo(f);if(!f.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=g.mixin(f.raster,{bandCount:f.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,f.raster.pixelType),statistics:f.raster.statistics,histograms:f.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(f){this._performance.start();this._initializeProgram({fragment:p.resample,fragmentName:"Resample"});
var d=this._setupTextureData(f.raster),a=this.bindFrameBuffer(),c=this.gl,n=c.drawingBufferWidth;c=c.drawingBufferHeight;var m=f.raster;void 0!==m.pixelBlock?(d=d||this._setupTextureData(m),f=m.pixelBlock.width,m=m.pixelBlock.height):(d=d||m,f=n,m=c);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[f/n,m/c],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/n,1/c]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:d.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(k,g,p,b,h,f,d,a,c){var n=function(){function m(l){q[l.prototype.rendererName]=l}var q={};m(b);m(f);m(d);m(h);m(a);m(c);return q}();return{wellKnownRenderers:n,
isSupported:function(m){if(!m)return!1;var q=!0;n[m.rendererName]||(q=!1);return q},create:function(m){if(!m)return null;if(m.rendererName){var q=m.rendererName;m=m.rendererArguments}else q="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(m.type),q="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[q],"rasterStretch"===m.type&&m.bandIndex&&1<m.bandIndex.length&&(q="RGB");return(q=n[q])?new q(m):null},createDefaultRenderer:function(m){if(m&&
m.raster){var q=m.raster.rasterInfo,l=m.raster.dataType;if(q){var e=m.raster.rasterFunction,t=["Stretch","Colormap","ContrastAndBrightness"];if(e&&"U8"===q.pixelType&&-1<t.indexOf(e.functionName))e.renderTexture=!0;else if("Processed"!==l||!(m.useWebGL&&e&&e.renderTexture||!m.useWebGL&&"U8"===q.pixelType)){e&&(q=e.rasterInfo);e=q.bandCount;var x=q.colormap,r=q.vat;t=q.histograms;t&&0===t.length&&(t=null);var w=q.statistics&&q.statistics.map(function(y){return[y.min,y.max,y.mean,y.stddev]});if(1===
e&&x&&0<x.length)var u=this._getDefaultColormapRenderer(r,x);else if(1===e&&r&&r.features&&0<r.features.length)u=new h({});else{x=0;r=!1;l||!m.raster||!m.raster.tileInfo||void 0!==m.raster.tileInfo.tileType&&"Map"!==m.raster.tileInfo.tileType?"U8"===q.pixelType&&"Processed"===l?(x=5,w=w||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],r=!1):"U8"===q.pixelType||"Elevation"===l?(x=5,r=w?!1:!0):"Scientific"===l?(x=5,r=w?!1:!0,u=this._getDefaultScientificColorRamp()):t&&0<t.length?(x=6,r=!1):w?(x=5,r=!1):(x=6,
r=!0):(w=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],x=5,r=!1);w||(x=5,r=!0);var v;3<=e&&!(m.bandIds||m.raster&&m.raster.imageServiceParams&&m.raster.imageServiceParams.bandIds)&&(v=this.getDefaultBandCombination(q));2===e&&(v=[0,0,0]);v&&(w=v.map(function(y){return w[y]}));m={stretchType:x,min:0,max:255,dra:r,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:w,histograms:t,numberOfStandardDeviations:2.5,bandIndex:v};1===e?(u&&(m.colorRamp=u,m.invert=!1),u=new d(m)):u=new f(m)}return u}}}},
getDefaultBandCombination:function(m){var q=m.bandCount;if(1===q)return null;if(2===q)return[0];m=m.keyProperties&&m.keyProperties.BandProperties;var l;if(m&&m.length===q){var e=this.getWellKnownBandIndexes(m);m=e.red;var t=e.green,x=e.blue;e=e.nir;null!=m&&null!=t&&null!=x?l=[m,t,x]:null!=e&&null!=m&&null!=t&&(l=[e,m,t])}!l&&3<=q&&(l=[0,1,2]);return l},getWellKnownBandIndexes:function(m){for(var q={},l=0;l<m.length;l++){var e=m[l],t=e.BandName&&e.BandName.toLowerCase();"red"===t?q.red=l:"green"===
t?q.green=l:"blue"===t?q.blue=l:"nearinfrared"===t||"nearinfrared_1"===t||"nir"===t?q.nir=l:e.WavelengthMax&&e.WavelengthMin&&(t=e.WavelengthMin,e=e.WavelengthMax,null==q.blue&&410<=t&&480>=t&&480<=e&&540>=e?q.blue=l:null==q.green&&490<=t&&560>=t&&560<=e&&610>=e?q.green=l:null==q.red&&595<=t&&670>=t&&660<=e&&730>=e?q.red=l:null==q.nir&&700<=t&&860>=t&&800<=e&&950>=e&&(q.nir=l))}return q},_getDefaultColormapRenderer:function(m,q){if(q||q.length){var l=[],e=this._ratContainsColormap(m);if(e)var t=this._getRATValueClassNameMap(m);
q.forEach(function(x){var r=t?t[x[0]]:x[0];l.push({color:[x[1],x[2],x[3]],value:x[0],label:e?null!=r?r:"":x[0]})});return new b({colormapInfos:l})}},_ratContainsColormap:function(m){if(!m||!m.fields)return!1;var q,l,e;return m.fields.some(function(t){t&&t.name&&(t=t.name.toLowerCase(),"red"===t&&(q=!0),"green"===t&&(l=!0),"blue"===t&&(e=!0));return q&&l&&e})},_getRATValueClassNameMap:function(m){if(!m||!m.fields)return null;var q={},l,e;m.fields.forEach(function(t){if("classname"===t.name.toLowerCase()||
"class_name"===t.name.toLowerCase())l=t.name;"value"===t.name.toLowerCase()&&(e=t.name)});m.features.forEach(function(t){t=t.attributes;q[t[e]]=l?t[l]:t[e]});return q},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(m){return{fromColor:m.toColor,toColor:m.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(k,g,p,b){return k([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(h){h&&h.colormapInfos&&(h.colormap=h.colormapInfos.map(function(f){return[f.value].concat(f.color)}));this._function=new b(h);this._function.outputPixelType="U8";this._function.renderTexture=!0},draw2D:function(h){this._updateColormapParameters();h=this._clonePixelData(h);
return h=this._function._colorize(h)},drawGL:function(h){this._updateColormapParameters();this._function._colorizeGL(h)},toJson:function(){var h=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:h}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(h){return{value:h[0],color:h.slice(1),label:h[0]}})}},_updateColormapParameters:function(){var h=this._function.functionArguments;
h.colormap=this.colormap;h.colormapName=this.colormapName;h.colorRamp=this.colorRamp;h.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(k,g,p,b){return k(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(h){h=h||{};this.raster=h.raster||h.Raster||this.raster;this.draw=g.hitch(this,this.draw);this.bind=
g.hitch(this,this.bind);h=g.clone(h);Object.keys(h).forEach(function(f){null==h[f]&&delete h[f]});g.mixin(this,h)},bind:function(h){if(!h)throw"failed to bind without options";var f=h;h.layer&&(h=h.layer,f={id:h.id,rawRasterInfo:h.raster.rasterInfo,glSetting:h._glSetting,xformSetting:h.tileManager&&h.tileManager.xformSetting,useWebGL:h.useWebGL,resampling:h.tileMode&&h.tileManager&&h.tileManager.xformSetting.requireProjection&&!h._hasTilingEffects&&"Thematic"!==h.raster.dataType?1:0,tileMode:h.tileMode});
this._rawRasterInfo=f.rawRasterInfo;this.useWebGL=f.useWebGL;this._function&&this._function.setProcessingContext(g.mixin({useProcessedData:!0},f));this._processingContext=f},hasTilingEffects:function(){},draw:function(h){return this.useWebGL?this.drawGL(h):this.draw2D(h)},toJson:function(){},_clonePixelData:function(h){if(null==h)return h;var f={};h.extent&&(f.extent=new p(h.extent.xmin,h.extent.ymin,h.extent.xmax,h.extent.ymax,h.extent.spatialReference));h=h.processedPixelBlock||h.pixelBlock;if(null==
h)return f;f.pixelBlock=h.clone?h.clone():b.prototype.clone(h);return f}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(k,g,p,b,h){return k([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",alias:"",uniqueValueInfos:null,constructor:function(f){f&&f.colormap&&(this.colormap=
f.colormap,this._function=new b(f),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(f){this.inherited(arguments);if(!this._function){var d=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!d)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,c=this.infos||this.uniqueValueInfos;this.defaultColor=this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var n=d.fields.filter(function(u){return"value"===
u.name.toLowerCase()})[0];if(n)var m=n.name;a||((a=d.fields.filter(function(u){return-1<["classname","category"].indexOf(u.name.toLowerCase())})[0])||(a=d.fields.filter(function(u){return"esriFieldTypeString"===u.type})[0]),this.alias=(this.field=a=a&&a.name||m)&&a.alias||m);var q=[],l;if(!c){c=[];var e=d.fields.filter(function(u){return"alpha"===u.name.toLowerCase()})[0];var t=d.fields.filter(function(u){return"red"===u.name.toLowerCase()})[0];var x=d.fields.filter(function(u){return"green"===u.name.toLowerCase()})[0];
var r=d.fields.filter(function(u){return"blue"===u.name.toLowerCase()})[0];for(n=0;n<d.features.length;n++){var w=d.features[n].attributes;(l=c.some(function(u){u.value===w[a]}))||(e&&t&&x&&r?c.push({value:w[a],alias:w[a],color:[w[t.name],w[x.name],w[r.name],w[e.name]]}):t&&x&&r?c.push({value:w[a],alias:w[a],color:[w[t.name],w[x.name],w[r.name]]}):c.push({value:w[a],alias:w[a]}))}if(!(t&&x&&r))for(l=h.createRandomColorRamp({size:c.length}),n=0;n<c.length;n++)c[n].color=l[n];this.uniqueValueInfos=
c}if(c)c.forEach(function(u){q=q.concat(d.features.filter(function(v){return u.value==v.attributes[a]}).map(function(v){return[v.attributes[m]].concat(u.color||u.symbol&&u.symbol.color)}))}),this.defaultColor&&d.features.filter(function(u){q.some(function(v){return v[0]===u.attributes[m]})||q.push([u.attributes[m]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=new b({colormap:q});this.colormap=q;this._function.outputPixelType="U8";this._function.renderTexture=
!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(f){f=this._clonePixelData(f);return f=this._function._colorize(f)},drawGL:function(f){this._function._colorizeGL(f)},toJson:function(f){var d={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};f&&(d.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:d}},toCommonRendererJson:function(){var f=this.attributeField||this.field1||this.field,d=(this.infos||
this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:f,uniqueValueInfos:d}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),function(k,g,p,b,h,f){return k([p],
{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(d){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);d=g.mixin({},
d,{stretchType:this.stretchType});this._function=new b(d);this._function.outputPixelType="U8";this._function.renderTexture=!1;this.bandIndex=d.bandIndex||d.BandIndex;this._cbFunction=new h(d);this._cbFunction.functionArguments.raster=this._function;this._cbFunction.renderTexture=!0},hasTilingEffects:function(){return this._function.hasTilingEffects()},draw2D:function(d){this._updateStretchParameters();d=this._clonePixelData(d);if("U8"===d.pixelBlock.pixelType&&!this.contrastOffset&&!this.brightnessOffset)return d;
this._function._stretch(d);var a=d.pixelBlock,c=this.bandIndex,n=Math.max.apply(null,c);a&&a.pixels.length>n&&c&&(a.pixels=c.map(function(m){return a.pixels[m]}),a.statistics&&(a.statistics=c.map(function(m){return a.statistics[m]})));if(this.contrastOffset||this.brightnessOffset)d.pixelBlock=f.contrastBrightnessStretch(d.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return d},drawGL:function(d){this._updateStretchParameters();d.pixelBlock&&(d=this._clonePixelData(d));
var a=d.pixelBlock,c=this.bandIndex,n=Math.max.apply(null,c),m=this.statistics&&0<this.statistics.length?this.statistics:this._function&&this._function.srcStatistics,q=this.histograms&&0<this.histograms.length?this.histograms:this._function&&this._function.srcHistograms,l,e;a&&a.pixels.length>n&&c&&(a.pixels=c.map(function(t){return a.pixels[t]}),a.statistics&&(a.statistics=c.map(function(t){return a.statistics[t]})),m&&0<m.length&&m.length!==c.length&&(l=c.map(function(t){return m[t]})),q&&0<q.length&&
q.length!==c.length&&(e=c.map(function(t){return q[t]})));this._function.functionArguments.statistics=l||m;this._function.functionArguments.histograms=e||q;this.contrastOffset||this.brightnessOffset?(this._function.renderTexture=!1,this._cbFunction.renderTexture=!0,d=this._function._stretchGL(d),this._cbFunction._cbGL(d)):(this._function.renderTexture=!0,this._function._stretchGL(d))},toJson:function(){var d=this._function.toJson().rasterFunctionArguments;d.bandIndex=this.bandIndex;d.contrastOffset=
this.contrastOffset;d.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:d}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:g.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:g.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var d=this._function.functionArguments;d.stretchType=this.stretchType;d.min=this.min;d.max=this.max;d.numberOfStandardDeviations=this.numberOfStandardDeviations;d.statistics=this.statistics;d.histograms=this.histograms;d.dra=this.dra;d.minPercent=this.minPercent;d.maxPercent=this.maxPercent;d.useGamma=this.useGamma;d.gamma=this.gamma;d.computeGamma=this.computeGamma;
this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(k,g,p,b,h,f,d,a){return k([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],
colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);c=g.mixin({},c,{stretchType:this.stretchType});Object.keys(c).forEach(function(n){null==
c[n]&&delete c[n]});this._function=new f(c);this._stretchFunction=new h(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new d(c);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===
c.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return c;this._stretchFunction._stretch(c);var n=c.pixelBlock,m=this.bandIndex?this.bandIndex[0]:0;n&&1<n.pixels.length&&n.pixels.length>m&&(n.pixels=[n.pixels[m]],n.statistics&&(n.statistics=[n.statistics[m]]));this.colorRamp&&(c=this._clrFunction._colorize(c));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=a.contrastBrightnessStretch(c.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});
return c},drawGL:function(c){this._updateStretchParameters();var n=c.pixelBlock,m=this.bandIndex?this.bandIndex[0]||0:0,q=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,l=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,e,t;n&&1<n.pixels.length&&n.pixels.length>m&&(n.pixels=[n.pixels[m]],n.statistics&&(n.statistics=[n.statistics[m]]),q&&q.length>m&&(e=[q[m]]),l&&
l.length>m&&(t=[l[m]]));this._stretchFunction.functionArguments.statistics=e||q;this._stretchFunction.functionArguments.histograms=t||l;n=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),n&&(c=this._clrFunction._colorizeGL(c)),this._function._cbGL(c)):n?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,c=this._stretchFunction._stretchGL(c),
this._clrFunction._colorizeGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=this._stretchFunction.toJson().rasterFunctionArguments;c.colorRamp=this.colorRamp||"";this.invert&&(c.invert=!0);c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||
"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:g.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:g.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=
this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer",
"../function/ColormapFunction","../function/RemapFunction"],function(k,g,p,b,h){return k([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(f){f=f||{};this._function=new h(f);this._function.outputPixelType="U8";var d=f.classBreakInfos;f=f.minValue;null!=f&&d&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(f,d))},bind:function(f){this.inherited(arguments);this.isColormapFunction=!1;
var d=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=d&&d.vat;if(a&&"u8"===d.pixelType.toLowerCase()&&this.classBreakInfos){var c=this.field;if(d=a.fields.filter(function(t){return"value"===t.name.toLowerCase()})[0])var n=d.name;var m=a.features.sort(function(t,x){return parseFloat(t.attributes[c])-parseFloat(x.attributes[c])})[0].attributes[c];this.isColormapFunction=!0;var q=[],l=this.field,e=this.classBreakInfos;e.forEach(function(t,x){a.features.forEach(function(r){var w=e[x-1]&&e[x-
1].classMaxValue||m;r.attributes[l]<=t.classMaxValue&&(r.attributes[l]>w||r.attributes[l]===m)&&(w=t.symbol.color,q.some(function(u){return u[0]===r.attributes[n]})||q.push([r.attributes[n]].concat(w)))})});this._function=new b({colormap:q});this.colormap=q;this._function.outputPixelType="U8";this._function.renderTexture=!0}this._function&&this._function.setProcessingContext(g.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(f){if(this.isColormapFunction)return this._updateColormapParameters(),
f=this._clonePixelData(f),f=this._function._colorize(f);this._updateRemapParameters();return this._function._remap(f)},drawGL:function(f){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(f)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(f))},toJson:function(){var f=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:f}},toCommonRendererJson:function(){var f,d=this.classBreakInfos,
a=this.colorBreaks;if(null==d&&a)for(d=[],f=0;f<a.length-1;f++)d.push({classMaxValue:a[f+1].value,symbol:{color:a[f].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[f].value+" - "+a[f+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:d}},_updateRemapParameters:function(){var f=this.classBreakInfos,d=this.minValue;null!=d&&f&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(d,f))},_getSortedColorBreaks:function(f,
d){d=d.map(function(c){return{maxValue:c.classMaxValue,color:c.symbol.color}}).sort(function(c,n){return c.maxValue-n.maxValue});var a=[{value:f,mappedColor:d[0].color}];for(f=0;f<d.length;f++)a.push({value:d[f].maxValue,mappedColor:f===d.length-1?d[f].color:d[f+1].color});return a},_updateColormapParameters:function(){this._function.functionArguments.colormap=this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),
function(k,g,p,b,h,f,d){return k([p],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=
a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=g.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,slopeType:this.slopeType});Object.keys(a).forEach(function(c){null==a[c]&&delete a[c]});this._function=new h(a);this._hillshadeFunction=new b(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},
draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||this.brightnessOffset)a.pixelBlock=d.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),
this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||
"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=
this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),function(k,g,p,b,h,f,d,a,c,n,m){k={requirePE:function(l,e){return!(l.equals(e)||l._canProject(e))},load:function(){var l=new p;
if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var e=new p;e.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=e.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?l.resolve():this._loadPromise.isRejected()&&l.resolve():(this._pendingdfds=this._pendingdfds||[],this._pendingdfds.push(l),this._loadPromise.then(g.hitch(this,function(){this._pendingdfds.forEach(function(t){t.isFulfilled()||
t.resolve()})}),g.hitch(this,function(){this._pendingdfds.forEach(function(t){t.isFulfilled()||t.reject()})})));return l.promise},computeError:function(l,e){return[Math.abs((l[0]+l[4]+l[4*e.rows]+l[4*e.rows+4])/4-l[2*e.rows+2]),Math.abs((l[1]+l[5]+l[4*e.rows+1]+l[4*e.rows+5])/4-l[2*e.rows+3])]},project:function(l,e){if(!e||l.spatialReference.equals(e))return l;var t=a.isLoaded()?a:c;"esri.geometry.Extent"===l.declaredClass?l=new d(l.toJson()):"esri.geometry.Point"===l.declaredClass&&(l=new m(l.toJson()));
e=new n(e.toJson());(l=t.project(l,e))&&"esri.geometry.Extent"===l.declaredClass?l=new d(l.toJson()):l&&"esri.geometry.Point"===l.declaredClass&&(l=new m(l.toJson()));return l},projectResolution:function(l,e,t){var x=t.xmin+(t.xmax-t.xmin)/2;t=t.ymin+(t.ymax-t.ymin)/2;l=new d(x,t,x+l.x,t+l.y,l.spatialReference);l=this.project(l,e);return new m(l.xmax-l.xmin,l.ymax-l.ymin,e)},getProjectionOffsetGrid:function(l,e,t,x,r,w){null==w&&(w=[32,32]);var u=l.xmin,v=l.ymin;x=l.xmax;var y=l.ymax,z=l.spatialReference,
B=e.spatialReference,C=a.isLoaded()?a:c,E=r?-r:null,D=w[0]*t.x,G=w[1]*t.y;t={cols:Math.ceil((x-u)/D)+1,rows:Math.ceil((y-v)/G)+1};l=[];for(x=0;x<t.cols;x++){var H=N;var N=[];for(y=0;y<t.rows;y++){var O=new m({x:u+D*x,y:v+G*y,spatialReference:z});O=C.project(O,B);if(!O)return null;N.push(O);0<x&&null!=E&&O.x<H[y].x&&(O.x+=r-E,O.x<H[y].x&&(O.x+=r-E));l.push((O.x-e.xmin)/(e.xmax-e.xmin));l.push((O.y-e.ymin)/(e.ymax-e.ymin))}}e=this.computeError(l,t);r=new Float32Array((t.cols-1)*(t.rows-1)*12);N=new Float32Array([-0,
-1,1,-1,1,-0,1,-0,-0]);u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(x=0;x<t.cols-1;x++)for(y=0;y<t.rows-1;y++){H=x*t.rows*2+2*y;v=l[H];z=l[H+1];B=l[H+2];C=l[H+3];H+=2*t.rows;E=l[H];D=l[H+1];G=l[H+2];O=l[H+3];var S=0,da=12*(y*(t.cols-1)+x);for(H=0;3>H;H++)r[da++]=N[S++]*v+N[S++]*B+N[S++]*G;for(H=S=0;3>H;H++)r[da++]=N[S++]*z+N[S++]*C+N[S++]*O;for(H=S=0;3>H;H++)r[da++]=u[S++]*v+u[S++]*E+u[S++]*G;for(H=S=0;3>H;H++)r[da++]=u[S++]*z+u[S++]*D+u[S++]*O}return{offsets:l,error:e,coefficients:r,spacing:w,size:[t.cols-
1,t.rows-1]}},getHalfWorldWidth:function(l){var e=l&&l.wkid;if(null!=e)return l.isWebMercator()&&(e=3857),null==f[e]?180:q[e]}};g.setObject("layers.rasterLib.raster.rasterProjectionHelper",k,h);var q={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,
53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,
54034:2.0037508342789244E7,54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54099:1.3524439768288724E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};return k})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),function(k,g,p,b,h,f){function d(q,l,e,t,x){void 0===t&&(t=null);void 0===x&&(x=!1);if(null===
t){var r=f.cacheKey(l,e);void 0!==m[r]?t=m[r]:(t=a(l,e,null),null===t&&(t=new f),m[r]=t)}return c._project(q,l,e instanceof h||!1===x?e:new h(e),t,x)}function a(q,l,e){void 0===e&&(e=null);q=c._getTransformation(q,l,e);return null!==q?f.fromGE(q):null}Object.defineProperty(g,"__esModule",{value:!0});var c=null;g.isLoaded=function(){return!!c&&b.isLoaded()};g.isSupported=function(){return b.isSupported()};var n=null;g.load=function(){if(n)return n.promise;n=new p;var q=b.load();k(["./geometryEngine"],
function(l){c=l;q.then(function(){c._enableProjection(b);n.resolve()},function(e){n.reject(e)})});return n.promise};g.project=function(q,l,e){void 0===e&&(e=null);return q instanceof Array?0===q.length?[]:d(q,q[0].spatialReference,l,e):d([q],q.spatialReference,l,e)[0]};var m={};g.projectMany=d;g.getTransformation=a;g.getTransformations=function(q,l,e){void 0===e&&(e=null);q=c._getTransformationBySuitability(q,l,e);if(null!==q){l=[];for(e=0;e<q.length;e++)l.push(f.fromGE(q[e]));return l}return[]}})},
"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(k,g,p,b,h){function f(r){function w(z,B,C){z[B]=C(z[B])}g._pe=r;q.init();l.init();e.init();t.init();x.init();g.PeGCSExtent=function(z){function B(){return null!==z&&z.apply(this,arguments)||this}p(B,z);B.prototype.destroy=function(){g._pe.destroy(this)};return B}(g._pe.PeGCSExtent);for(var u=0,v=[g._pe.PeDatum,g._pe.PeGeogcs,g._pe.PeGeogtran,g._pe.PeObject,g._pe.PeParameter,
g._pe.PePrimem,g._pe.PeProjcs,g._pe.PeSpheroid,g._pe.PeUnit];u<v.length;u++)r=v[u],w(r.prototype,"getName",function(z){return function(){return z.call(this,Array(q.PE_NAME_MAX))}});u=0;for(v=[g._pe.PeGeogtran,g._pe.PeProjcs];u<v.length;u++)r=v[u],w(r.prototype,"getParameters",function(z){return function(){for(var B=Array(q.PE_PARM_MAX),C=z.call(this),E=0;E<B.length;E++){var D=g._pe.getValue(C,"*");B[E]=D?g._pe.wrapPointer(D,g._pe.PeParameter):null;C+=Int32Array.BYTES_PER_ELEMENT}return B}});w(g._pe.PeHorizon.prototype,
"getCoord",function(z){return function(){var B=this.getSize();if(!B)return null;var C=[],E=z.call(this);n(C,B,E);return C}});w(g._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(z){var B=g._pe._pe_getPeGTlistExtendedGTsSize();return function(){var C=null,E=z.call(this);if(!g._pe.compare(E,g._pe.NULL)){C=[E];var D=this.getSteps();if(1<D){E=g._pe.getPointer(E);for(var G=1;G<D;G++)C.push(g._pe.wrapPointer(E+B*G,g._pe.PeGTlistExtendedGTs))}}return C}});var y=g._pe._pe_getPeHorizonSize();r=function(z){return function(){var B=
this._cache;B||(this._cache=B=new Map);if(B.has(z))return B.get(z);var C=null,E=z.call(this);if(!g._pe.compare(E,g._pe.NULL)){C=[E];var D=E.getNump();if(1<D){E=g._pe.getPointer(E);for(var G=1;G<D;G++)C.push(g._pe.wrapPointer(E+y*G,g._pe.PeHorizon))}}B.set(z,C);return C}};w(g._pe.PeProjcs.prototype,"horizonGcsGenerate",r);w(g._pe.PeProjcs.prototype,"horizonPcsGenerate",r);g._pe.PeObject.prototype.toString=function(z){void 0===z&&(z=q.PE_STR_OPTS_NONE);g._pe.ensureCache.prepare();var B=g._pe.getPointer(this),
C=g._pe.ensureInt8(Array(q.PE_BUFFER_MAX));return g._pe.UTF8ToString(g._pe._pe_object_to_string_ext(B,z,C))}}function d(r){if(r){var w=g._pe.getClass(r);w&&(w=g._pe.getCache(w))&&(r=g._pe.getPointer(r))&&delete w[r]}}function a(r,w){var u=[];w=Array(w);for(var v=0;v<r;v++)u.push(g._pe.ensureInt8(w));return u}function c(r){if(Array.isArray(r[0])){var w=[];r.forEach(function(u){w.push(u[0],u[1])})}else w=r;return w}function n(r,w,u,v){void 0===v&&(v=!1);if(v)for(v=0;v<2*w;v++)r[v]=g._pe.getValue(u+
v*Float64Array.BYTES_PER_ELEMENT,"double");else{var y=0===r.length;for(v=0;v<w;v++)y&&(r[v]=Array(2)),r[v][0]=g._pe.getValue(u,"double"),r[v][1]=g._pe.getValue(u+Float64Array.BYTES_PER_ELEMENT,"double"),u+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(g,"__esModule",{value:!0});var m;g._pe=null;g.isLoaded=function(){return!!g._pe};g.isSupported=function(){return!!h("esri-wasm")};g.load=function(){if(m)return m.promise;m=new b;k(["./support/pe-wasm"],function(r){r({locateFile:function(w){return k.toUrl("./support/"+
w)},onAbort:function(w){m.reject(Error(w))}}).then(function(w){f(w);m.resolve()})});return m.promise};(function(r){function w(y,z,B){g._pe.ensureCache.prepare();var C=c(B),E=B===C;C=g._pe.ensureFloat64(C);(y=g._pe._pe_geog_to_proj(g._pe.getPointer(y),z,C))&&n(B,z,C,E);return y}function u(y,z,B){return v(y,z,B,0)}function v(y,z,B,C){g._pe.ensureCache.prepare();var E=c(B),D=B===E;E=g._pe.ensureFloat64(E);(y=g._pe._pe_proj_to_geog_center(g._pe.getPointer(y),z,E,C))&&n(B,z,E,D);return y}r.geogToProj=
w;r.projGeog=function(y,z,B,C){switch(C){case q.PE_TRANSFORM_P_TO_G:return u(y,z,B);case q.PE_TRANSFORM_G_TO_P:return w(y,z,B)}return 0};r.projToGeog=u;r.projToGeogCenter=v})(g.PeCSTransformations||(g.PeCSTransformations={}));var q;(function(r){r.init=function(){r.PE_BUFFER_MAX=g._pe.PeDefs.prototype.PE_BUFFER_MAX;r.PE_NAME_MAX=g._pe.PeDefs.prototype.PE_NAME_MAX;r.PE_MGRS_MAX=g._pe.PeDefs.prototype.PE_MGRS_MAX;r.PE_USNG_MAX=g._pe.PeDefs.prototype.PE_USNG_MAX;r.PE_DD_MAX=g._pe.PeDefs.prototype.PE_DD_MAX;
r.PE_DDM_MAX=g._pe.PeDefs.prototype.PE_DDM_MAX;r.PE_DMS_MAX=g._pe.PeDefs.prototype.PE_DMS_MAX;r.PE_UTM_MAX=g._pe.PeDefs.prototype.PE_UTM_MAX;r.PE_PARM_MAX=g._pe.PeDefs.prototype.PE_PARM_MAX;r.PE_TYPE_NONE=g._pe.PeDefs.prototype.PE_TYPE_NONE;r.PE_TYPE_GEOGCS=g._pe.PeDefs.prototype.PE_TYPE_GEOGCS;r.PE_TYPE_PROJCS=g._pe.PeDefs.prototype.PE_TYPE_PROJCS;r.PE_TYPE_GEOGTRAN=g._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;r.PE_TYPE_COORDSYS=g._pe.PeDefs.prototype.PE_TYPE_COORDSYS;r.PE_TYPE_UNIT=g._pe.PeDefs.prototype.PE_TYPE_UNIT;
r.PE_STR_OPTS_NONE=g._pe.PeDefs.prototype.PE_STR_OPTS_NONE;r.PE_STR_AUTH_NONE=g._pe.PeDefs.prototype.PE_STR_AUTH_NONE;r.PE_STR_AUTH_TOP=g._pe.PeDefs.prototype.PE_STR_AUTH_TOP;r.PE_STR_NAME_CANON=g._pe.PeDefs.prototype.PE_STR_NAME_CANON;r.PE_PARM_X0=g._pe.PeDefs.prototype.PE_PARM_X0;r.PE_PARM_ND=g._pe.PeDefs.prototype.PE_PARM_ND;r.PE_TRANSFORM_1_TO_2=g._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;r.PE_TRANSFORM_2_TO_1=g._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;r.PE_TRANSFORM_P_TO_G=g._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;
r.PE_TRANSFORM_G_TO_P=g._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;r.PE_HORIZON_RECT=g._pe.PeDefs.prototype.PE_HORIZON_RECT;r.PE_HORIZON_POLY=g._pe.PeDefs.prototype.PE_HORIZON_POLY;r.PE_HORIZON_LINE=g._pe.PeDefs.prototype.PE_HORIZON_LINE;r.PE_HORIZON_DELTA=g._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(q=g.PeDefs||(g.PeDefs={}));(function(r){function w(z,B){var C=null,E=v[z];E||(E={},v[z]=E);E.hasOwnProperty(String(B))?C=E[B]:(z=g._pe.PeFactory.prototype.factoryByType(z,B),g._pe.compare(z,g._pe.NULL)||
(C=z,E[B]=C));return C=u(C)}function u(z){if(z){var B=z.getType();switch(B){case q.PE_TYPE_GEOGCS:z=g._pe.castObject(z,g._pe.PeGeogcs);break;case q.PE_TYPE_PROJCS:z=g._pe.castObject(z,g._pe.PeProjcs);break;case q.PE_TYPE_GEOGTRAN:z=g._pe.castObject(z,g._pe.PeGeogtran);break;default:B&q.PE_TYPE_UNIT&&(z=g._pe.castObject(z,g._pe.PeUnit))}}return z}var v={},y={};r.initialize=function(){g._pe.PeFactory.prototype.initialize(null)};r.coordsys=function(z){return w(q.PE_TYPE_COORDSYS,z)};r.factoryByType=
w;r.fromString=function(z,B){var C=null,E=y[z];E||(E={},y[z]=E);E.hasOwnProperty(B)?C=E[B]:(z=g._pe.PeFactory.prototype.fromString(z,B),g._pe.compare(z,g._pe.NULL)||(C=z,E[B]=C));return C=u(C)};r.geogcs=function(z){return w(q.PE_TYPE_GEOGCS,z)};r.geogtran=function(z){return w(q.PE_TYPE_GEOGTRAN,z)};r.getCode=function(z){return g._pe.PeFactory.prototype.getCode(z)};r.projcs=function(z){return w(q.PE_TYPE_PROJCS,z)};r.unit=function(z){return w(q.PE_TYPE_UNIT,z)}})(g.PeFactory||(g.PeFactory={}));g.PeGCSExtent=
null;var l;(function(r){var w;r.init=function(){r.PE_GTLIST_OPTS_COMMON=g._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;w=g._pe._pe_getPeGTlistExtendedEntrySize()};r.getGTlist=function(u,v,y,z,B,C){var E=null,D=new g._pe.PeInteger(C);try{var G=g._pe.PeGTlistExtended.prototype.getGTlist(u,v,y,z,B,D);if(C=D.val)if(E=[G],1<C){var H=g._pe.getPointer(G);for(u=1;u<C;u++)E.push(g._pe.wrapPointer(H+w*u,g._pe.PeGTlistExtendedEntry))}}finally{g._pe.destroy(D)}return E}})(l=g.PeGTlistExtended||(g.PeGTlistExtended=
{}));(function(r){r.destroy=function(w){if(w&&w.length){for(var u=0;u<w.length;u++){var v=w[u];d(v);v.getEntries().forEach(function(y){d(y);y=y.getGeogtran();d(y);y.getParameters().forEach(d);[y.getGeogcs1(),y.getGeogcs2()].forEach(function(z){d(z);var B=z.getDatum();d(B);d(B.getSpheroid());d(z.getPrimem());d(z.getUnit())})})}g._pe.PeGTlistExtendedEntry.prototype.Delete(w[0])}}})(g.PeGTlistExtendedEntry||(g.PeGTlistExtendedEntry={}));(function(r){r.geogToGeog=function(w,u,v,y,z){g._pe.ensureCache.prepare();
var B=c(v),C=v===B;B=g._pe.ensureFloat64(B);var E=0;y&&(E=g._pe.ensureFloat64(y));(w=g._pe._pe_geog_to_geog(g._pe.getPointer(w),u,B,E,z))&&n(v,u,B,C);return w}})(g.PeGTTransformations||(g.PeGTTransformations={}));(function(r){function w(v,y,z,B,C,E){g._pe.ensureCache.prepare();switch(v){case "dd":var D=g._pe._pe_geog_to_dd;var G=q.PE_DD_MAX;break;case "ddm":D=g._pe._pe_geog_to_ddm;G=q.PE_DDM_MAX;break;case "dms":D=g._pe._pe_geog_to_dms,G=q.PE_DMS_MAX}v=0;y&&(v=g._pe.getPointer(y));y=c(B);y=g._pe.ensureFloat64(y);
G=a(z,G);B=g._pe.ensureInt32(G);if(C=D(v,z,y,C,B))for(D=0;D<z;D++)E[D]=g._pe.UTF8ToString(G[D]);return C}function u(v,y,z,B,C){g._pe.ensureCache.prepare();switch(v){case "dd":var E=g._pe._pe_dd_to_geog;break;case "ddm":E=g._pe._pe_ddm_to_geog;break;case "dms":E=g._pe._pe_dms_to_geog}v=0;y&&(v=g._pe.getPointer(y));y=B.map(function(D){return g._pe.ensureString(D)});B=g._pe.ensureInt32(y);y=g._pe.ensureFloat64(Array(2*z));(E=E(v,z,B,y))&&n(C,z,y);return E}r.geog_to_dms=function(v,y,z,B,C){return w("dms",
v,y,z,B,C)};r.dms_to_geog=function(v,y,z,B){return u("dms",v,y,z,B)};r.geog_to_ddm=function(v,y,z,B,C){return w("ddm",v,y,z,B,C)};r.ddm_to_geog=function(v,y,z,B){return u("ddm",v,y,z,B)};r.geog_to_dd=function(v,y,z,B,C){return w("dd",v,y,z,B,C)};r.dd_to_geog=function(v,y,z,B){return u("dd",v,y,z,B)}})(g.PeNotationDms||(g.PeNotationDms={}));var e;(function(r){r.init=function(){r.PE_MGRS_STYLE_NEW=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;r.PE_MGRS_STYLE_OLD=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;
r.PE_MGRS_STYLE_AUTO=g._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;r.PE_MGRS_180_ZONE_1_PLUS=g._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;r.PE_MGRS_ADD_SPACES=g._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};r.geog_to_mgrs_extended=function(w,u,v,y,z,B,C){g._pe.ensureCache.prepare();var E=0;w&&(E=g._pe.getPointer(w));w=c(v);v=g._pe.ensureFloat64(w);w=a(u,q.PE_MGRS_MAX);var D=g._pe.ensureInt32(w);if(y=g._pe._pe_geog_to_mgrs_extended(E,u,v,y,z,B,D))for(z=0;z<u;z++)C[z]=g._pe.UTF8ToString(w[z]);
return y};r.mgrs_to_geog_extended=function(w,u,v,y,z){g._pe.ensureCache.prepare();var B=0;w&&(B=g._pe.getPointer(w));w=v.map(function(C){return g._pe.ensureString(C)});v=g._pe.ensureInt32(w);w=g._pe.ensureFloat64(Array(2*u));(y=g._pe._pe_mgrs_to_geog_extended(B,u,v,y,w))&&n(z,u,w);return y}})(e=g.PeNotationMgrs||(g.PeNotationMgrs={}));(function(r){r.geog_to_usng=function(w,u,v,y,z,B,C){g._pe.ensureCache.prepare();var E=0;w&&(E=g._pe.getPointer(w));w=c(v);v=g._pe.ensureFloat64(w);w=a(u,q.PE_MGRS_MAX);
var D=g._pe.ensureInt32(w);if(y=g._pe._pe_geog_to_usng(E,u,v,y,z,B,D))for(z=0;z<u;z++)C[z]=g._pe.UTF8ToString(w[z]);return y};r.usng_to_geog=function(w,u,v,y){g._pe.ensureCache.prepare();var z=0;w&&(z=g._pe.getPointer(w));w=v.map(function(B){return g._pe.ensureString(B)});v=g._pe.ensureInt32(w);w=g._pe.ensureFloat64(Array(2*u));(z=g._pe._pe_usng_to_geog(z,u,v,w))&&n(y,u,w);return z}})(g.PeNotationUsng||(g.PeNotationUsng={}));var t;(function(r){r.init=function(){r.PE_UTM_OPTS_NONE=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;
r.PE_UTM_OPTS_ADD_SPACES=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;r.PE_UTM_OPTS_NS=g._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};r.geog_to_utm=function(w,u,v,y,z){g._pe.ensureCache.prepare();var B=0;w&&(B=g._pe.getPointer(w));w=c(v);v=g._pe.ensureFloat64(w);w=a(u,q.PE_UTM_MAX);var C=g._pe.ensureInt32(w);if(y=g._pe._pe_geog_to_utm(B,u,v,y,C))for(B=0;B<u;B++)z[B]=g._pe.UTF8ToString(w[B]);return y};r.utm_to_geog=function(w,u,v,y,z){g._pe.ensureCache.prepare();var B=0;w&&(B=g._pe.getPointer(w));
w=v.map(function(C){return g._pe.ensureString(C)});v=g._pe.ensureInt32(w);w=g._pe.ensureFloat64(Array(2*u));(y=g._pe._pe_utm_to_geog(B,u,v,y,w))&&n(z,u,w);return y}})(t=g.PeNotationUtm||(g.PeNotationUtm={}));var x;(function(r){var w=new Map;r.init=function(){r.PE_PCSINFO_OPTION_NONE=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;r.PE_PCSINFO_OPTION_DOMAIN=g._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;r.PE_POLE_OUTSIDE_BOUNDARY=g._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;r.PE_POLE_POINT=
g._pe.PePCSInfo.prototype.PE_POLE_POINT};r.generate=function(u,v){void 0===v&&(v=r.PE_PCSINFO_OPTION_DOMAIN);var y;if(w.has(u)){var z=w.get(u);z[v]&&(y=z[v])}y||(y=g._pe.PePCSInfo.prototype.generate(u,v),z||(z=[],w.set(u,z)),z[v]=y);return y}})(x=g.PePCSInfo||(g.PePCSInfo={}));(function(r){r.version_string=function(){return g._pe.PeVersion.prototype.version_string()}})(g.PeVersion||(g.PeVersion={}));g._init=f})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var k=
Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var b in p)p.hasOwnProperty(b)&&(g[b]=p[b])};return function(g,p){function b(){this.constructor=g}k(g,p);g.prototype=null===p?Object.create(p):(b.prototype=p.prototype,new b)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(k,g,p){return function(){function b(h){this.steps=[];this._cached_projection={};this._chain="";
this._gtlistentry=null;if(h&&h.steps){var f=0;for(h=h.steps;f<h.length;f++){var d=h[f];d instanceof p?this.steps.push(d):this.steps.push(new p({wkid:d.wkid,wkt:d.wkt,isInverse:d.isInverse}))}}}b.cacheKey=function(h,f){return[void 0!==h.wkid&&null!==h.wkid?h.wkid.toString():"-1",void 0!==h.wkt&&null!==h.wkt?h.wkt.toString():"",void 0!==f.wkid&&null!==f.wkid?f.wkid.toString():"-1",void 0!==f.wkt&&null!==f.wkt?f.wkt.toString():""].join()};b.fromGE=function(h){var f=new b,d="",a=0;for(h=h.steps;a<h.length;a++){var c=
p.fromGE(h[a]);f.steps.push(c);d+=c.uid.toString()+","}f._cached_projection={};f._gtlistentry=null;f._chain=d;return f};b.prototype.getInverse=function(){var h=new b;h.steps=[];for(var f=this.steps.length-1;0<=f;f--)h.steps.push(this.steps[f].getInverse());return h};b.prototype.getGTListEntry=function(){for(var h="",f=0,d=this.steps;f<d.length;f++)h+=d[f].uid.toString()+",";h!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=h);return this._gtlistentry};b.prototype.assignCachedGe=
function(h,f,d){this._cached_projection[b.cacheKey(h,f)]=d};b.prototype.getCachedGeTransformation=function(h,f){for(var d="",a=0,c=this.steps;a<c.length;a++)d+=c[a].uid.toString()+",";d!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=d);h=this._cached_projection[b.cacheKey(h,f)];return void 0===h?null:h};return b}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require","exports"],function(k,g){var p=0;return function(){function b(h){void 0===h&&
(h=null);this.uid=p++;h?(this._wkt=void 0!==h.wkt?h.wkt:null,this._wkid=void 0!==h.wkid?h.wkid:-1,this._isInverse=void 0!==h.isInverse?!0===h.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}b.fromGE=function(h){var f=new b;f._wkt=h.wkt;f._wkid=h.wkid;f._isInverse=h.isInverse;return f};Object.defineProperty(b.prototype,"wkt",{get:function(){return this._wkt},set:function(h){this._wkt=h;this.uid=p++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){return this._wkid},
set:function(h){this._wkid=h;this.uid=p++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isInverse",{get:function(){return this._isInverse},set:function(h){this._isInverse=h;this.uid=p++},enumerable:!0,configurable:!0});b.prototype.getInverse=function(){var h=new b;h._wkt=this.wkt;h._wkid=this._wkid;h._isInverse=!this.isInverse;return h};return b}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B){k=g([B],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(C){},open:function(){var C=new b,E=this.serviceInfo||this._getServiceInfo(null),D=p.hitch(this,function(H){this.serviceInfo=H;this.version=H.currentVersion;this.rasterInfo=this._parseRasterInfo(H);this.loaded=!0;this._getRasterIdentifier();C.resolve(this)}),G=p.hitch(this,function(H){this.loaded=!0;this._getRasterIdentifier();C.reject(H)});n(E,D,G);return C.promise},
read:function(C){var E=this.url+"/tile/"+C.level+"/"+C.row+"/"+C.col,D={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:E+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:D,tileOptions:C})},identify:function(C,E){null==E&&(E=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var D=(C.x-this.tileInfo.origin.x)/
this.tileInfo.lods[E].resolution/this.tileInfo.cols;C=(this.tileInfo.origin.y-C.y)/this.tileInfo.lods[E].resolution/this.tileInfo.rows;var G=Math.floor(D),H=Math.floor(C),N=Math.floor((D-G)*this.tileInfo.cols);N=Math.min(N,this.tileInfo.cols-1);var O=Math.floor((C-H)*this.tileInfo.rows);O=Math.min(O,this.tileInfo.rows-1);var S=new b;this.read({level:E,row:H,col:G}).then(function(da){var J=O*da.width+N;da&&da.pixels&&0<da.pixels.length?(da=da.mask?da.mask[J]?da.pixels.map(function(M){return M[J]}):
null:da.pixels.map(function(M){return M[J]}),S.resolve(da)):S.reject("no valid data")},function(da){S.reject(da)});return S.promise},setFetchParameters:function(C,E){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var C=this.url,E=new b(r._dfdCanceller);E._pendingDfd=l({url:C,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});E._pendingDfd.then(function(D){E.callback(D)},
function(D){E.errback(D)});return E},_parseRasterInfo:function(C){var E=new z;E.extent=new e(C.fullExtent);E.spatialReference=new x(C.spatialReference);this.tileType=C.cacheType||"Map";switch(this.tileType){case "Map":E.bandCount=3;E.pixelType="U8";this.dataType="Processed";break;case "Elevation":E.bandCount=1;E.pixelType=C.pixelType||"F32";this.dataType="Elevation";break;case "Raster":E.bandCount=null,E.pixelType=null,this.dataType=C.serviceDataType&&C.serviceDataType.replace("esriImageServiceDataType",
"")||"Generic"}var D=C.tileInfo;E.width=Math.floor((C.fullExtent.xmax-C.fullExtent.xmin)/D.lods[D.lods.length-1].resolution+.5);E.height=Math.floor((C.fullExtent.ymax-C.fullExtent.ymin)/D.lods[D.lods.length-1].resolution+.5);E.cellSize=new t({x:D.lods[D.lods.length-1].resolution,y:D.lods[D.lods.length-1].resolution,spatialReference:C.spatialReference});this.tileInfo=new y(D);this.tileInfo.tileType=this.tileType;return E}});p.setObject("layers.rasterLib.raster.TileServiceRaster",k,m);return k})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B){k=g([B],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(C){this._cloudBlobStorage=C&&C._cloudBlobStorage},open:function(){var C=new b,E=this.datasetInfo||this._getDatasetInfo(null),D=p.hitch(this,function(H){this.datasetInfo=H;this.rasterInfo=H=this._parseRasterInfo(H);this.tileType="Cache/LERC"===H.format?"Elevation":"Cache/MIXED"===H.format||"Cache/JPEG"===H.format||"Cache/PNG"===
H.format?"Map":"Raster";this.tileInfo=H.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=H.packetSize*H.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();C.resolve(this)}),G=p.hitch(this,function(H){this.loaded=
!0;this._getRasterIdentifier();C.reject(H)});n(E,D,G);return C.promise},read:function(C){var E=new b,D=C.level,G=C.row,H=C.col,N=this._buildCacheFilePath(this.url,D,G,H),O=this._getIndexRecordFromBundle(D,G,H);l({url:N,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(p.hitch(this,function(S,da){E.isCanceled()||(S=new Uint8Array(S),S=this._getTileEndAndContentType(S,O),da={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,
format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1},this._requestPixels({url:N+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+S.position.toString()+"-"+(S.position+S.recordSize).toString()},decodeParams:da,tileOptions:C}).then(function(J){E.isCanceled()||E.resolve(J)},function(J){E.isCanceled()||E.reject(J)}))}));return E.promise},identify:function(){return null},setFetchParameters:function(C,E){},toJson:function(){return{url:this.url,
tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return l({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(C){var E=new z;switch(C.pixelType){case 1:var D="U1";break;case 1:D="U2";break;case 2:D="U4";break;case 3:D="U8";break;case 4:D="S8";break;case 5:D="U16";break;case 6:D="S16";break;case 7:D="U32";break;case 8:D=
"S32";break;case 9:D="F32";break;default:D="F32"}var G,H=[],N=C.LODInfos;for(G=0;G<N.levels.length;G++)H.push({level:N.levels[G],resolution:N.resolutions[G],scale:96/.0254*N.resolutions[G]});G=new x(C.extent.spatialReference||C.geodataXform.spatialReference);H=new y({rows:C.blockHeight,cols:C.blockWidth,dpi:96,format:C.format,compressionQuality:0,origin:C.origin,spatialReference:G,lods:H});E.pixelType=D;E.bandCount=C.bandCount;E.spatialReference=G;E.extent=new e({xmin:C.extent.xmin,ymin:C.extent.ymin,
xmax:C.extent.xmax,ymax:C.extent.ymax,spatialReference:G});E.cellSize=new t({x:C.pixelSizeX,y:C.pixelSizeY,spatialReference:G});E.width=Math.floor((E.extent.xmax-E.extent.xmin)/E.cellSize.x+.5);E.height=Math.floor((E.extent.ymax-E.extent.ymin)/E.cellSize.y+.5);E.statistics=C.statistics.map(function(O){Object.keys(O).forEach(function(S){isNaN(O[S])&&(O[S]=null)});return O});E.histograms=C.histograms;E.geodataXform=C.geodataXform;E.packetSize=C.packetSize;E.format=C.format;E.compressionQuality=C.compressionQuality;
E.tileInfo=H;return E},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(C,E,D,G){var H=this.rasterInfo.packetSize;G=Math.floor(G/H)*H;D="R"+this._toHexString4(Math.floor(D/H)*H)+"C"+this._toHexString4(G);H="L";H=10<=E?H+E.toString():H+("0"+E.toString());return this._cloudBlobStorage?C+"/_alllayers/"+H+"/"+D+".bundle":C+"/"+H+"_"+D+"/bundle"},_getIndexRecordFromBundle:function(C,E,
D){C=this.rasterInfo.packetSize;E=E%C*C+D%C;if(0>E)throw"Invalid level / row / col";return E*this._RECORD_SIZE+64},_getTileEndAndContentType:function(C,E){C=C.subarray(E,E+8);E=0;var D;for(D=0;5>D;D++)E|=(C[D]&255)<<8*D;var G=E&0xffffffffff;E=0;for(D=5;8>D;D++)E|=(C[D]&255)<<8*(D-5);return{position:G,recordSize:E&0xffffffffff}},_toHexString4:function(C){C=C.toString(16);if(4!=C.length)for(var E=4-C.length;0<E--;)C="0"+C;return C}});p.setObject("layers.rasterLib.raster.TileRaster",k,m);return k})},
"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B){k=g([z],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(C){C&&C.rasterFx&&this._init(C.rasterFx,C.rasterFxArgs)},open:function(){var C=this.getMemberRasters().map(function(D){return D.open()});this.identifiers=this.getMemberRasters().map(function(D){return D._rasterId});var E=new b;(new c(C,null,null,!0)).then(function(D){D.some(function(G){return!G[0]})?E.reject(D):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=D[0][1].tileInfo,E.resolve(this))}.bind(this));return E.promise},getProjectedFullExtent:function(C){var E=new b;this.getMemberRasters()[0].getProjectedFullExtent(C).then(p.hitch(this,function(D){this.projectedFullExtent=D;E.resolve(D)}));return E.promise},setProcessingContext:function(C){var E=C;C.layer&&(C=C.layer,
E={id:C.id,rawRasterInfo:C.raster.rasterInfo,glSetting:C._glSetting,xformSetting:C.tileManager&&C.tileManager.xformSetting,useWebGL:C.useWebGL,resampling:C.tileMode&&C.tileManager&&C.tileManager.xformSetting.requireProjection&&!C._hasTilingEffects&&"Thematic"!==C.raster.dataType?1:0,tileMode:C.tileMode});this.rasterFunction.setProcessingContext(E);this._layerOptions=E},alterDefinition:function(C){if(C=C||this.rasterFunction)1===this.memberRasters.length&&!C._bindComplete&&(this.rasterFunction=B.create(C,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(C,E){var D=this.getMemberRasters();
D&&1===D.length&&D[0].setFetchParameters(C,E)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(C){var E=new b(e._dfdCanceller);if(C.src){var D=this.rasterFunction.read(C);E.resolve(D);return E.promise}var G=this.getMemberRasters().map(function(S){return S.read(C)});G=new c(G);var H,N,O=this.identifiers;E._pendingDfd=G;G.then(p.hitch(this,function(S){if(H=
S.some(function(da){return da[0]}))N={},S.forEach(function(da,J){N[O[J]]=da[0]?da[1]:null});D=N?this.rasterFunction.read({extent:C.extent,src:N}):null;D.srcData=N;E.resolve(D)}));return E},_init:function(C,E){if(this.rasterFunction=B.create(C,E))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(C,E){var D=Object.keys(C),G,H,N;for(G=0;G<D.length;G++)if(N=C[D[G]]){var O=N instanceof Array?N:[N];for(H=0;H<O.length;H++)(N=
O[H])&&("function"===typeof N||"object"===typeof N)&&N.read&&(N.functionArguments?this._getMemberRasters(N.functionArguments,E):N.sourceType&&"Function"!==N.sourceType&&(N._identifier=N._getRasterIdentifier(),E.some(function(S){return S._identifier===N._identifier})||E.push(N)))}return E}});p.setObject("layers.rasterLib.raster.FunctionRaster",k,m);return k})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(k){return function(g,p,b,h,f){this.list=g;p=new k(g,
p,b,h,f);var d=p.resolve.bind(p),a=p.cancel.bind(p);p.cancel=function(){g&&g.forEach(function(c){c.cancel&&c.cancel()});a.apply(this,arguments)}.bind(p);p.resolve=function(){this.isFulfilled()||d.apply(this,arguments)}.bind(p);return p}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m){var q=function(l,e){var t;for(t=0;t<l.length;t++)if(e(l[t]))return t;return-1};return k(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(l){this.tiles=[];this.xformSetting={};this.mapSpatialReference=l&&l.mapSR;this.layer=l&&l.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(e){return e._rasterId}):[this.layer.raster._rasterId];(l=l&&l.tileInfo)&&this.setTileInfo(l)},setTileInfo:function(l){this.tileInfo=l;this.virtual=l.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=m.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=m.getHalfWorldWidth(l.spatialReference)},updateResolution:function(l,e){if(!(this.mapResolution&&l&&this._resolutionEqual(this.mapResolution.x,l.x)&&this._resolutionEqual(this.mapResolution.y,l.y))){this.tiles.forEach(g.hitch(this,function(u){u.fetch&&!u.fetch.isCanceled()&&u.fetch.cancel();u.update&&!u.update.isCanceled()&&u.update.cancel()}));this.tiles.length=0;var t=this.xformSetting.requireProjection;this.mapResolution=
this.resolution=l;t&&(this.resolution=m.projectResolution(l,this.tileInfo.spatialReference,this.layer.projectedFullExtent||e));this._resolution=this.resolution;l=this.resolution;if(!this.tileInfo.virtual){t=.75*Math.min(l.x,l.y)+.25*Math.max(l.x,l.y);if(t>=this.tileInfo.lods[0].resolution){var x=this.tileInfo.lods[0];this.ooe=!0}else{if(t<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)x=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(l=0;l<this.tileInfo.lods.length-1;l++)if(x=
this.tileInfo.lods[l],e=this.tileInfo.lods[l+1],x.resolution>=t&&e.resolution<=t){x.resolution-t>t-e.resolution&&(x=e);break}this.ooe=!1}this.level=x&&x.level;l=this.resolution=new a({x:x.resolution,y:x.resolution,spatialReference:this.tileInfo.spatialReference})}t=this.layer.raster.rasterInfo.extent;x=this.tileInfo.origin;e=this.tileInfo.cols;var r=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((x.y-t.ymax)/l.y/r),rowEnd:Math.floor((x.y-t.ymin-l.y)/l.y/r),colStart:Math.floor((t.xmin-x.x)/
l.x/e),colEnd:Math.floor((t.xmax-x.x-l.x)/l.x/e)};if(t=this.halfWorldWidth){r=Math.ceil(t/l.x/(e/2));var w=Math.round(e-(t-x.x)/l.x%e);w===e&&(w=0);this.fullBoundary.colRange=r;this.fullBoundary.paddingRight=w;this.fullBoundary.paddingLeft=Math.round((r*e*l.x+x.x-t-(x.x+t))/l.x)}this.hasNewData=!0}},getXformGrid:function(){var l=this.mapExtent,e=this.layer._hasTilingEffects?this.extent:this.fullExtent,t=this.layer.getCurrentResolution(),x=JSON.stringify(l.toJson())+JSON.stringify(e.toJson());this._cachedExtentString&&
this._cachedExtentString===x||(this._cachedExtentString=x,this._xformGrid=l=m.getProjectionOffsetGrid(l,e,t,null,this.halfWorldWidth));l=this._xformGrid;this.xformSetting.meshSize=l&&l.size;return l},getWrapTimes:function(l){var e=m.getHalfWorldWidth(l.spatialReference);if(!e)return 0;var t=l.xmin;l=l.xmax;var x=this.normalizeCoordinate(t,e),r=this.normalizeCoordinate(l,e);e*=2;return Math.round((l-r)/e)-Math.round((t-x)/e)},normalizeCoordinate:function(l,e){if(!e)return 0;var t=2*e;if(0<l){for(;l>
e;)l-=t;return l}for(;l<-e;)l+=t;return l},updateExtent:function(l,e){this.mapExtent=this.extent=l;var t=this.xformSetting.requireProjection;if(t){this.extent=m.project(l,this.tileInfo.spatialReference);if(!this.extent)return;this.extent.spatialReference=new d(this.extent.spatialReference.toJson())}this.updateResolution(e,l);var x=this.extent,r=this.tileInfo,w=r.cols,u=r.rows;e=this.resolution;var v=x;t=t?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(v=this._getIntersect(x,
t));var y=Math.floor((v.xmin-r.origin.x)/e.x/w)-this.prefetchBufferSize,z=Math.floor((v.xmax-r.origin.x)/e.x/w)+this.prefetchBufferSize,B=null;l=this.getWrapTimes(l);var C=this.fullBoundary&&this.fullBoundary.colRange;l&&this.halfWorldWidth&&(z===y&&(B=y),z+=l*C);var E=this.halfWorldWidth&&this.tiles.length&&(l!==this.wrapTimes||B!==this._circlularColId);E&&(this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1);this.wrapTimes=l;this._circlularColId=B;var D=Math.floor((r.origin.y-
v.ymax)/e.y/u)-this.prefetchBufferSize;B=Math.floor((r.origin.y-v.ymin)/e.y/u)+this.prefetchBufferSize;this.tileBoundary={rowStart:D,rowEnd:B,colStart:y,colEnd:z};var G,H;if((v=(B-D+1)*(z-y+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<l||E)this.tiles.forEach(g.hitch(this,function(da){da.fetch&&!da.fetch.isCanceled()&&da.fetch.cancel();da.update&&!da.update.isCanceled()&&da.update.cancel()})),this.tiles.length=0;if(!(v||2<l)){E=this.tiles;v=!1;for(G=
E.length-1;0<=G;G--){var N=E[G].row;var O=E[G].col;l&&C&&(0>y||z-this.prefetchBufferSize>C)&&(O=O>z?l*C+O:O<y?l*C+O:O);if(N<D||N>B||O<y||O>z)E[G].fetch&&!E[G].fetch.isCanceled()&&E[G].fetch.cancel(),E[G].update&&!E[G].update.isCanceled()&&E[G].update.cancel(),E.splice(G,1),v=!0}for(G=D;G<=B;G++)for(H=y;H<=z;H++){D=new f(r.origin.x+e.x*w*H,r.origin.y-e.y*u*(G+1),r.origin.x+e.x*w*(H+1),r.origin.y-e.y*u*G,x.spatialReference);var S=l&&C?0<=H?H%C:C- -H%C:H;N=q(E,function(da){return da.row===G&&da.col===
S&&da.wrapCol===H});O=t.xmax>=D.xmax?w:Math.round((t.xmax-D.xmin)/e.x);-1===N&&(E.push({row:G,col:S,wrapCol:H,cellsizeX:e.x,cellsizeY:e.y,width:w,height:u,actualWidth:O,extent:D,normalizedExtent:this._wrapExtent(D,S),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),v=!0)}v&&this._sortTiles();e=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+
1);this.height=e;this.count=E.length;e=Math.min.apply(null,E.map(function(da){return da.extent.xmin}));r=Math.max.apply(null,E.map(function(da){return da.extent.xmax}));w=Math.min.apply(null,E.map(function(da){return da.extent.ymin}));u=Math.max.apply(null,E.map(function(da){return da.extent.ymax}));e=this.fullExtent=new f(e,w,r,u,x.spatialReference);if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(v&&(this._tilesChanged=
!0),this.xformSetting.offset=[(x.xmin-e.xmin)/(e.xmax-e.xmin),-(e.ymin-x.ymin)/(e.ymax-e.ymin)],this.xformSetting.scale=[(x.xmax-x.xmin)/(e.xmax-e.xmin),(x.ymax-x.ymin)/(e.ymax-e.ymin)])}},fetchTiles:function(l){(this._tilesChanged||l)&&this._fetchTiles(l)},_fetchTiles:function(l){this._fetchCounter=0;var e=this.extent;this.fetchAllCompleted=l?new p:null;(this._tilesChanged||l&&this.layer._hasTilingEffects)&&this.tiles.forEach(g.hitch(this,function(x){x.updateCompleted=!1}));var t={};!this.layer.roaming&&
this.layer._hasTilingEffects&&l?(this.identifiers.forEach(function(x,r){t[x]={extent:this.extent,pixelBlock:new c({width:this.layer._map.width,height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:t,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(x,r){t[x]={extent:this.fullExtent,pixelBlock:new c({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData=
{extent:this.fullExtent,src:t,isEmpty:!0});this.tiles.forEach(g.hitch(this,function(x){if(x.fetch)x.update||(x.update=this.updateTile(x));else{if(this._isTileOutSide(x,e)){x.updateCompleted=!0;return}this._requestTile(x)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(x):x.src&&l&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&(this._fillPixelData(x),this.layer._hasTilingEffects&&(x.updateCompleted=!0),x.processedPixelBlock=null,x.renderedPixelBlock=null)}));0===this._fetchCounter&&
(this._fetched=!0);this._tilesChanged=!1;l&&this._updateFetchStatus()},updateTile:function(l,e){var t=new p;if(!l.src&&!l.fetch)return t.resolve(l),t.promise;b(l.src||l._fetched||l.fetch,g.hitch(this,function(){var x=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),r=this.layer._drawTile,w=this._validateRawPixelBlocks(l);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(r=r&&(this._progressiveGlobal||e));if((e||!e&&w)&&(x||r||this.layer.roaming)){if(this.xformSetting.requireProjection&&
this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return t.cancel(),t.promise;this._processTile(l,e).then(g.hitch(this,function(u){t.isCanceled()||this._renderTile(u,e).then(g.hitch(this,function(v){this.hasNewData=!1;t.isCanceled()||t.resolve(v)}))}))}else e||w||(l.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?t.resolve(this.originalPixelData):t.resolve()}));return t.promise},setLayer:function(l){this.layer=l},fillupTiles:function(){this.tiles.forEach(g.hitch(this,
function(l){l.update&&l.updateCompleted&&!l.filled&&(l.updateCompleted=!1,this._fillPixelData(l),l.updateCompleted=!0)}))},_validateRawPixelBlocks:function(l){return l&&l.src&&!this.identifiers.some(function(e){return!(l.src[e].pixelBlock&&0!==l.src[e].pixelBlock.validPixelCount&&l.src[e].pixelBlock.pixels&&0<l.src[e].pixelBlock.pixels.length)})},_wrapExtent:function(l,e){if(l){if(this.halfWorldWidth){var t=null!=e?new f({xmin:this.tileInfo.origin.x+this.tileInfo.cols*e*this.resolution.x,ymin:l.ymin,
xmax:this.tileInfo.origin.x+this.tileInfo.cols*(e+1)*this.resolution.x,ymax:l.ymax,spatialReference:l.spatialReference}):new f({xmin:l.xmin,ymin:l.ymin,xmax:l.xmax,ymax:l.ymax,spatialReference:l.spatialReference});e=this.normalizeCoordinate(t.xmin,this.halfWorldWidth);var x=e-t.xmin;.01<Math.abs(x)&&(t.xmin=e,t.xmax+=x)}return t||l}},_getIntersect:function(l,e){return new f(Math.max(l.xmin,e.xmin),Math.max(l.ymin,e.ymin),Math.min(l.xmax,e.xmax),Math.min(l.ymax,e.ymax),l.spatialReference)},_isTileOutSide:function(l,
e){var t=!1;if(l.virtual){var x=l.normalizedExtent;if(e=e||(this.xformSetting.requireProjection?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){l=x.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;t=x.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var r=x.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;x=x.ymax+this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;t=r<=e.xmin||l>=e.xmax||x<=e.ymin||t>=e.ymax}else t=
!1}else t=0>l.level||l.row<this.fullBoundary.rowStart||l.row>this.fullBoundary.rowEnd||l.col<this.fullBoundary.colStart||l.col>this.fullBoundary.colEnd;return t},_resolutionEqual:function(l,e){return l===e||l&&e&&Math.abs(l-e)<Math.abs(e/1E4)?!0:!1},_requestTile:function(l){var e=this.identifiers,t;if(this._isTileOutSide(l)){var x=new p;l.updateCompleted=!0;x.resolve(null);x=x.promise}else x=this.layer.raster.rasterFunction?new h(this.layer.raster.getMemberRasters().map(function(r){return r.read(l)})):
new h([this.layer.raster.read(l)]);l.fetch=x;this._fetchCounter++;b(l.src||l._fetched||x,g.hitch(this,function(r){if(t=r&&r.some(function(u){return u[0]})){var w={};r.forEach(function(u,v){w[e[v]]=u[0]&&u[1]?{extent:u[1].extent,pixelBlock:u[1].pixelBlock,width:u[1].width,height:u[1].height}:null});l.src=w}else l.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);l._fetched=!0;this._updateFetchStatus()}),g.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=
!0);l._fetched=!0;this._updateFetchStatus()}));l.update=this.updateTile(l)},_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(l){return!l._fetched})&&(this.tiles.forEach(g.hitch(this,function(l){this._fillPixelData(l)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(l,e){if(l&&!l.updateCompleted)if(Math.abs(l.cellsizeX-this.resolution.x)>l.cellsizeX/10)l.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(l))l.updateCompleted=
!0;else{var t=l.extent;if(this.layer.roaming||this.layer.useWebGL&&!this.layer._hasTilingEffects){var x=this.fullExtent;var r=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var w=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);e?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:r,height:w,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(g.hitch(this,function(v){this.originalPixelData.src[v].pixelBlock.width=
r;this.originalPixelData.src[v].pixelBlock.height=w}))}else x=this.extent,r=this.layer._map.width,w=this.layer._map.height,e?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:r,height:w,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(g.hitch(this,function(v){this.originalPixelData.src[v].pixelBlock.width=r;this.originalPixelData.src[v].pixelBlock.height=w}));if(x.xmax<=t.xmin||x.xmin>=t.xmax||x.ymax<=t.ymin||x.ymin>=t.ymax)return null;
var u=this.originalPixelData.isEmpty=!1;this.identifiers.forEach(g.hitch(this,function(v){l.src&&(this._fillPixelBlock(l.src[v],this.originalPixelData.src[v],{extent:x,width:r,height:w,normalizedExtent:l.normalizedExtent},!1),u=!0)}));l.filled=u;this.hasNewData=!0}},_fillPixelBlock:function(l,e,t,x){var r=l.extent,w=t.extent;x=t.width;var u=t.height;if(l.pixelBlock&&l.pixelBlock.pixels&&l.pixelBlock.pixels[0]){var v=(r.xmax-r.xmin)/l.width,y=Math.max(r.xmin,w.xmin),z=Math.min(r.ymax,w.ymax),B=Math.round((y-
r.xmin)/v),C=l.width-Math.round(Math.abs(r.xmax-Math.min(r.xmax,w.xmax))/v),E=Math.round(Math.abs(r.ymax-z)/v),D=l.height-Math.round((Math.max(r.ymin,w.ymin)-r.ymin)/v),G=this.halfWorldWidth;y=Math.round((y-w.xmin)/v);var H=t.normalizedExtent;if(!(this.wrapTimes&&G&&r.xmin<-G)){this.wrapTimes&&G&&(r.xmin>G?(y-=this.fullBoundary.paddingLeft,t=this.normalizeCoordinate(r.xmin,G),r=this.normalizeCoordinate(r.xmax,G)):(t=r.xmin,r=r.xmax),H&&H.xmin<G&&H.xmax>G?C-=this.fullBoundary.paddingRight:t<G&&r>G&&
(C-=this.fullBoundary.paddingRight));w=Math.round(Math.abs(w.ymax-z)/v);v=l.pixelBlock.pixels.length;e=e.pixelBlock;z=l.width;G=e.mask||new Uint8Array(x*u);var N=l.pixelBlock,O=N.mask,S=0;for(t=0;t<v;t++){H=N.pixels[t];var da=e.pixels[t]||new H.constructor(x*u);for(l=E;l<D;l++)for(S=(w+l-E)*x+y,r=B;r<C;r++)da[S+r-B]=H[l*z+r];e.pixels[t]=da}if(O)for(l=E;l<D;l++)for(S=(w+l-E)*x+y,r=B;r<C;r++)G[S+r-B]=O[l*z+r];else for(l=E;l<D;l++)for(S=(w+l-E)*x+y,r=B;r<C;r++)G[S+r-B]=1;e.pixelType=e.pixelType||N.pixelType;
e.mask=G;if(!(e.statistics&&0<e.statistics.length))for(e.statistics=[],l=0;l<N.statistics.length;l++)e.statistics[l]={minValue:N.statistics[l].minValue,maxValue:N.statistics[l].maxValue};else if(N.statistics&&e.statistics)for(l=0;l<e.statistics.length;l++)e.statistics[l].minValue=Math.min(N.statistics[l].minValue,e.statistics[l].minValue),e.statistics[l].maxValue=Math.max(N.statistics[l].maxValue,e.statistics[l].maxValue)}}},_processTile:function(l,e){var t=new p,x=this.layer._hasTilingEffects,r=
this.layer.useWebGL,w=x||r,u=this.layer.raster.rasterFunction&&l&&(x||r||!l.processedPixelBlock);if(e)var v=l;else this._fillPixelData(l),v=w?this.originalPixelData:l;this.xformSetting.hasNewTexture=this.hasNewData;var y;u?(this.identifiers.forEach(function(z){if(0===v.src[z].pixelBlock.pixels.length||0===v.src[z].pixelBlock.pixels[0].length)y=!0}),y?t.resolve({extent:v.extent,processedPixelBlock:v.src[this.identifiers[0]],pixelBlock:v.src[this.identifiers[0]]}):r?(this.processedPixelData=this.layer.raster.rasterFunction.read(v),
t.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:v.extent,src:v.src}).then(function(z){x?(this.processedPixelData=z,t.resolve(this.processedPixelData)):(l.processedPixelBlock=z.pixelBlock,t.resolve(l))}):(e=this.layer.raster.rasterFunction.read(l),l.processedPixelBlock=e.pixelBlock,t.resolve(l))):w?t.resolve(v.src[this.identifiers[0]]):(l.pixelBlock=v.src[this.identifiers[0]]&&v.src[this.identifiers[0]].pixelBlock,t.resolve(l));return t.promise},
_renderTile:function(l){var e=new p,t=this.layer._hasTilingEffects,x=this.layer.useWebGL,r=Math.abs((l.extent.xmax-l.extent.xmin)/l.width-this.layer.getCurrentResolution().x)>this.resolution.x/10;r=this.layer.useWebGL&&(r||this._isTileOutSide(l,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&l&&(l.texture||l.src||l.pixelBlock||l.processedPixelBlock)?(this.layer._rasterRenderer.interpolation=this.layer.interpolation,x&&!r?(this.layer.raster.rasterFunction&&
this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(l),e.resolve(l)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:l.extent,pixelBlock:l.processedPixelBlock||l.pixelBlock}).then(function(w){t?(w.renderedPixelBlock=w.pixelBlock,e.resolve(w)):(l.renderedPixelBlock=w.pixelBlock,e.resolve(l))}.bind(this)):(l.renderedPixelBlock=this.layer._rasterRenderer.draw(l).pixelBlock,e.resolve(l))):(l.renderedPixelBlock=l.processedPixelBlock||l.pixelBlock,e.resolve(l));
return e.promise},_sortTiles:function(){this.tiles.sort(function(l,e){return l.row<e.row||l.row==e.row&&l.col<e.col?-1:1})}})})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t){k=k(l,{declaredClass:"esri.virtualearth.VETiledLayer",
constructor:function(x){try{if(x=g.mixin({bingMapsKey:null,culture:"en-US"},x||{}),this.url=n.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=n.urlToObject(this.url),this.spatialReference=new m({wkid:102100}),this.tileInfo=new q({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,
scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},
{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),
this.initialExtent=this.fullExtent=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new m({wkid:102100})),g.mixin(this,x),this.hasAttributionData=this.showAttribution,this._initLayer=g.hitch(this,this._initLayer),this._errorHandler=g.hitch(this,this._errorHandler),this._getTileInfo=g.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");}catch(r){throw this.onError(r),r;}},_unsetMap:function(x,r){this.inherited("_unsetMap",
arguments)},_getTileInfo:function(){if(this.mapStyle){var x=this._url.path+"/Imagery/Metadata/"+this.mapStyle,r=window.location.protocol;if(this.bingMapsKey){var w=this.resourceInfo;!this.loaded&&w?this._initLayer(w):t({url:x,content:g.mixin({},{uriScheme:"https:"===r?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(x,r){if(200!==x.statusCode)r=
Error(),r.code=x.statusCode,r.message=x.statusDescription,r.details=x.errorDetails,r.authenticationResultCode=x.authenticationResultCode,this.onError(r);else try{this.resourceInfo=p.toJson(x);var w=x.resourceSets[0].resources[0],u=w.imageUrl.replace("{","${");this.tileServers=b.map(w.imageUrlSubdomains,function(y){var z=n.getProtocolForWebResource();return d.substitute(u,{subdomain:y}).replace("http:",z)});this._tsLength=this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();
else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var v=this.loadCallback;v&&(delete this.loadCallback,v(this))}}catch(y){this.onError(y)}},getAttributionData:function(){var x=new a,r=p.fromJson(this.resourceInfo),w;this.hasAttributionData&&r&&(w=g.getObject("resourceSets.0.resources.0.imageryProviders",!1,r));w?x.callback({contributors:w}):(r=Error("Layer does not have attribution data"),r.log=h.isDebug,x.errback(r));
return x},getTileUrl:function(x,r,w){return d.substitute(this.tileServers[r%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(x,r,w),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(x,r,w){var u="",v;for(v=x;0<v;v--){x="0";var y=1<<v-1;0!=(w&y)&&x++;0!=(r&y)&&(x++,x++);u+=x}return u},setMapStyle:function(x){this.mapStyle=x;this._getTileInfo()},setCulture:function(x){this.culture=x;this._getTileInfo()},setBingMapsKey:function(x){this.bingMapsKey=x},onMapStyleChange:function(){}});
g.mixin(k,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});g.setObject("virtualearth.VETiledLayer",k,c);return k})},"esri/dijit/Attribution":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry ../kernel ../lang ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w){k=k(null,{declaredClass:"esri.dijit.Attribution",itemDelimiter:" | ",listClass:"esriAttributionList",itemClass:"esriAttributionItem",lastItemClass:"esriAttributionLastItem",delimiterClass:"esriAttributionDelim",constructor:function(u,v){try{g.mixin(this,u);this._attributions={};this._pendingDfds={};this._activeLayers=[];this._sharedLayers=[];this._layerHandles={};var y=this.domNode=a.byId(v),z=this.map,B="\x3cspan class\x3d'"+this.listClass+"'\x3e\x3c/span\x3e";
y&&(c.set(y,"innerHTML",B),this.listNode=h.query(".esriAttributionList",y)[0],this.itemNodes={});this._eventConnections=[b.connect(z,"onLayerAdd",this,this._onLayerAdd),b.connect(z,"onLayerRemove",this,this._onLayerRemove),b.connect(z,"onLayerSuspend",this,this._onLayerSuspend),b.connect(z,"onLayerResume",this,this._onLayerResume),b.connect(z,"onResize",this,this._adjustFocus),b.connect(z,"onExtentChange",this,this._onExtentChange)];if(z.loaded){var C=z.layerIds.concat(z.graphicsLayerIds),E,D=C.length;
for(E=0;E<D;E++){var G=z.getLayer(C[E]);G.loaded&&this._onLayerAdd(G)}}}catch(H){}},startup:function(){},destroy:function(){p.forEach(this._eventConnections,b.disconnect);n.destroy(this.listNode);var u=this._layerHandles,v;for(v in u)u[v]&&u[v].remove();this.map=this.domNode=this._eventConnections=this.listNode=this._attributions=this._pendingDfds=this.itemNodes=this._activeLayers=this._lastItem=this._sharedLayers=this._layerHandles=null},_onLayerAdd:function(u){try{var v=this._attributions,y=u.id;
if(!t.isDefined(v[y])&&u.showAttribution){if(u.hasAttributionData){var z=u.getAttributionData();this._pendingDfds[y]=1;v[y]=z;z.addBoth(g.partial(this._onAttributionLoad,this,u))}else v[y]=u.copyright||u.copyrightText||"",v[y]?(u.suspended||this._activeLayers.push(y),this._createNode(y)):this._onLayerRemove(u);-1<u.declaredClass.toLowerCase().indexOf("vetiledlayer")&&(this._layerHandles[y]=u.on("map-style-change",g.hitch(this,function(){this._onLayerRemove(u);this._onLayerAdd(u)})))}}catch(B){}},
_onAttributionLoad:function(u,v,y){var z=u._attributions,B=u._pendingDfds,C=v.id;if(B&&B[C]){delete B[C];if(!y||y instanceof Error)y="";z[C]=y?u._createIndexByLevel(y,-1!==v.declaredClass.toLowerCase().indexOf("vetiledlayer")):v.copyright||v.copyrightText||"";z[C]?(v.suspended||u._activeLayers.push(C),u._createNode(C)):u._onLayerRemove(v)}},_onLayerRemove:function(u){try{var v=u.id,y=this.itemNodes,z=-1;this._onLayerSuspend(u);this._layerHandles[v]&&this._layerHandles[v].remove();delete this._attributions[v];
delete this._pendingDfds[v];delete this._layerHandles[v];var B=this._getGroupIndex(v);-1!==B&&(z=p.indexOf(this._sharedLayers[B],v),-1!==z&&(this._sharedLayers[B].splice(z,1),1>=this._sharedLayers[B].length&&this._sharedLayers.splice(B,1)));y[v]&&-1===z&&n.destroy(y[v]);delete y[v];this._updateLastItem()}catch(C){}},_onLayerSuspend:function(u){try{var v=u.id;if(this._attributions[v]){var y=p.indexOf(this._activeLayers,v),z=this.itemNodes[v];-1!==y&&this._activeLayers.splice(y,1);z&&this._toggleItem(z,
!1,this._getGroupIndex(v))}}catch(B){}},_adjustFocus:function(){var u=this.domNode.scrollWidth>this.domNode.clientWidth,v=q.contains(this.domNode,"esriAttributionOpen");c.set(this.domNode,"tabIndex",u||v?"0":"")},_onLayerResume:function(u){try{var v=u.id,y=this._attributions[v],z=this.itemNodes[v];if(y&&(-1===p.indexOf(this._activeLayers,v)&&this._activeLayers.push(v),z)){var B=g.isString(y)?y:this._getContributorsList(y,this.map.extent,this.map.getLevel());g.isString(y)||c.set(z,"innerHTML",B?B+
this._getDelimiter():"");B&&this._toggleItem(z,!0,this._getGroupIndex(v))}}catch(C){}},_onExtentChange:function(u,v,y,z){try{var B=this._activeLayers,C=this._attributions,E=this.itemNodes,D,G,H=B.length||0;for(G=0;G<H;G++){var N=B[G];var O=C[N];if((D=E[N])&&!g.isString(O)){var S=this._getContributorsList(O,u,z?z.level:-1);c.set(D,"innerHTML",S?S+this._getDelimiter():"");this._toggleItem(D,!!S,-1)}}}catch(da){}this._adjustCursorStyle()},_createNode:function(u){if(this.domNode){var v=this._checkShareInfo(u),
y=v&&v.sharedWith;y=y&&this.itemNodes[y];var z=this.map,B=this._attributions[u];B=g.isString(B)?B:this._getContributorsList(B,z.extent,z.getLevel());z=!!B&&!z.getLayer(u).suspended;y?(this.itemNodes[u]=y,this._toggleItem(y,z,v.index)):(u=this.itemNodes[u]=n.create("span",{"class":this.itemClass,innerHTML:B?B+this._getDelimiter():"",style:{display:z?"inline":"none"}},this.listNode),z&&this._setLastItem(u));this._adjustCursorStyle()}},_checkShareInfo:function(u){var v=this._attributions,y,z=-1,B=v[u];
if(B&&g.isString(B)){for(y in v){var C=v[y];if(y!==u&&C&&g.isString(C)&&C.length===B.length&&C.toLowerCase()===B.toLowerCase()){var E=y;break}}v=this._sharedLayers;C=v.length;if(E){for(y=0;y<C;y++)if(B=v[y],-1!==p.indexOf(B,E)){z=y;B.push(u);break}-1===z&&(z=v.push([E,u])-1)}}return-1<z?{index:z,sharedWith:E}:null},_getGroupIndex:function(u){var v=this._sharedLayers,y,z=v.length,B=-1;for(y=0;y<z;y++)if(-1!==p.indexOf(v[y],u)){B=y;break}return B},_getDelimiter:function(){var u=this.itemDelimiter;return u?
"\x3cspan class\x3d'"+this.delimiterClass+"'\x3e"+u+"\x3c/span\x3e":""},_toggleItem:function(u,v,y){if(-1<y&&!v){y=this._sharedLayers[y];var z,B=y.length,C=this._activeLayers;for(z=0;z<B;z++)if(-1!==p.indexOf(C,y[z]))return}m.set(u,"display",v?"inline":"none");this._updateLastItem()},_updateLastItem:function(){var u=this.listNode.childNodes;var v=u.length;if(v)for(--v;0<=v;v--){var y=u[v];if("none"!==m.get(y,"display")){this._setLastItem(y);break}}this._adjustCursorStyle()},_setLastItem:function(u){var v=
this.itemClass,y=this.lastItemClass;this._lastItem&&q.replace(this._lastItem,v,y);u&&(q.replace(u,y,v),this._lastItem=u)},_createIndexByLevel:function(u,v){u=u.contributors;var y,z,B=u?u.length:0,C,E=new x(4326),D={};for(z=0;z<B;z++){var G=u[z];var H=(y=G.coverageAreas)?y.length:0;for(C=0;C<H;C++){var N=y[C];var O=N.bbox;O={extent:r.geographicToWebMercator(new w(O[1],O[0],O[3],O[2],E)),attribution:G.attribution||"",zoomMin:N.zoomMin-(v&&N.zoomMin?1:0),zoomMax:N.zoomMax-(v&&N.zoomMax?1:0),score:t.isDefined(N.score)?
N.score:100,objectId:z};for(N=O.zoomMin;N<=O.zoomMax;N++)D[N]=D[N]||[],D[N].push(O)}}return D},_getContributorsList:function(u,v,y){var z="";if(v&&t.isDefined(y)&&-1<y){u=u[y];y=v.getCenter().normalize();var B=u?u.length:0,C=[],E={};for(z=0;z<B;z++)v=u[z],!E[v.objectId]&&v.extent.contains(y)&&(E[v.objectId]=1,C.push(v));C.sort(function(D,G){return G.score-D.score||D.objectId-G.objectId});B=C.length;for(z=0;z<B;z++)C[z]=C[z].attribution;z=C.join(", ")}return z},_adjustCursorStyle:function(){var u=
l.position(this.listNode.parentNode,!0).h;q.contains(this.listNode.parentNode,"esriAttributionOpen")?(q.remove(this.listNode.parentNode,"esriAttributionOpen"),u>l.position(this.listNode.parentNode,!0).h?(m.set(this.listNode.parentNode,"cursor","pointer"),q.add(this.listNode.parentNode,"esriAttributionOpen")):m.set(this.listNode.parentNode,"cursor","default")):(q.add(this.listNode.parentNode,"esriAttributionOpen"),u<l.position(this.listNode.parentNode,!0).h?m.set(this.listNode.parentNode,"cursor",
"pointer"):m.set(this.listNode.parentNode,"cursor","default"),q.remove(this.listNode.parentNode,"esriAttributionOpen"));this._adjustFocus()}});g.setObject("dijit.Attribution",k,e);return k})},"esri/dijit/TimeSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/kernel dojo/has dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dom-geometry dijit/_Widget dijit/_Templated dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojox/timing/_base dojox/form/RangeSlider dojo/text!dojox/form/resources/HorizontalRangeSlider.html ../kernel ../lang ../TimeExtent ./_EventedWidget dojo/text!./templates/TimeSlider.html dojo/i18n!../nls/jsapi".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B){h=k([y,n,m],{declaredClass:"esri.dijit.TimeSlider",widgetsInTemplate:!0,templateString:z,intermediateChanges:!1,_slideDuration:1E3,_defaultCount:10,_eventMap:{"time-extent-change":!0,play:!0,pause:!0,next:!0,previous:!0},constructor:function(C,E){g.mixin(this,B.widgets.timeSlider);this._iconClass="tsButton tsPlayButton";this.loop=this.playing=!1;this.thumbCount=1;this.thumbMovingRate=1E3;this._createTimeInstants=!1;this._options=g.mixin({excludeDataAtTrailingThumb:!1,
excludeDataAtLeadingThumb:!1},C.options||{})},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this._timer=new t.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=g.hitch(this,"_bumpSlider",1);this._createSlider()},destroy:function(){this._timer.stop();this.timeStops=this._timer=null;this._slider.destroy();this._slider=null;this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null);this._hLabels&&(this._hLabels.destroyRecursive(),
this._hLabels=null);this.inherited(arguments)},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var C=this._sliderToTimeExtent();this.onTimeExtentChange(C)},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay(this._sliderToTimeExtent())):(this._timer.stop(),this.onPause(this._sliderToTimeExtent()));var C=this._getSliderValue();this._offset=g.isArray(C)?
C[1]-C[0]:0},_onNext:function(){this.playing||(this._bumpSlider(1),this.onNext(this._sliderToTimeExtent()))},_onPrev:function(){this.playing||(this._bumpSlider(-1),this.onPrevious(this._sliderToTimeExtent()))},createTimeStopsByCount:function(C,E){C&&C.startTime&&C.endTime&&(E=E||this._defaultCount,this.createTimeStopsByTimeInterval(C,Math.ceil((C.endTime-C.startTime)/(E-1)),"esriTimeUnitsMilliseconds"))},createTimeStopsByTimeInterval:function(C,E,D,G){if(C&&C.startTime&&C.endTime){this.fullTimeExtent=
new v(C.startTime,C.endTime);G&&!0===G.resetStartTime&&this._resetStartTime(this.fullTimeExtent,D);this._timeIntervalUnits=D;G=this.fullTimeExtent.startTime;for(var H=[];G<=C.endTime;)H.push(G),G=C._getOffsettedDate(G,E,D);0<H.length&&H[H.length-1]<C.endTime&&H.push(G);this.setTimeStops(H)}},getCurrentTimeExtent:function(){return this._sliderToTimeExtent()},setTimeStops:function(C){this.timeStops=C||[];this._numTicks=this._numStops=this.timeStops.length;!1===u.isDefined(this.fullTimeExtent)&&(this.fullTimeExtent=
new v(C[0],C[C.length-1]))},setLoop:function(C){this.loop=C},setThumbCount:function(C){this.thumbCount=C;this.singleThumbAsTimeInstant(this._createTimeInstants);this._slider&&this._createSlider()},setThumbIndexes:function(C){this.thumbIndexes=g.clone(C)||[0,1];this._initializeThumbs()},setThumbMovingRate:function(C){this.thumbMovingRate=C;this._timer&&this._timer.setInterval(this.thumbMovingRate)},setLabels:function(C){this.labels=C;this._slider&&this._createSlider()},setTickCount:function(C){this._numTicks=
C;this._slider&&this._createSlider()},singleThumbAsTimeInstant:function(C){this._createTimeInstants=C&&1===this.thumbCount},next:function(){this._onNext()},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(){!0!==this.playing&&(this.playing=!1,this._onPlay())},previous:function(){this._onPrev()},_setIntermediateChangesAttr:function(C){this.intermediateChanges=!!C;this._slider&&this._slider.set("intermediateChanges",!!C)},_updateUI:function(){f.remove(this.playPauseBtn.iconNode,
this._iconClass);this._iconClass=this.playing?"tsButton tsPauseButton":"tsButton tsPlayButton";f.add(this.playPauseBtn.iconNode,this._iconClass);this.previousBtn.set("disabled",this.playing);this.nextBtn.set("disabled",this.playing)},_createSlider:function(){this._slider&&(this._slider.destroy(),this._slider=null);for(var C=this.domNode;C.parentNode&&!C.dir;)C=C.parentNode;C={onChange:g.hitch(this,"_onHorizontalChange"),showButtons:!1,discreteValues:this._numStops,slideDuration:this._slideDuration,
"class":"ts",dir:"ltr",intermediateChanges:this.intermediateChanges};this._ts=d.create("div",{},b.query(".tsTmp",this.domNode)[0],"first");this._timeSliderTicks=d.create("div",{},this._ts,"first");this._timeSliderLabels=d.create("div",{},this._ts);2===this.thumbCount?this._createRangeSlider(C):this._createSingleSlider(C);this.thumbIndexes=this.thumbIndexes||[0,1];this._createHorizRule();this._createLabels();!0===this._createTimeInstants&&b.query(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper",
this._ts).forEach(function(E){a.set(E,{background:"none"})});this._initializeThumbs();p.disconnect(this._onChangeConnect);this._onChangeConnect=p.connect(this._slider,"onChange",g.hitch(this,"_updateThumbIndexes"))},_createRangeSlider:function(C){this._isRangeSlider=!0;this._slider=new (k([q,x],{templateString:r}))(C,this._ts)},_createSingleSlider:function(C){this._isRangeSlider=!1;this._slider=new q(C,this._ts)},_createHorizRule:function(){this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=
null);2>this._numTicks||(this._hTicks=new l({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks},this._timeSliderTicks))},_createLabels:function(){this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null);this.labels&&0<this.labels.length&&(this._hLabels=new e({labels:this.labels,labelStyle:"","class":"tsLabels"},this._timeSliderLabels))},_initializeThumbs:function(){if(this._slider){this._offset=this._toSliderValue(this.thumbIndexes[1])||0;var C=this._toSliderValue(this.thumbIndexes[0]);
C=C>this._slider.maximum||C<this._slider.minimum?this._slider.minimum:C;if(!0===this._isRangeSlider){var E=this._toSliderValue(this.thumbIndexes[1]);E=E>this._slider.maximum||E<this._slider.minimum?this._slider.maximum:E;this._setSliderValue([C,E<C?C:E])}else this._setSliderValue(C);this._onHorizontalChange()}},_bumpSlider:function(C){var E=this._getSliderValue(),D=E,G=D,H=C;g.isArray(E)&&(G=E[0],D=E[1],H=[{change:C,useMaxValue:!0},{change:C,useMaxValue:!1}]);1E-10>Math.abs(G-this._slider.minimum)&&
0>C||1E-10>Math.abs(D-this._slider.maximum)&&0<C?this._timer.isRunning&&(this.loop?(this._timer.stop(),this._setSliderValue(this._getSliderMinValue()),C=this._sliderToTimeExtent(),this.onTimeExtentChange(C),this._timer.start(),this.playing=!0):this.pause()):this._slider._bumpValue(H)},_updateThumbIndexes:function(){var C=this._getSliderValue();g.isArray(C)?(this.thumbIndexes[0]=this._toSliderIndex(C[0]),this.thumbIndexes[1]=this._toSliderIndex(C[1])):this.thumbIndexes[0]=this._toSliderIndex(C)},_sliderToTimeExtent:function(){if(this.timeStops&&
0!==this.timeStops.length){var C=new v,E=this._getSliderValue();if(g.isArray(E)){if(E[0]>E[1]){var D=E[0];var G=E[1]}else G=E[0],D=E[1];C.startTime=new Date(this.timeStops[this._toSliderIndex(G)]);C.endTime=new Date(this.timeStops[this._toSliderIndex(D)]);this._adjustTimeExtent(C)}else C.startTime=!0===this._createTimeInstants?new Date(this.timeStops[this._toSliderIndex(E)]):new Date(this.fullTimeExtent.startTime),C.endTime=!0===this._createTimeInstants?C.startTime:new Date(this.timeStops[this._toSliderIndex(E)]);
return C}},_adjustTimeExtent:function(C){if((!1!==this._options.excludeDataAtTrailingThumb||!1!==this._options.excludeDataAtLeadingThumb)&&C.startTime.getTime()!==C.endTime.getTime()){if(this._options.excludeDataAtTrailingThumb){var E=C.startTime;E.setUTCSeconds(E.getUTCSeconds()+1)}this._options.excludeDataAtLeadingThumb&&(C=C.endTime,C.setUTCSeconds(C.getUTCSeconds()-1))}},_resetStartTime:function(C,E){switch(E){case "esriTimeUnitsSeconds":C.startTime.setUTCMilliseconds(0);break;case "esriTimeUnitsMinutes":C.startTime.setUTCSeconds(0,
0,0);break;case "esriTimeUnitsHours":C.startTime.setUTCMinutes(0,0,0);break;case "esriTimeUnitsDays":C.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsWeeks":C.startTime.setUTCDate(C.startTime.getUTCDate()-C.startTime.getUTCDay());break;case "esriTimeUnitsMonths":C.startTime.setUTCDate(1);C.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsDecades":C.startTime.setUTCFullYear(C.startTime.getUTCFullYear()-C.startTime.getUTCFullYear()%10);break;case "esriTimeUnitsCenturies":C.startTime.setUTCFullYear(C.startTime.getUTCFullYear()-
C.startTime.getUTCFullYear()%100)}},_getSliderMinValue:function(){return this._isRangeSlider?[this._slider.minimum,this._slider.minimum+this._offset]:this._slider.minimum},_toSliderIndex:function(C){C=Math.floor((C-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum));0>C&&(C=0);C>=this._numStops&&(C=this._numStops-1);return C},_toSliderValue:function(C){return C*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum},_getSliderValue:function(){return this._slider.get("value")},
_setSliderValue:function(C){this._slider._setValueAttr(C,!1,!1)}});g.setObject("dijit.TimeSlider",h,w);return h})},"esri/dijit/MultidimensionalSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/on dojo/json dijit/form/VerticalSlider dojox/form/VerticalRangeSlider dijit/form/VerticalRule dijit/form/VerticalRuleLabels dijit/form/HorizontalSlider dojox/form/HorizontalRangeSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dijit/_Widget dijit/_Templated dojox/timing/_base dojo/_base/array dojo/Deferred dojo/DeferredList ../layers/MosaicRule ../layers/DimensionalDefinition ../kernel ../lang ./_EventedWidget dojo/text!./templates/MultidimensionalSlider_vertical.html dojo/text!./templates/MultidimensionalSlider_horizontal.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/touch dojo/query dojo/dom-construct dojo/_base/sniff".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da,J){var M={LAYOUT_VERTICAL:"vertical",LAYOUT_HORIZONTAL:"horizontal"};e=k([C,e,t],{declaredClass:"esri.dijit.MultidimensionalSlider",widgetsInTemplate:!0,templateString:E,nLabels:10,_thumbCount:1,useRanges:void 0,loop:!0,useLayersDimSlices:!0,prefetch:!0,prefetchedValues:{},showPlayButton:!0,prefetchFactor:2,_hasUnitConflict:!1,_update:!0,useDefaults:!1,playDirectionAscending:!0,unitSymbols:{meter:"m",pascal:"Pa"},_eventMap:{"dimension-value-change":!0,
play:!0,pause:!0,next:!0,previous:!0,change:!0,"dimension-array-create":!0},onChange:function(){},onPlay:function(){},onPause:function(){},onDimensionValueChange:function(){},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay()):(this._timer.stop(),this.onPause())},constructor:function(K,R){k.safeMixin(this,K);this.playing=!1;this._iconClass="mdsButton mdsPlayButton";this.map&&this._getImageLayers();this.layout===M.LAYOUT_HORIZONTAL&&(this.templateString=
D);this.thumbMovingRate=this.thumbMovingRate||3E3;this._i18n=G;this.prefetchImgNodes={}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);var K=this;this._getAllLayersMDInfo().then(function(){K._sortDimensionValues();K.dimensionValues=K.dimensionValues&&K.dimensionValues.length&&!K.useLayersDimSlices?K.dimensionValues:K._mapSortedDimensionValues;K.getUnit();K._setupSlider()});this._timer=new x.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=
g.hitch(this,function(){this.playDirectionAscending?this._bumpSlider(1):this._bumpSlider(-1)});this.layout===M.LAYOUT_VERTICAL&&(this.computeSliderStyle(),this.on("resize",g.hitch(this,"computeSliderStyle")));this._setupHandles()},_insertPassiveLabels:function(){var K=da(".dijitSliderMoveable.dijitSliderMoveableV",this.domNode);this._passiveLbl1=J.create("div");H.add(this._passiveLbl1,"esriMdSliderPassiveLbl");J.place(this._passiveLbl1,K[0]);2===this._thumbCount&&(this._passiveLbl2=J.create("div"),
H.add(this._passiveLbl2,"esriMdSliderPassiveLbl"),J.place(this._passiveLbl2,K[1]))},_setupHandles:function(){this._eventHandles=[];this._eventHandles.push(b(this.domNode,"mouseover",g.hitch(this,"activateSlider")));this._eventHandles.push(b(this.domNode,"mouseleave",g.hitch(this,"deactivateSlider")));this._eventHandles.push(b(this.domNode,S.press,g.hitch(this,"activateSlider")));this._eventHandles.push(b(this.domNode,S.release,g.hitch(this,"deactivateSlider")));this._eventHandles.push(b(this.prevBtn.domNode,
S.press,g.hitch(this,"activateSlider")));this._eventHandles.push(b(this.playPauseBtn.domNode,S.press,g.hitch(this,"activateSlider")));this._eventHandles.push(b(this.nextBtn.domNode,S.press,g.hitch(this,"activateSlider")));var K=da(".dijitSliderImageHandle.dijitSliderImageHandleV",this.domNode);r.forEach(K,function(R){this._eventHandles.push(b(R,S.press,g.hitch(this,"activateSlider")));this._eventHandles.push(b(R,S.release,g.hitch(this,"deactivateSlider")))},this)},_removeHandles:function(){r.forEach(this._eventHandles,
function(K){K&&K.remove()})},activateSlider:function(){9>p("ie")&&N.set(this.domNode,"background","#fff");this.sliderActive=!0;this.deactivateTimer&&clearTimeout(this.deactivateTimer);H.remove(this.domNode,"esriMdSliderPassive");H.add(this.domNode,"esriMdSliderActive");N.set(this._passiveLbl1,"display","none");this._passiveLbl2&&N.set(this._passiveLbl2,"display","none")},deactivateSlider:function(){if(!(10>p("ie"))){var K=this;this.deactivateTimer=setTimeout(function(){K.sliderActive=!1;K.updatePassiveLabels();
H.remove(K.domNode,"esriMdSliderActive");H.add(K.domNode,"esriMdSliderPassive");K._showPassiveLabels()},2500)}},updatePassiveLabels:function(){this._slider&&B.isDefined(this._slider.value)&&(this._passiveLbl1.innerHTML=this.value.length?this.value[0]:this.value,this._slider.value.length&&(this._passiveLbl2.innerHTML=this.value[1]),this.sliderActive||this._showPassiveLabels())},_showPassiveLabels:function(){B.isDefined(this.value)&&(N.set(this._passiveLbl1,"display","inline-block"),this.value.length?
N.set(this._passiveLbl2,"display","inline-block"):this._passiveLbl2&&N.set(this._passiveLbl2,"display","none"))},increment:function(){var K=1;!this.playDirectionAscending&&this.playing&&(K=-1);this._bumpSlider(K)},decrement:function(){var K=-1;!this.playDirectionAscending&&this.playing&&(K=1);this._bumpSlider(K)},_setDimensionAttr:function(K){this._slider&&(K.dimension&&(this.dimension=K.dimension),this.dimensionValues=K.dimensionValues&&K.dimensionValues.length?K.dimensionValues:[],this.update())},
update:function(){var K=this;this._mapSortedDimensionValues=[];this._getImageLayers();this.value=this.dimensionValues[this._slider.value];this._getAllLayersMDInfo().then(function(){K._sortDimensionValues();K.getUnit();K.dimensionValues&&K.dimensionValues.length&&!K.useLayersDimSlices||(K.dimensionValues=K._mapSortedDimensionValues);K._setupSlider()})},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(K){!0!==this.playing&&(this.playing=!1,this._onPlay())},_setupSlider:function(){this._destroySlider();
this.dimensionValues&&this.dimensionValues.length&&(this.sliderNode=document.createElement("div"),this._getDimensionAlias(),this._layers&&this._layers.length&&1===this._layers.length&&this._readMosaicRule(),this._createRule(),this._createLabels(),this._createSlider(),this._insertPassiveLabels(),this._slider.onChange(this._slider.value))},_createLabels:function(){this.layout===M.LAYOUT_HORIZONTAL?this._createHorizontalLabels():this._createVerticalLabels()},_createRule:function(){this.layout===M.LAYOUT_HORIZONTAL?
this._createHorizontalRule():this._createVerticalRule()},_createVerticalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new c({labels:this._filterLabels(),labelStyle:"font-size: 83%; padding-left: 5px;"},this.labelsNode)},_createVerticalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new a({count:this.dimensionValues.length,
style:"width:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new l({labels:this._filterLabels(),labelStyle:"font-size: 83%"},this.labelsNode)},_createHorizontalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new q({count:this.dimensionValues.length,
style:"height:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalSingleSlider:function(K){K=K?K:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new n({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width: 100%;",increment:g.hitch(this,"increment"),decrement:g.hitch(this,"decrement"),value:K||0,onChange:g.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup()},_createHorizontalRangeSlider:function(K){K=K?K:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new m({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width:100%;",increment:g.hitch(this,"increment"),decrement:g.hitch(this,"decrement"),value:K||[0,1],onChange:g.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup();b(this._slider.incrementButton,"click",this._slider.increment);b(this._slider.decrementButton,"click",this._slider.decrement);this._slider._typematicCallback=function(){}},_createVerticalSingleSlider:function(K){K=B.isDefined(K)?K:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new f({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:g.hitch(this,
"increment"),decrement:g.hitch(this,"decrement"),value:K||0,onChange:g.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);this._slider.startup()},_createVerticalRangeSlider:function(K){K=K?K:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new d({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:g.hitch(this,
"increment"),decrement:g.hitch(this,"decrement"),value:K||[0,1],onChange:g.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);this._slider.startup();this._slider._typematicCallback=function(){}},_onSingleSliderChange:function(K){var R=this.dimensionValues[K];this.setDimensionInfoText(R);r.forEach(this._layers,function(X){this._updateMosaicRule(X,R);this.prefetch&&this.playing&&this._prefetchData(K,X)},this);this._oldValue=K;this.value=R;this.updatePassiveLabels();this.onChange(R)},
_onRangeSliderChange:function(K){if(this._update){this._snap&&(K=this._snapToNearestRange(K));var R=[this.dimensionValues[K[1]],this.dimensionValues[K[0]]];R.sort(this._sortCompareFunction);this.value=R;this.setDimensionInfoText(R);this.updatePassiveLabels();r.forEach(this._layers,function(X){this._updateMosaicRule(X,R);this.prefetch&&this.playing&&this._prefetchData(K,X)},this);this._update=!0;this._oldValue=g.clone(K);this.onChange(R)}},destroy:function(){this.inherited(arguments);this._timer.stop();
this._destroySlider();this._removeHandles()},_destroySlider:function(){if(this._slider)try{this._slider.destroy()}catch(K){this._slider.domNode&&J.destroy(this._slider.domNode)}finally{this._slider=null}},_createSlider:function(){this.mdSliderCell.appendChild(this.sliderNode);if(this.value&&this.value.length&&0<=r.indexOf(this.dimensionValues,this.value[0])&&0<=r.indexOf(this.dimensionValues,this.value[1]))var K=[r.indexOf(this.dimensionValues,this.value[0]),r.indexOf(this.dimensionValues,this.value[1])];
else if(B.isDefined(this.value)){var R=r.indexOf(this.dimensionValues,this.value);0<=R&&(K=R)}B.isDefined(K)||(K=this._getDefaultSliderValue());this.useDefaults&&B.isDefined(K)&&(K===this.dimensionValues.length-1||K.length&&0<=r.indexOf(K,this.dimensionValues.length-1))&&(this.playDirectionAscending=!1);2===this._thumbCount?this.layout===M.LAYOUT_HORIZONTAL?this._createHorizontalRangeSlider(K):this._createVerticalRangeSlider(K):this.layout===M.LAYOUT_HORIZONTAL?this._createHorizontalSingleSlider(K):
this._createVerticalSingleSlider(K)},_getDefaultSliderValue:function(){if(this.dimensionValues&&this.dimensionValues.length){var K=Infinity,R=1,X;if(this.dimension&&"stdz"===this.dimension.toLowerCase())for(X=0;X<this.dimensionValues.length;X++){var Q=this.dimensionValues[X];var W=Math.abs(Q-0);if(W<K){K=W;var I=Q}if(0===W)break}else I=this.dimensionValues[0];I=r.indexOf(this.dimensionValues,I);I=0>I?0:I;2===this._thumbCount&&(I===this.dimensionValues.length-1&&(R=-1),I=[I,I+R]);return I}},_getMultidimensionalInfo:function(K){function R(){K.getMultidimensionalInfo().then(function(Q){K.multidimensionalInfo=
Q;X.resolve(K)},function(Q){X.reject(Q)})}var X=new w;if(K.multidimensionalInfo)X.resolve(K);else if(K.loaded)R();else K.on("load",function(){R()});return X},_getAllLayersMDInfo:function(){var K=[];r.forEach(this._layers,function(R){K.push(this._getMultidimensionalInfo(R))},this);return new u(K)},_getImageLayers:function(){var K=this.map.layerIds.concat(this.map.graphicsLayerIds),R;this._layers=[];r.forEach(K,function(X){R=this.map.getLayer(X);"esri.layers.ArcGISImageServiceLayer"!==R.declaredClass&&
"esri.layers.ArcGISImageServiceVectorLayer"!==R.declaredClass&&"esri.layers.RasterLayer"!==R.declaredClass&&"esri.layers.WCSLayer"!==R.declaredClass||this._layers.push(R)},this);return this._layers},_sortCompareFunction:function(K,R){return B.isDefined(K)&&B.isDefined(R)?K-R:!1},_getDimensionObjects:function(){function K(Q){if(Q&&Q.values&&Q.hasRanges){var W=[];r.forEach(Q.values,function(I){I.length?W=R(W,I):W.push.apply(R(W.sort(this._sortCompareFunction),[I]))},this);W=W.sort(X._sortCompareFunction);
Q.decodedValues=W}return Q}var R=this._merge,X=this;this._allRangeValues=!0;this._thumbCount=1;this._snap=!1;this._dimensionObjects=[];this._layers=this._filterLayers();r.forEach(this._layers,function(Q){Q.multidimensionalInfo&&r.some(Q.multidimensionalInfo.variables,function(W){r.some(W.dimensions,function(I){I.name!==this.dimension||I.hasRanges||(this._allRangeValues=!1)},this)},this)},this);this.useRanges?(this._thumbCount=2,this._snap=!1):this._allRangeValues&&this.useLayersDimSlices?(this._thumbCount=
2,this._snap=!0):this._snap=!1;r.forEach(this._layers,function(Q){Q.multidimensionalInfo&&r.some(Q.multidimensionalInfo.variables,function(W){r.some(W.dimensions,function(I){I.name===this.dimension&&(this._allRangeValues&&I.hasRanges||this.useRanges?this._dimensionObjects.push(K(g.clone(I))):this._dimensionObjects.push(g.clone(I)))},this)},this)},this)},_merge:function(K,R){for(var X=[],Q=0,W=0;Q<K.length&&W<R.length;)K[Q]<R[W]?X.push(K[Q++]):K[Q]>R[W]?X.push(R[W++]):(X.push(R[W++]),Q++);X=X.concat(K.slice(Q)).concat(R.slice(W));
return X=r.filter(X,function(I,T,Y){return Y.indexOf(I)===T})},_mergeRangeArrays:function(K,R){for(var X=[],Q=0,W=0;Q<K.length&&W<R.length;)K[Q][0]<R[W][0]||K[Q][0]===R[W][0]&&K[Q][1]<R[W][1]?X.push(K[Q++]):K[Q][0]>R[W][0]||K[Q][0]===R[W][0]&&K[Q][1]>R[W][1]?X.push(R[W++]):(X.push(R[W++]),Q++);X=X.concat(K.slice(Q)).concat(R.slice(W));return X=r.filter(X,function(I,T,Y){return Y.indexOf(I)===T},this)},_sortDimensionValues:function(){var K=0,R=this._merge,X=this._mergeRangeArrays;this._getDimensionObjects();
1<=this._dimensionObjects.length&&(this._mapSortedDimensionValues=this._dimensionObjects[0].decodedValues||this._dimensionObjects[0].values,this._allRangeValues&&(this._dimensionRangeValues=this._dimensionObjects[0].values));if(1<this._dimensionObjects.length)for(K=1;K<this._dimensionObjects.length;K++)this._mapSortedDimensionValues=R(this._mapSortedDimensionValues,this._dimensionObjects[K].decodedValues||this._dimensionObjects[K].values),this._allRangeValues&&(this._dimensionRangeValues=X(this._dimensionRangeValues,
this._dimensionObjects[K].values))},_createDimensionalDefinition:function(K,R){K=[K];return new y({variableName:R,dimensionName:this.dimension,values:K,isSlice:1===K.length})},_updateMosaicRule:function(K,R){var X=!1,Q=K.mosaicRule||K.defaultMosaicRule||new v({multidimensionalDefinition:[]}),W="esri.layers.WCSLayer"===K.declaredClass,I=(W?K.multidimensionalDefinition:Q.multidimensionalDefinition)||[];R.length&&R.sort(this._sortCompareFunction);r.forEach(I,function(ca){ca.dimensionName===this.dimension&&
(ca.values=[R],ca.isSlice=!this.useRanges,X=!0)},this);if(!X){var T="",Y=r.filter(K.multidimensionalInfo.variables,function(ca){return r.some(I,function(V){return V.variableName&&V.variableName.toLowerCase()===ca.name.toLowerCase()},this)},this);0===Y.length&&(Y=K.multidimensionalInfo.variables);r.some(Y,function(ca){if(r.some(ca.dimensions,function(V){if(V.name===this.dimension)return W&&(T=ca.name),!0},this))return!0},this)&&(I.push(this._createDimensionalDefinition(R,T)),X=!0)}X&&(W?K.setMultidimensionalDefinition(I):
(Q.multidimensionalDefinition=I,K.setMosaicRule(Q)))},_prefetchData:function(K,R){if(R&&(R.mosaicRule||R.multidimensionalDefinition)){var X,Q,W=!1,I,T=this,Y;this.prefetchedValues[R.id]||(this.prefetchedValues[R.id]=[]);this.prefetchImgNodes[R.id]=[];var ca=g.clone(R._params);var V=(Q=g.clone(R.mosaicRule))&&Q.multidimensionalDefinition||g.clone(R.multidimensionalDefinition);for(X=1;X<=this.prefetchFactor;X++)W=!1,r.forEach(V,function(Z){Z.dimensionName===this.dimension&&(this.playDirectionAscending?
K.length?(this.snap?(I=this._getNextRangeIndex(K)||K,Z.values=[this.dimensionValues[I[0]],this.dimensionValues[I[1]]]):Z.values=[this.dimensionValues[(K[0]+X)%this.dimensionValues.length],this.dimensionValues[(K[1]+X)%this.dimensionValues.length]],Z.values.sort(this._sortCompareFunction)):Z.values=[this.dimensionValues[(K+X)%this.dimensionValues.length]]:K.length?(this.snap?(I=this._getNextRangeIndex(K,-1)||K,Z.values=[this.dimensionValues[I[0]],this.dimensionValues[I[1]]]):Z.values=[this.dimensionValues[(this.dimensionValues.length+
K[0]-X)%this.dimensionValues.length],this.dimensionValues[(this.dimensionValues.length+K[1]-X)%this.dimensionValues.length]],Z.values.sort(this._sortCompareFunction)):Z.values=[this.dimensionValues[(this.dimensionValues.length+K-X)%this.dimensionValues.length]],r.some(this.prefetchedValues[R.id],function(ja){if(h.stringify(ja)===h.stringify(Z.values))return!0})||(W=!0,this.prefetchedValues[R.id].push(Z.values)))},this),W&&"esri.layers.WCSLayer"!==R.declaredClass&&(ca.mosaicRule=h.stringify(Q.toJson()),
R.getImageUrl(this.map.extent,this.map.width,this.map.height,function(Z){Y=new Image;T.prefetchImgNodes[R.id].push(Y);Y.src=Z},ca))}},setDimensionInfoText:function(K){if(B.isDefined(K)){var R=this.unitSymbol||this.unit;if("number"!==typeof K){K=g.clone(K.sort(this._sortCompareFunction));if(0!==K[0]%1||0!==K[1]%1)K[0]=parseFloat(K[0].toFixed(2)),K[1]=parseFloat(K[1].toFixed(2));K="["+K[0]+", "+K[1]+"]"}else 0!==K%1&&(K=K.toFixed(2));this.dimensionInfo.innerHTML=this.unitSymbol?"\x3clabel style\x3d'font-weight:700;'\x3e"+
this.dimensionAlias+" ("+R+")\x3c/label\x3e":"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+"\x3c/label\x3e";this.dimensionInfo.innerHTML=this.layout===M.LAYOUT_HORIZONTAL?this.dimensionInfo.innerHTML+(": "+K):this.dimensionInfo.innerHTML+("\x3cbr/\x3e "+K)}},setLabels:function(K){},_filterLabels:function(){if(this.nLabels&&this.dimensionValues&&this.dimensionValues.length){var K=Math.ceil(this.dimensionValues.length/this.nLabels);return r.map(this.dimensionValues,function(R,X){return 0===
X%K||X===this.dimensionValues.length-1?(0!==R%1&&(R=parseFloat(R.toFixed(2))),R):""},this)}},_filterLayers:function(){return r.filter(this._layers,function(K){if(K.multidimensionalInfo&&K.visible&&K.useMapDimensionValue&&r.some(K.multidimensionalInfo.variables,function(R){if(r.some(R.dimensions,function(X){if(X.name===this.dimension)return!0},this))return!0},this))return!0},this)},_updateUI:function(){H.remove(this.playPauseBtn.iconNode,this._iconClass);this._iconClass=this.playing?"mdsButton mdsPauseButton":
"mdsButton mdsPlayButton";H.add(this.playPauseBtn.iconNode,this._iconClass)},_bumpSlider:function(K){var R=this._slider.value;if(0<=K)!this._snap&&(0>R||R>=this.dimensionValues.length-1||R[0]>=this.dimensionValues.length-1||R[1]>=this.dimensionValues.length-1)?this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},this.prefetchImgNodes={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(R)):this._slider.set("value",[0,Math.abs(R[0]-R[1])]):this._slider.set("value",
0),this._timer.start(),this.playing=!0):this.pause()):2===this._thumbCount&&!this._snap&&R[0]<this.dimensionValues.length-1&&R[1]<this.dimensionValues.length-1?this._slider.set("value",[R[0]+1,R[1]+1]):1===this._thumbCount&&R<this.dimensionValues.length-1?this._slider.set("value",R+1):this._snap&&this._slider.set("value",this._getNextRangeIndex(R));else if(0>=R||0>=R[0]||0>=R[1])this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},2===this._thumbCount?this._snap?this._slider.set("value",
this._getNextRangeIndex(R,-1)):this._slider.set("value",[this.dimensionValues.length-1,this.dimensionValues.length-1-Math.abs(R[0]-R[1])]):this._slider.set("value",this.dimensionValues.length-1),this._timer.start(),this.playing=!0):this.pause());else if(0<=R||0<=R[1])2===this._thumbCount&&0<R[1]&&0<R[0]?this._snap?this._slider.set("value",this._getNextRangeIndex(R,-1)):this._slider.set("value",[R[0]-1,R[1]-1]):1===this._thumbCount&&0<R&&this._slider.set("value",R-1)},setThumbMovingRate:function(K){this.thumbMovingRate=
K;this._timer&&this._timer.setInterval(this.thumbMovingRate)},getFullDimensionRange:function(K){K=K||this.dimension;var R,X;r.forEach(this._layers,function(Q){Q.multidimensionalInfo&&Q.multidimensionalInfo.variables&&r.forEach(Q.multidimensionalInfo.variables,function(W){r.forEach(W.dimensions,function(I){if(I.name===K&&I.extent&&I.extent.length&&1<I.extent.length){if(!B.isDefined(R)||I.extent[0]<R)R=I.extent[0];if(!B.isDefined(X)||I.extent[1]>X)X=I.extent[1]}},this)},this)},this);return[R,X]},setThumbCount:function(K){this._thumbCount=
2==K?2:1;this.value=this.dimensionValues[this._slider.value];this._setupSlider()},clearDimensionalDefinition:function(K){var R=[];if(K&&K.mosaicRule&&K.mosaicRule.multidimensionalDefinition){var X=K.mosaicRule;var Q=X.multidimensionalDefinition;r.forEach(Q,function(W){W.dimensionName!==this.dimension&&R.push(W)},this);X.multidimensionalDefinition=R;K.setMosaicRule(X)}},getUnit:function(){var K=null,R=!1;this.unit=null;r.forEach(this._layers,function(X){X.multidimensionalInfo&&r.forEach(X.multidimensionalInfo.variables,
function(Q){r.forEach(Q.dimensions,function(W){W.name===this.dimension&&W.unit&&(null!=K||R?B.isDefined(W.unit)&&W.unit.replace("esri","").toLowerCase()!==K.toLowerCase()&&(K=null,R=!0):K=W.unit.replace("esri",""))},this)},this)},this);K&&(K=K.replace("esri",""));this.unit=K;this.unitSymbol=this.getUnitSymbol();this._hasUnitConflict=R;return K},_getDimensionAlias:function(){this.dimensionAlias=this.dimension;r.some(this._layers,function(K){if(K.fields&&K.fields.length&&r.some(K.fields,function(R){if(R.name&&
R.name===this.dimension&&R.alias)return this.dimensionAlias=R.alias,!0},this))return!0},this)},_readMosaicRule:function(){var K;r.forEach(this._layers,function(R){(R=R.mosaicRule&&R.mosaicRule.multidimensionalDefinition||R.multidimensionalDefinition)&&r.forEach(R,function(X){X&&X.dimensionName===this.dimension&&X.values&&(K=X.values.length&&X.values[0]&&X.values[0].length?X.values[0]:X.values)},this)},this);this.useRanges=B.isDefined(this.useRanges)?this.useRanges:K&&1!==K.length?!0:!1;K&&(this.useRanges?
(this._thumbCount=2,this.value=1===K.length?[K[0],this.dimensionValues[this.dimensionValues.length-1]]:K):1<K.length&&this._snap?(this._thumbCount=2,this.value=K):(this._thumbCount=1,this.useRanges=!1,this.value=K[0]))},hasUnitConflict:function(){this.getUnit();return this._hasUnitConflict},resizeSlider:function(K,R){N.set(this.domNode,{height:K+"px",width:R+"px"});N.set(this.mdSliderTable,{height:K+"px",width:R+"px"});this.computeSliderStyle()},computeSliderStyle:function(){var K=O.getContentBox(this.domNode).h-
O.getContentBox(this.dimensionInfo).h-(O.getContentBox(this.playPauseBtnRow).h+20);10>=p("ie")&&(K-=53);var R="height: "+K+"px;";this._slider&&this._slider.domNode&&N.set(this._slider.domNode,"height",K+"px");return R},getUnitSymbol:function(){if(!B.isDefined(this.unit))return null;var K=this.unit.toLowerCase();if("meters"===K||"meter"===K)return this.unitSymbols.meter;if("pascal"===K||"pascals"===K)return this.unitSymbols.pascal},_snapToNearestRange:function(K){if(K&&K.length&&this._snap){var R,
X,Q,W=this;var I=[this.dimensionValues[K[1]],this.dimensionValues[K[0]]];I.sort(this._sortCompareFunction);if(r.some(this._dimensionObjects,function(Z){if(r.some(Z.values,function(ja){if(ja&&ja.length&&ja[0]===I[0]&&ja[1]===I[1])return!0}))return!0},this))return K;if(r.some(this._dimensionObjects,function(Z){if(r.some(Z.values,function(ja){if(ja&&ja.length&&ja[0]===I[0])return R=g.clone(ja.sort(this._sortCompareFunction)),!0},this))return!0},this)){r.some(this.dimensionValues,function(Z,ja){Z===R[0]&&
(X=ja);Z===R[1]&&(Q=ja)});var T=Math.abs(K[0]-X);var Y=[X,Q]}if(r.some(this._dimensionObjects,function(Z){if(r.some(Z.values,function(ja){if(ja&&ja.length&&ja[1]===I[1])return R=g.clone(ja.sort(this._sortCompareFunction)),!0},this))return!0},this)){r.some(this.dimensionValues,function(Z,ja){Z===R[1]&&(Q=ja);Z===R[0]&&(X=ja)});var ca=Math.abs(K[1]-Q);var V=[X,Q]}K=T&&ca?this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,Y)?V:this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,
V)?Y:T<=ca?Y:V:Y||V||K;this._update=!1;setTimeout(function(){W._slider.set("value",K)},100);return K}},_arraysEqual:function(K,R){var X;if(!B.isDefined(K)||!B.isDefined(R))return!1;if(K===R)return!0;if(K.length!==R.length)return!1;K.sort(this._sortCompareFunction);R.sort(this._sortCompareFunction);for(X=0;X<K.length;++X)if(K[X]!==R[X])return!1;return!0},_getNextRangeIndex:function(K,R){if(!this._dimensionRangeValues||!this._dimensionRangeValues.length)return null;var X,Q,W;R=B.isDefined(R)?R:1;r.some(this._dimensionRangeValues,
function(T,Y){if(this._arraysEqual(T,[this.dimensionValues[K[0]],this.dimensionValues[K[1]]]))return X=Y,!0},this);var I=this._dimensionRangeValues[0<R?(X+1)%this._dimensionRangeValues.length:(this._dimensionRangeValues.length+X-1)%this._dimensionRangeValues.length];r.some(this.dimensionValues,function(T,Y){T===I[0]&&(Q=Y);T===I[1]&&(W=Y);if(Q&&W)return!0},this);return[Q,W]}});g.mixin(e,M);g.setObject("dijit.MultidimensionalSlider",e,z);return e})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ../layers/RasterFunction ../layers/RasterXLayer ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da,J,M,K,R,X){g=g([R,t,x],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:X,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(Q,W){Q=Q||{};this.map=Q.map;this._hasUI=W?!0:!1;this.bingMapsKey=Q.bingMapsKey&&
0<Q.bingMapsKey.length?Q.bingMapsKey:null;this.showArcGISBasemaps=!1!==Q.showArcGISBasemaps;this.basemaps=Q.basemaps||[];this.basemapIds=Q.basemapIds;this.referenceIds=Q.referenceIds;this.basemapsGroup=Q.basemapsGroup;this.arcgisUrl=r.dijit._arcgisUrl;Q.portalUrl&&(this.arcgisUrl=Q.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=u.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));
this.init()},init:function(){this.inherited(arguments);this._checkVTLSupport().then(h.hitch(this,function(Q){this._supportsVTL=Q}));p.forEach(this.basemaps,function(Q){Q.id&&0!==Q.id.length||(Q.id=this._getUniqueId());p.forEach(Q.layers,function(W){W.opacity=0<=W.opacity?W.opacity:1;W.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&p.forEach(this.basemapIds,function(Q){this.map.getLayer(Q)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&
p.forEach(this.referenceIds,function(Q){Q=this.map.getLayer(Q);Q._basemapGalleryLayerType="reference";Q.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(h.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(h.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():b.connect(this,"onLoad",
h.hitch(this,function(){this._refreshUI()}))},select:function(Q){this._select(Q)},getSelected:function(){return this._selectedBasemap},get:function(Q){var W;for(W=0;W<this.basemaps.length;W++)if(this.basemaps[W].id===Q)return this.basemaps[W];return null},add:function(Q){return Q&&!Q.id?(Q.id=this._getUniqueId(),this.basemaps.push(Q),this._refreshUI(),this.onAdd(Q),!0):Q&&this._isUniqueId(Q.id)?(this.basemaps.push(Q),this._refreshUI(),this.onAdd(Q),!0):!1},remove:function(Q){var W;for(W=0;W<this.basemaps.length;W++){var I=
this.basemaps[W];if(I.id===Q)return this._selectedBasemap&&this._selectedBasemap.id===I.id&&(this._selectedBasemap=null),this.basemaps.splice(W,1),this._refreshUI(),this.onRemove(I),I}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(Q){},onRemove:function(Q){},onError:function(Q){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&
0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(Q){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,Q):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(Q))},_findArcGISBasemapsGroup:function(Q){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(Q);else{var W=this.arcgisUrl+"/portals/self",
I={f:"json"};I.culture=f.locale;v({url:W,content:I,callbackParamName:"callback",load:h.hitch(this,function(T,Y){T&&T.useVectorBasemaps&&T.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(h.hitch(this,function(ca){this._basemapGalleryGroupQuery=ca?T.vectorBasemapGalleryGroupQuery:T&&T.basemapGalleryGroupQuery?T.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(Q)})):(this._basemapGalleryGroupQuery=T&&T.basemapGalleryGroupQuery?T.basemapGalleryGroupQuery:
this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(Q))}),error:h.hitch(this,function(T,Y){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(Q){var W=h.hitch(this,"_findArcGISBasemaps"),I=this.arcgisUrl+"/community/groups",T={};T.q=this._basemapGalleryGroupQuery;T.f="json";v({url:I,content:T,callbackParamName:"callback",load:h.hitch(this,function(Y,ca){if(0<Y.results.length)W(Y.results[0].id,Q,Y.results[0].sortField,
Y.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:h.hitch(this,function(Y){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(Q,W,I,T){var Y=h.hitch(this,function(ca,V,Z,ja){var la=this.arcgisUrl+"/search",ba={};ba.q="group:"+ca+' AND type:"web map" NOT type:"web mapping application"';ba.sortField=Z;ba.sortOrder="asc"===ja?"desc":"asc";ba.num=100;ba.f="json";v({url:la,content:ba,
callbackParamName:"callback",load:h.hitch(this,function(ka,qa){if(0<ka.results.length)V(ka.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:h.hitch(this,function(ka,qa){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});I&&T?Y(Q,W,I,T):v({url:this.arcgisUrl+"/community/groups/"+Q,content:{f:"json"},callbackParamName:"callback",load:h.hitch(this,function(ca,V){ca.sortField?Y(Q,W,ca.sortField,ca.sortOrder):Y(Q,W,"name",
"desc")}),error:h.hitch(this,function(ca,V){Y(Q,W,"name","desc")})})},_handleArcGISBasemapsResponse:function(Q){0<Q.length&&(p.forEach(Q,function(W,I){if(this.bingMapsKey||!this.bingMapsKey&&W.title&&-1===W.title.indexOf("Bing Maps")){I={};I.id=this._getUniqueId();I.title=W.title;I.thumbnailUrl="";if(W.thumbnail&&W.thumbnail.length&&(I.thumbnailUrl=this.arcgisUrl+"/content/items/"+W.id+"/info/"+W.thumbnail,r.id)){var T=r.id.findCredential(u.urlToObject(this.arcgisUrl).path);T&&(I.thumbnailUrl+="?token\x3d"+
T.token)}I.itemId=W.id;W=new K(I,this);this.basemaps.splice(0,0,W)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(l.empty(this.flowContainer),p.forEach(this.basemaps,function(Q,W){Q.id||(Q.id="basemap_"+W);this.flowContainer.appendChild(this._buildNodeLayout(Q))},this),l.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(Q){var W=l.create("div",{id:"galleryNode_"+Q.id,"class":"esriBasemapGalleryNode"}),
I=l.create("a",{href:"javascript:void(0);"},W);b.connect(I,"onclick",h.hitch(this,"_onNodeClick",Q));var T=Q.title||"";Q.thumbnailUrl?l.create("img",{"class":"esriBasemapGalleryThumbnail",src:Q.thumbnailUrl,title:T,alt:T},I):l.create("img",{"class":"esriBasemapGalleryThumbnail",src:k.toUrl("./images/transparent.gif"),title:T,alt:T},I);Q=l.create("div",{"class":"esriBasemapGalleryLabelContainer"},W);l.create("span",{innerHTML:T,alt:T,title:T},Q);return W},_onNodeClick:function(Q,W){W.preventDefault();
this._markSelected(Q);this.select(Q.id)},_markSelected:function(Q){Q&&(p.forEach(f.query(".esriBasemapGallerySelectedNode",this.domNode),function(W){e.remove(W,"esriBasemapGallerySelectedNode")}),(Q=q.byId("galleryNode_"+Q.id))&&e.add(Q,"esriBasemapGallerySelectedNode"))},_select:function(Q){this._selectBasemapInProgress=!0;var W=this.get(Q);W?(W.layers?this._getServiceInfos(W):(Q=W.getLayers(this.arcgisUrl),h.isArray(Q)?this._getServiceInfos(W):Q.addCallback(h.hitch(this,function(I){this._getServiceInfos(W)}))),
this._markSelected(W)):this._selectBasemapInProgress=!1},_getServiceInfos:function(Q){"https:"===location.protocol&&p.forEach(Q.layers,function(I){if(this._isAgolService(I.url)||this._isHostedService(I.url))I.url=I.url.replace("http:","https:")},this);this._selectedBasemap=Q;var W=[];p.forEach(Q.layers,function(I){I.url&&0<I.url.length&&!I.isReference&&!I.type&&(I.deferredsPos=W.length,W.push(this._getServiceInfo(I.url)))},this);0<W.length?(new m(W)).addCallback(h.hitch(this,function(I){var T=null;
p.forEach(Q.layers,function(Y){if(0===Y.deferredsPos||Y.deferredsPos){Y.serviceInfoResponse=I[Y.deferredsPos][1];var ca=Y.serviceInfoResponse.fullExtent;ca||(ca=Y.serviceInfoResponse.extent);T=T?T.union(new y(ca)):new y(ca)}},this);this.map.extent&&5>this._getIntersectionPercent(T,this.map.extent)&&this.map.setExtent(T,!0);this._switchBasemapLayers(Q);this._updateReferenceLayer(Q)})):(this._switchBasemapLayers(Q),this._updateReferenceLayer(Q))},_checkVTLSupport:function(){var Q=new n;d("ie")?Q.resolve(!1):
Q.resolve(H.supported());return Q},_switchBasemapLayers:function(Q){var W=Q.layers,I=!1,T,Y,ca;p.forEach(W,function(Z){"VectorTileLayer"===Z.type&&(I=!0)});if(I&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===W[0].type||W[0].type&&-1<W[0].type.indexOf("BingMaps")||"WebTiledLayer"===W[0].type||"VectorTileLayer"===
W[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{p.forEach(W,function(Z){if(!Z.isReference&&Z.type&&-1<Z.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var V=0;p.forEach(W,function(Z,ja){if(!Z.isReference){if("OpenStreetMap"===Z.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}var la=new C({id:"layer_osm",opacity:Z.opacity})}else if(Z.type&&-1<Z.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}la=B.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===Z.type?la=B.MAP_STYLE_AERIAL:"BingMapsRoad"===Z.type&&(la=B.MAP_STYLE_ROAD);la=new B({id:"layer_bing",bingMapsKey:this.bingMapsKey,
mapStyle:la,opacity:Z.opacity})}else if("WebTiledLayer"===Z.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}la=Z.initialExtent||Z.fullExtent;la=new G(Z.templateUrl||Z.url,{visible:Z.visibility,opacity:Z.opacity,copyright:Z.copyright,fullExtent:Z.fullExtent&&new y(Z.fullExtent),initialExtent:la&&new y(la),subDomains:Z.subDomains,
tileInfo:Z.tileInfo?new N(Z.tileInfo):null,tileServers:Z.tileServers})}else if("VectorTileLayer"===Z.type){la=new H(Z.styleUrl,{visible:Z.visibility,opacity:Z.opacity});0===ja&&1<W.length&&this._removeBasemapLayers();var ba=this;b.connect(la,"onLoad",h.hitch(this,function(ka,qa,wa){var za=ba._sameSpatialReference(wa.spatialReference,ba.map.spatialReference);if(ba.map.spatialReference&&!za)ba.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");
else{if(0<ba.map.getNumLevels()){if(za=ba._sameTilingScheme(wa.tileInfo,ba.map.__tileInfo),!za){ba.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(ba.map.loaded){ba.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a vector tile layer and cannot be loaded as a dynamic layer.");return}0===qa&&1===W.length&&ba._removeBasemapLayers();wa._basemapGalleryLayerType="basemap";ba.map.addLayer(wa,
ka)}},V,ja))}else if(Z.serviceInfoResponse&&Z.serviceInfoResponse.mapName){T=new z(Z.serviceInfoResponse.spatialReference);Y=this._sameSpatialReference(T,this.map.spatialReference);if(this.map.spatialReference&&!Y){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===Z.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(ca=this._sameTilingScheme(Z.serviceInfoResponse.tileInfo,this.map.__tileInfo),
!ca){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(!0===Z.serviceInfoResponse.singleFusedMapCache&&-1<Z.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&this.map.loaded&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}la=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&
!0===Z.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(Z):this._loadAsDynamic(Z)}else if(Z.serviceInfoResponse&&Z.serviceInfoResponse.pixelSizeX){T=new z(Z.serviceInfoResponse.spatialReference);Y=this._sameSpatialReference(T,this.map.spatialReference);if(this.map.spatialReference&&!Y){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===Z.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&
(ca=this._sameTilingScheme(Z.serviceInfoResponse.tileInfo,this.map.__tileInfo),!ca)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}Z.serviceInfoResponse.singleFusedMapCache&&"ArcGISImageServiceLayer"!==Z.type?la="Raster"===Z.serviceInfoResponse.cacheType?new M(Z.url,{serviceInfo:Z.serviceInfoResponse,opacity:Z.opacity,visible:Z.visibility,bandIds:Z.bandIds&&0<Z.bandIds.length?Z.bandIds:null}):new E(Z.url,{resourceInfo:Z.serviceInfoResponse,
opacity:Z.opacity,visible:Z.visibility}):Z.serviceInfoResponse.pixelSizeX?(la=new S,la.bandIds=Z.bandIds,Z.renderingRule?la.renderingRule=new J(Z.renderingRule):!Z.bandIds&&Z.serviceInfoResponse.bandCount&&3<parseInt(Z.serviceInfoResponse.bandCount,10)&&(la.bandIds=[0,1,2]),la=new O(Z.url,{resourceInfo:Z.serviceInfoResponse,opacity:Z.opacity,visible:Z.visibility,imageServiceParameters:la})):(la=new da,la.format="png24",Z.serviceInfoResponse.supportedImageFormatTypes&&-1<Z.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&
(la.format="png32"),la=new D(Z.url,{resourceInfo:Z.serviceInfoResponse,opacity:Z.opacity,visible:Z.visibility,imageParameters:la}))}"VectorTileLayer"===Z.type?V++:la&&(0===ja&&this._removeBasemapLayers(),la._basemapGalleryLayerType="basemap",this.map.addLayer(la,V),V++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var Q=this.map.layerIds,W=[];p.forEach(Q,function(I){I=this.map.getLayer(I);"basemap"===I._basemapGalleryLayerType&&W.push(I)},this);
0===W.length&&0<Q.length&&W.push(this.map.getLayer(Q[0]));0<W.length&&p.forEach(W,function(I){this.map.removeLayer(I)},this)},_updateReferenceLayer:function(Q){var W;this._removeReferenceLayer();for(W=0;W<Q.layers.length;W++)!0===Q.layers[W].isReference&&this._addReferenceLayer(Q.layers[W])},_removeReferenceLayer:function(){var Q;for(Q=this.map.layerIds.length-1;0<=Q;Q--){var W=this.map.getLayer(this.map.layerIds[Q]);"reference"===W._basemapGalleryLayerType&&this.map.removeLayer(W)}},_addReferenceLayer:function(Q){"VectorTileLayer"===
Q.type?this._handleReferenceServiceInfoResponse(Q):this._getServiceInfo(Q.url,h.hitch(this,"_handleReferenceServiceInfoResponse",Q))},_handleReferenceServiceInfoResponse:function(Q,W,I){Q.serviceInfoResponse=W;if("VectorTileLayer"===Q.type)var T=new H(Q.styleUrl,{visible:Q.visibility,opacity:Q.opacity});else W&&W.mapName?T=!0===W.singleFusedMapCache?this._loadAsCached(Q):this._loadAsDynamic(Q):W&&W.pixelSizeX&&(Q.serviceInfoResponse.singleFusedMapCache?T=new E(Q.url,{resourceInfo:Q.serviceInfoResponse,
opacity:Q.opacity,visible:Q.visibility}):Q.serviceInfoResponse.pixelSizeX?(I=new S,I.bandIds=Q.bandIds,Q.renderingRule?I.renderingRule=new J(Q.renderingRule):!Q.bandIds&&W.bandCount&&3<parseInt(W.bandCount,10)&&(I.bandIds=[0,1,2]),T=new O(Q.url,{resourceInfo:W,opacity:Q.opacity,visible:Q.visibility,imageServiceParameters:I})):(W=new da,W.format="png24",Q.serviceInfoResponse.supportedImageFormatTypes&&-1<Q.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(W.format="png32"),W.transparent=
!0,T=new D(Q.url,{resourceInfo:Q.serviceInfoResponse,opacity:Q.opacity,visible:Q.visibility,imageParameters:W})));T&&(T._basemapGalleryLayerType="reference",T.attr("data-reference",!0),this.map.addLayer(T))},_getServiceInfo:function(Q,W){return v({url:Q,content:{f:"json"},callbackParamName:"callback",load:function(I,T){W&&W(I,T)},error:h.hitch(this,function(I,T){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(Q){var W=[];Q.displayLevels||(W=p.map(Q.serviceInfoResponse.tileInfo.lods,
function(T){return T.level}));var I=null;Q.exclusionAreas&&Q.exclusionAreas.length&&(I=[],p.forEach(Q.exclusionAreas,function(T){I.push({minZoom:T.minZoom,maxZoom:T.maxZoom,minScale:T.minScale,maxScale:T.maxScale,geometry:new y(T.geometry)})}));return new E(Q.url,{resourceInfo:Q.serviceInfoResponse,opacity:Q.opacity,visible:Q.visibility,exclusionAreas:I,displayLevels:Q.displayLevels||W})},_loadAsDynamic:function(Q){var W=new D(Q.url,{resourceInfo:Q.serviceInfoResponse,opacity:Q.opacity,visible:Q.visibility});
Q.visibleLayers&&W.setVisibleLayers(Q.visibleLayers);return W},_getIntersectionPercent:function(Q,W){return(Q=W.intersects(Q))?(Q=Q.getWidth()*Q.getHeight(),W=W.getWidth()*W.getHeight(),Q/W*100):0},_getIds:function(){var Q=[];p.forEach(this.basemaps,function(W){Q.push(W.id)},this);return Q},_getUniqueId:function(){for(var Q=","+this._getIds().toString()+",",W=0;;)if(-1<Q.indexOf(",basemap_"+W+","))W++;else return"basemap_"+W},_isUniqueId:function(Q){return-1===(","+this._getIds().toString()+",").indexOf(","+
Q+",")?!0:!1},_isAgolService:function(Q){return Q?-1!==Q.indexOf("/services.arcgisonline.com/")||-1!==Q.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(Q){return Q?-1!==Q.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(Q,W){return Q&&W&&Q.wkt==W.wkt&&(Q.wkid===W.wkid||w.isDefined(Q.latestWkid)&&Q.latestWkid===W.wkid||w.isDefined(W.latestWkid)&&Q.wkid===W.latestWkid||w.isDefined(Q.latestWkid)&&Q.latestWkid===W.latestWkid)||Q&&W&&Q.isWebMercator()&&W.isWebMercator()?!0:
!1},_sameTilingScheme:function(Q,W){var I=this.map;I=I.width>I.height?I.width:I.height;var T=!1,Y=!1,ca,V;for(ca=0;ca<Q.lods.length;ca++){var Z=Q.lods[ca].scale;Q.dpi!==W.dpi&&(Z=Q.lods[ca].scale/Q.dpi);for(V=0;V<W.lods.length;V++){var ja=W.lods[V].scale;Q.dpi!==W.dpi&&(ja=W.lods[V].scale/W.dpi);if(Math.abs(ja-Z)/ja<1/I)if(T){Y=!0;break}else T=!0;if(ja<Z)break}if(Y)break}return Y||T&&(1===Q.lods.length||1===W.lods.length)?!0:!1}});h.setObject("dijit.BasemapGallery",g,r);return g})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e){function t(x,r){var w=[];if(x&&r&&(r.customLayerParameters||r.customParameters)){var u=g.clone(r.customParameters||{});g.mixin(u,r.customLayerParameters||{});x=n.urlToObject(x);for(var v in x.query)u.hasOwnProperty(v)||w.push(v+"\x3d"+x.query[v]);x=x.path+(w.length?"?"+w.join("\x26"):"")}return x}k=k(l,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(x,r){r||(r={});this.urlTemplate=x=t(x,r.wmtsInfo);var w=new q(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new m({wkid:102100})),u=new q(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new m({wkid:102100}));this.initialExtent=r.initialExtent||w;this.fullExtent=r.fullExtent||u;this.tileInfo=r.tileInfo?r.tileInfo:new e({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new m(this.tileInfo.spatialReference.toJson());this.copyright=r.copyright||"";var v=new b(x);w=v.scheme+"://"+v.authority+"/";this.urlPath=x.substring(w.length);this.tileServers=r.tileServers||[];-1===v.authority.indexOf("{subDomain}")&&
this.tileServers.push(w);if(r.subDomains&&0<r.subDomains.length&&1<v.authority.split(".").length){this.subDomains=r.subDomains;var y;p.forEach(r.subDomains,function(C){-1<v.authority.indexOf("${subDomain}")?y=v.scheme+"://"+f.substitute(v.authority,{subDomain:C})+"/":-1<v.authority.indexOf("{subDomain}")&&(y=v.scheme+"://"+v.authority.replace(/\{subDomain\}/gi,C)+"/");this.tileServers.push(y)},this)}this.tileServers=p.map(this.tileServers,function(C){"/"!==C.charAt(C.length-1)&&(C+="/");return C});
this._levelToLevelValue=[];var z=0;p.forEach(this.tileInfo.lods,function(C,E){this._levelToLevelValue[C.level]=C.levelValue||C.level;0===E&&(z=this._levelToLevelValue[C.level])},this);this._wmtsInfo=r.wmtsInfo;var B=g.hitch(this,function(){this.loaded=!0;this.onLoad(this)});h("chrome")?(x=this.getTileUrl(z,0,0),r=d.defaults.io,w="with-credentials"===r.useCors?n.canUseXhr(x,!0):-1,(r=-1<w?r.corsEnabledServers[w]:null)&&r.withCredentials?c({url:x,handleAs:"arraybuffer"}).addBoth(function(){B()}):B()):
B()},getTileUrl:function(x,r,w){x=this._levelToLevelValue[x];var u=this.tileServers[r%this.tileServers.length]+f.substitute(this.urlPath,{level:x,z:x,col:w,x:w,row:r,y:r});u=u.replace(/\{level\}/gi,x).replace(/\{row\}/gi,r).replace(/\{col\}/gi,w).replace(/\{z\}/gi,x).replace(/\{x\}/gi,w).replace(/\{y\}/gi,r);u=this._appendCustomLayerParameters(u);u=this.addTimestampToURL(u);return n.addProxy(u)},_appendCustomLayerParameters:function(x){var r;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||
this._wmtsInfo.customParameters)){var w=g.clone(this._wmtsInfo.customParameters||{});g.mixin(w,this._wmtsInfo.customLayerParameters||{});for(r in w)x+=(-1===x.indexOf("?")?"?":"\x26")+r+"\x3d"+encodeURIComponent(w[r])}return x}});g.setObject("layers.WebTiledLayer",k,a);return k})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(k,g,p,b,h,f,d){k=k(null,{declaredClass:"esri.dijit.Basemap",id:null,
title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,c){a=a||{};this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=c},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=f({url:(a||h.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:p.hitch(this,function(c,n){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.")})}),
a.addCallback(p.hitch(this,function(c,n){if(c.baseMap)return this.layers=[],g.forEach(c.baseMap.baseMapLayers,function(m){this.layers.push(new d(m))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");return[]})),a}});p.setObject("dijit.Basemap",k,h);return k})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,g,p,b){k=k(null,{declaredClass:"esri.dijit.BasemapLayer",
constructor:function(h){h=h||{};this.url=h.url;this.type=h.type;this.isReference=!0===h.isReference?!0:!1;this.opacity=h.opacity;this.visibleLayers=h.visibleLayers;this.displayLevels=h.displayLevels;this.exclusionAreas=h.exclusionAreas;this.bandIds=h.bandIds;this.renderingRule=h.renderingRule;this.templateUrl=h.templateUrl;this.copyright=h.copyright;this.subDomains=h.subDomains;this.fullExtent=h.fullExtent;this.initialExtent=h.initialExtent;this.tileInfo=h.tileInfo;this.tileServers=h.tileServers;
this.styleUrl=h.styleUrl}});g.setObject("dijit.BasemapLayer",k,b);return k})},"esri/dijit/HomeButton":function(){define("dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/HomeButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l,e){k=g("esri.dijit.HomeButton",[f,a,k],{templateString:m,options:{theme:"HomeButton",map:null,extent:null,
fit:!1,visible:!0},constructor:function(t,x){t=p.mixin({},this.options,t);this.domNode=x;this._i18n=q;this.set("map",t.map);this.set("theme",t.theme);this.set("visible",t.visible);this.set("extent",t.extent);this.set("fit",t.fit);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this._css={container:"homeContainer",home:"home",loading:"loading"}},postCreate:function(){this.inherited(arguments);this.own(c(this._homeNode,d,p.hitch(this,this.home)))},startup:function(){this.inherited(arguments);
this.map||this.destroy();if(this.map.loaded)this._init();else c.once(this.map,"load",p.hitch(this,function(){this._init()}))},destroy:function(){this.inherited(arguments)},home:function(){var t=new n,x=this.get("extent");this._showLoading();var r={extent:x};x?this.map.extent!==x?this.map.setExtent(x,this.get("fit")).then(p.hitch(this,function(){this._hideLoading();this.emit("home",r);t.resolve(r)}),p.hitch(this,function(w){w||(w=Error("HomeButton::Error setting map extent"));r.error=w;this.emit("home",
r);t.reject(w)})):(this._hideLoading(),this.emit("home",r),t.resolve(r)):(this._hideLoading(),x=Error("HomeButton::home extent is undefined"),r.error=x,this.emit("home",r),t.reject(x));return t.promise},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_init:function(){this._visible();this.get("extent")||this.set("extent",this.map.extent);this.set("loaded",!0);this.emit("load",{})},_showLoading:function(){l.add(this._homeNode,this._css.loading)},_hideLoading:function(){l.remove(this._homeNode,
this._css.loading)},_updateThemeWatch:function(t,x,r){l.remove(this.domNode,x);l.add(this.domNode,r)},_visible:function(){this.get("visible")?e.set(this.domNode,"display","block"):e.set(this.domNode,"display","none")}});p.setObject("dijit.HomeButton",k,h);return k})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B){k=p("esri.dijit.LocateButton",[a,n,g],{templateString:l,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new z(k.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(C,E){C=b.mixin({},this.options,C);this.domNode=
E;this._i18n=e;E=navigator.geolocation;var D=window.hasOwnProperty("isSecureContext");(D&&window.isSecureContext||!D&&"https:"===window.location.protocol)&&E||(C.visible=!1);this.set("map",C.map);this.set("theme",C.theme);this.set("visible",C.visible);this.set("scale",C.scale);this.set("highlightLocation",C.highlightLocation);this.set("symbol",C.symbol);this.set("infoTemplate",C.infoTemplate);this.set("geolocationOptions",C.geolocationOptions);this.set("useTracking",C.useTracking);this.set("setScale",
C.setScale);this.set("centerAt",C.centerAt);this.set("timeout",C.timeout);this.set("graphicsLayer",C.graphicsLayer);this.set("clearOnTrackingStop",C.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",b.hitch(this,function(){this.get("tracking")&&!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",
tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(m(this._locateNode,c,b.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||this.set("visible",!1);if(this.get("map").loaded)this._init();else m.once(this.get("map"),"load",b.hitch(this,function(){this._init()}))},destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var C=this.get("highlightGraphic"),
E=this.get("graphicsLayer");C&&(E?E.remove(C):this.get("map").graphics.remove(C),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?this.get("tracking")?r.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):r.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):
r.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){t.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(C){return C?{coords:b.mixin({},C.coords),timestamp:C.timestamp}:{}},_startTracking:function(){t.add(this._locateNode,
this._css.tracking);this._removeWatchPosition();var C=navigator.geolocation.watchPosition(b.hitch(this,function(E){E=this._positionToObject(E);this._setPosition(E).then(b.hitch(this,function(D){this._locateEvent(D)}),b.hitch(this,function(D){D||(D=Error("LocateButton::Error setting the position."));this._locateError(D)}))}),b.hitch(this,function(E){this.set("tracking",!1);E||(E=Error("LocateButton::Could not get tracking position."));this._locateError(E)}),this.get("geolocationOptions"));this.set("watchId",
C)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var C=new q;this._removePrivateVars();var E=setTimeout(b.hitch(this,function(){clearTimeout(E);C.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));navigator.geolocation.getCurrentPosition(b.hitch(this,function(D){D=this._positionToObject(D);clearTimeout(E);this._setPosition(D).then(b.hitch(this,function(G){C.resolve(G)}),b.hitch(this,function(G){G||
(G=Error("LocateButton::Error setting map position."));C.reject(G)}))}),b.hitch(this,function(D){D||(D=Error("LocateButton::Could not get current position."));C.reject(D)}),this.get("geolocationOptions"));return C.promise},_locate:function(){var C=new q;this._showLoading();if(navigator.geolocation)this.get("useTracking")?this.get("tracking")?(this._startTracking(),C.resolve({tracking:!0})):(this._stopTracking(),C.resolve({tracking:!1})):this._getCurrentPosition().then(b.hitch(this,function(D){this._locateEvent(D);
C.resolve(D)}),b.hitch(this,function(D){D||(D=Error("LocateButton::Could not get current position."));this._locateError(D);C.reject(D)}));else{var E=Error("LocateButton::geolocation unsupported");this._locateError(E);C.reject(E)}this._setTitle();return C.promise},_projectPoint:function(C){var E=new q,D=this.get("map").spatialReference,G=D.wkid;D.isWebMercator()?(C=w.geographicToWebMercator(C),E.resolve(C)):d.defaults.geometryService&&4326!==G?(G=new B,G.geometries=[C],G.outSR=D,d.defaults.geometryService.project(G).then(b.hitch(this,
function(H){H&&H.length?E.resolve(H[0]):E.reject(Error("LocateButton::Point was not projected."))}),function(H){H||(H=Error("LocateButton::please specify a geometry service on esri/config to project."));E.reject(H)})):E.resolve(C);return E.promise},_getScale:function(C){var E=this.get("scale");return C&&C.coords?E||C.coords.accuracy||5E4:E||5E4},_createPoint:function(C){var E;C&&C.coords&&(E=new u([C.coords.longitude,C.coords.latitude],new v({wkid:4326})));return E},_setPosition:function(C){var E=
new q,D,G;this._removePrivateVars();if((this._position=C)&&C.coords){if(D=this._createPoint(C))this._graphic=G=this._createGraphic(D,C);var H=this._getScale(C);this._scale=H;D?this._projectPoint(D).then(b.hitch(this,function(N){this._graphic=G=this._createGraphic(N,C);var O={graphic:G,scale:H,position:C};this.get("setScale")&&this.get("map").setScale(H);this.get("centerAt")?this.get("map").centerAt(N).then(b.hitch(this,function(){E.resolve(O)}),b.hitch(this,function(S){S||(S=Error("LocateButton::Could not center map."));
E.reject(S)})):E.resolve(O)}),b.hitch(this,function(N){N||(N=Error("LocateButton::Error projecting point."));E.reject(N)})):(D=Error("LocateButton::Invalid point"),E.reject(D))}else D=Error("LocateButton::Invalid position"),E.reject(D);return E.promise},_createGraphic:function(C,E){if(C){E={position:E};var D=new y(C,this.get("symbol"),E,this.get("infoTemplate"))}return D},_locateEvent:function(C){if(C.graphic){var E=this.get("highlightGraphic"),D=this.get("graphicsLayer");E?(E.setGeometry(C.graphic.geometry),
E.setAttributes(C.graphic.attributes),E.setInfoTemplate(C.graphic.infoTemplate),E.setSymbol(C.graphic.symbol)):(E=C.graphic,this.get("highlightLocation")&&(D?D.add(E):this.get("map").graphics.add(E)));this.set("highlightGraphic",E)}this._hideLoading();this.emit("locate",C)},_locateError:function(C){C={graphic:this._graphic,scale:this._scale,position:this._position,error:C};this._hideLoading();this.emit("locate",C)},_showLoading:function(){this.get("useTracking")||t.add(this._locateNode,this._css.loading)},
_hideLoading:function(){this.get("useTracking")||t.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",{})},_updateThemeWatch:function(C,E,D){t.remove(this.domNode,E);t.add(this.domNode,D)},_visible:function(){this.get("visible")?x.set(this.domNode,"display","block"):x.set(this.domNode,"display","none")}});b.setObject("dijit.LocateButton",k,f);return k})},
"esri/layers/graphics":function(){define(["./GraphicsLayer","../graphic","../renderer"],function(){return{}})},"esri/renderer":function(){define("./renderers/Renderer ./renderers/SimpleRenderer ./renderers/UniqueValueRenderer ./renderers/ClassBreaksRenderer ./renderers/TemporalRenderer ./renderers/SymbolAger ./renderers/TimeClassBreaksAger ./renderers/TimeRampAger ./renderers/StretchRenderer ./renderers/jsonUtils".split(" "),function(k,g,p,b,h,f,d,a,c,n){return{Renderer:k,SimpleRenderer:g,UniqueValueRenderer:p,
ClassBreaksRenderer:b,TemporalRenderer:h,SymbolAger:f,TimeClassBreaksAger:d,TimeRampAger:a,StretchRenderer:c,jsonUtils:n}})},"esri/layers/agstiled":function(){define(["./agscommon","./ArcGISTiledMapServiceLayer"],function(){return{}})},"esri/layers/agsdynamic":function(){define(["./agscommon","./ArcGISDynamicMapServiceLayer","../_time"],function(){return{}})},"esri/_time":function(){define(["./TimeExtent"],function(){return{}})},"esri/layers/agsimageservice":function(){define("./agscommon ./ArcGISImageServiceLayer ./ImageServiceParameters ./MosaicRule ./RasterFunction ../utils".split(" "),
function(){return{}})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B){var C=
g([u],{declaredClass:"esri.layers.KMLLayer",serviceUrl:t.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(E,D){this._url=t.urlToObject(this.url=E);this._outSR=D&&D.outSR||new x({wkid:4326});this._options=b.mixin({},D);q.defaults.kmlService&&(this.serviceUrl=q.defaults.kmlService);if(E=this.linkInfo=D&&D.linkInfo)this.visible=!!E.visibility,this._waitingForMap=!!E.viewFormat;(!E||E&&E.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=b.hitch(this,this.refresh);
this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(E){if(E){var D=E.type,G=E.id,H;switch(D){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(E=this["_"+D])&&(H=b.getObject("_mode._featureMap."+G,!1,E));break;case "GroundOverlay":if(E=this._groundLyr){var N=E.getImages();D=N.length;for(E=0;E<D;E++)if(N[E].id===G){H=N[E];break}}break;case "NetworkLink":h.some(this._links,function(O){return O.linkInfo&&O.linkInfo.id===G?(H=O,!0):!1});break;case "Folder":for(D=
(N=this.folders)?N.length:0,E=0;E<D;E++)if(N[E].id===G){H=N[E];break}}return H}},getLayers:function(){var E=[];this._groundLyr&&E.push(this._groundLyr);this._fLayers&&(E=E.concat(this._fLayers));this._links&&h.forEach(this._links,function(D){D.declaredClass&&E.push(D)});return E},setFolderVisibility:function(E,D){E&&(this._fireUpdateStart(),(E.visible=D)&&(D=this._areLocalAncestorsVisible(E)),this._setState(E,D),this._fireUpdateEnd())},_eventMap:{"network-link-error":["error"]},onRefresh:function(){},
onOpacityChange:function(){},onNetworkLinkError:function(){},_parseKml:function(E){var D=this;this._fireUpdateStart();this._io=e({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(E),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:f.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(G){D._io=null;D._initLayer(G)},error:function(G){D._io=null;G=b.mixin(Error(),G);G.message="Unable to load KML: "+(G.message||"");D._fireUpdateEnd(G);D._errorHandler(G)}})},
_initLayer:function(E){if(this.loaded){var D=[];h.forEach(this.folders,function(J){J.visible&&D.push(J.id)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale;this._options.opacity=this.opacity;this._removeInternalLayers()}this.name=E.name;this.description=E.description;this.snippet=E.snippet;this.visibility=E.visibility;this.featureInfos=E.featureInfos;var G,H=this.folders=E.folders,N=[];if(H){var O=H.length;for(G=0;G<O;G++){var S=H[G]=new v(H[G]);-1===S.parentFolderId&&N.push(S)}}H=
this._links=E.networkLinks;O=H?H.length:0;for(G=0;G<O;G++)if(!H[G].viewRefreshMode||-1===H[G].viewRefreshMode.toLowerCase().indexOf("onregion")){var da=b.mixin({},this._options);da.linkInfo=H[G];da.id&&(da.id=da.id+"_"+G);S=H[G]=new C(H[G].href,da);S._parentLayer=this;S._parentFolderId=this._getLinkParentId(S.linkInfo.id);S._linkErrorHandle=S.on("error,network-link-error",b.hitch(S,function(J){this._parentLayer.onNetworkLinkError(J.error)}))}if((H=E.groundOverlays)&&0<H.length)for(da=b.mixin({},this._options),
da.id&&(da.id+="_mapImage"),S=this._groundLyr=new z(da),O=H.length,G=0;G<O;G++)S.addImage(new y(H[G]));(E=b.getObject("featureCollection.layers",!1,E))&&0<E.length&&(this._fLayers=[],h.forEach(E,function(J,M){var K=b.getObject("featureSet.features",!1,J);K&&0<K.length&&(da=b.mixin({outFields:["*"],infoTemplate:J.popupInfo?new w(J.popupInfo):null,editable:!1},this._options),da.id&&(da.id=da.id+"_"+M),da.webgl=!1,J.layerDefinition.capabilities="Query,Data",J=new B(J,da),J.geometryType&&(this["_"+J.geometryType]=
J),this._fLayers.push(J))},this),0===this._fLayers.length&&delete this._fLayers);if(!this.loaded)for(O=N.length,G=0;G<O;G++)S=N[G],this._setState(S,S.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),h.forEach(this.folders,function(J){-1<h.indexOf(D,J.id)?this.setFolderVisibility(J,!0):this.setFolderVisibility(J,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var E=this._map;this._fireUpdateStart();this._links&&h.forEach(this._links,
function(N){N.declaredClass&&(E.addLayer(N),N._waitingForMap&&(N._waitingForMap=null,N.visible?N._parseKml(E):N._wMap=E))});var D=E.spatialReference,G=this._outSR;if(!D.equals(G))if(D.isWebMercator()&&4326===G.wkid)var H=r.geographicToWebMercator;else if(G.isWebMercator()&&4326===D.wkid)H=r.webMercatorToGeographic;else return;this._groundLyr&&(H&&h.forEach(this._groundLyr.getImages(),function(N){N.extent=H(N.extent)}),E.addLayer(this._groundLyr));(D=this._fLayers)&&0<D.length&&h.forEach(D,function(N){if(H){var O=
N.graphics,S,da,J=O?O.length:0;for(S=0;S<J;S++)(da=O[S].geometry)&&O[S].setGeometry(H(da))}E.addLayer(N)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var E=this._map;this._links&&h.forEach(this._links,function(D){D.declaredClass&&D._io&&D._io.cancel();D._linkErrorHandle&&(D._linkErrorHandle.remove(),D._linkErrorHandle=null)});E&&h.forEach(this.getLayers(),E.removeLayer,E)},_setState:function(E,D){E=E.featureInfos;var G,H,N=E?E.length:0,O=D?"show":"hide",S=D?"_resume":
"_suspend";for(H=0;H<N;H++){var da=E[H];if(G=this.getFeature(da))if("Folder"===da.type)this._setState(G,D&&G.visible);else if("NetworkLink"===da.type)this._setInternalVisibility(G,D);else if(G[S])G[S]();else G[O]()}},_areLocalAncestorsVisible:function(E){var D=E.parentFolderId;for(E=E.visible;E&&-1!==D;)D=this.getFeature({type:"Folder",id:D}),E=E&&D.visible,D=D.parentFolderId;return E},_setInternalVisibility:function(E,D){var G=E._parentLayer,H=E._parentFolderId;for(D=D&&E.visible;D&&G;)D=D&&G.visible,
-1<H&&(D=D&&G._areLocalAncestorsVisible(G.getFeature({type:"Folder",id:H}))),H=G._parentFolderId,G=G._parentLayer;this._setIntState(E,D)},_setIntState:function(E,D){E&&h.forEach(E.getLayers(),function(G){G.linkInfo?E._setIntState(G,D&&G.visible&&E._areLocalAncestorsVisible(E.getFeature({type:"Folder",id:G._parentFolderId}))):G.setVisibility(D)})},_getLinkParentId:function(E){var D=-1;this.folders&&h.some(this.folders,function(G){return G.networkLinkIds&&-1!==h.indexOf(G.networkLinkIds,E)?(D=G.id,
!0):!1});return D},_checkAutoRefresh:function(){var E=this.linkInfo;if(E)if(this.visible){if(this.loaded&&this._map){var D=E.refreshMode,G=E.refreshInterval,H=E.viewRefreshMode;E=E.viewRefreshTime;D&&-1!==D.toLowerCase().indexOf("oninterval")&&0<G&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*G));H&&-1!==H.toLowerCase().indexOf("onstop")&&0<E&&!this._extChgHandle&&(this._extChgHandle=p.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),
p.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(E){E=E||this._map;var D={},G=this.linkInfo,H=E&&E.extent;if(this._url.query){b.mixin(D,this._url.query);var N=!!this._url.query.token}m.id&&!N&&(N=m.id.findCredential(this._url.path))&&(D.token=N.token);if(G){N=G.viewFormat;var O=G.httpQuery;G=G.viewBoundScale;if(H&&N){var S=H,da=H,J=H.spatialReference;J&&(J.isWebMercator()?
S=r.webMercatorToGeographic(H):4326===J.wkid&&(da=r.geographicToWebMercator(H)));H=S.getCenter();da=Math.max(da.getWidth(),da.getHeight());G&&(S=S.expand(G));N=N.replace(/\[bboxWest\]/ig,S.xmin).replace(/\[bboxEast\]/ig,S.xmax).replace(/\[bboxSouth\]/ig,S.ymin).replace(/\[bboxNorth\]/ig,S.ymax).replace(/\[lookatLon\]/ig,H.x).replace(/\[lookatLat\]/ig,H.y).replace(/\[lookatRange\]/ig,da).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,H.x).replace(/\[lookatTerrainLat\]/ig,
H.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,H.x).replace(/\[cameraLat\]/ig,H.y).replace(/\[cameraAlt\]/ig,da).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,E.width).replace(/\[vertPixels\]/ig,E.height).replace(/\[terrainEnabled\]/ig,0);b.mixin(D,a.queryToObject(N))}O&&(O=O.replace(/\[clientVersion\]/ig,m.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,k.locale),b.mixin(D,
a.queryToObject(O)))}E=[];for(var M in D)l.isDefined(D[M])&&E.push(M+"\x3d"+D[M]);return(E=E.join("\x26"))?"?"+E:""},setScaleRange:function(E,D){this.inherited(arguments);h.forEach(this.getLayers(),function(G){G.setScaleRange(E,D)})},setOpacity:function(E){this.opacity!=E&&(h.forEach(this.getLayers(),function(D){D.setOpacity(E)}),this.opacity=E,this.onOpacityChange(E))},_setMap:function(E,D){this.inherited(arguments);this._map=E;var G=this._div=c.create("div",null,D);n.set(G,"position","absolute");
this._addInternalLayers();this.evaluateSuspension();return G},_unsetMap:function(E,D){this._io&&this._io.cancel();this._stopAutoRefresh();p.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var G=this._div;G&&(D.removeChild(G),c.destroy(G));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(E){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,E),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&E&&(this._waitingForMap||
this._parseKml(this._wMap))},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._parseKml()},getFeatureCollection:function(E){var D,G=[];(E=this.getFeature({type:"Folder",id:E}))&&(D=h.map(E.featureInfos,function(H){if("esriGeometryPoint"===H.type||"esriGeometryPolyline"===H.type||"esriGeometryPolygon"===H.type)return H.id},this))&&0<D.length&&h.forEach(this._fLayers,function(H){var N;var O=H.toJson();O.featureSet.features&&0<O.featureSet.features.length&&(N=h.filter(O.featureSet.features,
function(S){if(-1!==h.indexOf(D,S.attributes[H.objectIdField]))return S},this));N&&0<N.length&&(O.featureSet.features=N,G.push(O))},this);return G},getFeatureCount:function(E){E=this.getFeature({type:"Folder",id:E});var D={points:0,polylines:0,polygons:0};E&&h.forEach(E.featureInfos,function(G){"esriGeometryPoint"===G.type&&(D.points+=1);"esriGeometryPolyline"===G.type&&(D.polylines+=1);"esriGeometryPolygon"===G.type&&(D.polygons+=1)});return D},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=
setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});b.setObject("layers.KMLLayer",C,m);return C})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(k,g,p,b,h){k=k(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(f){g.mixin(this,f);h.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});g.setObject("layers.KMLFolder",k,b);return k})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),
function(k,g,p,b,h,f){k=k([f],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(d){h.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});g.setObject("layers.KMLGroundOverlay",k,b);return k})},"esri/layers/osm":function(){define(["./OpenStreetMapLayer"],function(){return{}})},"esri/SnappingManager":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/Deferred dojo/has dojo/keys ./kernel ./graphic ./geometry/ScreenPoint ./geometry/Extent ./symbols/SimpleMarkerSymbol ./symbols/SimpleLineSymbol ./tasks/query".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t){k=k(null,{declaredClass:"esri.SnappingManager",constructor:function(x){x=x||{};this.map=x.map;this.tolerance=x.tolerance||15;this.layerInfos=[];if(x.layerInfos)this.layerInfos=x.layerInfos;else{var r;for(r=0;r<this.map.graphicsLayerIds.length;r++){var w=this.map.getLayer(this.map.graphicsLayerIds[r]);this.layerInfos.push({layer:w})}if(this.map.loaded)this.layerInfos.push({layer:this.map.graphics});else var u=g.connect(this.map,"onLoad",this,function(v){g.disconnect(u);
u=null;this.layerInfos.push({layer:this.map.graphics});this.setLayerInfos(this.layerInfos)})}this.snapPointSymbol=x.snapPointSymbol?x.snapPointSymbol:new l(l.STYLE_CROSS,15,new e(e.STYLE_SOLID,new h([0,255,255]),1),new h([0,255,0,0]));this.alwaysSnap=x.alwaysSnap?x.alwaysSnap:!1;this.snapKey=x.snapKey?x.snapKey:d("mac")?a.META:a.CTRL;this._SelectionLyrQuery=new t;this._SelectionLyrQuery.spatialRelationship=t.SPATIAL_REL_INTERSECTS;this._snappingGraphic=new n;this.setLayerInfos(this.layerInfos);this._currentGraphicOption=
{snapToPoint:!0,snapToVertex:!0,snapToLastVertex:!0,snapToEdge:!0};this._snappingCallback=p.hitch(this,this._snappingCallback)},getSnappingPoint:function(x){var r=this.layers,w=this.tolerance,u=this.map,v=this.layerOptions,y=u.toMap(x.offset(-w,w));w=u.toMap(x.offset(w,-w));y=new q(y.x,y.y,w.x,w.y,u.spatialReference);var z=new t;z.geometry=y;z.spatialRelationship=t.SPATIAL_REL_INTERSECTS;var B=[],C=[],E=this._extractPointsAndLines,D=new f,G=0,H;w=y.xmin;var N=y.xmax;b.forEach(r,function(M,K){M.visible&&
M.loaded&&"esri.layers.FeatureLayer"===M.declaredClass&&M.mode!==M.constructor.MODE_SELECTION&&G++});u.spatialReference._isWrappable()&&(w=q.prototype._normalizeX(y.xmin,u.spatialReference._getInfo()).x,N=q.prototype._normalizeX(y.xmax,u.spatialReference._getInfo()).x);var O=new q(w,y.ymin,N,y.ymax,u.spatialReference);b.forEach(r,function(M,K){if("esri.layers.GraphicsLayer"===M.declaredClass&&M.visible){var R=[];b.forEach(M.graphics,function(X){X&&X.visible&&O.intersects(X.geometry)&&R.push(X)});
M=E(R,v[K]);B=B.concat(M[0]);C=C.concat(M[1])}});var S=p.hitch(this,function(M){G--;M instanceof Error||(M=E(M.features,v[H]),B=B.concat(M[0]),C=C.concat(M[1]));G||(J=this._getSnappingPoint(B,C,x),D.callback(J))}),da=!1;b.forEach(r,function(M,K){M.visible&&M.loaded&&(H=K,"esri.layers.FeatureLayer"===M.declaredClass&&M.mode!==M.constructor.MODE_SELECTION&&(da=!0,M.queryFeatures(z,S,S)))});if(!da){var J=this._getSnappingPoint(B,C,x);D.callback(J)}return D},setLayerInfos:function(x){this.layers=[];this.layerOptions=
[];var r;for(r=0;r<x.length;r++)this.layers.push(x[r].layer),this.layerOptions.push({snapToPoint:!0,snapToVertex:!0,snapToEdge:!0}),!1===x[r].snapToPoint&&(this.layerOptions[r].snapToPoint=x[r].snapToPoint),!1===x[r].snapToVertex&&(this.layerOptions[r].snapToVertex=x[r].snapToVertex),!1===x[r].snapToEdge&&(this.layerOptions[r].snapToEdge=x[r].snapToEdge);this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];this._selectionLayers=[];this._selectionLayerOptions=[];b.forEach(this.layers,
function(w,u){"esri.layers.FeatureLayer"===w.declaredClass&&w.mode===w.constructor.MODE_SELECTION&&(this._selectionLayers.push(w),this._selectionLayerOptions.push(this.layerOptions[u]))},this);this.layerInfos=x},destroy:function(){g.disconnect(this._onExtentChangeConnect);this._killOffSnapping();this._featurePtsFromSelectionLayer=this._featureLinesFromSelectionLayer=this._currentFeaturePts=this._currentFeatureLines=this.layers=this.map=null},_startSelectionLayerQuery:function(){g.disconnect(this._onExtentChangeConnect);
this._mapExtentChangeHandler(this._selectionLayers,this._selectionLayerOptions,this.map.extent);this._onExtentChangeConnect=g.connect(this.map,"onExtentChange",p.hitch(this,"_mapExtentChangeHandler",this._selectionLayers,this._selectionLayerOptions))},_stopSelectionLayerQuery:function(){g.disconnect(this._onExtentChangeConnect)},_mapExtentChangeHandler:function(x,r,w){this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];var u;this._SelectionLyrQuery.geometry=w;var v=p.hitch(this,
function(y){y instanceof Error||(y=this._extractPointsAndLines(y.features,r[u]),this._featurePtsFromSelectionLayer=this._featurePtsFromSelectionLayer.concat(y[0]),this._featureLinesFromSelectionLayer=this._featureLinesFromSelectionLayer.concat(y[1]))});b.forEach(x,function(y,z){y.visible&&y.loaded&&(u=z,y.queryFeatures(this._SelectionLyrQuery,v,v))},this)},_extractPointsAndLines:function(x,r){var w=[],u=[],v,y;b.forEach(x,function(z,B){if((!z._graphicsLayer||z.visible)&&z.geometry)if("point"===z.geometry.type&&
r.snapToPoint)w.push(z.geometry);else if("polyline"===z.geometry.type)for(v=0;v<z.geometry.paths.length;v++){u.push("lineStart");B=z.geometry.paths[v].length;for(y=0;y<B;y++)if(r.snapToLastVertex||y!==B-1){var C=z.geometry.getPoint(v,y);r.snapToVertex&&w.push(C);r.snapToEdge&&u.push(C)}u.push("lineEnd")}else if("polygon"===z.geometry.type)for(v=0;v<z.geometry.rings.length;v++){u.push("lineStart");B=z.geometry.rings[v].length;for(y=0;y<B;y++)if(r.snapToLastVertex||y!==B-1)C=z.geometry.getPoint(v,y),
r.snapToVertex&&w.push(C),r.snapToEdge&&u.push(C);u.push("lineEnd")}});return[w,u]},_getSnappingPoint:function(x,r,w){var u,v=this.tolerance,y=this.map,z=this.map._getFrameWidth();x=x.concat(this._featurePtsFromSelectionLayer);r=r.concat(this._featureLinesFromSelectionLayer);if(this._currentGraphic){var B=this._extractPointsAndLines([this._currentGraphic],this._currentGraphicOption);x=x.concat(B[0]);r=r.concat(B[1])}var C,E;b.forEach(x,function(W,I){W=y.toScreen(W,!0);if(-1!==z&&(W.x%=z,0>W.x&&(W.x+=
z),y.width>z))for(I=(y.width-z)/2;W.x<I;)W.x+=z;u=Math.sqrt((W.x-w.x)*(W.x-w.x)+(W.y-w.y)*(W.y-w.y));u<=v&&(v=u,C=W.x,E=W.y)});if(C){r=new m(C,E);var D=r=y.toMap(r)}else{v=this.tolerance;for(x=0;x<r.length;x++)if("lineStart"===r[x])for(B=x+1;B<r.length;B++){if("lineEnd"!==r[B+1]&&"lineStart"!==r[B+1]&&"lineEnd"!==r[B]&&"lineStart"!==r[B]){var G=y.toScreen(r[B],!0),H=y.toScreen(r[B+1],!0),N=G.x>=H.x?G:H,O=G.x>=H.x?H:G;-1!==z&&(N.x%=z,0>N.x&&(N.x+=z),O.x%=z,0>O.x&&(O.x+=z),O.x>N.x&&(O.x-=z));G=N.x;
N=N.y;H=O.x;O=O.y;var S;if(G===H){var da=G;var J=w.y;var M=S=G;var K=N<=O?N:O;var R=N<=O?O:N}else N===O?(da=w.x,J=N,M=G<=H?G:H,S=G<=H?H:G,K=R=N):(J=(O-N)/(H-G),M=(N*H-G*O)/(H-G),da=(M-(w.y*O-w.y*N-w.x*G+w.x*H)/(O-N))/((G-H)/(O-N)-J),J=J*da+M,M=G<=H?G:H,S=G<=H?H:G,K=N<=O?N:O,R=N<=O?O:N);if(da>=M&&da<=S&&J>=K&&J<=R){if(G=Math.sqrt((w.x-da)*(w.x-da)+(w.y-J)*(w.y-J)),G<=v){v=G;var X=da;var Q=J}}else da=Math.sqrt((G-w.x)*(G-w.x)+(N-w.y)*(N-w.y)),J=Math.sqrt((H-w.x)*(H-w.x)+(O-w.y)*(O-w.y)),da<=J?(M=da,
da=G,J=N):(M=J,da=H,J=O),M<=v&&(v=M,X=da,Q=J)}if("lineEnd"===r[B]){x=B;break}}X&&(r=new m(X,Q),D=r=y.toMap(r))}return D},_setGraphic:function(x,r){this._currentGraphic=x;this._currentGraphicOption.snapToLastVertex=r&&!1===r.snapToLastVertex?!1:!0},_addSnappingPointGraphic:function(){var x=this.map;this._snappingGraphic.setSymbol(this.snapPointSymbol);x.graphics.add(this._snappingGraphic)},_setUpSnapping:function(){var x=this.map;this._onSnapKeyDown_connect=g.connect(x,"onKeyDown",this,"_onSnapKeyDownHandler");
this._onSnapKeyUp_connect=g.connect(x,"onKeyUp",this,"_onSnapKeyUpHandler");this._onSnappingMouseMove_connect=g.connect(x,"onMouseMove",this,"_onSnappingMouseMoveHandler");this._onSnappingMouseDrag_connect=g.connect(x,"onMouseDrag",this,"_onSnappingMouseMoveHandler");this.alwaysSnap&&this._activateSnapping()},_killOffSnapping:function(){g.disconnect(this._onSnapKeyDown_connect);g.disconnect(this._onSnapKeyUp_connect);g.disconnect(this._onSnappingMouseMove_connect);g.disconnect(this._onSnappingMouseDrag_connect);
this._deactivateSnapping()},_onSnapKeyDownHandler:function(x){x.keyCode===this.snapKey&&(g.disconnect(this._onSnapKeyDown_connect),this.alwaysSnap?this._deactivateSnapping():this._activateSnapping())},_activateSnapping:function(){this._snappingActive=!0;this._addSnappingPointGraphic();this._currentLocation&&this._onSnappingMouseMoveHandler(this._currentLocation)},_onSnapKeyUpHandler:function(x){x.keyCode===this.snapKey&&(this._onSnapKeyDown_connect=g.connect(this.map,"onKeyDown",this,"_onSnapKeyDownHandler"),
this.alwaysSnap?this._activateSnapping():this._deactivateSnapping())},_deactivateSnapping:function(){this._snappingActive=!1;this._snappingPoint=null;this.map.graphics.remove(this._snappingGraphic);this._snappingGraphic.setGeometry(null)},_onSnappingMouseMoveHandler:function(x){this._currentLocation=x;this._snappingPoint=null;this._snappingActive&&(this._snappingGraphic.hide(),this.getSnappingPoint(x.screenPoint).addCallback(this._snappingCallback))},_snappingCallback:function(x){if(this._snappingPoint=
x)this._snappingGraphic.show(),this._snappingGraphic.setGeometry(x)}});return c.SnappingManager=k})},"esri/tasks/geometry":function(){define("./GeometryService ./TrimExtendParameters ./BufferParameters ./AreasAndLengthsParameters ./LengthsParameters ./RelationParameters ./DensifyParameters ./GeneralizeParameters ./OffsetParameters ./DistanceParameters ./ProjectParameters".split(" "),function(){return{}})},"esri/tasks/TrimExtendParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),
function(k,g,p,b,h,f){k=k(null,{declaredClass:"esri.tasks.TrimExtendParameters",polylines:null,trimExtendTo:null,extendHow:null,toJson:function(){var d=p.map(this.polylines,function(c){return c.toJson()}),a={};a.polylines=b.toJson(d);a.trimExtendTo=b.toJson(this.trimExtendTo.toJson());a.sr=b.toJson(this.polylines[0].spatialReference.toJson());a.extendHow=this.extendHow||0;return a}});g.mixin(k,{DEFAULT_CURVE_EXTENSION:0,RELOCATE_ENDS:1,KEEP_END_ATTRIBUTES:2,NO_END_ATTRIBUTES:4,NO_EXTEND_AT_FROM:8,
NO_EXTEND_AT_TO:16});g.setObject("tasks.TrimExtendParameters",k,f);return k})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(k,g,p,b,h,f,d,a){k=k(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var c={unit:this.unit,
unionResults:this.unionResults,geodesic:this.geodesic},n=this.distances,m=this.outSpatialReference,q=this.bufferSpatialReference,l=p.map(this.geometries,function(x){x="extent"===x.type?d.fromExtent(x):x;return x.toJson()},this),e=this.geometries;if(e&&0<e.length){var t="extent"===e[0].type?"esriGeometryPolygon":a.getJsonType(e[0]);c.geometries=b.toJson({geometryType:t,geometries:l});c.inSR=e[0].spatialReference.wkid?e[0].spatialReference.wkid:b.toJson(e[0].spatialReference.toJson())}n&&(c.distances=
n.join(","));m&&(c.outSR=m.wkid?m.wkid:b.toJson(m.toJson()));q&&(c.bufferSR=q.wkid?q.wkid:b.toJson(q.toJson()));return c}});g.setObject("tasks.BufferParameters",k,f);return k})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(k,g,p,b,h,f,d){k=k(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var a=
p.map(this.geometries1,function(q){return q.toJson()}),c=p.map(this.geometries2,function(q){return q.toJson()}),n={},m=this.geometries1;m&&0<m.length&&(n.geometries1=b.toJson({geometryType:d.getJsonType(m[0]),geometries:a}),a=this.geometries1[0].spatialReference,n.sr=a.wkid?a.wkid:b.toJson(a.toJson()));(a=this.geometries2)&&0<a.length&&(n.geometries2=b.toJson({geometryType:d.getJsonType(a[0]),geometries:c}));this.relation&&(n.relation=this.relation);this.relationParam&&(n.relationParam=this.relationParam);
return n}});g.mixin(k,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",
SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});g.setObject("tasks.RelationParameters",k,f);return k})},"esri/tasks/DensifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(k,g,p,b,h,f,d){k=k(null,{declaredClass:"esri.tasks.DensifyParameters",geometries:null,geodesic:null,lengthUnit:null,maxSegmentLength:null,
toJson:function(){var a=p.map(this.geometries,function(n){return n.toJson()}),c={};this.geometries&&0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.geodesic&&(c.geodesic=this.geodesic);this.lengthUnit&&(c.lengthUnit=this.lengthUnit);this.maxSegmentLength&&(c.maxSegmentLength=this.maxSegmentLength);return c}});g.setObject("tasks.DensifyParameters",k,f);return k})},"esri/tasks/GeneralizeParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(k,g,p,b,h,f,d){k=k(null,{declaredClass:"esri.tasks.GeneralizeParameters",geometries:null,deviationUnit:null,maxDeviation:null,toJson:function(){var a=p.map(this.geometries,function(n){return n.toJson()}),c={};this.geometries&&0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.deviationUnit&&(c.deviationUnit=this.deviationUnit);this.maxDeviation&&(c.maxDeviation=this.maxDeviation);
return c}});g.setObject("tasks.GeneralizeParameters",k,f);return k})},"esri/tasks/OffsetParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(k,g,p,b,h,f,d){k=k(null,{declaredClass:"esri.tasks.OffsetParameters",geometries:null,bevelRatio:null,offsetDistance:null,offsetHow:null,offsetUnit:null,toJson:function(){var a=p.map(this.geometries,function(n){return n.toJson()}),c={};this.geometries&&
0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.bevelRatio&&(c.bevelRatio=this.bevelRatio);this.offsetDistance&&(c.offsetDistance=this.offsetDistance);this.offsetHow&&(c.offsetHow=this.offsetHow);this.offsetUnit&&(c.offsetUnit=this.offsetUnit);return c}});g.mixin(k,{OFFSET_BEVELLED:"esriGeometryOffsetBevelled",OFFSET_MITERED:"esriGeometryOffsetMitered",OFFSET_ROUNDED:"esriGeometryOffsetRounded"});
g.setObject("tasks.OffsetParameters",k,f);return k})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(k,g,p,b,h,f){k=k(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var d={},a=this.geometry1;a&&(d.geometry1=p.toJson({geometryType:f.getJsonType(a),geometry:a}));if(a=this.geometry2)d.geometry2=p.toJson({geometryType:f.getJsonType(a),
geometry:a});d.sr=p.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(d.distanceUnit=this.distanceUnit);this.geodesic&&(d.geodesic=this.geodesic);return d}});g.setObject("tasks.DistanceParameters",k,h);return k})},"esri/tasks/identify":function(){define(["./IdentifyTask","./IdentifyParameters","./IdentifyResult"],function(){return{}})},"esri/tasks/IdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./IdentifyResult".split(" "),
function(k,g,p,b,h,f,d,a,c){k=k(a,{declaredClass:"esri.tasks.IdentifyTask",_eventMap:{complete:["results"]},constructor:function(n,m){this._url.path+="/identify";this._handler=g.hitch(this,this._handler);this.gdbVersion=m&&m.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(n,m,q,l,e){try{var t=[];p.forEach(n.results,function(x,r){t[r]=new c(x)});this._successHandler([t],"onComplete",q,e)}catch(x){this._errorHandler(x,l,e)}},execute:function(n,
m,q,l){var e=l.assembly;n=this._encode(g.mixin({},this._url.query,{f:"json"},n.toJson(e&&e[0])));var t=this._handler,x=this._errorHandler;this.gdbVersion&&(n.gdbVersion=this.gdbVersion);return f({url:this._url.path,content:n,callbackParamName:"callback",load:function(r,w){t(r,w,m,q,l.dfd)},error:function(r){x(r,q,l.dfd)}})},onComplete:function(){}});d._createWrappers(k);g.setObject("tasks.IdentifyTask",k,h);return k})},"esri/tasks/IdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../graphic ../geometry/jsonUtils".split(" "),
function(k,g,p,b,h,f){k=k(null,{declaredClass:"esri.tasks.IdentifyResult",constructor:function(d){g.mixin(this,d);this.feature=new h(d.geometry?f.fromJson(d.geometry):null,null,d.attributes);delete this.geometry;delete this.attributes}});g.setObject("tasks.IdentifyResult",k,b);return k})},"esri/tasks/IdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../layerUtils ../geometry/jsonUtils ../geometry/scaleUtils".split(" "),function(k,
g,p,b,h,f,d,a,c){var n=k(null,{declaredClass:"esri.tasks.IdentifyParameters",constructor:function(){this.layerOption=n.LAYER_OPTION_TOP},geometry:null,spatialReference:null,layerIds:null,tolerance:null,returnGeometry:!1,returnFieldName:!1,returnUnformattedValues:!1,mapExtent:null,width:400,height:400,dpi:96,layerDefinitions:null,timeExtent:null,layerTimeOptions:null,dynamicLayerInfos:null,toJson:function(m){var q=m&&m.geometry||this.geometry,l=this.mapExtent,e=this.spatialReference,t=this.layerIds;
m={tolerance:this.tolerance,returnGeometry:this.returnGeometry,returnFieldName:this.returnFieldName,returnUnformattedValues:this.returnUnformattedValues,imageDisplay:this.width+","+this.height+","+this.dpi,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision};if(q){var x=q.toJson();delete x.spatialReference;m.geometry=b.toJson(x);m.geometryType=a.getJsonType(q)}e?m.sr=e.wkid||b.toJson(e.toJson()):q&&q.spatialReference?m.sr=q.spatialReference.wkid||b.toJson(q.spatialReference.toJson()):
l&&l.spatialReference&&(m.sr=l.spatialReference.wkid||b.toJson(l.spatialReference.toJson()));l&&(m.mapExtent=l.xmin+","+l.ymin+","+l.xmax+","+l.ymax);m.layers=this.layerOption;t&&(m.layers+=":"+t.join(","));m.layerDefs=d._serializeLayerDefinitions(this.layerDefinitions,!0);q=this.timeExtent;m.time=q?q.toJson().join(","):null;m.layerTimeOptions=d._serializeTimeOptions(this.layerTimeOptions);if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length){l=c.getScale({extent:l,width:this.width,spatialReference:l.spatialReference});
var r=d._getLayersForScale(l,this.dynamicLayerInfos),w=[];p.forEach(this.dynamicLayerInfos,function(u){if(!u.subLayerIds){var v=u.id;if((!this.layerIds||this.layerIds&&-1!==p.indexOf(this.layerIds,v))&&-1!==p.indexOf(r,v)){var y={id:v};y.source=u.source&&u.source.toJson();var z;this.layerDefinitions&&this.layerDefinitions[v]&&(z=this.layerDefinitions[v]);z&&(y.definitionExpression=z);var B;this.layerTimeOptions&&this.layerTimeOptions[v]&&(B=this.layerTimeOptions[v]);B&&(y.layerTimeOptions=B.toJson());
w.push(y)}}},this);l=b.toJson(w);"[]"===l&&(l="[{}]");m.dynamicLayers=l}return m}});g.mixin(n,{LAYER_OPTION_TOP:"top",LAYER_OPTION_VISIBLE:"visible",LAYER_OPTION_ALL:"all"});g.setObject("tasks.IdentifyParameters",n,f);return n})},"esri/virtualearth/VEGeocoder":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/has ../kernel ../urlUtils ../tasks/Task ./VEGeocodeResult ../deferredUtils ../request".split(" "),function(k,g,p,b,h,f,d,a,c,n,m){k=k(a,{declaredClass:"esri.virtualearth.VEGeocoder",
constructor:function(q){try{if(q=g.mixin({bingMapsKey:null},q||{}),this.url=d.getProtocolForWebResource()+"//serverapi.arcgisonline.com/veadaptor/production/services/geocode/geocode",this._url=d.urlToObject(this.url),this._queue=[],this.bingMapsKey=q.bingMapsKey,this.culture=q.culture||"en-US",this._errorHandler=g.hitch(this,this._errorHandler),this._addressToLocationsHandler=g.hitch(this,this._addressToLocationsHandler),!this.bingMapsKey)throw Error("BingMapsKey must be provided.");}catch(l){throw this.onError(l),
l;}},addressToLocations:function(q,l,e){if(this.bingMapsKey){var t=g.mixin({},this._url.query,{query:q,token:this.bingMapsKey,culture:this.culture}),x=this._addressToLocationsHandler,r=this._errorHandler,w=new b(n._dfdCanceller);w._pendingDfd=m({url:this._url.path,content:t,callbackParamName:"callback",load:function(u,v){x(u,v,l,e,w)},error:function(u){r(u,e,w)}});return w}this._queue.push(arguments)},_addressToLocationsHandler:function(q,l,e,t,x){try{p.forEach(q,function(r,w){q[w]=new c(r)}),this._successHandler([q],
"onAddressToLocationsComplete",e,x)}catch(r){this._errorHandler(r,t,x)}},onAddressToLocationsComplete:function(){},setBingMapsKey:function(q){this.bingMapsKey=q},setCulture:function(q){this.culture=q}});g.setObject("virtualearth.VEGeocoder",k,f);return k})},"esri/virtualearth/VEGeocodeResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/Point ../geometry/Extent ./VEAddress".split(" "),function(k,g,p,b,h,f,d){k=k(null,{declaredClass:"esri.virtualearth.VEGeocodeResult",
constructor:function(a){g.mixin(this,{address:null,bestView:null,calculationMethod:null,confidence:null,displayName:null,entityType:null,location:null,matchCodes:null},a);this.address&&(this.address=new d(this.address));this.bestView&&(this.bestView=new f(this.bestView));this.locationArray&&(this.calculationMethod=this.locationArray[0].calculationMethod,this.location=new h(this.locationArray[0]))}});g.setObject("virtualearth.VEGeocodeResult",k,b);return k})},"esri/virtualearth/VEAddress":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(k,g,p,b){k=k(null,{declaredClass:"esri.virtualearth.VEAddress",constructor:function(h){g.mixin(this,{addressLine:null,adminDistrict:null,countryRegion:null,district:null,formattedAddress:null,locality:null,postalCode:null,postalTown:null},h)}});g.setObject("virtualearth.VEAddress",k,b);return k})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dojo/_base/kernel dijit/a11yclick dijit/_TemplatedMixin dijit/focus dijit/_FocusMixin ../kernel ../urlUtils ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da){g=g("esri.dijit.Geocoder",[D,w,v],{templateString:e,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(J,M){x.deprecated("esri.dijit.Geocoder","Use esri.dijit.Search instead","4.0");this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",
GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",
resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};
this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new E(k.toUrl("./images/sdk_gps_location.png"),28,28),graphicsLayer:null};J=p.mixin({},this.options,J);this.set("autoComplete",J.autoComplete);this.set("arcgisGeocoder",J.arcgisGeocoder);this.set("value",J.value);this.set("theme",
J.theme);this.set("activeGeocoderIndex",J.activeGeocoderIndex);this.set("maxLocations",J.maxLocations);this.set("minCharacters",J.minCharacters);this.set("searchDelay",J.searchDelay);this.set("geocoderMenu",J.geocoderMenu);this.set("autoNavigate",J.autoNavigate);this.set("showResults",J.showResults);this.set("map",J.map);this.set("activeGeocoder",J.activeGeocoder);this.set("geocoders",J.geocoders);this.set("zoomScale",J.zoomScale);this.set("highlightLocation",J.highlightLocation);this.set("symbol",
J.symbol);this.set("graphicsLayer",J.graphicsLayer);this.set("results",[]);this._i18n=l;this._deferreds=[];this._defaultSR=new B(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);
this.domNode=M},startup:function(){this.inherited(arguments);if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();else m.once(this.get("map"),"load",p.hitch(this,function(){this._init()}));else this._init();else this.destroy();else this.destroy()},postCreate:function(){this.inherited(arguments);this.own(m(this.submitNode,r,p.hitch(this,this._findThenSelect)));this.own(m(this.geocoderMenuArrowNode,r,p.hitch(this,this._toggleGeolocatorMenu)));this.own(m(this.inputNode,
r,p.hitch(this,this._inputClick)));this.own(m(this.clearNode,r,p.hitch(this,this.clear)));this.own(m(this.geocoderMenuCloseNode,r,p.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();c.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var J=this.get("highlightGraphic"),M=this.get("graphicsLayer");J&&(M?M.remove(J):this.get("map").graphics.remove(J),
this.set("highlightGraphic",null));f.set(this.inputNode,"value","");this.set("value","");this.set("results",[]);d.remove(this.containerNode,this._css.hasValueClass);f.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){a.set(this.domNode,"display","block")},hide:function(){a.set(this.domNode,"display","none")},find:function(J){var M=new b;if(J)if("string"===typeof J)this._findQuery(J).then(function(R){M.resolve(R)});else if("object"===typeof J&&J.hasOwnProperty("geometry")){switch(J.geometry.type){case "extent":var K=
J.geometry.getCenter();break;case "multipoint":K=J.geometry.getExtent().getCenter();break;case "point":K=J.geometry;break;case "polygon":K=J.geometry.getExtent().getCenter();break;case "polyline":K=J.geometry.getExtent().getCenter()}K&&this._reverseGeocodePoint(K,J.geometry).then(function(R){R.results[0]&&(J.hasOwnProperty("attributes")&&R.results[0].feature.setAttributes(p.mixin(R.results[0].feature.attributes,J.attributes)),J.hasOwnProperty("infoTemplate")&&R.results[0].feature.setInfoTemplate(J.infoTemplate),
J.hasOwnProperty("symbol")&&R.results[0].feature.setSymbol(J.symbol));M.resolve(R)},function(R){M.reject(R)})}else"object"===typeof J&&"point"===J.type?this._reverseGeocodePoint(J).then(function(R){M.resolve(R)},function(R){M.reject(R)}):J instanceof Array&&2===J.length?(K=new G(J,new B({wkid:4326})),this._reverseGeocodePoint(K).then(function(R){M.resolve(R)},function(R){M.reject(R)})):M.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(R){M.resolve(R)});
return M.promise},focus:function(){u.focus(this.inputNode);var J=this.get("map");J&&J.disableKeyboardNavigation()},blur:function(){u.curNode&&u.curNode.blur();this.inputNode.blur();this._hideMenus();var J=this.get("map");J&&J.enableKeyboardNavigation()},select:function(J){this.onSelect(J);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&J&&J.hasOwnProperty("extent")&&this.get("map")&&this.get("map").setExtent(J.extent);if(J.feature){var M=this.get("highlightGraphic"),K=this.get("graphicsLayer"),
R=this.get("symbol")||J.feature.symbol;M?(M.setGeometry(J.feature.geometry),M.setAttributes(J.feature.attributes),M.setInfoTemplate(J.feature.infoTemplate),M.setSymbol(R)):(M=J.feature,this.get("highlightLocation")&&(M.setSymbol(R),K?K.add(M):this.get("map").graphics.add(M)));this.set("highlightGraphic",M)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_onFocus:function(){this.focus();
this.inherited(arguments)},_onBlur:function(){this.blur();this.inherited(arguments)},_autoComplete:function(){var J=this.get("activeGeocoder"),M=this.reHostedFS.test(J.url);("query"!==J.type||M)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(p.hitch(this,function(K){this.onAutoComplete(K);this.get("showResults")&&this._showResults(K)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(J){for(var M=0;M<J.length;M++)if(255<
J.charCodeAt(M))return!0;return!1},_findQuery:function(J){var M=new b;this._query({delay:0,search:J}).then(p.hitch(this,function(K){this.onFindResults(K);M.resolve(K)}),p.hitch(this,function(K){this.onFindResults(K);M.reject(K)}));return M.promise},_reverseGeocodePoint:function(J,M){var K=new b;if(J&&this.get("activeGeocoder")){var R=M||J;M=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);
this._task.locationToAddress(J,M,p.hitch(this,function(X){X={results:[this._hydrateResult(X)],geometry:R};this.onFindResults(X);K.resolve(X)}),p.hitch(this,function(X){K.reject(X)}))}else K.reject("Geocoder:: no point or active geocoder defined");return K.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=
!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||(this._arcgisGeocoder.url=z.getProtocolForWebResource()+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=l.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",
this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new S(this.get("activeGeocoder").url):new N(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var J=[];this.get("arcgisGeocoder")&&(J=J.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(J=J.concat(this.get("geocoders")));this._geocoders=
J},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);f.set(this.inputNode,"placeholder",this._placeholder);f.set(this.submitNode,"title",this._placeholder)},_updateValue:function(J,M,K){this._ignoreUpdateValue||
(f.set(this.inputNode,"value",K),this._checkStatus())},_updateTheme:function(J,M,K){d.remove(this.domNode,M);d.add(this.domNode,K)},_setActiveGeocoderIndex:function(J,M,K){this.set("activeGeocoderIndex",K);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();J={attr:this.get("activeGeocoder"),oldVal:M,newVal:K};this.onGeocoderSelect(J)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(J){J||(J={delay:0});J.search||(J.search=this.get("value"));
var M=new b;this._deferreds.push(M);J.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(p.hitch(this,function(){this._performTask(M,J)}),J.delay)):this._performTask(M,J);return M.promise},_performTask:function(J,M){if(M.search){this._hideGeolocatorMenu();this._showLoading();var K="";this.get("activeGeocoder").prefix&&(K+=this.get("activeGeocoder").prefix);K+=M.search;this.get("activeGeocoder").suffix&&(K+=this.get("activeGeocoder").suffix);var R=this.get("activeGeocoder").outFields;R&&
(R instanceof Array||(R=[R]));var X=this.get("maxLocations")||6,Q=this.get("activeGeocoder").searchExtent,W=this._defaultSR;this.get("map")&&(W=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var I=new O;I.outSpatialReference=W;I.returnGeometry=!0;I.num=X;Q&&(I.geometry=Q);X=this.get("activeGeocoder").exactMatch;Q=this.get("activeGeocoder").field;W="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(K)&&(W="N");I.where=X?Q+" \x3d "+
W+"'"+K+"'":"UPPER("+Q+") LIKE "+W+"'%"+K.toUpperCase()+"%'";R&&(I.outFields=R);this._task.execute(I,p.hitch(this,function(T){this._receivedResults(T.features,J,M)}),p.hitch(this,function(T){this._receivedResults([],J,M)}))}else I={},this.get("activeGeocoder").categories&&(I.categories=this.get("activeGeocoder").categories),this._task.outSpatialReference=W,this.get("map")&&this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale")&&
(W=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||W&&W<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale))&&(I.location=this.get("map").extent.getCenter(),I.distance=this.get("activeGeocoder").localSearchOptions.distance),this.get("activeGeocoder").suggest&&M.autoComplete?(I.text=K,Q&&(I.searchExtent=Q),this._task.suggestLocations(I).then(p.hitch(this,function(T){this._receivedResults(T,J,M)}),p.hitch(this,function(T){this._receivedResults(T,J,
M)}))):(I.address={},I.maxLocations=X,Q&&(I.searchExtent=Q),this.get("activeGeocoder").sourceCountry&&(I.countryCode=this.get("activeGeocoder").sourceCountry),M.magicKey&&(I.magicKey=M.magicKey),this.get("activeGeocoder").singleLineFieldName?I.address[this.get("activeGeocoder").singleLineFieldName]=K:I.address["Single Line Input"]=K,R&&(I.outFields=R),this._task.addressToLocations(I,p.hitch(this,function(T){this._receivedResults(T,J,M)}),p.hitch(this,function(T){this._receivedResults(T,J,M)})))}else this._hideLoading(),
J.reject("Geocoder:: no search to perform")},_showResults:function(){this._hideGeolocatorMenu();var J="";if(this.get("results")&&this.get("results").length&&this.resultsNode){var M=this.get("value"),K=new RegExp("("+M+")","gi");J+='\x3cul role\x3d"presentation"\x3e';for(M=0;M<this.get("results").length&&5>M;++M){var R=this.get("results")[M].text||this.get("results")[M].name,X=this._css.resultsItemClass+" ";X=0===M%2?X+this._css.resultsItemOddClass:X+this._css.resultsItemEvenClass;0===M?X+=" "+this._css.resultsItemFirstClass:
M===this.get("results").length-1&&(X+=" "+this._css.resultsItemLastClass);J+='\x3cli title\x3d"'+R+'" data-text\x3d"'+R+'" data-item\x3d"true" data-index\x3d"'+M+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+X+'"\x3e'+R.replace(K,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}J+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=J);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&(this.resultsNode.innerHTML=J),
this._hideResultsMenu()},_receivedResults:function(J,M){this._hideLoading();J=this._hydrateResults(J);this.set("results",J);J={results:J,value:this.get("value")};M.resolve(J)},_showLoading:function(){d.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){d.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){d.add(this.containerNode,this._css.activeMenuClass);d.add(this.domNode,this._css.GeocoderMenuOpenClass);a.set(this.geocoderMenuNode,"display","block");
f.set(this.geocoderMenuInsertNode,"aria-hidden","false");f.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){d.remove(this.containerNode,this._css.activeMenuClass);d.remove(this.domNode,this._css.GeocoderMenuOpenClass);a.set(this.geocoderMenuNode,"display","none");f.set(this.geocoderMenuInsertNode,"aria-hidden","true");f.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===a.get(this.geocoderMenuNode,
"display")?this._hideGeolocatorMenu():this._showGeolocatorMenu()},_showResultsMenu:function(){d.add(this.containerNode,this._css.GeocoderActiveClass);d.add(this.domNode,this._css.GeocoderResultsOpenClass);a.set(this.resultsNode,"display","block");f.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){a.set(this.resultsNode,"display","none");d.remove(this.containerNode,this._css.GeocoderActiveClass);d.remove(this.domNode,this._css.GeocoderResultsOpenClass);f.set(this.resultsNode,
"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var J="",M;var K='\x3cul role\x3d"presentation"\x3e';for(M=0;M<this._geocoders.length;M++){J=this._css.resultsItemClass+" ";J=0===M%2?J+this._css.resultsItemOddClass:J+this._css.resultsItemEvenClass;M===this.get("activeGeocoderIndex")&&(J+=" "+this._css.geocoderSelectedClass);0===M?J+=" "+this._css.resultsItemFirstClass:
M===this._geocoders.length-1&&(J+=" "+this._css.resultsItemLastClass);var R=this._geocoders[M].name||l.widgets.Geocoder.main.untitledGeocoder;K+='\x3cli data-index\x3d"'+M+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+J+'"\x3e';K+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';K+=R;K+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';K+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=K+"\x3c/ul\x3e";this._geocoderMenuEvent();
a.set(this.geocoderMenuNode,"display","none");a.set(this.geocoderMenuArrowNode,"display","block");d.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",a.set(this.geocoderMenuNode,"display","none"),a.set(this.geocoderMenuArrowNode,"display","none"),d.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(d.add(this.containerNode,this._css.hasValueClass),f.set(this.clearNode,"title",l.widgets.Geocoder.main.clearButtonTitle)):
this.clear()},_autoCompleteEvent:function(){var J=q('[data-item\x3d"true"]',this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=m(J,"click, keydown",p.hitch(this,function(M){this._clearQueryTimeout();var K=parseInt(f.get(M.currentTarget,"data-index"),10),R=f.get(M.currentTarget,"data-text");"click"===M.type||"keydown"===M.type&&M.keyCode===n.ENTER?(f.set(this.inputNode,"value",R),this.set("value",R),this.get("results")&&this.get("results")[K]&&(M=this.get("results")[K],M.name?this.select(M):
this._query({delay:0,search:M.text,magicKey:M.magicKey||null}).then(p.hitch(this,function(X){this.select(X.results[0])})))):"keydown"!==M.type||M.keyCode!==n.BACKSPACE&&M.keyCode!==n.DELETE?"keydown"===M.type&&M.keyCode===n.UP_ARROW?(h.stop(M),M=K-1,0>M?this.inputNode.focus():J[M].focus()):"keydown"===M.type&&M.keyCode===n.DOWN_ARROW?(h.stop(M),M=K+1,M>=J.length?this.inputNode.focus():J[M].focus()):M.keyCode===n.ESCAPE&&this._hideMenus():(h.stop(M),this.inputNode.focus(),M=this.inputNode.value.slice(0,
-1),f.set(this.inputNode,"value",M),this.set("value",M))}))},_geocoderMenuEvent:function(){var J=q('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=m(J,"click, keydown",p.hitch(this,function(M){var K=parseInt(f.get(M.currentTarget,"data-index"),10);"click"===M.type||"keydown"===M.type&&M.keyCode===n.ENTER?(this._setActiveGeocoderIndex(null,null,K),this._hideGeolocatorMenu()):"keydown"===M.type&&M.keyCode===n.UP_ARROW?(h.stop(M),M=K-1,0>M?this.geocoderMenuArrowNode.focus():
J[M].focus()):"keydown"===M.type&&M.keyCode===n.DOWN_ARROW?(h.stop(M),M=K+1,M>=J.length?this.geocoderMenuArrowNode.focus():J[M].focus()):M.keyCode===n.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var J;if(this._events&&this._events.length)for(J=0;J<this._events.length;J++)this._events[J].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();var J=m(document,"click",p.hitch(this,function(M){this._hideResultsMenu(M)}));
this._events.push(J);J=m(this.inputNode,"keyup",p.hitch(this,function(M){this._inputKeyUp(M)}));this._events.push(J);J=m(this.inputNode,"keydown",p.hitch(this,function(M){this._inputKeyDown(M)}));this._events.push(J);J=m(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(J);this.get("map")&&(J=m(this.get("map"),"mouse-down",p.hitch(this,function(){this.blur()})),this._events.push(J));this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(p.hitch(this,
function(J){J.results&&J.results.length&&(this.select(J.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(J){if(J){this._clearQueryTimeout();var M=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",M);this._ignoreUpdateValue=!1;var K=0;M&&(K=M.length);if(J.ctrlKey||J.metaKey||J.altKey||J.keyCode===n.copyKey||J.keyCode===n.ALT||J.keyCode===n.CTRL||J.keyCode===n.META||J.keyCode===n.SHIFT||J.keyCode===n.UP_ARROW||J.keyCode===n.DOWN_ARROW||J.keyCode===n.LEFT_ARROW||J.keyCode===
n.RIGHT_ARROW)return J;J&&J.keyCode===n.ENTER?(this._cancelDeferreds(),this._findThenSelect()):J&&J.keyCode===n.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):J&&J.keyCode===n.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&K>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var J=0;J<this._deferreds.length;J++)this._deferreds[J].cancel("Geocoder:: stop query");this._deferreds=
[]}},_inputKeyDown:function(J){var M=q('[data-item\x3d"true"]',this.resultsNode);J&&J.keyCode===n.TAB?(this._cancelDeferreds(),this._hideMenus()):J&&J.keyCode===n.UP_ARROW?(h.stop(J),(J=M.length)&&M[J-1].focus()):J&&J.keyCode===n.DOWN_ARROW&&(h.stop(J),M[0]&&M[0].focus())},_geocoderMenuButtonKeyDown:function(J){var M=q('[data-item\x3d"true"]',this.geocoderMenuInsertNode);J&&J.keyCode===n.UP_ARROW?(h.stop(J),this._showGeolocatorMenu(),(J=M.length)&&M[J-1].focus()):J&&J.keyCode===n.DOWN_ARROW&&(h.stop(J),
this._showGeolocatorMenu(),M[0]&&M[0].focus())},_inputClick:function(){this._hideGeolocatorMenu()},_hydrateResult:function(J){var M={},K=this._defaultSR,R;this.get("map")&&(K=this.get("map").spatialReference);if(J.hasOwnProperty("text")&&J.hasOwnProperty("magicKey"))return J;if(J.hasOwnProperty("feature"))M.feature=new C(J.feature),(R=M.feature.geometry)&&R.setSpatialReference(K);else if(J.hasOwnProperty("geometry")){var X=J.symbol||null;R=J.attributes||{};M.feature=new C(J.geometry,X,R,J.infoTemplate||
null);(R=M.feature.geometry)&&R.setSpatialReference(K)}else J.hasOwnProperty("location")?(X=new G(J.location.x,J.location.y,K),R={},J.hasOwnProperty("attributes")&&(R=J.attributes),J.hasOwnProperty("score")&&(R.score=J.score),M.feature=new C(X,null,R,null)):M.feature=null;if(J.hasOwnProperty("extent"))M.extent=new H(J.extent),M.extent.setSpatialReference(new B(K));else if(M.feature&&M.feature.geometry)switch(M.feature.geometry.type){case "extent":M.extent=M.feature.geometry;break;case "multipoint":M.extent=
M.feature.geometry.getExtent();break;case "polygon":M.extent=M.feature.geometry.getExtent();break;case "polyline":M.extent=M.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?M.extent=da.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(M.feature.geometry):M.extent=this.get("map").extent.centerAt(M.feature.geometry):M.extent=new H({xmin:M.feature.geometry.x-.25,ymin:M.feature.geometry.y-.25,xmax:M.feature.geometry.x+.25,
ymax:M.feature.geometry.y+.25,spatialReference:{wkid:4326}})}else M.extent=null;J.hasOwnProperty("name")?M.name=J.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&J.hasOwnProperty("attributes")&&J.attributes.hasOwnProperty(this.activeGeocoder.field)?M.name=J.attributes[this.activeGeocoder.field]:J.hasOwnProperty("Match_addr")&&"string"===typeof J.Match_addr?M.name=J.Match_addr:J.hasOwnProperty("address")&&"object"===typeof J.address&&J.address.hasOwnProperty("Match_addr")?M.name=
J.address.Match_addr:J.hasOwnProperty("address")&&"string"===typeof J.address?M.name=J.address:J.hasOwnProperty("address")&&"object"===typeof J.address&&J.address.hasOwnProperty("Address")?M.name=J.address.Address:M.name=M.feature&&M.feature.geometry?M.feature.geometry.x+","+M.feature.geometry.y:"";return M},_hydrateResults:function(J){var M=[],K=0;if(J&&J.length)for(K;K<J.length;K++){var R=this._hydrateResult(J[K]);M.push(R)}return M}});p.setObject("dijit.Geocoder",g,y);return g})},"dojox/lang/functional":function(){define(["./functional/lambda",
"./functional/array","./functional/object"],function(k){return k})},"dojox/lang/functional/lambda":function(){define(["../..","dojo/_base/lang","dojo/_base/array"],function(k,g,p){var b=g.getObject("lang.functional",!0,k),h={},f=1<"ab".split(/a*/).length?String.prototype.split:function(c){var n=this.split.call(this,c);(c=c.exec(this))&&0==c.index&&n.unshift("");return n},d=function(c){var n=[],m=f.call(c,/\s*->\s*/m);if(1<m.length)for(;m.length;)c=m.pop(),n=m.pop().split(/\s*,\s*|\s+/m),m.length&&
m.push("(function("+n.join(", ")+"){ return ("+c+"); })");else if(c.match(/\b_\b/))n=["_"];else{m=c.match(/^\s*(?:[+*\/%&|\^\.=<>]|!=)/m);var q=c.match(/[+\-*\/%&|\^\.=<>!]\s*$/m);if(m||q)m&&(n.push("$1"),c="$1"+c),q&&(n.push("$2"),c+="$2");else{m=c.replace(/(?:\b[A-Z]|\.[a-zA-Z_$])[a-zA-Z_$\d]*|[a-zA-Z_$][a-zA-Z_$\d]*:|this|true|false|null|undefined|typeof|instanceof|in|delete|new|void|arguments|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|escape|eval|isFinite|isNaN|parseFloat|parseInt|unescape|dojo|dijit|dojox|window|document|'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"/g,
"").match(/([a-z_$][a-z_$\d]*)/gi)||[];var l={};p.forEach(m,function(e){l.hasOwnProperty(e)||(n.push(e),l[e]=1)})}}return{args:n,body:c}},a=function(c){return c.length?function(){var n=c.length-1,m=b.lambda(c[n]).apply(this,arguments);for(--n;0<=n;--n)m=b.lambda(c[n]).call(this,m);return m}:function(n){return n}};g.mixin(b,{rawLambda:function(c){return d(c)},buildLambda:function(c){c=d(c);return"function("+c.args.join(",")+"){return ("+c.body+");}"},lambda:function(c){if("function"==typeof c)return c;
if(c instanceof Array)return a(c);if(h.hasOwnProperty(c))return h[c];var n=d(c);return h[c]=new Function(n.args,"return ("+n.body+");")},clearLambdaCache:function(){h={}}});return b})},"dojox/lang/functional/array":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","./lambda"],function(k,g,p,b){var h={};g.mixin(b,{filter:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||k.global;d=b.lambda(d);var c=[],n;if(g.isArray(f)){var m=0;for(n=f.length;m<n;++m){var q=f[m];d.call(a,
q,m,f)&&c.push(q)}}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(m=0;f.hasNext();)q=f.next(),d.call(a,q,m++,f)&&c.push(q);else for(m in f)m in h||(q=f[m],d.call(a,q,m,f)&&c.push(q));return c},forEach:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||k.global;d=b.lambda(d);var c;if(g.isArray(f)){var n=0;for(c=f.length;n<c;d.call(a,f[n],n,f),++n);}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(n=0;f.hasNext();d.call(a,f.next(),n++,f));else for(n in f)n in
h||d.call(a,f[n],n,f);return a},map:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||k.global;d=b.lambda(d);var c,n;if(g.isArray(f)){var m=Array(c=f.length);for(n=0;n<c;m[n]=d.call(a,f[n],n,f),++n);}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(m=[],n=0;f.hasNext();m.push(d.call(a,f.next(),n++,f)));else for(n in m=[],f)n in h||m.push(d.call(a,f[n],n,f));return m},every:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||k.global;d=b.lambda(d);var c;if(g.isArray(f)){var n=
0;for(c=f.length;n<c;++n)if(!d.call(a,f[n],n,f))return!1}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(n=0;f.hasNext();){if(!d.call(a,f.next(),n++,f))return!1}else for(n in f)if(!(n in h||d.call(a,f[n],n,f)))return!1;return!0},some:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||k.global;d=b.lambda(d);var c;if(g.isArray(f)){var n=0;for(c=f.length;n<c;++n)if(d.call(a,f[n],n,f))return!0}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(n=0;f.hasNext();){if(d.call(a,
f.next(),n++,f))return!0}else for(n in f)if(!(n in h)&&d.call(a,f[n],n,f))return!0;return!1}});return b})},"dojox/lang/functional/object":function(){define(["dojo/_base/kernel","dojo/_base/lang","./lambda"],function(k,g,p){var b={};g.mixin(p,{keys:function(h){var f=[],d;for(d in h)d in b||f.push(d);return f},values:function(h){var f=[],d;for(d in h)d in b||f.push(h[d]);return f},filterIn:function(h,f,d){d=d||k.global;f=p.lambda(f);var a={},c;for(c in h)if(!(c in b)){var n=h[c];f.call(d,n,c,h)&&(a[c]=
n)}return a},forIn:function(h,f,d){d=d||k.global;f=p.lambda(f);for(var a in h)a in b||f.call(d,h[a],a,h);return d},mapIn:function(h,f,d){d=d||k.global;f=p.lambda(f);var a={},c;for(c in h)c in b||(a[c]=f.call(d,h[c],c,h));return a}});return p})},"dojox/charting/axis2d/common":function(){define(["dojo/_base/lang","dojo/_base/window","dojo/dom-geometry","dojox/gfx","dojo/has"],function(k,g,p,b,h){var f=k.getObject("dojox.charting.axis2d.common",!0),d=function(a){a.marginLeft="0px";a.marginTop="0px";
a.marginRight="0px";a.marginBottom="0px";a.paddingLeft="0px";a.paddingTop="0px";a.paddingRight="0px";a.paddingBottom="0px";a.borderLeftWidth="0px";a.borderTopWidth="0px";a.borderRightWidth="0px";a.borderBottomWidth="0px"};return k.mixin(f,{createText:{gfx:function(a,c,n,m,q,l,e,t){return c.createText({x:n,y:m,text:l,align:q}).setFont(e).setFill(t)},html:function(a,c,n,m,q,l,e,t,x){c=g.doc.createElement("div");var r=c.style;a.getTextDir&&(c.dir=a.getTextDir(l));d(r);r.font=e;c.innerHTML=String(l).replace(/\s/g,
"\x26nbsp;");r.color=t;r.position="absolute";r.left="-10000px";g.body().appendChild(c);var w=b.normalizedLength(b.splitFontString(e).size);if(!x)if(c.getBoundingClientRect){var u=c.getBoundingClientRect();u=u.width||u.right-u.left}else u=p.getMarginBox(c).w;"rtl"==c.dir&&(n+=x?x:u);g.body().removeChild(c);r.position="relative";if(x)switch(r.width=x+"px",q){case "middle":r.textAlign="center";r.left=n-x/2+"px";break;case "end":r.textAlign="right";r.left=n-x+"px";break;default:r.left=n+"px",r.textAlign=
"left"}else switch(q){case "middle":r.left=Math.floor(n-u/2)+"px";break;case "end":r.left=Math.floor(n-u)+"px";break;default:r.left=Math.floor(n)+"px"}r.top=Math.floor(m-w)+"px";r.whiteSpace="nowrap";x=g.doc.createElement("div");r=x.style;d(r);r.width="0px";r.height="0px";x.appendChild(c);a.node.insertBefore(x,a.node.firstChild);h("dojo-bidi")&&a.htmlElementsRegistry.push([x,n,m,q,l,e,t]);return x}}})})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q){k=k([c,q],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(l){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=g.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(l,e,t,x,r){try{var w=[],u=[],v=l.directions||[],y=l.routes?l.routes.features:
[],z=l.stops?l.stops.features:[],B=l.barriers?l.barriers.features:[],C=l.polygonBarriers?l.polygonBarriers.features:[],E=l.polylineBarriers?l.polylineBarriers.features:[],D=l.messages,G=p.forEach,H=p.indexOf,N=!0,O,S,da=l.routes&&l.routes.spatialReference||l.stops&&l.stops.spatialReference||l.barriers&&l.barriers.spatialReference||l.polygonBarriers&&l.polygonBarriers.spatialReference||l.polylineBarriers&&l.polylineBarriers.spatialReference;this._chk=l.checksum;G(v,function(K){w.push(O=K.routeName);
u[O]={directions:K}});G(y,function(K){-1===H(w,O=K.attributes.Name)&&(w.push(O),u[O]={});u[O].route=K});G(z,function(K){S=K.attributes;-1===H(w,O=S.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(w.push(O),u[O]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==O&&(N=!1);void 0===u[O].stops&&(u[O].stops=[]);u[O].stops.push(K)});0<z.length&&!0===N&&(u[w[0]].stops=u["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete u["esri.tasks.RouteTask.NULL_ROUTE_NAME"],w.splice(p.indexOf(w,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),
1));var J=[];G(w,function(K,R){u[K].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===K?null:K;u[K].spatialReference=da;J.push(new n(u[K]))});l=function(K){G(K,function(R,X){R.geometry&&(R.geometry.spatialReference=da);K[X]=new f(R)});return K};G(D,function(K,R){D[R]=new m(K)});var M={routeResults:J,barriers:l(B),polygonBarriers:l(C),polylineBarriers:l(E),messages:D};this._successHandler([M],"onSolveComplete",t,r)}catch(K){this._errorHandler(K,x,r)}},solve:function(l,e,t,x){var r=x.assembly;l=this._encode(g.mixin({},
this._url.query,{f:"json"},l.toJson(r&&r[0]),this._chk?{checksum:this._chk}:{}));var w=this._handler,u=this._errorHandler;return d({url:this._url.path,timeout:25E4,content:l,callbackParamName:"callback",load:function(v,y){w(v,y,e,t,x.dfd)},error:function(v){u(v,t,x.dfd)}})},onSolveComplete:function(){}});a._createWrappers(k);g.setObject("tasks.RouteTask",k,h);return k})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),
function(k,g,p,b,h,f,d){k=k(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(a){var c=a.spatialReference,n=a.route;if(a.directions){var m=[],q=[],l=[];p.forEach(a.directions.features,function(t,x){q[x]=t.compressedGeometry;m[x]=t.strings;l[x]=t.events});a.directions.strings=m;a.directions.events=l;this.directions=new d(a.directions,q)}this.routeName=a.routeName;n&&(n.geometry&&(n.geometry.spatialReference=c),this.route=new f(n));if(a.stops){var e=this.stops=[];p.forEach(a.stops,function(t,
x){t.geometry&&(t.geometry.spatialReference=c);e[t.attributes.Sequence-1]=new f(t)})}},routeName:null,directions:null,route:null,stops:null});g.setObject("tasks.RouteResult",k,h);return k})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(k,g,p,b,h,f,d,a,c,n,m){k=k(m,{declaredClass:"esri.tasks.DirectionsFeatureSet",
constructor:function(q,l){this.routeId=q.routeId;this.routeName=q.routeName;g.mixin(this,q.summary);this.extent=new d(this.envelope);var e=this._fromCompressedGeometry,t=this.features,x=this.extent.spatialReference,r=[];p.forEach(l,function(w,u){t[u].setGeometry(r[u]=w?e(w,x):t[u].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(r,x);this.geometryType="esriGeometryPolyline";p.forEach(q.events,function(w,u){p.forEach(w,function(v,y){w[y]=new n(new c(v.point.x,v.point.y,x),null,{ETA:v.ETA,
strings:h.stringify(v.strings),arriveTimeUTC:v.arriveTimeUTC})});q.events[u]=w});delete this.envelope},_fromCompressedGeometry:function(q,l){var e=0,t=0,x=0,r=0,w=[],u=0,v=0,y=0;(q=q.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(q=[]);if(0===parseInt(q[u],32)){u=2;var z=parseInt(q[u],32);u++;var B=parseInt(q[u],32);u++;if(z&1){v=p.indexOf(q,"|")+1;var C=parseInt(q[v],32);v++}if(z&2){y=p.indexOf(q,"|",v)+1;var E=parseInt(q[y],32);y++}}else B=parseInt(q[u],32),u++;for(;u<q.length&&"|"!==q[u];){z=parseInt(q[u],
32)+e;u++;e=z;var D=parseInt(q[u],32)+t;u++;t=D;z=[z/B,D/B];v&&(D=parseInt(q[v],32)+x,v++,x=D,z.push(D/C));y&&(D=parseInt(q[y],32)+r,y++,r=D,z.push(D/E));w.push(z)}e=new a({paths:[w],hasZ:0<v,hasM:0<y});e.setSpatialReference(l);return e},_mergePolylinesToSinglePath:function(q,l){var e=[],t=!1;p.forEach(q,function(w){p.forEach(w.paths,function(u){t=t||w.hasM;e=e.concat(u)})});var x=[],r=[0,0];p.forEach(e,function(w){if(w[0]!==r[0]||w[1]!==r[1])x.push(w),r=w});return new a({paths:[x],spatialReference:l,
hasM:t})}});g.setObject("tasks.DirectionsFeatureSet",k,f);return k})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,g,p,b){k=k(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(h){g.mixin(this,h)}});g.mixin(k,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});g.setObject("tasks.NAMessage",k,b);return k})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare",
"dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(k,g,p,b,h){return k(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(f,d){var a=new p;if(this._sd)a.resolve(this._sd);else if(this._url&&this._url.orig){var c=this._url.orig,n=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":"ServiceAreas",m,q=function(l){h({url:l+("/"===l[l.length-1]?"":"/")+"GetTravelModes/execute",
content:{f:"json",serviceName:n},callbackParamName:"callback"}).then(function(e){var t=[],x=null;if(e&&e.results&&e.results.length)for(var r=0;r<e.results.length;r++)if("supportedTravelModes"===e.results[r].paramName){if(e.results[r].value&&e.results[r].value.features)for(var w=0;w<e.results[r].value.features.length;w++)if(e.results[r].value.features[w].attributes){var u=g.parse(e.results[r].value.features[w].attributes.TravelMode);t.push(u)}}else"defaultTravelMode"===e.results[r].paramName&&(x=e.results[r].value);
m.supportedTravelModes=t;m.defaultTravelMode=x;a.resolve(m)},function(e){a.reject(e)})};h({url:c,content:{f:"json"},callbackParamName:"callback"}).then(function(l){m=l;m.supportedTravelModes||(m.supportedTravelModes=[]);for(l=0;l<m.supportedTravelModes.length;l++)m.supportedTravelModes[l].id||(m.supportedTravelModes[l].id=m.supportedTravelModes[l].itemId);d?a.resolve(m):f?q(f):10.4<=m.currentVersion?h({url:c+("/"===c[c.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(e){m.supportedTravelModes=
e.supportedTravelModes;m.defaultTravelMode=e.defaultTravelMode;a.resolve(m)},function(e){a.reject(e)}):h({url:c.substring(0,c.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(e){e.owningSystemUrl?(c=e.owningSystemUrl,h({url:c+("/"===c[c.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(t){t&&t.helperServices&&t.helperServices.routingUtilities&&t.helperServices.routingUtilities.url?q(t.helperServices.routingUtilities.url):
a.resolve(m)},function(t){a.reject(t)})):a.resolve(m)},function(e){a.reject(e)})},function(l){a.reject(l)})}else a.reject("NA Task has no URL specified.");a.then(b.hitch(this,function(l){this._sd=l}),b.hitch(this,function(){this._sd=null}));return a.promise},getOwningSystemUrl:function(){var f=new p;if(this._url&&this._url.orig){var d=this._url.orig;h({url:d.substring(0,d.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(a){f.resolve(a.owningSystemUrl)})}else f.resolve(void 0);
return f.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),function(k,g,p,b,h,f,d,a){k=k(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,
findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,
timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(c){var n={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&p.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||
p.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,
impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:a.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,
travelMode:"object"===typeof this.travelMode?p.toJson(this.travelMode):this.travelMode},m=this.stops;"esri.tasks.FeatureSet"===m.declaredClass&&0<m.features.length?n.stops=p.toJson({type:"features",features:d._encodeGraphics(m.features,c&&c["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===m.declaredClass?n.stops=m:"esri.tasks.DataFile"===m.declaredClass&&(n.stops=p.toJson({type:"features",url:m.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));
if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":n.directionsOutputType="esriDOTComplete";break;case "complete-no-events":n.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":n.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":n.directionsOutputType="esriDOTStandard";break;case "summary-only":n.directionsOutputType="esriDOTSummaryOnly";break;default:n.directionsOutputType=this.directionsOutputType}m=function(q,
l){return q?"esri.tasks.FeatureSet"===q.declaredClass?0<q.features.length?p.toJson({type:"features",features:d._encodeGraphics(q.features,c&&c[l])}):null:"esri.tasks.DataLayer"===q.declaredClass?q:"esri.tasks.DataFile"===q.declaredClass?p.toJson({type:"features",url:q.url}):p.toJson(q):null};this.barriers&&(n.barriers=m(this.barriers,"barriers.features"));this.polygonBarriers&&(n.polygonBarriers=m(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(n.polylineBarriers=m(this.polylineBarriers,
"polylineBarriers.features"));return f.filter(n,function(q){if(null!==q)return!0})}});g.setObject("tasks.RouteParameters",k,h);return k})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(k,g,p){g={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"};var b={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",
TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},h={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},f={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},d={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},a={LengthUnit:g,OutputLine:b,
UTurn:h,OutputPolygon:f,TravelDirection:d};k.setObject("tasks._NALengthUnit",g,p);k.setObject("tasks.NAOutputLine",b,p);k.setObject("tasks.NAUTurn",h,p);k.setObject("tasks.NAOutputPolygon",f,p);k.setObject("tasks.NATravelDirection",d,p);return a})},"esri/layers/wmts":function(){define(["./agscommon","./tiled","./WMTSLayer"],function(){return{}})},"esri/layers/tiled":function(){define(["./TiledMapServiceLayer","./TileInfo","./LOD","../geometry","../utils"],function(){return{}})},"esri/layers/WMTSLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff dojox/xml/parser ../kernel ../lang ../request ../urlUtils ../WKIDUnitConversion ../SpatialReference ../geometry/Point ../geometry/Extent ../geometry/webMercatorUtils ./TiledMapServiceLayer ./TileInfo ./WMTSLayerInfo dojo/query".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w){g=g([x],{declaredClass:"esri.layers.WMTSLayer",copyright:null,extent:null,tileUrl:null,spatialReference:null,tileInfo:null,constructor:function(u,v){this.version="1.0.0";this.tileUrl=this._url=u;this.serviceMode="RESTful";this._parseCapabilities=p.hitch(this,this._parseCapabilities);this._getCapabilitiesError=p.hitch(this,this._getCapabilitiesError);this._formatDictionary={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png",
"image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};v||(v={});if(v.serviceMode)if("KVP"===v.serviceMode||"RESTful"===v.serviceMode)this.serviceMode=v.serviceMode;else return;this.customParameters=v.customParameters;this.customLayerParameters=v.customLayerParameters;this.layerInfo=new w;v.layerInfo&&(this.layerInfo=v.layerInfo,this._identifier=v.layerInfo.identifier,this._tileMatrixSetId=v.layerInfo.tileMatrixSet,
v.layerInfo.format&&(this.format="image/"+v.layerInfo.format),this._style=v.layerInfo.style,this.title=v.layerInfo.title,this._dimension=v.layerInfo.dimension,this._dimension2=v.layerInfo.dimension2);v.resourceInfo?(this.version=v.resourceInfo.version,v.resourceInfo.getTileUrl&&(this._url=this.tileUrl=v.resourceInfo.getTileUrl),this.copyright=v.resourceInfo.copyright,this.layerInfos=v.resourceInfo.layerInfos,this.customParameters=v.resourceInfo.customParameters||this.customParameters,this.customLayerParameters=
v.resourceInfo.customLayerParameters||this.customLayerParameters,this._parseResourceInfo(),this.loaded=!0,this.onLoad(this)):this._getCapabilities()},setActiveLayer:function(u){this.setVisibleLayer(u)},setVisibleLayer:function(u){this._setActiveLayer(u);this.refresh(!0)},setCustomParameters:function(u,v){this.customParameters=u;this.customLayerParameters=v;this.refresh(!0)},getTileUrl:function(u,v,y){u=this._levelToLevelValue[u];u=this.resourceUrls&&0<this.resourceUrls.length?this.resourceUrls[v%
this.resourceUrls.length].template.replace(/\{Style\}/gi,this._style).replace(/\{TileMatrixSet\}/gi,this._tileMatrixSetId).replace(/\{TileMatrix\}/gi,u).replace(/\{TileRow\}/gi,v).replace(/\{TileCol\}/gi,y).replace(/\{dimensionValue\}/gi,this._dimension).replace(/\{dimensionValue2\}/gi,this._dimension2):this.UrlTemplate.replace(/\{level\}/gi,u).replace(/\{row\}/gi,v).replace(/\{col\}/gi,y);u=this._appendCustomLayerParameters(u);u=this.addTimestampToURL(u);return n.addProxy(u)},getTileUrlTemplate:function(u){var v=
u.identifier,y=u.tileMatrixSet,z=u.format,B=u.style,C=u.dimension,E=u.dimension2;v?u=b.filter(this.layers,function(G){return G.identifier===v})[0]:(u=this.layers[0],v=this.layers[0].identifier);if(u){if(!z)z=u.formats[0];else if(!(-1===z.indexOf("image/")&&-1<b.indexOf(u.formats,z))&&(-1===z.indexOf("image/")&&(z="image/"+z),-1===b.indexOf(u.formats,z))){this.onError(Error("The layer doesn't support the format of "+z));return}if(!B)B=u.styles[0];else if(-1===b.indexOf(u.styles,B)){this.onError(Error("The layer doesn't support the style of "+
B));return}if(!C&&u.dimensions)C=u.dimensions[0];else if(-1===b.indexOf(u.dimensions,C)){this.onError(Error("The layer doesn't support the dimension of "+C));return}if(!E&&u.dimensions2)E=u.dimensions2[0];else if(-1===b.indexOf(u.dimensions2,E)){this.onError(Error("The layer doesn't support the dimension of "+E));return}if(y){var D=b.filter(u.tileMatrixSetInfos,function(G){return G.tileMatrixSet===y})[0];if(!D){this.onError(Error("The tileMatrixSetId "+y+" is not supported by the layer of "+v));return}}else(D=
b.filter(u.tileMatrixSetInfos,function(G){return"GoogleMapsCompatible"===G.tileMatrixSet})[0])||(D=u.tileMatrixSetInfos[0]),y=D.tileMatrixSet;return this._getTileUrlTemplate(v,y,z,B,C,E)}this.onError(Error("couldn't find the layer "+v))},_getTileUrlTemplate:function(u,v,y,z,B,C){u||(u=this._identifier);v||(v=this._tileMatrixSetId);y||(y=this.format);z||""===z||(z=this._style);if(this.resourceUrls&&0<this.resourceUrls.length){var E=this.resourceUrls[0].template;E.indexOf(".xxx")===E.length-4&&(E=E.slice(0,
E.length-4));E=E.replace(/\{Style\}/gi,z);E=E.replace(/\{TileMatrixSet\}/gi,v);E=E.replace(/\{TileMatrix\}/gi,"{level}");E=E.replace(/\{TileRow\}/gi,"{row}");E=E.replace(/\{TileCol\}/gi,"{col}");E=E.replace(/\{dimensionValue\}/gi,B);return E=E.replace(/\{dimensionValue2\}/gi,C)}"KVP"===this.serviceMode?E=this._url+"SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+u+"\x26STYLE\x3d"+z+"\x26FORMAT\x3d"+y+"\x26TILEMATRIXSET\x3d"+v+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(B="",this._formatDictionary[y.toLowerCase()]&&(B=this._formatDictionary[y.toLowerCase()]),E=this._url+u+"/"+z+"/"+v+"/{level}/{row}/{col}"+B);return E},_parseResourceInfo:function(){var u=this.layerInfos,v;"KVP"===this.serviceMode&&(this._url+=-1<this._url.indexOf("?")?"":"?");for(v=0;v<u.length;v++)if(!(this._identifier&&u[v].identifier!==this._identifier||this.title&&u[v].title!==this.title||this._tileMatrixSetId&&u[v].tileMatrixSet!==this._tileMatrixSetId||this.format&&
"image/"+u[v].format!==this.format||this._style&&u[v].style!==this._style)){p.mixin(this,{description:u[v].description,tileInfo:u[v].tileInfo,spatialReference:u[v].tileInfo.spatialReference,fullExtent:u[v].fullExtent,initialExtent:u[v].initialExtent,_identifier:u[v].identifier,_tileMatrixSetId:u[v].tileMatrixSet,format:"image/"+u[v].format,_style:u[v].style});break}for(v=0;v<u.length;v++){var y=u[v].tileInfo;96!==y.dpi&&(b.forEach(y.lods,function(z){z.scale=96*z.scale/y.dpi}),y.dpi=96);b.forEach(y.lods,
function(z){z.resolution=this._getResolution(y.spatialReference.wkid,90.71428571428571*z.scale/96,u[v].tileMatrixSet)},this)}this._setActiveLayer();this.UrlTemplate=this._getTileUrlTemplate();this._levelToLevelValue=[];b.forEach(this.tileInfo.lods,function(z){this._levelToLevelValue[z.level]=z.levelValue?z.levelValue:z.level},this)},_getCapabilities:function(){var u;"KVP"===this.serviceMode?u=-1<this._url.indexOf("?")?this._url+"\x26request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:
this._url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===this.serviceMode&&(u=this._url+"/"+this.version+"/WMTSCapabilities.xml");u=this._appendCustomParameters(u);c({url:u,handleAs:"text",load:this._parseCapabilities,error:this._getCapabilitiesError})},_parseCapabilities:function(u){u=u.replace(/ows:/gi,"");u=f.parse(u);var v=k.query("Contents",u)[0];if(v){var y=k.query("OperationsMetadata",u)[0],z=k.query("[name\x3d'GetTile']",y)[0];y=this._url;z=k.query("Get",
z);var B,C=!1;for(B=0;B<z.length;B++){var E=k.query("Constraint",z[B])[0];if(!E||this._getTagWithChildTagValue("AllowedValues","Value",this.serviceMode,E)){y=z[B].attributes[0].nodeValue;C=!0;break}else if(!E||this._getTagWithChildTagValue("AllowedValues","Value","RESTful",E))var D=z[B].attributes[0].nodeValue;else if(!E||this._getTagWithChildTagValue("AllowedValues","Value","KVP",E))var G=z[B].attributes[0].nodeValue}C||("KVP"===this.serviceMode&&D?(y=D,this.serviceMode="RESTful"):"RESTful"===this.serviceMode&&
G&&(y=G,this.serviceMode="KVP"));-1===y.indexOf("/1.0.0/")&&"RESTful"===this.serviceMode&&(y+="/");"KVP"===this.serviceMode&&(y+=-1<y.indexOf("?")?"":"?");this._url=y;this.copyright=this._getTagValues("Capabilities\x3eServiceIdentification\x3eAccessConstraints",u)[0];D=k.query("Layer",v);var H,N=[];this.layers=[];b.forEach(D,function(O){H=this._getTagValues("Identifier",O)[0];N.push(H);this.layers.push(this._getWMTSLayerInfo(H,O,v))},this);this._setActiveLayer();this.loaded=!0;this.onLoad(this)}else this.onError(Error("The WMTS capabilities XML is not valid"))},
_setActiveLayer:function(u){u||(u={});u.identifier&&(this._identifier=u.identifier);u.tileMatrixSet&&(this._tileMatrixSetId=u.tileMatrixSet);u.format&&(this.format=u.format);u.style&&(this._style=u.style);u.dimension&&(this._dimension=u.dimension);u.dimension2&&(this._dimension2=u.dimension2);if(this.layers)if(this._identifier?u=b.filter(this.layers,function(y){return y.identifier===this._identifier},this)[0]:(u=this.layers[0],this._identifier=this.layers[0].identifier),u){if(this.format){if(-1===
this.format.indexOf("image/")&&(this.format="image/"+this.format),-1===b.indexOf(u.formats,this.format)){this.onError(Error("The layer doesn't support the format of "+this.format));return}}else this.format=u.formats[0],-1===this.format.indexOf("image/")&&(this.format="image/"+this.format);if(!this._style)this._style=u.styles[0];else if(-1===b.indexOf(u.styles,this._style)){this.onError(Error("The layer doesn't support the style of "+this._style));return}if(!this._dimension&&u.dimensions)this._dimension=
u.dimensions[0];else if(-1===b.indexOf(u.dimensions,this._dimension)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension));return}if(!this._dimension2&&u.dimensions2)this._dimension2=u.dimensions2[0];else if(-1===b.indexOf(u.dimensions2,this._dimension2)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension2));return}if(this._tileMatrixSetId){var v=b.filter(u.tileMatrixSetInfos,function(y){return y.tileMatrixSet===this._tileMatrixSetId},this)[0];
if(!v){this.onError(Error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier));return}}else(v=b.filter(u.tileMatrixSetInfos,function(y){return"GoogleMapsCompatible"===y.tileMatrixSet})[0])||(v=u.tileMatrixSetInfos[0]),this._tileMatrixSetId=v.tileMatrixSet;this.description=u.description;this.title=u.title;this.spatialReference=v.tileInfo.spatialReference;this.tileInfo=v.tileInfo;this._levelToLevelValue=[];b.forEach(this.tileInfo.lods,function(y){this._levelToLevelValue[y.level]=
y.levelValue?y.levelValue:y.level},this);102100===this.spatialReference.wkid||102113===this.spatialReference.wkid?this.fullExtent=this.initialExtent=t.geographicToWebMercator(u.gcsExtent):4326===this.spatialReference.wkid?this.fullExtent=this.initialExtent=u.gcsExtent:(this.fullExtent=v.fullExtent,this.initialExtent=v.initialExtent);this.resourceUrls=u.resourceUrls;this.UrlTemplate=this._getTileUrlTemplate();this.layerInfo={identifier:this._identifier,tileMatrixSet:this._tileMatrixSetId,format:this.format,
style:this._style,fullExtent:this.fullExtent,initialExtent:this.initialExtent,tileInfo:this.tileInfo,title:this.title,description:this.description}}else this.onError(Error("couldn't find the layer "+this._identifier))},_getWMTSLayerInfo:function(u,v,y){var z=this._getTagValues("Abstract",v)[0],B=this._getTagValues("Title",v)[0],C=k.query("WGS84BoundingBox",v)[0],E=C?this._getTagValues("LowerCorner",C)[0].split(" "):["-180","-90"],D=C?this._getTagValues("UpperCorner",C)[0].split(" "):["180","90"];
C=parseFloat(E[0]);E=parseFloat(E[1]);var G=parseFloat(D[0]);D=parseFloat(D[1]);C=new e(C,E,G,D,new q({wkid:4326}));D=this._getTagValues("Identifier",k.query("Style",v)[0]);var H=this._getTagValues("Identifier",k.query("Dimension",v)[0]),N=this._getTagValues("Default",k.query("Dimension",v)[0])||this._getTagValues("Value",k.query("Dimension",v)[0]),O=1<k.query("Dimension",v).length?this._getTagValues("Identifier",k.query("Dimension",v)[1]):[],S=1<k.query("Dimension",v).length?this._getTagValues("Default",
k.query("Dimension",v)[1])||this._getTagValues("Value",k.query("Dimension",v)[1]):[];E=this._getTagValues("Format",v);y=this._getLayerMatrixInfos(v,y);u={identifier:u,tileMatrixSetInfos:y,formats:E,styles:D,title:B,description:z,gcsExtent:C,dimensions:N,dimensions2:S};v=k.query("ResourceURL",v);var da=[],J;b.forEach(v,function(M){J=M.getAttribute("template");if(H&&N&&H[0]&&N[0])if(-1<J.indexOf("{"+H+"}"))J=J.replace("{"+H+"}","{dimensionValue}");else{var K=J.toLowerCase().indexOf("{"+H[0].toLowerCase()+
"}");-1<K&&(J=J.substring(0,K)+"{dimensionValue}"+J.substring(K+H[0].length+2))}O&&S&&O[0]&&S[0]&&(-1<J.indexOf("{"+O+"}")?J=J.replace("{"+O+"}","{dimensionValue2}"):(K=J.toLowerCase().indexOf("{"+O[0].toLowerCase()+"}"),-1<K&&(J=J.substring(0,K)+"{dimensionValue2}"+J.substring(K+O[0].length+2))));da.push({template:J,format:M.getAttribute("format"),resourceType:M.getAttribute("resourceType")})});da&&0<da.length&&(u.resourceUrls=da);return u},_getLayerMatrixInfos:function(u,v){var y=[],z=this._getTagValues("TileMatrixSet",
u);if(z&&0!==z.length)return b.forEach(z,function(B){B=this._getLayerMatrixInfo(B,u,v);y.push(B)},this),y},_getLayerMatrixInfo:function(u,v,y){var z=[];v=this._getTagWithChildTagValue("TileMatrixSetLink","TileMatrixSet",u,v);var B=this._getTagValues("TileMatrix",v),C=this._getTagWithChildTagValue("TileMatrixSet","Identifier",u,y),E=this._getTagValues("SupportedCRS",C)[0];var D=parseInt(E.split(":").pop(),10);if(900913==D||3857==D)D=102100;if(-1<E.toLowerCase().indexOf("crs84")||-1<E.toLowerCase().indexOf("crs:84")){D=
4326;var G=!0}else if(-1<E.toLowerCase().indexOf("crs83")||-1<E.toLowerCase().indexOf("crs:83"))D=4269,G=!0;else if(-1<E.toLowerCase().indexOf("crs27")||-1<E.toLowerCase().indexOf("crs:27"))D=4267,G=!0;var H=new q({wkid:D}),N=k.query("TileMatrix",C)[0];y=parseInt(this._getTagValues("TileWidth",N)[0],10);v=parseInt(this._getTagValues("TileHeight",N)[0],10);var O=this._getTagValues("TopLeftCorner",N)[0].split(" ");var S=O[0],da=O[1];1<S.split("E").length&&(O=S.split("E"),S=O[0]*Math.pow(10,O[1]));1<
da.split("E").length&&(O=da.split("E"),da=O[0]*Math.pow(10,O[1]));S=parseFloat(S);da=parseFloat(da);var J=G&&4326===D&&90===S&&-180===da;for(O=0;O<this._flippingAxisForWkids.length;O++)if(E.split(":").pop()>=this._flippingAxisForWkids[O][0]&&E.split(":").pop()<=this._flippingAxisForWkids[O][1]||4326===D&&(!G||J)){4326===D&&90<S&&(S="90");var M=new l(da,S,H);break}O===this._flippingAxisForWkids.length&&(M=new l(S,da,H));if(0===B.length)for(B=k.query("TileMatrix",C),O=0;O<B.length;O++)G=this._getLodFromTileMatrix(B[O],
D,O,u),z.push(G);else for(O=0;O<B.length;O++)G=this._getTagWithChildTagValue("TileMatrix","Identifier",B[O],C),G=this._getLodFromTileMatrix(G,D,O,u),z.push(G);D=k.query("BoundingBox",C)[0];if(D){var K=this._getTagValues("LowerCorner",D)[0].split(" ");var R=this._getTagValues("UpperCorner",D)[0].split(" ")}K&&1<K.length&&R&&1<R.length?(N=parseFloat(K[0]),D=parseFloat(K[1]),K=parseFloat(R[0]),R=parseFloat(R[1])):(K=this._getTagValues("MatrixWidth",N)[0],D=this._getTagValues("MatrixHeight",N)[0],N=M.x,
R=M.y,K=N+K*v*z[0].resolution,D=R-D*y*z[0].resolution);R=K=new e(N,D,K,R,H);M=new r({dpi:96,spatialReference:H,format:this.format,rows:y,cols:v,origin:M,lods:z});return{tileMatrixSet:u,fullExtent:R,initialExtent:K,tileInfo:M}},_getCapabilitiesError:function(u){this.onError(u)},_getLodFromTileMatrix:function(u,v,y,z){var B=this._getTagValues("Identifier",u)[0];u=this._getTagValues("ScaleDenominator",u)[0];1<u.split("E").length?(u=u.split("E"),u=u[0]*Math.pow(10,u[1])):u=parseFloat(u);v=this._getResolution(v,
u,z);return{level:y,levelValue:B,scale:1.058267716535433*u,resolution:v}},_getResolution:function(u,v,y){u=a.isDefined(m[u])?m.values[m[u]]:"default028mm"===y?6370997*Math.PI/180:6378137*Math.PI/180;return 7*v/25E3/u},_getTag:function(u,v){return(u=k.query(u,v))&&0<u.length?u[0]:null},_getTagValues:function(u,v){var y=[];u=u.split("\x3e");var z=k.query(u[0],v)[0];if(1<u.length){for(v=1;v<u.length-1;v++)z=k.query(u[v],z)[0];v=k.query(u[u.length-1],z)}else v=k.query(u[0],v);v&&0<v.length&&b.forEach(v,
function(B){9>h("ie")?y.push(B.childNodes.length?B.childNodes[0].nodeValue:""):y.push(B.textContent)});return y},_getAttributeValues:function(u,v,y){u=k.query(u,y);var z=[];u&&0<u.length&&b.forEach(u,function(B){z.push(B.getAttribute(v))});return z},_getTagWithChildTagValue:function(u,v,y,z){z=z.childNodes;var B;for(B=0;B<z.length;B++)if(-1<z[B].nodeName.indexOf(u)){if(9>h("ie")){if(a.isDefined(k.query(v,z[B])[0]))var C=k.query(v,z[B])[0].childNodes[0].nodeValue}else a.isDefined(k.query(v,z[B])[0])&&
(C=k.query(v,z[B])[0].textContent);if(C===y||y.split(":")&&C===y.split(":")[1])return z[B]}},_appendCustomParameters:function(u){var v;if(this.customParameters)for(v in this.customParameters)u+=(-1===u.indexOf("?")?"?":"\x26")+v+"\x3d"+encodeURIComponent(this.customParameters[v]);return u},_appendCustomLayerParameters:function(u){var v;if(this.customLayerParameters||this.customParameters){var y=p.clone(this.customParameters||{});p.mixin(y,this.customLayerParameters||{});for(v in y)u+=(-1===u.indexOf("?")?
"?":"\x26")+v+"\x3d"+encodeURIComponent(y[v])}return u},_flippingAxisForWkids:[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,
5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,
3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],
[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]]});p.setObject("layers.WMTSLayer",g,d);return g})},"esri/layers/WMTSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(k,g,p,b){k=k(null,{declaredClass:"esri.layers.WMTSLayerInfo",identifier:null,tileMatrixSet:null,format:null,style:null,tileInfo:null,title:null,fullExtent:null,initialExtent:null,description:null,dimension:null,constructor:function(h){h&&(this.title=h.title,this.tileMatrixSet=
h.tileMatrixSet,this.format=h.format,this.style=h.style,this.tileInfo=h.tileInfo,this.fullExtent=h.fullExtent,this.initialExtent=h.initialExtent,this.identifier=h.identifier,this.description=h.description,this.dimension=h.dimension)}});g.setObject("layers.WMTSLayerInfo",k,b);return k})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da,J,M,K,R,X,Q,W,I,T,Y,ca,V,Z,ja,la,ba,ka,qa,wa,za,Fa,Ba,Ca,ra,Va,Sa,Ra,Ta,Wa,La,$a,ya,Xa,bb,cb,ab){var Ua=K.getProtocolForWebResource(),db=H.createSubclass({_setSourcesAttr:function(A){A&&(A=A.map(function(F){F.locator&&null==F.locationType&&(F=p.mixin({locationType:"street"},F));return F}));this.inherited(arguments,[A])}});g=g("esri.dijit.Directions",[ra,a],{templateString:G,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(A,F){if(!A.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!F)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=D;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",
linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Ua+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Ua+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Ua+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new W(D.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new W(D.widgets.directions.maneuver,D.widgets.directions.waypoint),segmentInfoTemplate:new W(D.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new Ca("11px",Ca.STYLE_NORMAL,Ca.VARIANT_NORMAL,Ca.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new f([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new wa({url:k.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new wa({url:k.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new wa({url:k.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new wa({url:k.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new wa({url:k.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new wa({url:k.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new wa({url:k.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new wa({url:k.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new qa({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new qa({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],
width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new za).setColor(new f([20,89,127,.75])).setWidth(10).setCap(za.CAP_ROUND).setJoin(za.JOIN_ROUND),segmentSymbol:(new za).setColor(new f([255,255,255,1])).setWidth(6).setCap(za.CAP_ROUND).setJoin(za.JOIN_ROUND),barrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=A;this.defaults=p.mixin({},this.options,A,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(A=2;A<this.defaults.minStops;A++)this.defaults.stops.splice(0,0,"");this.domNode=F},postCreate:function(){this.inherited(arguments);this.own(r(this._activateButtonNode,d,p.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(r(this._lineBarrierButtonNode,d,p.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(r(this._addDestinationNode,
d,p.hitch(this,this._addStopButton)));this.own(r(this._optionsButtonNode,d,p.hitch(this,this._toggleOptionsMenu)));this.own(r(this._saveMenuButton,d,p.hitch(this,this._toggleSaveMenu)));this.own(r(this._saveButton,d,p.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(r(this._saveAsButton,d,p.hitch(this,function(){p.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(r(this._findOptimalOrderNode,d,p.hitch(this,this._toggleCheckbox)));
this.own(r(this._returnToStartNode,d,p.hitch(this,this._toggleCheckbox)));this.own(r(this._useTrafficNode,d,p.hitch(this,this._toggleCheckbox)));this.own(r(this._useMilesNode,d,p.hitch(this,this._toggleUnits)));this.own(r(this._useKilometersNode,d,p.hitch(this,this._toggleUnits)));this.own(r(this._getDirectionsButtonNode,d,p.hitch(this,this.getDirections)));this.own(r(this._clearDirectionsButtonNode,d,p.hitch(this,function(){this.clearDirections()})));var A=p.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(p.hitch(this,function(){y.set(this._startTimeMenu,"display","none")}),100)});this.own(r(this._startTimeButtonNode,d,p.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===y.get(this._startTimeMenu,"display")?y.set(this._startTimeMenu,"display","none"):(y.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(r(this._startTimeMenuLeaveNow,
"blur",A));this.own(r(this._startTimeMenuDepartAt,"blur",A));this.own(r(this._startTimeMenuNone,"blur",A));this.own(r(this._startTimeMenuLeaveNow,"mousedown",p.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(r(this._startTimeMenuDepartAt,"mousedown",p.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(r(this._startTimeMenuNone,"mousedown",p.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new za).setColor(new f([0,255,0,0])).setWidth(20).setCap(za.CAP_ROUND);this._stopLayer=new Y({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new Y({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new Y({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new Y({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new Y({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new Y({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var F=new R(null,this.waypointSymbol,{});A=p.hitch(this,function(){this._moveInProgress||this._solveInProgress||!F._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(F),clearTimeout(F._solveTimeout),F._solveTimeout=null,F.attributes.isWaypoint=!0,F._isStopIcon&&this.stopGraphics[F._index]&&(this._stopLayer.add(this.stopGraphics[F._index]),this._stopLayer.add(this.textGraphics[F._index])));F._showTooltip()});this._handle=p.mixin(F,{_isHandle:!0,_tooltip:N.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:A},this.map.container),_showTooltip:p.hitch(this,function(L){F._tooltip.style.display=!L||L instanceof MouseEvent?
"none":"inline";L&&(L="string"===typeof L?L:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(L)+"\x3c/table\x3e",F._tooltip.innerHTML!==L&&(F._tooltip.innerHTML=L))}),_isShown:p.hitch(this,function(){return-1<h.indexOf(this._stopLayer.graphics,F)}),_remove:A});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();N.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(p.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(p.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(A,F){return this._enqueue(function(){return this._modifyStopSequence(A,
F)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(A,F,L){return this._enqueue(function(){this.clearMessages();return this._removeStop(A,F,L)})},updateStops:function(A){return this._enqueue(function(){return this._updateStops(A)})},addStops:function(A,F){return this._enqueue(function(){return this._addStops(A,F)}).then(p.hitch(this,this.zoomToFullRoute))},addStop:function(A,
F){return this._enqueue(function(){return this._addStop(A,F)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(A,F,L){return this._enqueue(function(){return this._updateStop(A,F,L)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(A){this.routeParams.barriers=A;return this._getDirections().then(p.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(A){this.routeParams.polylineBarriers=A;return this._getDirections().then(p.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(A){this.routeParams.polygonBarriers=A;return this._getDirections().then(p.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(A){return this._enqueue(function(){return this._getDirections().then(p.hitch(this,function(){!0!==A&&this.zoomToFullRoute()}))})},selectSegment:function(A){if(!(!this.directions||!this.directions.features||
0>A||A>=this.directions.features.length))for(var F=C("[data-segment]",this._resultsNode),L=0;L<F.length;L++){var U=parseInt(B.get(F[L],"data-segment"),10);if(A===U&&F[L]!==this._focusedDirectionsItem){this._focusedDirectionsItem=F[L];this.centerAtSegmentStart(A);this.onSegmentSelect(this.directions.features[A]);F[L].focus();break}}},unhighlightSegment:function(A){var F=this._segmentGraphics;if(F&&(!this._focusedDirectionsItem||A)){for(A=0;A<F.length;A++)this._routeLayer.remove(F[A]);this._segmentGraphics=
[]}},highlightSegment:function(A,F){if(!(this._focusedDirectionsItem&&!F||A>=this.directions.features.length)){A=A||0;var L=p.hitch(this,function(ta){var sa=this.map.toMap({x:0,y:0});return this.map.toScreen(sa.offset(ta,0)).x}),U=p.hitch(this,function(ta){for(var sa=0,xa=0;xa<ta.length;xa++)for(var Da=1;Da<ta[xa].length;Da++){var Oa=ta[xa][Da-1],Ha=ta[xa][Da];sa+=L(Math.sqrt((Oa[0]-Ha[0])*(Oa[0]-Ha[0])+(Oa[1]-Ha[1])*(Oa[1]-Ha[1])))}return sa}),P=p.hitch(this,function(ta){var sa=this.map.toMap({x:0,
y:0});return this.map.toMap({x:ta,y:0}).x-sa.x}),aa=function(ta,sa,xa){sa=Math.max(1,sa);for(var Da=xa?ta[0].length-1:0,Oa=0,Ha,Ia,Aa,ua=[[ta[0][xa?Da:0]]];xa&&0<Da||!xa&&Da<ta[0].length-1;){Ia=ta[0][xa?Da-1:Da];Aa=ta[0][xa?Da:Da+1];if(Ha=L(Math.sqrt((Ia[0]-Aa[0])*(Ia[0]-Aa[0])+(Ia[1]-Aa[1])*(Ia[1]-Aa[1]))))if(Oa+Ha<sa)xa?ua[0].splice(0,0,Ia):ua[0].push(Aa),Oa+=Ha;else{sa=(sa-Oa)/Ha;xa?ua[0].splice(0,0,[Aa[0]-(Aa[0]-Ia[0])*sa,Aa[1]-(Aa[1]-Ia[1])*sa]):ua[0].push([Ia[0]+(Aa[0]-Ia[0])*sa,Ia[1]+(Aa[1]-
Ia[1])*sa]);break}Da+=xa?-1:1}return 0<Oa+Ha?ua:ta};F=this.get("directions").features[A];var ea=new ba(F.geometry),fa=40*Math.PI/180;p.mixin(F.attributes,{_index:A});if(A){var ha=aa(this.get("directions").features[A-1].geometry.paths,25,!0),ia="esriDMTStop"!==F.attributes.maneuverType?aa(ea.paths,25,!1):ha;ha=ia!==ha?[ha[0].concat(ia[0])]:ia;var ma=(new ba(ia)).getExtent();if(1<ia[0].length&&15<=L(Math.max(ma.getWidth(),ma.getHeight()))){aa=15*Math.cos(fa/2);U=15*Math.sin(fa/2);var oa=ia[0].length-
2;fa=ia[0][oa+1];for(ma=0;0<=oa&&!ma;){var na=ia[0][oa];ma=L(Math.sqrt((na[0]-fa[0])*(na[0]-fa[0])+(na[1]-fa[1])*(na[1]-fa[1])));oa--}22>ma&&(ia=ma+(22-ma)/3,oa=ma+2*(22-ma)/3,oa=[na[0]+oa/ma*(fa[0]-na[0]),na[1]+oa/ma*(fa[1]-na[1])],na=[fa[0]-ia/ma*(fa[0]-na[0]),fa[1]-ia/ma*(fa[1]-na[1])],fa=oa,ma=22);aa/=ma;ia=[fa[0]-(fa[0]-na[0])*aa,fa[1]-(fa[1]-na[1])*aa];na[1]!==fa[1]?(aa=(fa[0]-na[0])/(fa[1]-na[1]),na=P(U/Math.sqrt(1+aa*aa)),P=aa*na):(na=0,P=P(U));Infinity===Math.abs(na)||Infinity===Math.abs(P)||
isNaN(na)||isNaN(P)||(ha[0].push(fa),ha[0].push([ia[0]-na,ia[1]+P]),ha[0].push([ia[0]+na,ia[1]-P]),ha[0].push(fa))}else ha=aa(ha,2*U(ia),!0);ea.paths=ha}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);P=p.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new f([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new R(F.geometry,P,F.attributes,this.get("segmentInfoTemplate")),
new R(ea,this.routeSymbol,F.attributes,this.get("segmentInfoTemplate")),new R(ea,this.segmentSymbol,F.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));F=p.hitch(this,function(ta){if(0<ta&&ta<this.directions.features.length){ta=this.directions.features[ta]._associatedFeaturesWithWaypoints;for(var sa=0;sa<ta.length;sa++)ta[sa]._associatedSnapFeature&&
ta[sa]._associatedSnapFeature.getDojoShape()&&ta[sa]._associatedSnapFeature.getDojoShape().moveToFront()}});F(A-1);F(A);this.onSegmentHighlight(this.directions.features[A])}},zoomToSegment:function(A){var F=new S;if(this.directions&&this.directions.features){var L=Math.max(0,Math.min(this.directions.features.length-1,A||0));this.map.setExtent(this.get("directions").features[L].geometry.getExtent(),!0).promise.always(p.hitch(this,function(){this.highlightSegment(L);F.resolve()}))}else F.reject(Error("No directions."));
return F.promise},centerAtSegmentStart:function(A){var F=new S;if(this.directions&&this.directions.features){var L=Math.max(0,Math.min(this.directions.features.length-1,A||0));var U=this.directions.features[L];this.map.centerAt(U.geometry.getPoint(0,0)).promise.always(p.hitch(this,function(){this.highlightSegment(L,!0);this._showSegmentPopup(U,L);F.resolve()}))}else F.reject(Error("No directions."));return F.promise},zoomToFullRoute:function(){var A=new S;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(A.resolve)):A.resolve();return A.promise},setListIcons:function(){var A,F=this._dnd.getAllNodes();for(A=0;A<F.length;A++){var L=C("."+this._css.stopIconClass,F[A])[0];L&&(L.innerHTML=this._getLetter(A));z.remove(F[A],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);L=this._getStopSymbol(this.stops[A]);
L===this.fromSymbol?z.add(F[A],this._css.stopOriginClass):L===this.toSymbol?z.add(F[A],this._css.stopDestinationClass):L===this.unreachedSymbol&&z.add(F[A],this._css.stopUnreachedClass)}A=C("[data-reverse-td]",this._dndNode)[0];N.destroy(A);this.get("showReverseStopsButton")&&N.create("td",{"data-reverse-td":"true",rowspan:F.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
D.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(U){U.stopPropagation()},onmouseout:function(U){U.stopPropagation()}},F[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var A=0;A<this.stopGraphics.length;A++)if(this.stopGraphics[A]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==A)){this._stopLayer.add(this.stopGraphics[A]);var F=this.stopGraphics[A].getDojoShape();F&&F.moveToFront();this._stopLayer.add(this.textGraphics[A]);
(F=this.textGraphics[A].getDojoShape())&&F.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var A=this.stops,F=function(fa){var ha={},ia;for(ia in fa)fa.hasOwnProperty(ia)&&0===ia.indexOf("Attr_")&&(ha[ia]=fa[ia]);return ha},L=0;L<A.length;L++){var U=A[L];if(U&&U.feature){var P=U.feature.attributes,aa=P?P.Status:void 0,ea=null;this._isStopAWaypoint(U)||
(ea=new Fa(this._getLetter(L),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&ea.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));ea=new R(U.feature.geometry,ea,{address:U.name},this.get("stopsInfoTemplate"));ea._isStopLabel=!0;ea._index=L;U=new R(U.feature.geometry,this._getStopSymbol(U),p.mixin({address:U.name,Status:void 0===aa?0:aa,CurbApproach:P&&P.CurbApproach?P.CurbApproach:null,TimeWindowStart:P&&P.TimeWindowStart?P.TimeWindowStart:
null,TimeWindowEnd:P&&P.TimeWindowEnd?P.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(U)},F(P)),this.get(this._isStopAWaypoint(U)?"waypointInfoTemplate":"stopsInfoTemplate"));U._isStopIcon=!0;U._index=L;this.stopGraphics[L]=U;this.textGraphics[L]=ea}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(A){return this._enqueue(function(){this.clearMessages();this._travelModeSelector.setValue(A);
return this._setTravelMode(A)})},getSupportedTravelModeNames:function(){var A=[],F=this.serviceDescription;if(F&&F.supportedTravelModes&&F.supportedTravelModes.length){F=F.supportedTravelModes;for(var L=0;L<F.length;L++)A.push(F[L].name)}return A},setDirectionsLengthUnits:function(){var A=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(A)})},setDirectionsLanguage:function(){var A=1===arguments.length?
arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(A)})},useMyCurrentLocation:function(A){this.clearMessages();return this._createLocateButton(this.geocoders[A],!0,!0)},loadRoute:function(A){return this._enqueue(p.hitch(this,function(){return this._loadRoute(A)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var A=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(p.hitch(this,function(){this.mapClickActive=!A;this.set("mapClickActive",A);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var A=this.get("mapClickActive"),F=p.hitch(this,function(L){for(var U=L?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],P=0;P<U.length;P++)for(var aa=U[P],ea=0;ea<aa.length;ea++){var fa=aa[ea].getDojoShape();fa&&fa[L?"moveToBack":"moveToFront"].call(fa)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),z.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();A?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=r(this.map,"click",p.hitch(this,function(L){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new R(L.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),z.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
z.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());F(!A);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(bb.FREEHAND_POLYLINE),z.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),z.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var A=this.get("map"),F=A.graphicsLayerIds.length-1;A.reorderLayer(this._routeLayer,F);A.reorderLayer(this._polygonBarriersLayer,F);A.reorderLayer(this._polylineBarriersLayer,F);A.reorderLayer(this._barriersLayer,F);A.reorderLayer(this._waypointsEventLayer,F);
A.reorderLayer(this._stopLayer,F)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(A){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var A=this._clearDirections(!0),F;if(this._watchEvents&&this._watchEvents.length)for(F=0;F<this._watchEvents.length;F++)this._watchEvents[F].unwatch();if(this._onEvents&&this._onEvents.length)for(F=0;F<this._onEvents.length;F++)this._onEvents[F].remove();
if(this._geocoderEvents)for(F=0;F<this._geocoderEvents.length;F++)this._geocoderEvents[F].value.unwatch(),this._geocoderEvents[F].blur.remove(),this._geocoderEvents[F].select.remove(),this._geocoderEvents[F].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return A},_getDirections:function(){var A=new S;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(p.hitch(this,function(F){this.stops=F;this._setStops();this._configureRoute().always(p.hitch(this,function(L){A.resolve(L)}))}),p.hitch(this,function(F){this.set("directions",null);this._clearRouteGraphics();A.reject(F);this.onDirectionsFinish(F)}))):this._clearDirections(!0).always(p.hitch(this,function(){this.createRouteSymbols();A.resolve()}));return A.promise},
_clearDirections:function(){var A=new S;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),A.resolve()):arguments.length?A.resolve():this._reset().then(A.resolve,A.reject):A.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return A.promise},_setTravelMode:function(A){var F=new S,L=this.serviceDescription,U=function(){F.resolve(A)};if(L&&L.supportedTravelModes&&L.supportedTravelModes.length){var P=L.supportedTravelModes,aa=!1;for(L=0;L<P.length;L++)if(P[L].name===A){aa=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==A?(this.routeParams.travelMode=P[L].impedanceAttributeName?P[L]:P[L].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(U)):U();this._travelModeSelector&&
this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=P[L].description);break}aa||F.reject(A)}else F.reject(A);return F.promise},_setDirectionsLengthUnits:function(A){this._clearDisplayBeforeSolve();var F=new S;z.remove(this._useMilesNode,this._css.stopsPressedButtonClass);z.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);A===X.KILOMETERS?z.add(this._useKilometersNode,this._css.stopsPressedButtonClass):A===X.MILES&&z.add(this._useMilesNode,this._css.stopsPressedButtonClass);
A===X.KILOMETERS||A===X.METERS||A===X.MILES||A===X.FEET||A===X.YARDS||A===X.NAUTICAL_MILES?(this.directionsLengthUnits=A,F.resolve(A)):F.reject(A);return F.promise},_setDirectionsLanguage:function(A){this._clearDisplayBeforeSolve();var F=new S;A=this._setDirectionsLanguageByLocale(A);this._solveAndZoom().always(function(){F.resolve(A)},F.reject);return F.promise},_showLoadingSpinner:function(A){void 0===A&&(A=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);A?(z.add(this._widgetContainer,
this._css.resultsLoadingClass),z.add(this._resultsNode,"esriRoutesContainerBusy")):(z.remove(this._widgetContainer,this._css.resultsLoadingClass),z.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(A,F){var L=new S;this._requestQueueTail||(this._requestQueueTail=new S,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(p.hitch(this,function(){try{p.mixin(this,{_incrementalSolveStopRange:null},F);var U=A.call(this);U&&"object"===typeof U&&U.hasOwnProperty("isFulfilled")?
U.then(p.hitch(this,function(P){L.resolve(P);this._showLoadingSpinner()}),p.hitch(this,function(P){L.reject(P);this._showLoadingSpinner()})):(L.resolve(U),this._showLoadingSpinner())}catch(P){L.reject(P),this._showLoadingSpinner()}}));this._requestQueueTail=L;this._showLoadingSpinner();return L.promise},_createDnD:function(){this._dnd=new da(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){N.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&
this._restoreMapTimeExtent(),this._useTrafficItemNode.title=D.widgets.directions.trafficLabelLive,z.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var A=this,F=function(){this._keepDirections||A._clearDisplayBeforeSolve();this._keepDirections=!1},L=p.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),U=p.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()});this._departAtTime=new q({required:!0,value:new Date,
onChange:F,onFocus:L,onBlur:U},this._departAtTimeContainer);this._departAtDate=new m({required:!0,value:new Date,onChange:F,onFocus:L,onBlur:U,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(A,F,L){if(isNaN(L))this.startTime="now"===L?L:"none";else{F=L instanceof Date?L:new Date(L);L=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;var U=6E4*-F.getTimezoneOffset();F=new Date(F-U+(L&&L.arriveTimeUTC?
L.ETA-L.arriveTimeUTC:U));this._departAtTime._keepDirections=!A;this._departAtDate._keepDirections=!A;this._departAtTime.setValue(F);this._departAtDate.setValue(F)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var A=this._getImpedanceAttribute();A=this._isTimeUnits(A?A.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!A;z[A?"remove":"add"].apply(this,[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);
z[A?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);A||this.set("startTime","now")},_usingAGOL:function(A){A||(A=this.routeTaskUrl);return-1<A.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var A={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=p.mixin({maxResults:1,
locationToAddressDistance:100},this.defaults.searchOptions,A)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var A="EN-US"===b.locale.toUpperCase()?X.MILES:X.KILOMETERS;this.defaults.directionsLengthUnits?A=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(A=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",A)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&
!this.trafficLayer&&(this.trafficLayer=new T(Ua+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(A,F){this.canModifyStops||this.canModifyWaypoints||
this.set("mapClickActive",!1);F||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(A,F){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);F||this.canModifyStops||!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?
(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,z.remove(this._startTimeButtonNodeContainer,"departAtButton"),z.remove(this._departAtContainer,"departAtContainerVisible")):(z.add(this._startTimeButtonNodeContainer,"departAtButton"),z.add(this._departAtContainer,"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();
this.set(this.defaults);this.routeLayer=p.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(A){var F=new S;A?this.get("loaded")?this._reset().then(p.hitch(this,function(){this._addStops(A).then(F.resolve,F.reject)}),F.reject):this._addStops(A).then(F.resolve,F.reject):F.reject();return F.promise},_removeStop:function(A,
F,L,U){var P=new S,aa=p.hitch(this,function(fa){this.stops.splice(fa,1);var ha=this._dnd.getAllNodes()[fa],ia=this.get("geocoders");this._geocoderEvents[ha.id]&&(this._geocoderEvents[ha.id].blur.remove(),this._geocoderEvents[ha.id].select.remove(),this._geocoderEvents[ha.id].suggest.remove(),this._geocoderEvents[ha.id].value.unwatch());ia[fa].destroy();ia.splice(fa,1);this.set("geocoders",ia);N.destroy(ha);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();
this._sortGeocoders()});if(0>A||A>=this.stops.length||void 0===A)A=this.stops.length-1;var ea=!1;for(U=this.stopGraphics[A]&&this._isStopAWaypoint(this.stops[A])||U;!ea;)aa(A),U?ea=!0:(A-=0>=A||A<this.stops.length&&this._isStopAWaypoint(this.stops[A])?0:1,ea=!this._isStopAWaypoint(this.stops[A]));for(;this.stops.length-this._getWaypointCount()<this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();L?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),
this.createRouteSymbols(),P.resolve()):this._solveAndZoom(F).then(P.resolve,P.reject);return P.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(A,F){var L=new S,U=[],P=this.autoSolve;this.autoSolve=!1;void 0===F&&(F=this._getStopCount());for(var aa=0;aa<Math.min(A.length,this.maxStops-this._getStopCount());aa++){var ea=new S;this._addStop(A[aa],F+aa,!0).always(ea.resolve);U.push(ea)}O(U).always(p.hitch(this,
function(){this.autoSolve=P;this._getDirections().always(function(){L.resolve(A)})}));return L.promise},_addStop:function(A,F,L){var U=new S;this._checkMaxStops();this.maxStopsReached?(this._showMessage(D.widgets.directions.error.maximumStops),U.reject(Error(D.widgets.directions.error.maximumStops))):(void 0===A&&void 0===F&&(F=this.stops.length),A instanceof R&&A.attributes&&A.attributes.isWaypoint&&(!F||F===this.stops.length||2>this._getStopCount())&&!L?(this._showMessage(D.widgets.directions.error.waypointShouldBeInBetweenStops),
U.reject(Error(D.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(A).then(p.hitch(this,function(P){this._isStopAWaypoint(P)&&P&&P.feature&&(P.feature.attributes=p.mixin({},P.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(P,F);this.autoSolve&&""!==P.name?this._getDirections().always(function(){U.resolve(P,F)}):U.resolve(P,F)}),p.hitch(this,function(P){U.reject(P)})));return U.promise},_removeEmptyStops:function(){for(var A=0,F=this.stops.length-this._getWaypointCount()-
this.minStops;A<this.stops.length&&0<F;)this.stops[A]&&this.stops[A].name?A++:(this._removeStop(A,!0,!0,!0),F--,this._moveInProgress&&this._handle._index>=A&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(A,F,L){if(A.feature.geometry&&-1<L){var U={address:A.name};this.stopGraphics[L]&&(p.mixin(this.stopGraphics[L].attributes,U),this.stopGraphics[L].setGeometry(F));this.textGraphics[L]&&(p.mixin(this.textGraphics[L].attributes,U),this.textGraphics[L].setGeometry(F));
this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(U=this.geocoders[L])&&U.inputNode&&(U.value=A.name,U.inputNode.value=A.name);p.mixin(A.feature.attributes,this.stops[L].feature.attributes);this.stops[L]=A;this.stops[L].feature.setGeometry(F);this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(A,F){var L;if(void 0===F)for(L=0;L<this.geocoders.length;L++){if(!this.geocoders[L].get("value")){var U=this.geocoders[L];
break}}else L=F,this.geocoders[L]&&!this.geocoders[L].get("value")&&(U=this.geocoders[L]);!U||void 0!==F&&F!==L||this._isStopAWaypoint(A)?(void 0===F&&(F=this.geocoders.length),this.stops.splice(F,0,A),this._createGeocoder(A,F)):(this.stops[L]=A,U.set("value",A.name),U._stopReference=A);this._optionsMenu()},_createGeocoder:function(A,F){var L=this._dnd.getAllNodes(),U=!1,P=!1,aa=L.length;L[F]?(P=L[F],U=!0):U=P=!1;var ea=p.hitch(this,function(ma,oa){var na=oa?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,
ta=oa?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;z.replace(ma.children[0],na,ta);2<this.geocoders.length&&(na=oa?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,ta=oa?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,z.replace(ma.children[3].children[0],na,ta))}),fa=N.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(A)?"display:none;":"",onmouseover:function(){ea(this,!0)},onmouseout:function(){ea(this,!1)}});N.create("td",
{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},fa);L=N.create("td",{className:this._css.stopIconColumnClass},fa);N.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(aa),"data-center-at":"true"},L);aa=N.create("td",{className:this._css.esriStopGeocoderColumnClass},fa);aa=N.create("div",{},aa);L=N.create("td",{className:this._css.stopIconRemoveColumnClass},fa);N.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},
L);this._dnd.insertNodes(!1,[fa],U,P);U=p.mixin({},this.get("searchOptions"),{value:A.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var ha=new db(U,aa),ia=p.hitch(this,function(ma,oa){this._enqueue(function(){if(oa!==ma&&ha._stopReference&&ha._stopReference.name!==oa){var na=h.indexOf(this.stops,ha._stopReference);this.stops[na]={name:oa};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(na));this._setStops();this._clearDisplayBeforeSolve();
this._clearDisplayAfterSolve();this.createRouteSymbols()}})});ha._tr=fa;ha._stopReference=A;ha.startup();this.geocoders.splice(F,0,ha);this._geocoderEvents[fa.id]={blur:ha.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&this.search()}),select:ha.on("select-result",p.hitch(this,function(ma){var oa=!0;if(ma&&(ma.results||ma.result)){var na=this._dnd.getAllNodes();na=h.indexOf(na,fa);var ta=ha.value,sa=ma.results&&ma.results.results&&ma.results.results.length?
ma.results.results[0]:ma.result;sa?(sa.name=ta,this.stops[na]=this._toPointGeometry(sa),this.geocoders[na]._stopReference=this.stops[na],ia("",ta)):(this.removeStop(na),this.set("directions",null),this._showMessage(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",ma.target.get("value"))),this._clearRouteGraphics(),oa=!1);oa&&this.getDirections()}})),suggest:ha.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var ma=C("LI[role\x3d'menuitem']",this.suggestionsNode),
oa=0;oa<ma.length;oa++)B.set(ma[oa],"tabindex",-1);else this._hideSuggestionsMenu()}),value:ha.watch("value",function(ma,oa,na){ia(oa,na)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var A=0;A<this.geocoders.length;A++)if(this.geocoders[A].inputNode===document.activeElement){this.geocoders[A]._hideSuggestionsMenu();this.geocoders[A].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&
this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(A){A&&", , "===A.name&&(A.name=A.feature&&A.feature.attributes&&A.feature.attributes.Match_addr?A.feature.attributes.Match_addr+("POI"===A.feature.attributes.Addr_type&&A.feature.attributes.City&&-1===A.feature.attributes.Match_addr.indexOf(A.feature.attributes.City)?", "+A.feature.attributes.City:""):"");return A},_toPointGeometry:function(A){var F=A.feature.geometry;F&&(F.getCentroid?A.feature.geometry=F.getCentroid():F.getExtent&&
(F=F.getExtent())&&(A.feature.geometry=F.getCenter()));return A},_removeLocateButtonVisibilityEvents:function(){for(var A=0;A<this.geocoders.length;A++){var F=this.geocoders[A];F._onMouseEnter&&F._onMouseEnter.remove();F._onMouseOut&&F._onMouseOut.remove();F._onKeyPress&&F._onKeyPress.remove();F._locateButton&&(F._locateButton._onMouseEnter&&F._locateButton._onMouseEnter.remove(),F._locateButton._onMouseOut&&F._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();
for(var A=this,F=function(ha){ha instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;A._createLocateButton(this._geocoder,!0)},L=function(ha){ha instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(p.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||A._destroyLocateButton(this._locateButton)}),400)},U=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);
this._destroyTimeout=setTimeout(p.hitch(this,function(){""===this.value?A._createLocateButton(this._geocoder,!0):A._destroyLocateButton(this._locateButton)}),400)},P=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},aa=function(){this._geocoder._lbShown_lb=!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(p.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||A._destroyLocateButton(this._geocoder.inputNode._locateButton)}),
400)},ea=0;ea<this.geocoders.length;ea++){var fa=this.geocoders[ea];fa&&fa.inputNode&&(fa.inputNode._geocoder=fa,fa._onMouseEnter=r(fa.inputNode,w.enter,F),fa._onMouseOut=r(fa.inputNode,[w.leave,"blur"],L),fa._onKeyPress=r(fa.inputNode,"keydown",U),fa.inputNode._locateButton&&(fa=fa.inputNode._locateButton,fa._onMouseEnter=r(fa.domNode,w.enter,P),fa._onMouseOut=r(fa.domNode,w.leave,aa)))}},_createLocateButton:function(A,F,L){var U=new S;A.inputNode._locateButton&&A.inputNode._locateButton._locating?
U.resolve():k(["./LocateButton"],p.hitch(this,function(P){this._destroyLocateButton(A.inputNode._locateButton);if(A&&!this._solveInProgress){var aa=N.create("div",{},A.domNode);z.add(A.domNode,this._css.stopsInnerGeocoderClass);var ea=new P({map:this.map,highlightLocation:!1,centerAt:!1,setScale:!1,useTracking:!1},aa);ea.startup();A.inputNode._locateButton=ea;ea.domNode._geocoder=A;this._setLocateButtonVisibilityEvents();P=p.hitch(this,function(){ea._locating=!0;A.set("value","");A.inputNode.placeholder=
D.widgets.directions.retrievingMyLocation.toUpperCase()});ea._onBeforeLocate=r(ea._locateNode,d,P);ea._onLocate=r(ea,"locate",p.hitch(this,function(fa){ea._locating=!1;fa.graphic?(F&&this._destroyLocateButton(A.inputNode._locateButton),this.updateStop(new R(fa.graphic.geometry),h.indexOf(this.geocoders,A)).then(p.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){U.resolve(fa)}):U.resolve(fa)}))):(A.set("value",""),A.inputNode.placeholder=D.widgets.directions.myLocationError.toUpperCase(),
U.reject(fa.error))}));L?(P(),ea.locate().then(null,U.reject)):U.resolve()}else U.resolve()}));return U.promise},_destroyLocateButton:function(A){if(A){var F=A.domNode._geocoder;clearTimeout(F._destroyTimeout);A._locating?F._destroyTimeout=setTimeout(p.hitch(this,function(){F._lbShown_lb||F._lbShown_f||this._destroyLocateButton(A)}),100):(A.clear(),A._onBeforeLocate.remove(),A._onLocate.remove(),A._onMouseEnter&&A._onMouseEnter.remove(),A._onMouseOut&&A._onMouseOut.remove(),A.destroy(),F.inputNode&&
(F.inputNode._locateButton=null,F._setPlaceholder(F.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(p.hitch(this,function(A,F){for(var L,U,P=0;P<this.get("geocoders").length;P++)this.geocoders[P]._stopReference===A?L=P:this.geocoders[P]._stopReference===F&&(U=P);return L>U?1:U>L?-1:0})),this._setStops())},_getCandidate:function(A){var F=new S,L=typeof A;A?"object"===L&&A.hasOwnProperty("feature")&&A.hasOwnProperty("name")?(A.feature.attributes&&void 0!==A.feature.attributes.displayName&&
!this._isStopAWaypoint(A)&&(A.name=A.feature.attributes.displayName,A.feature.attributes.Name=this._userDefinedStopName),A.name=this._isStopAWaypoint(A)?this._waypointName:String(A.name),"point"!==A.feature.geometry.type&&(A.feature.geometry=new ja([A.feature.geometry.x,A.feature.geometry.y],this.map.spatialReference)),F.resolve(A)):"object"===L&&A.hasOwnProperty("address")&&A.hasOwnProperty("location")?(A=this._globalGeocoder._hydrateResult(A),F.resolve(A)):"object"!==L||!A.hasOwnProperty("name")||
null!==A.name&&""!==A.name?A instanceof R&&A.attributes&&(void 0!==A.attributes.Name||A.attributes.isWaypoint)?(L=this._addStopWrapperToGraphic(A,A.attributes.isWaypoint?this._waypointName:String(A.attributes.Name)),String(A.attributes.Name)&&(L.feature.attributes.Name=this._userDefinedStopName),F.resolve(L)):("object"===L&&A.hasOwnProperty("name")&&(A=String(A.name)),this._reverseGeocode(A).then(F.resolve,F.reject)):F.resolve(p.clone(this._emptyStop)):F.resolve(p.clone(this._emptyStop));return F.promise},
_reverseGeocode:function(A){var F=new S,L,U=A.geometry?A.geometry:A;if(this._globalGeocoder){var P=p.hitch(this,function(ha){var ia=new S,ma=500;if(this.map){var oa=this.map.toScreen(U);oa.x+=Z._calculateClickTolerance([ha]);this.map.spatialReference.isWebMercator()?(ma=Math.abs(this.map.toMap(oa).x-U.x),ia.resolve(ma)):4326===this.map.spatialReference.wkid?(ma=Math.abs(ca.geographicToWebMercator(this.map.toMap(oa)).x-ca.geographicToWebMercator(U).x),ia.resolve(ma)):this._geometryService&&(ha=new Wa,
ha.distanceUnit=Ta.UNIT_METER,ha.geometry1=U,ha.geometry2=this.map.toMap(oa),this._geometryService.distance(ha,function(na){ma=na;ia.resolve(ma)},function(){ia.resolve(ma)}))}return ia.promise}),aa=[],ea=this._globalGeocoder.sources,fa=function(){ea[L].featureLayer&&aa.push(P(ea[L].featureLayer).then(p.hitch(ea[L],function(ha){this.searchQueryParams=p.mixin(this.searchQueryParams,{distance:ha})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(L=0;L<ea.length;L++)fa();else L=this._globalGeocoder.activeSourceIndex,
fa();O(aa).always(p.hitch(this,function(){this._globalGeocoder.search(U).then(p.hitch(this,function(ha){var ia=!1;if(ha){var ma=null;for(L=0;L<this._globalGeocoder.sources.length;L++)if(ha[L]&&ha[L].length){var oa=ha[L];break}if(oa.length&&(ia=!0,ma=oa[0],this._globalGeocoder.sources[L].featureLayer))for(ha=Number.POSITIVE_INFINITY,L=0;L<oa.length;L++){oa[L]=this._toPointGeometry(oa[L]);var na=V.geodesicLengths([new ba({paths:[[ca.xyToLngLat(U.x,U.y),ca.xyToLngLat(oa[L].feature.geometry.x,oa[L].feature.geometry.y)]],
spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];ha>na&&(ha=na,ma=oa[L])}(ma=this._decorateEmptyAGOLGeocoderResponse(ma))&&""!==ma.name&&null!==ma.name&&void 0!==ma.name?(ma.name=String(ma.name),isNaN(U.x)||isNaN(U.y)||this.map.spatialReference.wkid!==U.spatialReference.wkid?!ma.feature.geometry||isNaN(ma.feature.geometry.x)||isNaN(ma.feature.geometry.y)?(this._showMessage(D.widgets.directions.error.locator),F.reject(Error(D.widgets.directions.error.locator))):F.resolve(ma):
(ma.feature.geometry=U,F.resolve(ma))):ia=!1}ia||(A instanceof ja?A=new R(A):A instanceof Array&&(A=new R(new ja(A[0],A[1]))),A instanceof R?this._decorateUngeocodedStop(A).then(F.resolve,F.reject):(this._showMessage(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",A.toString())),F.reject(Error(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",A.toString())))))}))}))}else this._showMessage(D.widgets.directions.error.locatorUndefined),F.reject(Error(D.widgets.directions.error.locatorUndefined));
return F.promise},_updateStop:function(A,F,L){var U=new S;this.stops&&this.stops[F]?A instanceof R&&A.attributes&&A.attributes.isWaypoint&&(!F||F===this.stops.length-1||2>this._getStopCount())?(this._showMessage(D.widgets.directions.error.waypointShouldBeInBetweenStops),U.reject(Error(D.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(A).then(p.hitch(this,function(P){var aa=P.feature;aa=aa?aa.geometry:null;var ea=this.stops[F].feature;ea=ea?ea.geometry:null;aa=aa&&ea&&
(aa.x!==ea.x||aa.y!==ea.y)||!aa&&ea;this.stops[F]=P;this.geocoders[F]||this._createGeocoder(P,F);ea=this.geocoders[F];ea._stopReference=P;ea._tr.style.display=this._isStopAWaypoint(P)?"none":"";ea.value=P.name;ea.inputNode&&(ea.inputNode.value=P.name);aa&&this.autoSolve&&1<this._getStopCount()+this._getWaypointCount()||L?this._getDirections().then(U.resolve,U.reject):(this._setStops(),U.resolve(P))}),p.hitch(this,function(P){U.reject(P)})):(this._showMessage(D.widgets.directions.error.couldNotUpdateStop),
U.reject(Error(D.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return U.promise},_renderDirections:function(){var A=this.get("directions");if(this._resultsNode){var F='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';F+=this._renderDirectionsSummary(A);F+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';F+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';F+=this._renderDirectionsTable(A);F+="\x3cdiv class\x3d'esriPrintFooter'\x3e"+D.widgets.directions.printDisclaimer+
"\x3c/div\x3e";F+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=F);this._disconnectResults();(A=C("[data-segment]",this._resultsNode))&&A.length&&h.forEach(A,p.hitch(this,function(L){this._resultEvents.push(r(L,w.enter,p.hitch(this,function(){if(!this._focusedDirectionsItem){var U=parseInt(B.get(L,"data-segment"),10);this.highlightSegment(U)}})));this._resultEvents.push(r(L,"focusout",p.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(r(L,
w.leave,this.unhighlightSegment));this._resultEvents.push(r(L,"click, keydown",p.hitch(this,function(U){U&&("click"===U.type||"keydown"===U.type&&U.keyCode===t.ENTER)&&(this._focusedDirectionsItem!==L?this.selectSegment(parseInt(B.get(L,"data-segment"),10)):(L.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},_renderDirectionsSummary:function(A){var F="",L=p.hitch(this,function(){for(var ea={},fa=this._getDirectionsTimeAttribute()||{},ha=this._getTimeNeutralAttribute()||
{},ia=0,ma=0,oa=this.get("stops"),na=oa.length-1;0<=na;na--)if(null!==oa[na].feature.attributes.ArriveCurbApproach){ea=oa[na].feature.attributes;break}for(var ta in ea)ea.hasOwnProperty(ta)&&(ta==="Cumul_"+fa.name&&(ia=ea[ta]),ta==="Cumul_"+ha.name&&(ma=ea[ta]));ea="esriTrafficLabelHidden";oa=D.widgets.directions.noTraffic;na=A.totalTime-A.totalDriveTime;na=(ma-this._convertCostValue(na,fa.units,ha.units))/(ia-na||1);0<na&&.8>na?(ea="esriTrafficLabelHeavy",oa=D.widgets.directions.heavyTraffic):1===
na?(ea="esriTrafficLabelNone",oa=D.widgets.directions.noTraffic):1.25<na&&(ea="esriTrafficLabelLight",oa=D.widgets.directions.ligthTraffic);ha=this._formatTime(ma,!1,ha.units);return{label:oa,labelClass:ea,ratio:na,noTrafficCostStr:1!==na&&ha?ha+" "+D.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:ia,noTrafficCost:ma,timeAtt:fa}});if(A.totalLength||A.totalTime){L=L();var U=this._getImpedanceAttribute();F+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";
if(this._isTimeUnits(U.units))F+=this._formatTime(L.trafficCost,!0,L.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+D.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+D.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(L.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+L.labelClass+"'\x3e"+L.label+"\x3c/div\x3e"+L.noTrafficCostStr:"")+this._formatDistance(A.totalLength);
else{U=(U=D.widgets.directions.units[this.directionsLengthUnits])?U.name:"";var P=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,aa=this.directions.features[0].attributes;F+=E.format(A.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+U+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(L.noTrafficCost&&P?"\x3cdiv class\x3d'esriTrafficLabel "+L.labelClass+"'\x3e"+L.label+"\x3c/div\x3e"+L.noTrafficCostStr:"")+this._formatTime(A.totalTime)+" "+
("none"!==this.startTime&&L.noTrafficCost&&P?D.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(aa.arriveTimeUTC,aa.ETA):"")}F+="\x3c/div\x3e\x3c/div\x3e"}return F},_renderDirectionsTable:function(A){for(var F=0,L=0,U=0,P='\x3ctable summary\x3d"'+A.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',aa=0;aa<A.features.length;aa++){var ea=A.features[aa].attributes;"esriDMTDepart"===ea.maneuverType&&(L=U=0);U+=ea.length;L+=ea.time;F+=ea.time;P+=this._renderDirectionsItemTR(A.features[aa],
U,L,F)}return P+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(A,F,L,U){var P=this.directions,aa=P?h.indexOf(P.features,A):-1;U="";var ea=this._css.routeClass,fa=A._associatedStopWithReturnToStart&&A._associatedStopWithReturnToStart.attributes,ha=A.attributes;if(-1<aa){ha&&(ha.step=aa+1);ha.maneuverType&&(ea+=" "+ha.maneuverType);fa&&null===fa.ArriveCurbApproach&&null!==fa.DepartCurbApproach?ea+=" "+this._css.routeOriginClass:fa&&null!==fa.ArriveCurbApproach&&null===fa.DepartCurbApproach&&
(ea+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);U+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+ea+" "+this._css.routeZoomClass+'" data-segment\x3d"'+aa+'"\x3e';U+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';U+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';U+=this._getLetter(A._associatedStop);U=U+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');U+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';U+='\x3cdiv class\x3d"'+
this._css.routeTextClass+'"\x3e';A=(P.strings[aa]||[]).slice();if("esriDMTDepart"===ha.maneuverType||"esriDMTStop"===ha.maneuverType)for(P=0;P<this.stops.length;P++)this.stops[P]&&this.stops[P].name&&A.push({string:this.stops[P].name});if(A){ea=ha.text;for(P=0;P<A.length;P++)ea=this._boldText(ea,A[P].string);ha.formattedText=ea}else ha.formattedText=ha.text;if("esriDMTStop"===ha.maneuverType&&(F||L)||"esriDMTDepart"===ha.maneuverType&&0===aa)F=this._formatDistance(F-ha.length,!0),L=this._formatTime(L-
ha.time),aa=this._formatTime(ha.time),A=this._formatDistance(ha.length,!0),ha.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+F+(F&&L?" \x26middot; ":"")+L+(F||L?"\x3cbr\x3e":"")+(aa?D.widgets.directions.serviceTime+":\x26nbsp;"+aa:"")+(aa&&A?"\x3cbr\x3e":"")+(A?D.widgets.directions.serviceDistance+":\x26nbsp;"+A:"")+"\x3c/div\x3e";U+="\x3cstrong\x3e"+E.format(ha.step)+".\x3c/strong\x3e "+ha.formattedText;U+="\x3c/div\x3e";F=this._formatDistance(ha.length,!0);L=this._formatTime(ha.time);
"esriDMTStop"!==ha.maneuverType&&"esriDMTDepart"!==ha.maneuverType||!this.routeParams.startTime||-22091616E5===ha.ETA?F&&(U+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',U+=F,L&&(U+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+L),U+="\x3c/div\x3e"):U+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(ha.arriveTimeUTC,ha.ETA)+"\x3c/div\x3e";U+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return U},_toSpatiallyLocalTimeString:function(A,F){var L=new Date(F),U=
new Date(L.getTime()+6E4*L.getTimezoneOffset());U=b.date.locale.format(U,{selector:"time"});var P="";A?(F=(F-A)/1E3/60/60,A=Math.floor(F),F=60*(F-A),A=D.widgets.directions.GMT+(0>A?"":"+")+E.format(A,{pattern:"00"})+E.format(F,{pattern:"00"}),P=U+" "+A):P="now"===this.startTime?b.date.locale.format(L,{selector:"time"}):U;return P},_addStopWrapperToGraphic:function(A,F){return{extent:new la({xmin:A.geometry.x-.25,ymin:A.geometry.y-.25,xmax:A.geometry.x+.25,ymax:A.geometry.y+.25,spatialReference:A.geometry.spatialReference}),
feature:A,name:F}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var A=this.routeParams,F=A.polylineBarriers&&A.polylineBarriers.features||[],L=A.polygonBarriers&&A.polygonBarriers.features||[];h.forEach(A.barriers&&A.barriers.features||[],p.hitch(this,function(U){this._barriersLayer.add(U)}));h.forEach(F,p.hitch(this,function(U){this._polylineBarriersLayer.add(U)}));
h.forEach(L,p.hitch(this,function(U){this._polygonBarriersLayer.add(U)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(A){this._clearDisplayAfterSolve();var F=A.routeResults[0].directions,L=new S;if(F){this.set("solveResult",A);this.set("directions",F);var U=A.routeResults[0].stops,P,aa;if(U&&U.length){var ea=[];for(P=0;P<U.length;P++){var fa=U[P];fa.attributes.isWaypoint=fa.attributes.Name===this._waypointName||fa.attributes.isWaypoint;
fa=this._addStopWrapperToGraphic(fa,fa.attributes.Name);this.stops[P]&&this.stops[P].feature&&this.stops[P].feature.attributes&&this.stops[P].feature.attributes.Name===this._userDefinedStopName&&(fa.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===P?this._returnToStartStop=fa:ea.push(fa)}if(this.stops.length>ea.length)for(P=0;P<this.stops.length;P++)this.stops[P].feature||""!==this.stops[P].name||ea.splice(P,0,this._emptyStop);
this.stops=ea;for(P=0;P<this.stops.length;P++)this._updateStop(this.stops[P],P);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new R(F.mergedGeometry,this.get("routeSymbol")));U=[];ea=[];for(P=fa=0;P<F.featuresWithWaypoints.length;P++){var ha=F.featuresWithWaypoints[P];if("esriDMTDepart"===ha.attributes.maneuverType)for(aa=0;aa<this.stops.length;aa++)if(this.stops[aa].feature===ha._associatedStop){fa=aa+1;break}ha.setSymbol(this.get("routeSymbol"));this._routeLayer.add(ha);
U.push(ha);(aa=ha.getDojoShape())&&aa.moveToBack();aa=new R(ha.geometry,this._symbolEventPaddingDirections,ha.attributes);aa._nextStopIndex=fa-.5;aa._isSnapFeature=!0;ha._associatedSnapFeature=aa;this._waypointsEventLayer.add(aa);"esriDMTDepart"!==ha.attributes.maneuverType&&(aa=ha.geometry.getPoint(0,0))&&(aa=new R(aa,this.maneuverSymbol),aa._directionsFeature=ha._associatedFeatureNoWaypoints,ea.push(aa),this._waypointsEventLayer.add(ea[ea.length-1]))}this.set("displayedRouteGraphics",U);this.set("displayedManeuverPointGraphics",
ea);this._renderDirections();for(P=0;P<this.stops.length;P++)if(this._isStopAWaypoint(this.stops[P])&&this._modifiedWaypointIndex===P){for(aa=0;aa<F.featuresWithWaypoints.length;aa++)if(U=F.featuresWithWaypoints[aa],U._associatedStop===this.stops[P].feature){if("esriDMTStop"===U.attributes.maneuverType||"esriDMTDepart"===U.attributes.maneuverType)this.stops[P].feature.geometry.x=U.geometry.paths[0][0][0],this.stops[P].feature.geometry.y=U.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=
null;break}y.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(A)}else A=A.routeResults[0].route,A.setSymbol(this.routeSymbol),this._routeLayer.add(A),this._incrementalRouteSegment=A;L.resolve();this._moveLayersToFront();this.createRouteSymbols();return L.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var A=0;A<this.geocoders.length;A++)this.geocoders[A]&&this.stops[A]&&(this.geocoders[A]._stopReference=this.stops[A])},_setStops:function(){this._setGeocodersStopReference();
this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(A){var F=[];if(A&&A.length){for(var L=0;L<A.length;L++)F.push(this._getCandidate(A[L]));return O(F)}A=new S;A.resolve([]);return A.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";y.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(A){if(A&&this.get("showSegmentPopup")&&this.get("map").infoWindow){var F=A.geometry.getPoint(0,0);A=new R(F,null,
A.attributes,this.get("segmentInfoTemplate"));var L=this.get("map").infoWindow;L.setFeatures([A]);L.show(F)}},_addStopButton:function(){this.addStop().then(p.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var A=this._dnd.getAllNodes();this.geocoders.sort(p.hitch(this,function(L,U){return L.domNode&&L.domNode.parentNode&&L.domNode.parentNode.parentNode&&U.domNode&&U.domNode.parentNode&&U.domNode.parentNode.parentNode?h.indexOf(A,
L.domNode.parentNode.parentNode)>h.indexOf(A,U.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var F=0;F<this.geocoders.length;F++)this.geocoders[F]&&this.geocoders[F].inputNode&&(this.geocoders[F].inputNode.title=D.widgets.directions.stopNoTitle+(F+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var A=0;A<this._resultEvents.length;A++)this._resultEvents[A]&&this._resultEvents[A].remove();
this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(A){var F="",L;for(L in A)if(0===L.indexOf("Total_")&&A.hasOwnProperty(L)){var U=this._getCostAttribute(L.substr(6));U&&(F+=this._isTimeUnits(U.units)?this._formatTime(A[L],!1,U.units):this._formatDistance(A[L],!0,U.units),F+=F?" \x26middot; ":"")}F&&(F=D.widgets.directions.toNearbyStops+": \x3cb\x3e"+F.substr(0,F.length-10)+"\x3c/b\x3e");return F},_formatTime:function(A,F,L){L||(L=(this._getDirectionsTimeAttribute()||{}).units);
var U="";L=Math.round(this._convertCostValue(A,L,"esriNAUMinutes"));A=Math.floor(L/60);L=Math.floor(L%60);F?U=E.format(A,{pattern:100>A?"00":"000"})+":"+E.format(L,{pattern:"00"}):(A&&(U+=A+" "+D.widgets.directions.time.hr+" "),U+=A||L?L+" "+D.widgets.directions.time.min:"");return U},_formatDistance:function(A,F,L){L||(L=this.directionsLengthUnits);var U=this.directionsLengthUnits,P=D.widgets.directions.units[U],aa=U.replace("esri","").toLowerCase();A=this._convertCostValue(A,L,U);P&&(aa=F?P.abbr:
P.name);return A?E.format(A,{locale:"root",places:2})+" "+aa:""},_projectToGeographic:function(A){var F=new S;if(!A)return F.reject("Directions:: 'geometry' is not defined.",{geometry:A}),F.promise;if(4326==A.spatialReference.wkid)return F.resolve(A),F.promise;if(!this._geometryService)return F.reject("Directions:: Geometry service is not defined."),F.promise;var L=new ab;L.outSR=new I(4326);L.geometries=[A];this._geometryService.project(L).then(function(U){F.resolve(U&&U[0])},F.reject);return F.promise},
_createToolbars:function(){this.editToolbar||(this.editToolbar=new Xa(this.map));this.drawToolbar||(this.drawToolbar=new bb(this.map),D.toolbars.draw.freehand=D.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=p.hitch(this,function(A){var F=new R(A.geometry,null,{BarrierType:0});this._projectToGeographic(A.geographicGeometry||A.geometry).then(p.hitch(this,function(L){1<V.geodesicLengths([L],X.METERS)[0]&&(this._polylineBarriersLayer.add(F),this.routeParams.polylineBarriers||
(this.routeParams.polylineBarriers=new Va),this.routeParams.polylineBarriers.features.push(F),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var A=new S;this._globalGeocoder=new db(this.get("searchOptions"));r.once(this._globalGeocoder,"load",A.resolve,A.reject);this._globalGeocoder.startup();return A.promise},_init:function(){var A=new S;
this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);y.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(A.resolve);else r.once(this.get("map"),"load",p.hitch(this,function(){this._configure().always(A.resolve)}));return A.promise},_setDefaultStops:function(){var A=new S;this.defaults.stops&&this.defaults.stops.length?this._updateStops(this.defaults.stops).then(p.hitch(this,function(){this._removeEmptyStops();A.resolve()}),
A.reject):A.resolve();return A.promise},_configure:function(){var A=new S;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(p.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var F=
[this._createRouteTask(),this._setDefaultStops()];O(F).then(p.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var L=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||b.locale.toLowerCase();this._setDirectionsLanguageByLocale(L);this._setupTravelModes().then(p.hitch(this,function(){this.set("loaded",!0);this.onLoad();A.resolve(!0)}),function(U){A.reject(U)})}),function(L){A.reject(L)})}),
function(F){A.reject(F)});this._naRouteSharing=null;return A.promise},_setDirectionsLanguageByLocale:function(A){var F=this.serviceDescription.directionsSupportedLanguages,L=function(P){if(F)for(var aa=0;aa<F.length;aa++)if(F[aa].toLowerCase().substr(0,2)===P)return F[aa];return null},U=L(A);U||(A=A.substr(0,2),U=L(A));this.directionsLanguage=U;return this.routeParams.directionsLanguage=U},_getStopSymbol:function(A,F){var L=A&&(A.feature&&A.feature.attributes||A.attributes),U=this.stopSymbol;L&&(U=
this._isStopAWaypoint(A)?this.waypointSymbol:void 0===L.Status||0===L.Status||6===L.Status?null===L.ArriveCurbApproach&&null!==L.DepartCurbApproach?this.get(F?"fromSymbolDrag":"fromSymbol"):null!==L.ArriveCurbApproach&&null===L.DepartCurbApproach?this.get(F?"toSymbolDrag":"toSymbol"):this.get(F?"stopSymbolDrag":"stopSymbol"):this.get(F?"unreachedSymbolDrag":"unreachedSymbol"));return U},_addTrafficLayer:function(){this.trafficLayer&&!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),
this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(A){A.target===this._useMilesNode?this.setDirectionsLengthUnits(X.MILES):A.target===this._useKilometersNode&&this.setDirectionsLengthUnits(X.KILOMETERS)},_toggleCheckbox:function(A){var F=B.get(A.target,"checked");A.target===this._findOptimalOrderNode?this.set("optimalRoute",F):A.target===this._useTrafficNode?this.set("traffic",F):A.target===this._returnToStartNode&&this.set("returnToStart",F)},_isStopLocated:function(A){return A&&
A.feature&&A.feature.attributes&&(!A.feature.attributes.Status||6===A.feature.attributes.Status)},_configureRouteOptions:function(){var A=this.get("routeParams"),F;this.get("directionsLengthUnits")?A.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",A.directionsLengthUnits);A.findBestSequence=this.get("optimalRoute");if(A.findBestSequence)for(A.preserveFirstStop=this._isStopLocated(this.stops[0]),A.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-
1])||this.returnToStart&&this._isStopLocated(this.stops[0]),F=0;F<this.stops.length;)this._isStopAWaypoint(this.stops[F])?this._removeStop(F,!0,!0):F++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(F=this.stops.length-1;0<F;)this._isStopAWaypoint(this.stops[F])&&this._removeStop(F,!0,!0),F--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion)if(A.useTimeWindows=!0,
"now"===this.startTime)A.timeWindowsAreUTC=!0,A.startTimeIsUTC=!0,A.startTime=new Date;else if("none"===this.startTime)A.startTime=null;else{A.timeWindowsAreUTC=!1;A.startTimeIsUTC=!1;var L=this._departAtTime,U=6E4*L.getValue().getTimezoneOffset();L=new Date(L.getValue().getTime()+this._departAtDate.getValue().getTime()-U);L=new Date(L.getTime()-6E4*L.getTimezoneOffset());A.startTime=L}else A.startTime=null,A.useTimeWindows=!1;L=this._getImpedanceAttribute();U=this._getTimeNeutralAttribute();var P=
this._getDirectionsTimeAttribute();F=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;U&&-1===h.indexOf(F,U.name)&&F.push(U.name);!this._isTimeUnits(L.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&P&&-1===h.indexOf(F,P.name)&&F.push(P.name);this.routeParams.accumulateAttributes=F;A.returnStops=!0;P=[];for(F=0;F<this.stopGraphics.length;F++)if(this.stopGraphics[F]&&(P.push(new R(this.stopGraphics[F].toJson())),F)){var aa=P[0].attributes,
ea=P[F].attributes;for(fa in ea)ea.hasOwnProperty(fa)&&!aa.hasOwnProperty(fa)&&(aa[fa]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var fa=new R(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(fa,fa.attributes.Name);P.push(fa)}else this._returnToStartStop=null;A.stops.features=P;if(U)for(F=0;F<P.length;F++)P[F].attributes["Attr_"+U.name]=this._convertCostValue(P[F].attributes["Attr_"+L.name],L.units,U.units);
this.set("routeParams",A)},_configureRoute:function(){var A=new S;A.promise.always(p.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var F=this._incrementalSolveStopRange;F.start<F.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(F.start,F.end+1):F.start>F.end&&(this.routeParams.stops.features=this.routeParams.stops.features.slice(F.start,this.routeParams.stops.features.length-
1).concat(this.routeParams.stops.features.slice(0,F.end+1)))}else this._incrementalSolveStopRange=null;var L={},U=this.routeParams.stops.features;for(F=0;F<U.length;F++){var P=U[F].attributes.address;var aa=(F===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:P)+"_"+this._stopSequence++;U[F].attributes.Name=aa;L[aa]=P;delete U[F].attributes.address;delete U[F].attributes.isWaypoint;delete U[F].attributes.Status}this._solveInProgress=!0;
var ea={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,p.hitch(this,function(fa){this._solveResultProcessing(fa,L,ea).then(A.resolve,A.reject)}),p.hitch(this,function(fa){p.mixin(this,ea);this._solveInProgress=!1;for(var ha=0;ha<this.stops.length;ha++)this.stops[ha].feature&&(this.stops[ha].feature.attributes=p.mixin(this.stops[ha].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();
this._routeTaskError(fa);A.reject(fa)}));return A.promise},_solveResultProcessing:function(A,F,L){var U=new S;p.mixin(this,L);this._solveInProgress=!1;L=A.routeResults[0];var P=L.directions;L=L.stops;if(P){this._solverMessages=A.messages;var aa=function(ma){for(var oa in F)if(ma&&0===P.routeName.indexOf(oa)||!ma&&0<P.routeName.indexOf(oa))return F[oa];return""};var ea=aa(!0);aa=aa(!1);P.routeName=(ea!==this._waypointName?ea:D.widgets.directions.waypoint)+" \u2014 "+(aa!==this._waypointName?aa:D.widgets.directions.waypoint);
for(ea=0;ea<P.features.length;ea++)if(aa=P.features[ea].attributes,"esriDMTDepart"===aa.maneuverType||"esriDMTStop"===aa.maneuverType)for(var fa in F)if(F.hasOwnProperty(fa)&&-1<aa.text.indexOf(fa)){aa.text=aa.text.replace(fa,F[fa]);for(var ha=0;ha<L.length;ha++){var ia=L[ha].attributes;if(ia.Name===fa){p.mixin(P.features[ea],{_associatedStop:L[this.returnToStart&&ha===L.length-1?0:ha],_associatedStopWithReturnToStart:L[ha]});if(!ia.ArriveTime&&!ia.ArriveTimeUTC&&aa.ETA&&aa.arriveTimeUTC){ia.ArriveTime=
aa.ETA;ia.ArriveTimeUTC=aa.arriveTimeUTC;ha=0;if(0==ea&&"esriDMTDepart"===aa.maneuverType||0<ea&&"esriDMTStop"===aa.maneuverType)ha=this._convertCostValue(aa.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");ia.DepartTime=ia.ArriveTime+ha;ia.DepartTimeUTC=ia.ArriveTimeUTC+ha}break}}}for(ea=0;ea<L.length;ea++)this._returnToStartStop&&L[ea].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=ea),L[ea].attributes.Name=F[L[ea].attributes.Name];
this._directionsPostprocessing(P);this.traffic&&this._updateMapTimeExtent()}this._showRoute(A).always(p.hitch(this,function(){this._incrementalSolveStopRange=null;U.resolve(A)}));return U.promise},_directionsPostprocessing:function(A){var F,L=function(aa,ea){var fa=A.features[aa]._associatedFeaturesWithWaypoints||[];fa.push(A.featuresWithWaypoints[ea]);A.features[aa]._associatedFeaturesWithWaypoints=fa;A.featuresWithWaypoints[ea]._associatedFeatureNoWaypoints=A.features[aa]};var U=p.hitch(this,function(aa){return"\x3cdiv class\x3d'"+
this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(aa._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});A.featuresWithWaypoints=[];for(F=0;F<A.features.length;F++){var P=new R(A.features[F].toJson());P.setInfoTemplate(new W({title:this._i18n.widgets.directions.maneuver,content:U}));A.featuresWithWaypoints.push(P);A.featuresWithWaypoints[F]._associatedStop=A.features[F]._associatedStop;A.featuresWithWaypoints[F]._associatedStopWithReturnToStart=A.features[F]._associatedStopWithReturnToStart}A.stringsWithWaypoints=
p.mixin([],A.strings);A.eventsWithWaypoints=p.mixin([],A.events);for(U=F=0;F<A.features.length;)A.features[F]._associatedStop&&A.features[F]._associatedStop.attributes.Name===this._waypointName?(A.features.splice(F,F?2:1),A.strings.splice(F,F?2:1),A.events.splice(F,F?2:1),F&&A.features[F]&&"esriDMTStraight"===A.features[F].attributes.maneuverType?(P=A.features.splice(F,1)[0],A.strings[F-1]=(A.strings[F-1]||[]).concat(A.strings.splice(F,1)[0]||[]),A.strings[F-1].length||(A.strings[F-1]=void 0),A.events[F-
1]=(A.events[F-1]||[]).concat(A.events.splice(F,1)[0]||[]),A.events[F-1].length||(A.events[F-1]=void 0),A.features[F-1].attributes.length+=P.attributes.length,A.features[F-1].attributes.time+=P.attributes.time,A.features[F-1].geometry.paths[0]=A.features[F-1].geometry.paths[0].concat(P.geometry.paths[0]),L(F-1,U++),L(F-1,U++),L(F-1,U++)):(F&&L(F-1,U++),F<A.features.length&&L(F,U++))):(L(F,U++),F++)},_boldText:function(A,F){try{var L=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+F.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,
"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");A=(" "+A+" ").replace(L,"\x3cstrong\x3e\x26nbsp;"+F+"\x26nbsp;\x3c/strong\x3e");A=A.trim()}catch(U){}return A},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var A=0;A<this.stopGraphics.length;A++)this._stopLayer.remove(this.stopGraphics[A]),this._stopLayer.remove(this.textGraphics[A]);this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var A=this.directions&&this.directions.features[0]&&
this.directions.features[0].attributes||{},F=(new Date).getTime();F="none"==this.startTime?F:A.arriveTimeUTC||F;this._useTrafficItemNode.title="none"!==this.startTime&&A.arriveTimeUTC?D.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(A.arriveTimeUTC,A.ETA):"";this._myTimeExtentUpdate=!0;A=new Date(F);this.map.setTimeExtent(new Q(A,A))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var A=
this.displayedRouteGraphics,F=this.displayedManeuverPointGraphics,L=this._routeLayer,U=this._waypointsEventLayer,P=0,aa=0,ea=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};A&&aa<A.length;){if(A[aa]._associatedStop)for(var fa=0;fa<this.stops.length;fa++)if(this.stops[fa].feature===A[aa]._associatedStop){P=fa;break}P>=ea.start&&P<ea.end||ea.start>=ea.end&&(P>=ea.start||P<ea.end)?(L.remove(A[aa]),A.splice(aa,1)):aa++}L.remove(this._incrementalRouteSegment);
this.set("displayedRouteGraphics",A?A:[]);F&&F.length&&h.forEach(F,function(ha){U.remove(ha)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var A=this.get("map").infoWindow;A&&(A.hide(),A.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();
this.clearMessages()},_getLetter:function(A){var F=this.alphabet,L="",U=function(ea){var fa="";"0123456789"===F||"1234567890"===F?fa=String(ea+1):(ea=ea||0,ea>=F.length&&(fa=U(Math.floor(ea/F.length)-1),ea%=F.length),fa+=F[ea]);return fa},P=A instanceof R?p.hitch(this,function(){for(var ea=this.get("returnToStart")?0:-1,fa=0;fa<this.stops.length;fa++)if(this.stops[fa].feature===A){ea=fa;break}return ea})():A;if(-1<P&&F&&F.length){F instanceof Array&&(F=F.toString().replace(/,/g,""));L=-1;for(var aa=
0;aa<=P;aa++)L+=this._isStopAWaypoint(this.stops[aa])?0:1;L=U(L)}return L},_solveAndZoom:function(A){if(this.autoSolve)return this._getDirections().then(p.hitch(this,function(){A||this.zoomToFullRoute()}));var F=new S;F.resolve();return F.promise},_setupEvents:function(){this._onEvents.push(r(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(r(this._dndNode,"[data-reverse-stops]:click, [data-reverse-stops]:keydown",p.hitch(this,function(P){P&&("click"===P.type||
"keydown"===P.type&&P.keyCode===t.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(r(this._printButton,"click, keydown",p.hitch(this,function(P){P&&("click"===P.type||"keydown"===P.type&&P.keyCode===t.ENTER)&&this._printDirections()})));this._onEvents.push(r(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",p.hitch(this,function(P){P&&("click"===P.type||"keydown"===P.type&&P.keyCode===t.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(r(this._dndNode,"[data-remove]:click, [data-remove]:keydown",
p.hitch(this,function(P){if(P&&("click"===P.type||"keydown"===P.type&&P.keyCode===t.ENTER)){var aa=C("[data-remove]",this._dndNode);P=h.indexOf(aa,P.target);this.removeStop(P)}})));this._onEvents.push(r(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",p.hitch(this,function(P){if(P&&("click"===P.type||"keydown"===P.type&&P.keyCode===t.ENTER)){var aa=C("[data-center-at]",this._dndNode);P=h.indexOf(aa,P.target);this.stops[P]&&this.stops[P].feature&&this.stops[P].feature.geometry&&this.map.centerAndZoom(this.stops[P].feature.geometry)}})));
this._onEvents.push(r(this.map,"zoom-end",p.hitch(this,function(){var P=this._segmentGraphics;P&&P[0]&&void 0!==P[0].attributes._index&&this.highlightSegment(P[0].attributes._index,!0)})));this._onEvents.push(r(this._dnd,"Drop",p.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var P,aa=!1,ea=[],fa=this._dnd.getAllNodes();for(P=0;P<this.geocoders.length;P++){var ha=h.indexOf(fa,this.geocoders[P]._tr);if(-1<ha&&P!==ha&&P!==ha-1){for(;0<ha&&this._isStopAWaypoint(this.stops[ha]);)ha--;
aa=!0;break}}aa&&(ea=this._markWPsForRemovalAfterUserChangedStopSequence(P,ha));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(ea);this.stops[ha].name&&this.getDirections()})));this._onEvents.push(r(this._dnd,"DndStart",p.hitch(this,function(){var P=C("body")[0];z.add(P,this._css.dndDragBodyClass);this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(r(this._dnd,"DndDrop, DndCancel",p.hitch(this,function(){var P=C("body")[0];z.remove(P,this._css.dndDragBodyClass);
this._setLocateButtonVisibilityEvents()})));var A=this._handle,F=p.hitch(this,function(P){var aa=p.hitch(this,function(fa,ha,ia,ma,oa){var na=A._isShown();A.setGeometry(fa);A._tooltip.style.left=P.screenPoint.x+"px";A._tooltip.style.top=P.screenPoint.y+"px";!na||A._index===ia&&A.attributes.isWaypoint===ma||(A._remove(),na=!1);A.setSymbol(ha);A._index=ia;A._isStopIcon=A._index===Math.floor(A._index);A.attributes.isWaypoint=ma;A._isStopIcon&&(A.attributes.address=this.stopGraphics[ia].attributes.address,
A.setInfoTemplate(this.stopGraphics[ia].infoTemplate));if(this.canModifyWaypoints||A._isStopIcon)na||(this._stopLayer.add(A),(fa=A.getDojoShape())&&fa[ma?"moveToBack":"moveToFront"].call(fa)),this.editToolbar.activate(Xa.MOVE,A);ma=ma?A._isStopIcon?D.widgets.directions.dragWaypoint:this.canModifyWaypoints?D.widgets.directions.dragRoute:"":D.widgets.directions.dragStop;A._showTooltip(oa||ma)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&
!A._solveTimeout)if(clearTimeout(A._removeTimeout),(P.graphic._isStopIcon||P.graphic._isStopLabel)&&!P.graphic.attributes.isWaypoint&&this.canModifyStops||P.graphic._isStopIcon&&P.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var ea=P.graphic._isStopLabel?this.stopGraphics[P.graphic._index]:P.graphic;aa(ea.geometry,this._getStopSymbol(this.stops[ea._index],!0),ea._index,!0===ea.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[ea._index]);this._stopLayer.remove(this.textGraphics[ea._index])}else if(P.graphic._isSnapFeature||
P.graphic._isHandle&&!P.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(P.screenPoint).then(p.hitch(this,function(fa){if(!this.maxStopsReached&&!this._moveInProgress&&fa){for(var ha=this.displayedManeuverPointGraphics,ia=null,ma=0;ma<ha.length;ma++)if(ha[ma].geometry.x===fa.x&&ha[ma].geometry.y===fa.y){ia=ha[ma]._directionsFeature;ha=h.indexOf(this.directions.features,ia);-1<ha&&this.highlightSegment(ha);break}aa(fa,
P.graphic._isHandle?A.symbol:this.waypointSymbol,P.graphic._isHandle?A._index:P.graphic._nextStopIndex,P.graphic._isHandle?A.attributes.isWaypoint:!0,ia)}}))}),L=p.hitch(this,function(){clearTimeout(A._removeTimeout);A._removeTimeout=setTimeout(A._remove,100);this.unhighlightSegment()}),U=p.hitch(this,function(P){if(this.barrierToolActive){P=P.graphic;var aa=this.routeParams,ea=aa.barriers?h.indexOf(aa.barriers.features,P):-1,fa=aa.polygonBarriers?h.indexOf(aa.polygonBarriers.features,P):-1,ha=aa.polylineBarriers?
h.indexOf(aa.polylineBarriers.features,P):-1;-1<ea&&aa.barriers.features.splice(ea,1);-1<fa&&aa.polygonBarriers.features.splice(fa,1);-1<ha&&aa.polylineBarriers.features.splice(ha,1);this._barriersLayer.remove(P);this._polygonBarriersLayer.remove(P);this._polylineBarriersLayer.remove(P);this._clearStopsStatusAttr();this.getDirections(!0)}});this._onEvents.push(this._waypointsEventLayer.on("mouse-move",F));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",L));this._onEvents.push(this._stopLayer.on("mouse-move",
F));this._onEvents.push(this._stopLayer.on("mouse-out",L));this._onEvents.push(this._barriersLayer.on("click",U));this._onEvents.push(this._polylineBarriersLayer.on("click",U));this._onEvents.push(this._polygonBarriersLayer.on("click",U));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",
this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",
p.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",p.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",p.hitch(this,function(){this._createGeometryTask()})));this._watchEvents.push(this.watch("routeParams",p.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",p.hitch(this,function(){this._setSearchOptions();
this._createGlobalGeocoder();var P=this.get("searchOptions").sources;if(P)for(var aa=0;aa<this.geocoders.length;aa++)this.geocoders[aa].set("sources",P)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",
this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));
this._watchEvents.push(this.watch("showPrintPage",function(){y.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){y.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var A=p.hitch(this,function(L){var U="";if((L=L.routeResults?L.routeResults[0]:null)&&L.route){L=L.route.attributes;var P=this.routeParams.travelMode;if(P){U+="\x3cb\x3e"+
P.name+"\x3c/b\x3e "+D.widgets.directions.toNearbyStops+": ";var aa=void 0!==L["Total_"+P.timeAttributeName]?this._formatTime(L["Total_"+P.timeAttributeName],!1,(this._getCostAttribute(P.timeAttributeName)||{}).units):"";U+=(void 0!==L["Total_"+P.distanceAttributeName]?this._formatDistance(L["Total_"+P.distanceAttributeName],!0,(this._getCostAttribute(P.distanceAttributeName)||{}).units):"")+(aa?" \x26middot; "+aa:"")}else U=this._formatArbitraryCostsForRouteTooltip(L)}this._handle._showTooltip(U)}),
F=p.hitch(this,function(L,U){var P=new S,aa=this._handle,ea=this.map.toScreen(aa._origPoint).offset(L.transform.dx+aa.symbol.xoffset,L.transform.dy+aa.symbol.yoffset);L.origMapPoint||(L.origMapPoint=this.map.toMap(ea));y.set(aa._tooltip,"left",ea.x+"px");y.set(aa._tooltip,"top",ea.y+"px");clearTimeout(aa._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())aa._solveTimeout=setTimeout(function(){F(L,U).always(P.resolve)},100);else if(aa._isStopIcon){ea=L.graphic._index;var fa=
this.stops[ea];(fa=fa?{name:fa.name,extent:fa.extent,feature:new R(fa.feature.toJson())}:null)?(fa.feature.setGeometry(L.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[ea])?ea:null,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+ea-1)%this.stops.length:Math.max(0,ea-1),end:this.returnToStart?(ea+1)%this.stops.length:Math.min(this.stops.length-1,ea+1)},this.updateStop(fa,ea,U).always(p.hitch(this,function(ha){aa._solveTimeout=null;ha.routeResults&&
A(ha);P.resolve()}))):P.resolve()}else P.resolve();return P.promise});this._onEvents.push(r(this.editToolbar,"graphic-click",p.hitch(this,function(L){if(L.graphic.attributes.isWaypoint)!L.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||(this._handle._remove(),this._moveInProgress=!0,this.removeStop(L.graphic._index,!0).always(p.hitch(this,function(){this._moveInProgress=!1})));else{var U=this.get("map").infoWindow;U&&(U.setFeatures([L.graphic]),U.show(L.graphic.geometry))}})));this._onEvents.push(r(this.editToolbar,
"graphic-move-start",p.hitch(this,function(L){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;L=L.graphic;L._origPoint=new ja(L.geometry.toJson());L._maxDeviation=0;L._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(r(this.editToolbar,"graphic-move-stop",p.hitch(this,function(L){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;
if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)F(L,!0).always(p.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var U=this.stops[L.graphic._index],P=(U&&U.feature&&U.feature.attributes&&U.feature.attributes.Name)===this._userDefinedStopName,aa=U&&U.name;this._reverseGeocode(new R(L.graphic.toJson())).then(p.hitch(this,
function(ea){P&&(ea.name=aa,ea.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(ea,ea.feature.geometry,L.graphic._index).always(p.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(r(this.editToolbar,"graphic-move",p.hitch(this,function(L){var U=this._handle,P=L.transform;P.dx&&P.dy&&(L.graphic._maxDeviation=Math.max(U._maxDeviation,Math.sqrt(P.dx*
P.dx+P.dy*P.dy)));10<U._maxDeviation&&(U._solveHasHappened=!0,L.graphic===U&&U.attributes.isWaypoint&&!U._isStopIcon?(this.set("optimalRoute",!1),U._index+=.5,U._isStopIcon=!0,L.graphic._stopIndex=U._index,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+U._index-1)%this.stops.length:Math.max(0,U._index-1),end:this.returnToStart?(U._index+1)%(this.stops.length+1):Math.min(this.stops.length,U._index+1)},this.addStop({name:this._waypointName,feature:new R(U.geometry,U.symbol,
{isWaypoint:!0,CurbApproach:3})},L.graphic._stopIndex)):((U=L.graphic.getDojoShape())&&U.moveToFront(),F(L)))})))},_isStopAWaypoint:function(A){return A&&A.feature&&A.feature.attributes&&A.feature.attributes.isWaypoint},_getStopCount:function(){var A=0,F;for(F=0;F<this.stops.length;F++)A+=!this._isStopAWaypoint(this.stops[F])&&this.stops[F].name?1:0;return A},_getWaypointCount:function(){var A=0,F;for(F=0;F<this.stops.length;F++)A+=this._isStopAWaypoint(this.stops[F])?1:0;return A},_decorateUngeocodedStop:function(A){var F=
new S,L=function(P,aa){F.resolve({name:void 0===P?D.widgets.directions.unlocatedStop:P.toFixed(6)+" "+aa.toFixed(6),feature:A})};if(A.geometry)if(A.geometry.spatialReference&&4326!==A.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var U=ca.xyToLngLat(A.geometry.x,A.geometry.y);L(U[0],U[1])}else this._geometryService?(U=new ab,U.outSR=new I(4326),U.geometries=[A.geometry],this._geometryService.project(U).then(p.hitch(this,function(P){P&&
P.length?L(P[0].x,P[0].y):L(A.geometry.x,A.geometry.y)}),p.hitch(this,function(){L()}))):L(A.geometry.x,A.geometry.y);else L(A.geometry.x,A.geometry.y);else L();return F.promise},_trafficLayerUpdate:function(A,F,L){A=this.get("map");F&&this._trafficLayerAdded&&(A.removeLayer(F),this._trafficLayerAdded=!1);L&&this.get("traffic")&&!this._trafficLayerAdded&&(A.addLayer(L),L.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(A){var F=D.widgets.directions.error.routeTask,L=A.details,U=function(P){return(res=
P.match(/(\d+)/))?": "+res[0]:"."};L&&1===L.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===L[0]?F=D.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===L[0]?F=D.widgets.directions.error.nonNAmTruckingMode:0===L[0].indexOf("The number of input locations loaded into Barriers")?F=D.widgets.directions.error.tooManyBarriers+U(L[0]):0===L[0].indexOf("The number of input locations loaded into PolygonBarriers")?
F=D.widgets.directions.error.tooManyPolygonBarriers+U(L[0]):0===L[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(F=D.widgets.directions.error.tooManyPolylineBarriers+U(L[0])));this._showMessage(F);this.onDirectionsFinish(A)},_showMessage:function(A,F){var L="";this.messages.push({msg:A,error:!F});if(this.messages.length){L+="\x3cul\x3e";for(var U=0;U<this.messages.length;U++)L+='\x3cli class\x3d"'+(this.messages[U].error?this._css.routesErrorClass:this._css.routesInfoClass)+
'"\x3e'+this.messages[U].msg+"\x3c/li\x3e";L+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=L);if(!F)this.onError(A)},_isTimeUnits:function(A){return"milliseconds"===A||"esriNAUSeconds"===A||"esriNAUMinutes"===A||"esriNAUHours"===A||"esriNAUDays"===A},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var A=(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(A)},_getCostAttribute:function(A){for(var F=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],L,U=0;U<F.length;U++)if(F[U].name===A&&"esriNAUTCost"===F[U].usageType){L=
F[U];break}return L},_convertCostValue:function(A,F,L){var U=this._isTimeUnits(F),P=this._isTimeUnits(L);F=U?this._toMinutes(A,F):this._toMeters(A,F);return U===P?P?this._fromMinutes(F,L):this._fromMeters(F,L):A},_toMinutes:function(A,F,L){A=A||0;switch(F){case "milliseconds":A/=Math.pow(6E4,L?-1:1);break;case "esriNAUSeconds":A/=Math.pow(60,L?-1:1);break;case "esriNAUHours":A*=Math.pow(60,L?-1:1);break;case "esriNAUDays":A*=Math.pow(1440,L?-1:1)}return A},_fromMinutes:function(A,F){return this._toMinutes(A,
F,!0)},_toMeters:function(A,F,L){A=A||0;switch((F||"").replace("esriNAU","esri")){case "esriInches":A*=Math.pow(.0254,L?-1:1);break;case "esriFeet":A*=Math.pow(.3048,L?-1:1);break;case "esriYards":A*=Math.pow(.9144,L?-1:1);break;case "esriMiles":A*=Math.pow(1609.344,L?-1:1);break;case "esriNauticalMiles":A*=Math.pow(1851.995396854,L?-1:1);break;case "esriMillimeters":A/=Math.pow(1E3,L?-1:1);break;case "esriCentimeters":A/=Math.pow(100,L?-1:1);break;case "esriKilometers":A*=Math.pow(1E3,L?-1:1);break;
case "esriDecimeters":A/=Math.pow(10,L?-1:1)}return A},_fromMeters:function(A,F){return this._toMeters(A,F,!0)},_createRouteTask:function(){var A=new S;this.set("routeTask",new Sa(this.get("routeTaskUrl")));this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(p.hitch(this,function(F){F.networkDataset?(this.set("serviceDescription",F),this.set("maxStops",parseInt(this.userOptions.maxStops||F.serviceLimits&&F.serviceLimits.Route_MaxStops||
this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,A.resolve()):this.routeTask.getOwningSystemUrl().then(p.hitch(this,function(L){this.owningSystemUrl=L;A.resolve()}),A.reject)):(this._showMessage(D.widgets.directions.error.cantFindRouteServiceDescription),A.reject(Error(D.widgets.directions.error.cantFindRouteServiceDescription)))}),p.hitch(this,function(){this._showMessage(D.widgets.directions.error.cantFindRouteServiceDescription);A.reject(Error(D.widgets.directions.error.cantFindRouteServiceDescription));
this.mapClickActive=!1;this._activate()}));return A.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&1<this._globalGeocoder.sources.length){var A=p.hitch(this,function(U){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",U);for(var P=0;P<this.geocoders.length;P++)this.geocoders[P].set("activeSourceIndex",U);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var F=[{value:"all",label:D.widgets.Search.main.all,
selected:!0}],L=0;L<this._globalGeocoder.sources.length;L++)F.push({value:String(L),label:this._globalGeocoder.sources[L].name});this._searchSourceSelector=new c({className:"esriSearchSourcesDDL",style:"width:100%;",options:F},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",A);this._searchSourceSelector.domNode.style.width=""}A("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},
_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new c({className:"esriTravelModesDDL",style:"width:100%;"},this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",p.hitch(this,function(A){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(A).always(p.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=
!0})))},_setupTravelModes:function(){var A=this.get("serviceDescription"),F=A.supportedTravelModes,L=new S;if(F&&F.length&&this._travelModeSelector){for(var U=F[0].name,P=[],aa=0;aa<F.length;aa++){for(var ea="AUTOMOBILE"===F[aa].type?"Driving":"TRUCK"===F[aa].type?"Trucking":"WALK"===F[aa].type?"Walking":"Other",fa="",ha=A.networkDataset.networkAttributes,ia=0;ia<ha.length;ia++){var ma=ha[ia];if(ma.name===F[aa].impedanceAttributeName){if("esriNAUCentimeters"===ma.units||"esriNAUDecimalDegrees"===
ma.units||"esriNAUDecimeters"===ma.units||"esriNAUFeet"===ma.units||"esriNAUInches"===ma.units||"esriNAUKilometers"===ma.units||"esriNAUMeters"===ma.units||"esriNAUMiles"===ma.units||"esriNAUMillimeters"===ma.units||"esriNAUNauticalMiles"===ma.units||"esriNAUYards"===ma.units)fa="Distance";else if("esriNAUDays"===ma.units||"esriNAUHours"===ma.units||"esriNAUMinutes"===ma.units||"esriNAUSeconds"===ma.units)fa="Time";break}}P.push({id:F[aa].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+
ea+fa+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+F[aa].description+'"\x3e'+F[aa].name+"\x3c/div\x3e"});!A.defaultTravelMode||F[aa].id!==A.defaultTravelMode&&F[aa].itemId!==A.defaultTravelMode||(U=F[aa].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new e({objectStore:new l({data:P})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(U);this._setTravelMode(U).always(L.resolve)}else this._checkStartTimeUIAvailability(),
this.set("showTravelModesOption",!1),L.resolve();return L.promise},_createPrintTask:function(){this._printService=(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new La(this.printTaskUrl,{async:!1}):null;var A=new ya;A.exportOptions={width:670,height:750,dpi:96};A.format="PNG32";A.layout="MAP_ONLY";A.preserveScale=!1;A.showAttribution=!1;var F=new $a;F.map=this.map;F.outSpatialReference=this.map.spatialReference;F.template=A;this._printParams=F},_createGeometryTask:function(){this._geometryService=
null;this._usingAGOL()?this._geometryService=new Ta(this.geometryTaskUrl):this.geometryTaskUrl=(this._geometryService=this.defaults.geometryTaskUrl?new Ta(this.defaults.geometryTaskUrl):cb.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var A=this.get("serviceDescription");y.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&A&&A.supportedTravelModes&&A.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":
"none")},_showMilesKilometersOption:function(){y.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?"block":"none")},_showClearButton:function(){y.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){y.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){y.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?
"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var A={returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new Va,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var F=new Ra;this.routeParams=p.mixin(F,{outputGeometryPrecision:0,
outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),A)},_markWPsForRemovalAfterUserChangedStopSequence:function(A,F){for(var L=A-1,U=[];0<=L&&this._isStopAWaypoint(this.stops[L]);)U.push(this.stops[L]),L--;for(L=A+1;L<this.stops.length&&this._isStopAWaypoint(this.stops[L]);)U.push(this.stops[L]),L++;if(F>A)for(L=F+1;L<this.stops.length&&this._isStopAWaypoint(this.stops[L]);)U.push(this.stops[L]),L++;else if(void 0!==F)for(L=F-1;0<=L&&this._isStopAWaypoint(this.stops[L]);)U.push(this.stops[L]),
L--;else if(this.returnToStart&&0===A)for(L=this.stops.length-1;0<=L&&this._isStopAWaypoint(this.stops[L]);)U.push(this.stops[L]),L--;return U},_removeSomeWaypoints:function(A){for(var F=new S,L=[],U=0;U<A.length;U++){var P=h.indexOf(this.stops,A[U]);-1<P&&L.push(this._removeStop(P,!0,!0))}O(L).always(F.resolve);return F.promise},_modifyStopSequence:function(A,F){var L=this._dnd.getAllNodes(),U=new S,P,aa=[];if(L.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==A)if(0<=
A&&0<=F&&A<this.stops.length&&F<this.stops.length&&A!==F){L=this._markWPsForRemovalAfterUserChangedStopSequence(A,F);var ea=this.stops.splice(A,1);this.stops.splice(F,0,ea[0]);for(P=0;P<this.stops.length;P++)aa.push(this._updateStop(this.stops[P],P));aa.push(this._removeSomeWaypoints(L));O(aa).always(p.hitch(this,function(){this._solveAndZoom().always(U.resolve)}))}else U.reject("Invalid From and To values.");else{for(P=0;P<this.stops.length;)this._isStopAWaypoint(this.stops[P])?aa.push(this._removeStop(P,
!0,!0)):P++;O(aa).always(p.hitch(this,function(){aa=[];this.stops.reverse();for(P=0;P<this.stops.length;P++)aa.push(this._updateStop(this.stops[P],P));O(aa).always(p.hitch(this,function(){this._solveAndZoom().always(U.resolve)}))}))}else U.resolve();return U.promise},_setMenuNodeValues:function(A){"traffic"!==A&&this._clearDisplayBeforeSolve();A=this.get("optimalRoute");this._findOptimalOrderNode&&B.set(this._findOptimalOrderNode,"checked",A);this._returnToStartNode&&(A=this.returnToStart&&!this.maxStopsReached&&
this.stops[0]&&(!this.stops[0].feature||this._isStopLocated(this.stops[0])),B.set(this._returnToStartNode,"checked",A),this.set("returnToStart",A),this.maxStopsReached&&this.returnToStart&&this._showMessage(D.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,A=this.stops.length;0<A--&&this._isStopAWaypoint(this.stops[A]);)this._removeSomeWaypoints([this.stops[A]]);
this._useTrafficNode&&(B.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case X.KILOMETERS:B.set(this._useKilometersNode,"checked",!0);B.set(this._useMilesNode,"checked",!1);break;case X.MILES:B.set(this._useKilometersNode,"checked",!1),B.set(this._useMilesNode,"checked",!0)}y.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");y.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&y.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&y.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&y.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?z.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(z.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===y.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?z.add(this._widgetContainer,this._css.stopsRemovableClass):
z.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(A,F,L){z.remove(this.domNode,F);z.add(this.domNode,L)},_toggleOptionsMenu:function(){"block"===y.get(this._optionsMenuNode,"display")?(y.set(this._optionsMenuNode,"display","none"),z.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
D.widgets.directions.showOptions):(y.set(this._optionsMenuNode,"display","block"),z.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=D.widgets.directions.hideOptions)},_toggleSaveMenu:function(A){"block"===y.get(this._saveMenuNode,"display")||!1===A?(y.set(this._saveMenuNode,"display","none"),z.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),y.set(this._saveMenuNode,"display","block"),z.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(p.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var F=this._folderSelector.store.objectStore.data,L=0;L<F.length;L++)if(F[L].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==F[L].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(F[L].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){z[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(N,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(A){A=k.toUrl(A);return/^https?:/i.test(A)?A:/^\/\//i.test(A)?Ua+A:/^\//i.test(A)?Ua+"//"+window.location.host+A:A},_getManeuverImage:function(A){return A?"esriDMTStop"===A||"esriDMTDepart"===A?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+A+".png"):""},_loadPrintDirections:function(A){var F=this.get("printTemplate"),L=new S;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(L.resolve,
L.reject):L.resolve();L.then(p.hitch(this,function(){if(!F&&this.directions){var U=this._getAbsoluteUrl("./css/Directions.css"),P=this._getAbsoluteUrl("./css/DirectionsPrint.css"),aa=this._getAbsoluteUrl("./images/Directions/print-logo.png");var ea=v.isBodyLtr()?"ltr":"rtl";F="";F+="\x3c!DOCTYPE HTML\x3e";F+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+ea+'"\x3e';F+="\x3chead\x3e";F+='\x3cmeta charset\x3d"utf-8"\x3e';F+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
F+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";F+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+U+'" /\x3e';F+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+P+'" /\x3e';F+="\x3c/head\x3e";F+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';F+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';F+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+D.common.close+'" onclick\x3d"window.close();"\x3e'+
D.common.close+"\x3c/div\x3e";F+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+D.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+D.widgets.directions.print+"\x3c/div\x3e";F+="\x3c/div\x3e";F+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';F+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';F+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+aa+'" /\x3e';F+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";F+=this._renderDirectionsSummary(this.directions);A&&(F+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',F+='\x3chr class\x3d"esriNoPrint"/\x3e');F+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';F+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+D.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
F+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';F+="\x3c/div\x3e";F+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';F+=this._renderDirectionsTable(this.directions);F+="\x3c/div\x3e";F+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';F+="\x3cp\x3e"+D.widgets.directions.printDisclaimer+"\x3c/p\x3e";F+="\x3c/div\x3e";F+="\x3c/div\x3e";F+="\x3c/body\x3e";F+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(F);
this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var A=this._searchSourceSelector,F=A.containerNode.firstChild;A.domNode.clientWidth>this.domNode.clientWidth?y.set(F,"width",this._searchSourceContainerNode.clientWidth-20+"px"):y.set(F,"width","")},_printDirections:function(){if(this.directions){var A=screen.width/2,F=screen.height/1.5;A="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+
A+", height\x3d"+F+", top\x3d"+(screen.height/2-F/2)+", left\x3d"+(screen.width/2-A/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",A,!0)):(this._printWindow=window.open("","directions_widget_print",A,!0),this._loadPrintDirections(!!this._printService),this._printService&&k(["dojo/_base/window"],p.hitch(this,function(L){this.zoomToFullRoute().then(p.hitch(this,function(){this._printService.execute(this._printParams,p.hitch(this,
function(U){L.withDoc(this._printWindow.document,function(){var P=u.byId("divMap");P&&(z.remove(P,"esriPrintWait"),z.add(P,"esriPageBreak"),N.create("img",{src:U.url,"class":"esriPrintMapImg"},P))})}),p.hitch(this,function(U){L.withDoc(this._printWindow.document,function(){var P=u.byId("divMap");P&&z.remove(P,"esriPrintWait")})}))}))})))}},_enableButton:function(A,F){F=F||void 0===F;z[F?"remove":"add"].apply(this,[A,"esriDisabledDirectionsButton"]);A._enabled=F},_clearStopsStatusAttr:function(){for(var A=
0;A<this.stops.length;A++)this.stops[A].feature&&this.stops[A].feature.attributes&&(this.stops[A].feature.attributes.Status=void 0)},_enableSharing:function(){var A=new S;!this._naRouteSharing&&this.owningSystemUrl?k(["../tasks/NARouteSharing"],p.hitch(this,function(F){this._naRouteSharing=new F(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new c({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:p.hitch(this,
function(){this._folderSelector._interractive?this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new n({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:p.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:p.hitch(this,function(){this.map&&
this.map.disableKeyboardNavigation()}),onBlur:p.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(p.hitch(this,function(L){for(var U=[],P=0;P<L.length;P++)U.push({id:L[P].url,folderId:L[P].id,label:L[P].title});this._folderSelector.setStore(new e({objectStore:new l({data:U})}));this._naRouteSharing.canCreateItem().then(p.hitch(this,function(aa){this._folderSelector.set("disabled",!aa);
this._userCanCreatePortalItem=aa}));this._enableButton(this._saveButton);A.resolve()}),p.hitch(this,function(L){this._naRouteSharing=null;this._toggleSaveMenu(!1);A.reject(L)}))})):this.owningSystemUrl?A.resolve():(A.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return A.promise},_storeRouteUI:function(){var A=new S;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),
this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(A.resolve,A.reject):(this._outputLayer&&this._outputLayer.focus(),A.reject(Error("Need result layer name specified.")));return A.promise},_storeRoute:function(A,F,L){var U=new S,P=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),U.reject(Error("Not ready to store route.")),U.promise;this.clearMessages();U.then(null,p.hitch(this,function(pa){this._showMessage(D.widgets.directions.error.cantSaveRoute)}));
U.promise.always(p.hitch(this,function(){this._enableButton(this._saveButton);y.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(P&&P.features&&P.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(A&&F){var aa=p.hitch(this,function(pa){return this._naRouteSharing.getAttributeUnits(pa,this.serviceDescription)});var ea=
this.routeParams.travelMode.timeAttributeName;var fa=this.routeParams.travelMode.distanceAttributeName,ha=aa(ea),ia=aa(fa),ma=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,oa=this._naRouteSharing.toMeters,na=this._naRouteSharing.toMinutes,ta=function(pa,Ea,Ja){var Ga;for(Ga in pa)if(pa.hasOwnProperty(Ga)&&0===Ga.indexOf(Ea)&&-1===h.indexOf(Ja,Ga.substr(Ea.length))){var fb=fb||{};fb[Ga.substr(Ea.length)]=pa[Ga]}return fb},sa=[],xa=[],Da=[];if(ea&&ha&&fa&&ia){var Oa=
[],Ha=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],Ia=this.serviceDescription.networkDataset.networkAttributes;for(aa=0;aa<Ia.length;aa++)"esriNAUTCost"===Ia[aa].usageType&&-1===h.indexOf(Ha,Ia[aa].name)&&Ia[aa].name!==ea&&Ia[aa].name!==fa&&Oa.push(Ia[aa].name);Ha=this.get("stops");var Aa={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(aa=0;aa<Ha.length;aa++)if(Ha[aa].feature&&Ha[aa].feature.toJson){Ia=Ha[aa].feature.toJson();var ua=Ia.attributes;
var va=Ia.geometry,Ka=this._naRouteSharing.getUTCOffset(ua.ArriveTime,ua.ArriveTimeUTC),Pa=this._naRouteSharing.getUTCOffset(ua.DepartTime,ua.DepartTimeUTC);p.mixin(Aa,{xmin:Aa.xmin>va.x?va.x:Aa.xmin,ymin:Aa.ymin>va.y?va.y:Aa.ymin,xmax:Aa.xmax<va.x?va.x:Aa.xmax,ymax:Aa.ymax<va.y?va.y:Aa.ymax});Ia.attributes={__OBJECTID:aa+1,CurbApproach:ua.CurbApproach,ArrivalCurbApproach:ua.ArriveCurbApproach,DepartureCurbApproach:ua.DepartCurbApproach,Name:ua.Name===this._waypointName?D.widgets.directions.waypoint:
ua.Name===this._userDefinedStopName?Ha[aa].name:ua.Name,RouteName:P.routeName,Sequence:ua.Sequence,Status:ua.Status,LocationType:ua.isWaypoint?1:0,TimeWindowStart:ua.TimeWindowStart,TimeWindowEnd:ua.TimeWindowEnd,TimeWindowStartUTCOffset:Ka,TimeWindowEndUTCOffset:Ka,ServiceMinutes:na(ua["Attr_"+ea],ha),ServiceMeters:oa(ua["Attr_"+fa],ia),ServiceCosts:J.stringify(ta(ua,"Attr_",Oa)),CumulativeMinutes:na(ua["Cumul_"+ea],ha),CumulativeMeters:oa(ua["Cumul_"+fa],ia),CumulativeCosts:J.stringify(ta(ua,"Cumul_",
Oa)),LateMinutes:na(ua["Violation_"+ea],ha),WaitMinutes:na(ua["Wait_"+ea],ha),ArrivalTime:this._naRouteSharing.toUTCTime(ua.ArriveTime,Ka),DepartureTime:this._naRouteSharing.toUTCTime(ua.DepartTime,Pa),ArrivalUTCOffset:Ka,DepartureUTCOffset:Pa};sa.push(Ia)}fa=0;ia=function(pa){try{pa.strings=J.parse(pa.strings)}catch(Ja){Za.strings=void 0}if(pa.strings&&pa.strings.length)for(var Ea=0;Ea<pa.strings.length;Ea++)if("esriDSTGeneral"===pa.strings[Ea].stringType)return pa.strings[Ea].string};Ha=function(pa,
Ea){for(var Ja=[],Ga=0;Ga<(pa||[]).length;Ga++)pa[Ga].stringType!==Ea&&Ea||Ja.push(pa[Ga].string);return Ja.length?Ja.toString():void 0};Ia=function(pa){switch(pa){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";
case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";
case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";
case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};for(aa=0;aa<P.featuresWithWaypoints.length;aa++){var Qa=P.featuresWithWaypoints[aa];va=Qa.toJson();Ka=va.attributes;Pa=va.geometry&&va.geometry.paths&&va.geometry.paths[0]||[];var Ya=va.geometry.hasM||Pa[0]&&3===Pa[0].length;ua=this._naRouteSharing.getUTCOffset(Ka.ETA,Ka.arriveTimeUTC);va.attributes={__OBJECTID:aa+1,Sequence:++fa,StopID:function(){var pa=void 0,Ea=Qa._associatedStopWithReturnToStart&&
Qa._associatedStopWithReturnToStart.attributes.Sequence;if(Ea)for(var Ja=0;Ja<sa.length;Ja++)if(sa[Ja].attributes.Sequence===Ea){pa=sa[Ja].attributes.__OBJECTID;break}return pa}(),DirectionPointType:Ia(Ka.maneuverType),DisplayText:Qa._associatedStopWithReturnToStart&&Qa._associatedStopWithReturnToStart.attributes.isWaypoint?Ka.text.replace(this._waypointName,D.widgets.directions.waypoint):Ka.text,ArrivalTime:this._naRouteSharing.toUTCTime(Ka.ETA,ua),ArrivalUTCOffset:ua,Azimuth:void 0,Name:Ha(P.stringsWithWaypoints[aa],
"esriDSTStreetName"),AlternateName:Ha(P.stringsWithWaypoints[aa],"esriDSTAltName"),ExitName:Ha(P.stringsWithWaypoints[aa],"esriDSTExit"),IntersectingName:Ha(P.stringsWithWaypoints[aa],"esriDSTCrossStreet"),BranchName:Ha(P.stringsWithWaypoints[aa],"esriDSTBranch"),TowardName:Ha(P.stringsWithWaypoints[aa],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete va.symbol;delete va.infoTemplate;Pa.length?(va.geometry={x:Pa[0][0],y:Pa[0][1],spatialReference:va.geometry.spatialReference},
Ya&&p.mixin(va.geometry,{m:Pa[0][2]})):delete va.geometry;xa.push(va);va=Qa.toJson();Ka=va.attributes;Pa=va.geometry&&va.geometry.paths&&va.geometry.paths[0]||[];ua=!0;for(ea=0;ea<Pa.length-1;ea++)if(Pa[ea][0]!==Pa[ea+1][0]||Pa[ea][1]!==Pa[ea+1][1]){ua=!1;break}ua||(va.attributes={DirectionPointID:aa+1,DirectionLineType:"esriDLTSegment",Meters:oa(Ka.length,ma),Minutes:na(Ka.time,ha),FromLevel:void 0,ToLevel:void 0},va.geometry.hasM=Ya,delete va.symbol,delete va.infoTemplate,Da.push(va));var Za=P.eventsWithWaypoints[va.attributes.Sequence]||
[];for(ea=0;ea<Za.length;ea++)va=Za[ea].toJson(),Ka=va.attributes,ua=this._naRouteSharing.getUTCOffset(Ka.ETA,Ka.arriveTimeUTC),va.attributes={Sequence:++fa,DirectionPointType:"esriDPTEvent",DisplayText:ia(Ka),ArrivalTime:this._naRouteSharing.toUTCTime(Ka.ETA,ua),ArrivalUTCOffset:ua,Name:Ka.strings},xa.push(va)}ea=this.routeParams.barriers&&this.routeParams.barriers.features||[];var Ma=[];for(aa=0;aa<ea.length;aa++)fa=ea[aa].toJson(),ia=fa.attributes,fa.attributes={BarrierType:ia.BarrierType||0,FullEdge:ia.FullEdge||
!1,AddedCost:ia["Attr_"+this._getImpedanceAttribute().name]||0,Costs:J.stringify(ta(ia,"Attr_",Oa)),CurbApproach:ia.CurbApproach||0,Name:ia.Name},Ma.push(fa);ea=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var eb=[];for(aa=0;aa<ea.length;aa++)fa=ea[aa].toJson(),ia=fa.attributes,fa.attributes={BarrierType:ia.BarrierType||0,ScaleFactor:ia["Attr_"+this._getImpedanceAttribute().name]||1,Costs:J.stringify(ta(ia,"Attr_",Oa)),Name:ia.Name},eb.push(fa);ea=this.routeParams.polygonBarriers&&
this.routeParams.polygonBarriers.features||[];var Na=[];for(aa=0;aa<ea.length;aa++)fa=ea[aa].toJson(),ia=fa.attributes,fa.attributes={BarrierType:ia.BarrierType||0,ScaleFactor:ia["Attr_"+this._getImpedanceAttribute().name]||1,Costs:J.stringify(ta(ia,"Attr_",Oa)),Name:ia.Name},Na.push(fa);var ib={geometry:P.mergedGeometry,attributes:{RouteName:P.routeName,TotalMinutes:na(P.totalTime,ha),TotalMeters:oa(P.totalLength,ma),TotalLateMinutes:function(){for(var pa=0,Ea=0;Ea<sa.length;Ea++)pa+=sa[Ea].attributes.LateMinutes||
0;return pa}(),TotalWaitMinutes:function(){for(var pa=0,Ea=0;Ea<sa.length;Ea++)pa+=sa[Ea].attributes.WaitMinutes||0;return pa}(),TotalCosts:sa[sa.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?sa[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?sa[sa.length-1].attributes.DepartureTime:null,StartUTCOffset:sa[0].attributes.ArrivalUTCOffset,EndUTCOffset:sa[sa.length-1].attributes.DepartureUTCOffset,Messages:J.stringify(this._solverMessages),AnalysisSettings:J.stringify({travelMode:p.hitch(this,
function(){var pa=p.clone(this.routeParams.travelMode);"\x26lt;"===pa.name.substr(0,4)&&"\x26gt;"===pa.name.substr(pa.name.length-4,4)&&(pa.name=pa.name.substr(4,pa.name.length-8));return pa})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,
accumulateAttributeNames:this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);p.hitch(this,function(){var pa=new S;this._printService?this.zoomToFullRoute().then(p.hitch(this,function(){var Ea=this._printParams.template,Ja=Ea.exportOptions;Ea.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Ga){Ea.exportOptions=Ja;pa.resolve(Ga.url)},
function(Ga){Ea.exportOptions=Ja;pa.resolve()})})):pa.resolve();return pa.promise})().then(p.hitch(this,function(pa){var Ea={folder:F,name:A,stops:sa,directionPoints:xa,directionLines:Da,barriers:Ma,polylineBarriers:eb,polygonBarriers:Na,extent:p.mixin(p.clone(P.extent),{xmin:Aa.xmin>P.extent.xmin?P.extent.xmin:Aa.xmin,ymin:Aa.ymin>P.extent.ymin?P.extent.ymin:Aa.ymin,xmax:Aa.xmax<P.extent.xmax?P.extent.xmax:Aa.xmax,ymax:Aa.ymax<P.extent.ymax?P.extent.ymax:Aa.ymax}),routeInfo:ib,thumbnail:pa};this._userCanCreatePortalItem?
this._naRouteSharing.store(Ea,this.routeLayer.itemId,"1.0.0").then(p.hitch(this,function(Ja){if(Ja.success){var Ga=this._naRouteSharing.portal;Ga="//"+(Ga.isPortal?Ga.portalHostname:Ga.urlKey+"."+Ga.customBaseUrl);this._toggleSaveMenu();this._showMessage(D.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Ga+"/home/item.html?id\x3d"+Ja.id+"'\x3e"+D.widgets.directions.share+"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Ja.id);
else this.onRouteItemCreated(Ja.id);p.mixin(this.routeLayer,{itemId:Ja.id,title:Ea.name,isItemOwner:!0,ownerFolder:L});U.resolve(Ja)}else U.reject(Ja)}),U.reject):this._naRouteSharing.createFeatureCollection(Ea,"1.0.0").then(p.hitch(this,function(Ja){U.resolve(Ja);this._toggleSaveMenu();this.onFeatureCollectionCreated(Ja)}),U.reject)}))}else U.reject(Error("Cannot deduce the impedance used."))}else U.reject(Error("Missing required parameter: layerName, folder must be specified."));else U.reject(Error("Shared route must be built using a Travel Mode."));
else U.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else U.reject(Error("No route to share. Build a route first."));return U.promise},_loadRoute:function(A){var F=new S;F.promise.always(p.hitch(this,function(){this._showLoadingSpinner(!1);y.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));
this._reset().then(p.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(p.hitch(this,function(){var L=p.clone(this.serviceDescription),U=p.hitch(this,function(ha){p.mixin(this.routeLayer,{itemId:A,title:ha.title,isItemOwner:ha.isItemOwner,ownerFolder:ha.ownerFolder})}),P,aa,ea,fa;L.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(A,L).then(p.hitch(this,function(ha){if(ha.routeParameters){p.mixin(this.routeParams,ha.routeParameters);this.routeParams.accumulateAttributes=
ha.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var ia=ha.routeParameters.travelMode,ma=ia?this._getCostAttribute(ia.impedanceAttributeName):void 0;ma=ma?this._isTimeUnits(ma.units)?"Time":"Distance":"";fa=L.supportedTravelModes&&L.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():[];if(canUseRouteLayerTM=
1!==ha.successCode&&ma){var oa="AUTOMOBILE"===ia.type?"Driving":"TRUCK"===ia.type?"Trucking":"WALK"===ia.type?"Walking":"Other";ia.name="\x26lt;"+ia.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(L.supportedTravelModes||[]).concat(ia);fa.push({id:ia.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+oa+ma+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+ia.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new e({objectStore:new l({data:fa})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ia.name)}else{ma=!1;if(ia&&ia.name)for(fa=L.supportedTravelModes||[],P=0;P<fa.length;P++)if(fa[P].name===ia.name){ma=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ia.name);this.routeParams.travelMode=fa[P].impedanceAttributeName?fa[P]:fa[P].itemId;ha.loadMessages.push({message:D.widgets.directions.error.tmFromPortalSameName+" "+ia.name,messageType:"Warning"});break}if(!ma)if((ia=L.defaultTravelMode)&&
fa)for(P=0;P<fa.length;P++){if(fa[P].id===ia){this.routeParams.travelMode=fa[P].impedanceAttributeName?fa[P]:fa[P].itemId;ha.loadMessages.push({message:D.widgets.directions.error.tmFromPortalDefault+" "+(fa[P].name?fa[P].name:fa[P].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(ha.solveResult&&ha.solveResult.routeResults){var na=Infinity,ta=-Infinity;ia=ha.solveResult.routeResults[0].stops;var sa=ha.solveResult.routeResults[0].directions.features;
ma={};for(P=0;P<ia.length;P++){var xa=ia[P].attributes;if(xa.isWaypoint)for(aa=0;aa<sa.length;aa++)oa=sa[aa].attributes,oa._stopSequence===xa.Sequence&&(oa.text=oa.text.replace(xa.Name,this._waypointName));ea=xa.Name+"_"+this._stopSequence++;ma[ea]=xa.isWaypoint?this._waypointName:xa.Name;xa.Name=ea;if(xa.Sequence<na&&(null!==xa.ArriveCurbApproach||null!==xa.DepartCurbApproach)){var Da=xa.Name;na=xa.Sequence}if(xa.Sequence>ta&&(null!==xa.ArriveCurbApproach||null!==xa.DepartCurbApproach)){var Oa=xa.Name;
ta=xa.Sequence}}ea=Da+" - "+Oa;ha.solveResult.routeResults[0].routeName=ea;ha.solveResult.routeResults[0].directions.routeName=ea;for(P=0;P<sa.length;P++)if(oa=sa[P].attributes,void 0!==oa._stopSequence)for(aa=0;aa<ia.length;aa++)if(oa._stopSequence===ia[aa].attributes.Sequence){ea=ia[aa].attributes.Name;oa.text=(oa.text||"").replace(ma[ea],ea);delete oa._stopSequence;break}Da=ia[ia.length-1];ia[0].geometry.x===Da.geometry.x&&ia[0].geometry.y===Da.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new R(Da.geometry,
null,Da.attributes),ma[Da.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(ha.solveResult,ma).then(p.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);U(ha);this.zoomToFullRoute();F.resolve(ha)}),F.reject)}else{if(ha.routeParameters){Da=ha.routeParameters.stops.features;this.stops=[];for(P=0;P<Da.length;P++)this.stops.push(this._addStopWrapperToGraphic(Da[P],Da[P].attributes.Name)),this._updateStop(this.stops[P],P);this._setStops();ha.loadMessages.push({message:D.widgets.directions.routeLayerStopsOnly,
messageType:"Warning"})}else ha.loadMessages.push({message:D.widgets.directions.routeLayerEmpty,messageType:"Warning"});U(ha);F.resolve(ha)}for(P=0;P<ha.loadMessages.length;P++)this._showMessage(ha.loadMessages[P].message)}),p.hitch(this,function(ha){F.reject(ha);this._showMessage("GWM_0003"===ha.messageCode?D.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:D.widgets.directions.error.loadError)}))}),F.reject)}),F.reject);return F.promise}});p.setObject("dijit.Directions",
g,M);return g})},"dijit/layout/AccordionPane":function(){define(["dojo/_base/declare","dojo/_base/kernel","./ContentPane"],function(k,g,p){return k("dijit.layout.AccordionPane",p,{constructor:function(){g.deprecated("dijit.layout.AccordionPane deprecated, use ContentPane instead","","2.0")},onSelected:function(){}})})},"arcgisonline/sharing/geow/MemberReadStore":function(){define(["dojo","dijit","dojox","dojo/require!dojox/data/QueryReadStore,arcgisonline/sharing/geow/Content"],function(k,g,p){k.provide("arcgisonline.sharing.geow.MemberReadStore");
k.require("dojox.data.QueryReadStore");k.require("arcgisonline.sharing.geow.Content");k.declare("arcgisonline.sharing.geow.MemberReadStore",p.data.QueryReadStore,{_fetchItems:function(b,h,f){var d=b.serverQuery||b.query||{};d.start=b.start||0;d.start++;b.count&&(d.num=b.count);arcgisonline.sharing.util.getJson(this.url,k.hitch(this,function(a){this._items=[];var c=null,n="";if(a.users){n="groupMembers";this._total=a.users.length+a.admins.length;k.publish("onMemberCount",[this._total]);var m={name:a.owner,
memberType:"owner",requestType:n,groupowner:a.owner||"",groupadmins:a.admins||[]};this._items.push({i:m,r:this});k.forEach(a.admins,function(q,l){q!=a.owner&&(m={name:q,memberType:"admin",requestType:n,groupowner:a.owner||"",groupadmins:a.admins||[]},this._items.push({i:m,r:this}))},this);k.forEach(a.users,function(q,l){m={name:q,memberType:"member",requestType:n,groupowner:a.owner||"",groupadmins:a.admins||[]};this._items.push({i:m,r:this})},this)}else c=a.applications,n="groupApplications",k.publish("onAppCount",
[a.applications.length]),this._total=c.length,k.forEach(c,function(q,l){this._items.push({i:{name:q.username,fullname:q.fullname,requestType:n,groupowner:a.owner||"",groupadmins:a.admins||[],received:q.received||-1},r:this})},this);this._itemsByIdentity={};this._identifier="name";for(i=0;i<this._items.length;++i)m=this._items[i].i,c=m.name,this._itemsByIdentity.name||(this._itemsByIdentity[c]=m);h(this._items,b,this._total);this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);
this._lastServerQuery=k.mixin({},d)}))}})})},"arcgisonline/sharing/dijit/DataGrid":function(){define(["dojo","dijit","dojox","dojo/require!dojox/grid/DataGrid"],function(k,g,p){k.provide("arcgisonline.sharing.dijit.DataGrid");k.require("dojox.grid.DataGrid");k.declare("arcgisonline.sharing.dijit.DataGrid",p.grid.DataGrid,{sort:function(){this.inherited(arguments);setTimeout(k.hitch(this,"update"),300)},_onFetchComplete:function(b,h){var f=!this._isLoaded;this.inherited(arguments);f&&this.update()}})})},
"arcgisonline/sharing/dijit/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array esri/IdentityManager".split(" "),function(k,g,p,b,h,f,d,a){var c=function(n){function m(q){n[q]||(n[q]=function(){var l=arguments;return f.when(n,function(e){Array.prototype.unshift.call(l,e.features||e);return c(h[q].apply(h,l))})})}if(!n)return n;n.then&&(n=b.delegate(n));n.total||(n.total=f.when(n,
function(q){return k._isDefined(q.total)?q.total:q.length||0}));m("forEach");m("filter");m("map");m("some");m("every");return n};b.setObject("arcgisonline.sharing.dijit.FeatureLayerQueryResult",c);return c})},"arcgisonline/sharing/dijit/FeatureLayerQueryStore":function(){define(["dojo","dijit","dojox","dojo/require!arcgisonline/sharing/dijit/FeatureLayerQueryResult"],function(k,g,p){k.provide("arcgisonline.sharing.dijit.FeatureLayerQueryStore");k.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");
k.declare("arcgisonline.sharing.dijit.FeatureLayerQueryStore",null,{queryUrl:"",idProperty:"id",data:[],constructor:function(b){k.mixin(this,b);this.layer=b.layer;this.objectIds=b.objectIds;this.where=b.where;this.orderByFields=b.orderByFields;this.totalCount=b.totalCount;this.batchCount=b.batchCount||25;this.idProperty=this.layer.objectIdField},get:function(b,h){return this.data[b]},getIdentity:function(b){return b[this.idProperty]},query:function(b,h){var f=new esri.tasks.Query;b=h.start||0;h=this.batchCount;
this.objectIds?f.objectIds=this.objectIds.length>=b+this.batchCount?this.objectIds.slice(b,b+h):this.objectIds.slice(b):(f.start=b,f.num=h,f.where=this.where,f.orderByFields=this.orderByFields);f.returnGeometry=!1;f.outFields=["*"];var d=this.totalCount;b=this.layer.queryFeatures(f);b.total=b.then(k.hitch(this,function(a){if(this.objectIds){var c=a.objectIdFieldName;if(!c)for(var n=0;n<a.fields.length;n++)if("esriFieldTypeOID"==a.fields[n].type){c=a.fields[n].name;break}var m={};for(n=0;n<a.features.length;n++)m[a.features[n].attributes[c]]=
a.features[n];a.features=k.map(f.objectIds,function(q){return m[q]})}for(n=0;n<a.features.length;n++)a.features[n]=a.features[n].attributes,this.data[a.features[n][c]]=a.features[n];a=a.features;return d}),function(){return 0});return arcgisonline.sharing.dijit.FeatureLayerQueryResult(b)}})})},"arcgisonline/sharing/dijit/GroupMembershipRequestsGrid":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dojox/grid/DataGrid,dojox/rpc/Service,dojo/rpc/JsonService,dijit/Toolbar,arcgisonline/sharing/geow/MemberReadStore,arcgisonline/sharing/dijit/ProfilePopup"],
function(k,g,p){k.provide("arcgisonline.sharing.dijit.GroupMembershipRequestsGrid");k.require("dijit._Widget");k.require("dijit._Templated");k.require("dojox.grid.DataGrid");k.require("dojox.rpc.Service");k.require("dojo.rpc.JsonService");k.require("dijit.Toolbar");k.require("arcgisonline.sharing.geow.MemberReadStore");k.require("arcgisonline.sharing.dijit.ProfilePopup");k.declare("arcgisonline.sharing.dijit.GroupMembershipRequestsGrid",[g._Widget,g._Templated],{widgetsInTemplate:!0,groupId:null,
initialized:!1,templateString:'\x3cdiv id\x3d"esriGroupMambershipRequestsGrid" style\x3d"width: 100%; height: 100%; margin:auto;"\x3e\r\n  \x3ctable data-dojo-type\x3d"dojox.grid.DataGrid" jsid\x3d"grid" id\x3d"groupMembershipRequestsNode"\r\n         data-dojo-props\x3d"rowsperpage:10,delayscroll:true"\r\n         class\x3d"esriGrid" style\x3d"height:100%; width:100%;"\x3e\r\n    \x3cthead\x3e\r\n    \x3ctr\x3e\r\n      \x3cth get\x3d"arcgisonline.sharing.dijit.GroupMembershipRequestsGrid.formatters.name"\r\n          formatter\x3d"arcgisonline.sharing.util.fix" width\x3d"30%" name\x3d"Name"\x3ex\x3c/th\x3e\r\n      \x3cth get\x3d"arcgisonline.sharing.dijit.GroupMembershipRequestsGrid.formatters.username"\r\n          formatter\x3d"arcgisonline.sharing.util.fix" width\x3d"20%" name\x3d"Username"\x3ex\x3c/th\x3e\r\n      \x3cth get\x3d"arcgisonline.sharing.dijit.GroupMembershipRequestsGrid.formatters.received"\r\n          formatter\x3d"arcgisonline.sharing.util.fix" width\x3d"26%" name\x3d"Received"\x3ex\x3c/th\x3e\r\n      \x3cth get\x3d"arcgisonline.sharing.dijit.GroupMembershipRequestsGrid.formatters.yourResponse"\r\n          formatter\x3d"arcgisonline.sharing.util.fix" width\x3d"34%" name\x3d"Your Response"\x3ex\x3c/th\x3e\r\n    \x3c/tr\x3e\r\n    \x3c/thead\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
_eventConnections:[],i18n:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=k.i18n.getLocalization("arcgisonline","arcgisonline").common;k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").groupMembershipRequestsGrid)},postCreate:function(){k.subscribe("onApplicationAccept",this.refreshGrid);k.subscribe("onApplicationDecline",this.refreshGrid);this._applyGridPatches();if(esri.isTouchEnabled){var b=esri.setScrollable(grid.views.views[0].scrollboxNode);this._eventConnections.push(b[0],
b[1])}},_applyGridPatches:function(){var b=grid.adaptWidth;grid.adaptWidth=function(){var h=this.views.views,f,d;for(d=0;f=h[d];d++){k.style(f.headerNode,"display","block");var a=f.adaptWidth;f.adaptWidth=function(){this.flexCells&&null==this.headerContentNode.firstChild||a.apply(this,arguments)}}b.apply(this,arguments);for(d=0;f=h[d];d++)k.style(f.headerNode,"display","none")}},loadGrid:function(b){this.groupId=b;k.byId("membership-groupId").value=this.groupId;b=new arcgisonline.sharing.geow.MemberReadStore;
b.url=esriGeowConfig.restBaseUrl+"community/groups/"+this.groupId+"/applications";grid.noDataMessage="\x3cspan style\x3d'font-size:1.2em;color:#7a7979;'\x3e"+this.i18n.noMembershipRequests+"\x3c/span\x3e";grid.setStore(b)},onAppCount:function(b){0<b?(k.style(k.byId("membership-requests-has_no_requests"),"display","none"),k.style(k.byId("membership-requests-has_requests"),"display","block")):(k.style(k.byId("membership-requests-has_requests"),"display","none"),k.style(k.byId("membership-requests-has_no_requests"),
"display","block"))},refreshGrid:function(){grid.setQuery()},destroy:function(){this.inherited(arguments);k.forEach(this._eventConnections,k.disconnect)}});arcgisonline.sharing.dijit.GroupMembershipRequestsGrid.formatters={i18n:null,name:function(b,h){return h?'\x3cspan id\x3d"esriMemberInfo" class\x3d"esriItemLinks"\x3e\x3ca href\x3d"#" onclick\x3d"arcgisonline.sharing.dijit.ProfilePopup.prototype.statics.getInstance().showProfile(\''+h.i.name+"', this);\"\x3e"+h.i.fullname+"\x3c/span\x3e":this.defaultValue},
username:function(b,h){if(!h)return this.defaultValue;b=h.i.name;return'\x3cspan id\x3d"esriMemberInfo" class\x3d"esriItemLinks"\x3e\x3ca href\x3d"#" onclick\x3d"arcgisonline.sharing.dijit.ProfilePopup.prototype.statics.getInstance().showProfile(\''+b+"', this);\"\x3e"+b+"\x3c/span\x3e"},received:function(b,h){if(!h)return this.defaultValue;b='\x3cspan id\x3d"esriMemberInfo"\x3e';h=h.i.received;-1<h&&(h=new Date(parseFloat(h)),b+=k.date.locale.format(h,{selector:"date",formatLength:"long"}));return b+
"\x3c/span\x3e"},yourResponse:function(b,h){if(!h)return this.defaultValue;this.i18n=k.i18n.getLocalization("arcgisonline","arcgisonline").common;k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").groupMembershipRequestsGrid);b=k.byId("membership-groupId").value;h=h.i.name;var f='\x3cdiv class\x3d"list-links" style\x3d"padding-left:20px;"\x3e\x3cspan class\x3d"approveApplication"\x3e\x3c/span\x3e\x3ca href\x3d"JavaScript:arcgisonline.sharing.geow.Group.acceptApplication(\''+b+
"','"+h+"')\"\x3e"+this.i18n.approve+"\x3c/a\x3e";return f+='  \x3cspan class\x3d"declineApplication"\x3e\x3c/span\x3e\x3ca href\x3d"JavaScript:arcgisonline.sharing.geow.Group.declineApplication(\''+b+"','"+h+"')\"'\x3e"+this.i18n.decline+"\x3c/a\x3e\x3c/div\x3e"}}})},"arcgisonline/sharing/dijit/OrganizationSetup":function(){define("dojo/_base/declare dojo/_base/lang dojo/cookie dojo/debounce dojo/dom-attr dojo/dom-class dojo/dom-style dojo/on dijit/a11yclick dojo/string dojo/when dojox/html/entities dojo/data/ItemFileReadStore dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button dijit/form/CheckBox dijit/form/FilteringSelect dijit/form/TextBox dijit/layout/ContentPane dijit/Tooltip esri/lang esri/request ../../esriGeowConfig ../util ../../pages/pageUtil ../../pages/utils/culture ../../pages/utils/dom ../../pages/utils/tooltips ../geow/Account ../geow/Geow ./dialog/GeneralDlg dojo/i18n!../../nls/arcgisonline dojo/text!./templates/OrganizationSetup.html".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da,J,M,K,R){return k("arcgisonline.sharing.dijit.OrganizationSetup",[t,x,r],{declaredClass:"arcgisonline.sharing.dijit.OrganizationSetup",templateString:R,widgetsInTemplate:!0,DEFAULT_ACCOUNT_NAME:"My Account",ACCOUNT_ADMIN_ROLE:"account_admin",BROWSER_DEFAULT:"browser",ACCESS_DENIED_ERROR_PATH:"error.html?c\x3dAccessDenied",_user:null,_onlineDefaults:null,_settings:null,_validUrlKey:!1,_urlKeyAlreadySet:!1,_tooltips:[],postMixInProperties:function(){this.inherited(arguments);
this.i18n=g.mixin(K.common,K.organizationSetup);g.mixin(this.i18n,{usageTrackingDesc:K.myOrganization.generalTab.usageTrackingDesc,usageTrackingSetting:K.myOrganization.generalTab.usageTrackingSetting,allowArcgisOnlineToCollectInfo:K.usageTracking.allowArcgisOnlineToCollectInfo})},destroy:function(){this.inherited(arguments);this._tooltips.forEach(function(X){X&&X.destroyRecursive&&X.destroyRecursive()})},postCreate:function(){this.inherited(arguments);this._checkAccess();this._initHandlers();this._initImages();
this._initRedirects();this._initLocalization();this._initTooltips();da.getSupportedLanguagesAndRegions().then(function(X){X&&(this._initLanguage(X.languages),this._initRegion(X.regions),this._loadOrganization())}.bind(this),this._handleError.bind(this))},_handleError:function(X){},_showAlert:function(X,Q){var W=new M;a.once(W._dialog,"hide",function(){W._dialog.destroyRecursive();W.destroyRecursive()});W.show({title:X,message:Q})},_urlContainsInvalidChars:function(X){return!X.match(/^[a-zA-Z0-9\-]*$/)},
_handleUrlKeyCheck:function(X){!X||X.code||X.message?(this._validUrlKey=!1,this._clearUrlKeyStatus()):X.available?this._setGoodUrlKeyStatus(this.i18n.available):this._setBadUrlKeyStatus(this.i18n.unavailable)},_initHandlers:function(){var X=this.checkUrlKey.bind(this);this.own(c(this._sslCheckBox,this.onSSLCheck.bind(this)),c(this._saveBtn,this.onSave.bind(this)),c(this._signOutBtn,this.onSignOut.bind(this)),a(this._urlKeyTextBox,"change",X),H.registerKeystrokeHandler(this._urlKeyTextBox,b(X,500)),
a(this._languageSelect,"change",this.onLanguageChange.bind(this)))},_initImages:function(){this._orgNameImg&&h.set(this._orgNameImg,"src",G.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png"));this._orgAbbrImg&&h.set(this._orgAbbrImg,"src",G.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png"));this._languageImg&&h.set(this._languageImg,"src",G.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-language.png"));
this._languageFormatImg&&h.set(this._languageFormatImg,"src",G.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png"));this._regionImg&&h.set(this._regionImg,"src",G.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-region.png"));this._securityImg&&h.set(this._securityImg,"src",G.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-security-https.png"));this._linkImg&&h.set(this._linkImg,"src",G.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-links.png"));
this._usageTrackingImg&&h.set(this._usageTrackingImg,"src",G.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb_euei.png"))},_checkAccess:function(){G.isLoggedIn()?(this._user=G.getUser(),this._user.accountId||this._user.role===this.ACCOUNT_ADMIN_ROLE||(window.location=D.baseUrl+this.ACCESS_DENIED_ERROR_PATH)):this._showUser||G.requireAuthentication()},_initRedirects:function(){this.redirectUrl=D.baseUrl+"index.html";this.orgRedirectUrl=D.baseUrl+"organization.html"},_initLocalization:function(){h.set(dojo.byId("item-title"),
"innerHTML",this.i18n.setupYourOrg);this._sslCheckBoxLabel.innerHTML=n.substitute(this.i18n.securityDesc,{span:'\x3cspan id\x3d"sslTooltip" style\x3d"border-bottom: 1px dotted #487696;"\x3e',spanEnd:"\x3c/span\x3e"});h.set(this._linkTooltip,"innerHTML",n.substitute(this.i18n.contactUs,{startSpan:'\x3cspan class\x3d"orgSettingTooltip"\x3e',endSpan:"\x3c/span\x3e"}));this._link.set("placeholder",this.i18n.contactUsExample)},_initTooltips:function(){this._tooltips.push(S.createTooltip("linkTooltip",
this.i18n.contactUsTooltip));this._tooltips.push(S.createTooltip("sslTooltip",this.i18n.sslTooltip));this._tooltips.push(S.createTooltip("languageFormatTooltip",this.i18n.learnNumDateFormat))},_initLanguage:function(X){if(X){var Q=[{culture:this.BROWSER_DEFAULT,displayName:this.i18n.browserDefaultSelection,language:this.i18n.browserDefaultSelection,localizedName:this.i18n.browserDefaultSelection}];X.forEach(function(W){W=g.mixin({displayName:q.decode((W.localizedName?W.localizedName+" - ":"")+W.language+
"\x26lrm;")},W);W.cultureFormats&&W.cultureFormats.length&&W.cultureFormats.forEach(function(I){I.displayName=q.decode((I.localizedName?I.localizedName+" - ":"")+I.name+"\x26lrm;")});Q.push(W)});X=new e({idProperty:"culture",label:"displayName",data:Q});this._languageSelect.set("store",X);this._languageSelect.set("searchAttr","displayName")}},_initLanguageFormat:function(X,Q){if(X&&X!==this.BROWSER_DEFAULT&&Q&&Q.length){X=N.getSelectedFormat(this._settings.cultureFormat,Q||[]);var W=new e({idProperty:"format",
label:"displayName",data:Q});this._languageFormatSelect.set("store",W);this._languageFormatSelect.set("searchAttr","displayName");X?this._languageFormatSelect.set("displayedValue",X.displayName):this._languageFormatSelect.set("displayedValue",Q[0].displayName);O.showNode(this._languageFormatContainer)}else O.hideNode(this._languageFormatContainer)},_initRegion:function(X){X&&(X=new e({idProperty:"region",label:"localizedName",data:X}),this._regionSelect.set("store",X),this._regionSelect.set("searchAttr",
"localizedName"))},_loadOrganization:function(){E({url:G.getSecureUrl(D.restBaseUrl)+"portals/self",content:{f:"json"}}).then(function(X){this._onlineDefaults=X;da.getSelf(function(Q){if(!Q||Q.code||Q.message)this._handleError(Q);else{this._settings=Q;this._settings.customBaseUrl=this._settings.customBaseUrl||this._onlineDefaults.customBaseUrl;this._sslCheckBox.set("checked",!0);this._settings.name&&this.DEFAULT_ACCOUNT_NAME!==this._settings.name&&this._nameTextBox.set("value",this._settings.name);
this._settings.urlKey?(this._urlKeyAlreadySet=this._validUrlKey=!0,this._settings.customBaseUrl?h.set(this._sampleUrlTextBox,"innerHTML","https://"+this._settings.urlKey+"."+this._settings.customBaseUrl):h.set(this._sampleUrlTextBox,"innerHTML",G.getSecureUrl(D.baseUrl)),this._urlKeyTextBox.set("disabled",!0),this._urlKeyTextBox.set("value",this._settings.urlKey)):(this._validUrlKey=!1,h.set(this._sampleUrlTextBox,"innerHTML",""));var W=this._languageSelect.get("store");this._settings.culture=N.getActualCulture(Q.culture,
W.query());W=(W=W.query({culture:Q.culture||this.BROWSER_DEFAULT}).shift())?W.displayName:this.i18n.browserDefaultSelection;this._languageSelect.set("displayedValue",W);h.set(this._languageFormatHelpLink,"href",D.self.helpBase+(D.self.helpMap.m["120001487"]||""));(Q=this._regionSelect.get("store").query({region:Q.region}).shift())&&Q.localizedName?this._regionSelect.set("displayedValue",Q.localizedName):this._regionSelect.set("value",D.self&&D.self.ipCntryCode||"WO");this._settings.portalProperties&&
this._settings.portalProperties.links&&this._settings.portalProperties.links.contactUs&&(this._linkCheckBox.set("checked",!!this._settings.portalProperties.links.contactUs.visible),this._link.set("value",this._settings.portalProperties.links.contactUs.url));Q=D.restBaseUrl.replace("http:","https:").replace("/rest/","/geoip.jsp");G.getJson(Q,this._setUsageTrackingCheckbox.bind(this),this._setUsageTrackingCheckbox.bind(this))}}.bind(this))}.bind(this))},_setUsageTrackingCheckbox:function(X){this._usageTrackingCheckBox.set("checked",
D.urlKey?!!this._settings.eueiEnabled:"US"===X.country)},_handleUpdateAccount:function(X){if(!X||X.code||X.message)this._handleError(X),this._showAlert(this.i18n.errorTitle,this.i18n.errors.unableToSave),this._saveBtn.set("disabled",!1),this._saveBtn.set("label",this.i18n.saveContinue);else if(this._settings.urlKey&&this._settings.customBaseUrl){X=null;-1===window.location.host.indexOf(this._settings.urlKey+"."+this._settings.customBaseUrl)&&(X=G.getCookie("esri_auth"));var Q=(this._settings.allSSL?
"https:":"http:")+"//"+this._settings.urlKey+"."+this._settings.customBaseUrl,W=D.baseUrl.indexOf(location.host);Q=-1<W?Q+(D.baseUrl.substring(W+location.host.length)+"organization.html"):this._settings.allSSL?this.redirectUrl.replace("http:","https:"):this.redirectUrl.replace("https:","http:");X&&(Q=G.getBridgeUrl(Q,X));window.location=Q}else window.location="account_admin"!==user.role||this._settings.urlKey?this._settings.allSSL?this.redirectUrl.replace("http:","https:"):this.redirectUrl.replace("https:",
"http:"):this._settings.allSSL?this.orgRedirectUrl.replace("http:","https:"):this.orgRedirectUrl.replace("https:","http:")},_validates:function(){var X=this._nameTextBox.getValue(),Q=this._link.get("value"),W=this._linkCheckBox.get("checked"),I=this.i18n.errors.pleaseCorrect,T=!1;X?(X=n.trim(X),0<X.length?-1<X.indexOf("\x3c")||-1<X.indexOf("\x3e")||-1<X.indexOf("%")?(T=!0,I+="\x3cbr\x3e"+this.i18n.errors.orgNameInvalidChars):55<X.length&&(T=!0,I+="\x3cbr\x3e"+this.i18n.errors.orgNameTooLong):(T=!0,
I+="\x3cbr\x3e"+this.i18n.errors.orgNameRequired)):(T=!0,I+="\x3cbr\x3e"+this.i18n.errors.orgNameRequired);this._validUrlKey||(T=!0,I+="\x3cbr\x3e"+this.i18n.errors.urlKeyRequired);!W||esri.isDefined(Q)&&0!==Q.length||(T=!0,I+="\x3cbr\x3e"+this.i18n.errors.finishContactUsSetup);T&&this._showAlert(this.i18n.errorTitle,I);return!T},_setGoodUrlKeyStatus:function(X){this._validUrlKey=!0;this._urlKeyStatusLabel.innerHTML=X;f.remove(this._urlKeyStatusLabel,"statusBad");f.add(this._urlKeyStatusLabel,"statusGood")},
_setBadUrlKeyStatus:function(X){this._validUrlKey=!1;this._urlKeyStatusLabel.innerHTML=X;f.remove(this._urlKeyStatusLabel,"statusGood");f.add(this._urlKeyStatusLabel,"statusBad")},_clearUrlKeyStatus:function(){this._urlKeyStatusLabel.innerHTML="";f.remove(this._urlKeyStatusLabel,"statusGood");f.remove(this._urlKeyStatusLabel,"statusBad")},checkUrlKey:function(){if(!this._urlKeyAlreadySet){var X=this._urlKeyTextBox.getValue(),Q=this._handleUrlKeyCheck.bind(this);X&&(X=n.trim(X));X&&0<X.length&&17>
X.length?this._urlContainsInvalidChars(X)?this._setBadUrlKeyStatus(this.i18n.errors.urlKeyInvalidChars):"-"===X[0]||"-"===X[X.length-1]?this._setBadUrlKeyStatus(this.i18n.errors.urlKeyEndHyphen):(h.set(this._sampleUrlTextBox,"innerHTML","https://"+X+"."+this._settings.customBaseUrl),G.getJson(D.restBaseUrl+"portals/isUrlKeyAvailable?urlKey\x3d"+X,Q,Q)):(this._validUrlKey=!1,h.set(this._sampleUrlTextBox,"innerHTML",""),X&&16<X.length?this._setBadUrlKeyStatus(this.i18n.urlKeyTooLong):this._clearUrlKeyStatus())}},
onLanguageChange:function(){var X=this._languageSelect.get("store").query({displayName:this._languageSelect.get("displayedValue")}).shift();X&&this._initLanguageFormat(X.culture,X.cultureFormats)},onSSLCheck:function(){var X=this._sslCheckBox.attr("checked");this._showAlert(this.i18n.warning,X?this.i18n.sslOnWarning:this.i18n.sslOffWarning)},onSave:function(){this._saveBtn.set("disabled",!0);this._saveBtn.set("label",this.i18n.saving);if(this._validates()){var X=this._handleUpdateAccount.bind(this),
Q=this._nameTextBox.getValue(),W=this._urlKeyTextBox.getValue(),I=this._sslCheckBox.attr("checked");this._settings.name=n.trim(Q);this._settings.urlKey=n.trim(W);this._settings.allSSL=I;Q=(W=this._languageSelect.get("store").query({displayName:this._languageSelect.get("displayedValue")}).shift())&&W.culture?W.culture:this.BROWSER_DEFAULT;this._settings.culture=Q===this.BROWSER_DEFAULT?"":Q;W&&W.cultureFormats?(W=(W=this._languageFormatSelect.get("store").query({displayName:this._languageFormatSelect.get("displayedValue")}).shift())&&
W.format?W.format:void 0)?(this._settings.culture=Q+"-"+W,this._settings.cultureFormat=W):this._settings.cultureFormat="":this._settings.cultureFormat="";Q=this._regionSelect.get("store").query({localizedName:this._regionSelect.get("displayedValue")}).shift();this._settings.region=Q&&Q.region||"";this._settings.portalProperties=this._settings.portalProperties||{};this._settings.portalProperties.mustWelcome=!0;this._settings.portalProperties.links=this._settings.portalProperties.links||{};Q=this._link.get("value");
C.isDefined(Q)&&0<Q.length?(0!==Q.indexOf("http")&&0!==Q.indexOf("mailto:")&&0<Q.indexOf("@")?Q="mailto:"+Q:0!==Q.indexOf("http")&&0>Q.indexOf("mailto:")&&0>Q.indexOf("@")&&(Q="http://"+Q),this._settings.portalProperties.links.contactUs={url:Q,visible:!!this._linkCheckBox.get("checked")}):delete this._settings.portalProperties.links.contactUs;this._settings.eueiEnabled=this._usageTrackingCheckBox.checked;this._settings.basemapGalleryGroupQuery=null;this._settings.colorSetsGroupQuery=null;this._settings.defaultBasemap=
null;this._settings.defaultExtent=null;this._settings.featuredGroups=null;this._settings.featuredGroupsId=null;this._settings.featuredItemsGroupQuery=null;this._settings.homePageFeaturedContent=null;this._settings.layerTemplatesGroupQuery=null;this._settings.rotatorPanels=null;this._settings.symbolSetsGroupQuery=null;this._settings.templatesGroupQuery=null;this._settings.contacts=this._settings.contacts||[];da.updateAccount(this._settings,X,X)}else this._saveBtn.set("disabled",!1),this._saveBtn.set("label",
this.i18n.saveContinue)},onSignOut:function(){p("esri_webmap","",{expires:-1,path:"/"});var X=this.allSSL?G.getSecureUrl():G.getHttpUrl();J.signout(X+"index.html")}})})},"arcgisonline/pages/utils/culture":function(){define(["require","exports","tslib","dojo/string","dojo/_base/kernel"],function(k,g,p,b,h){b=p.__importDefault(b);h=p.__importDefault(h);return function(){function f(){}f.getString=function(d,a,c){var n,m="id ja ko th vi zh-cn zh-hk zh-tw".split(" "),q="en ca da de el es et fi hi hu it nb nl pt-pt sv tr".split(" "),
l=null!==(n=f.getRootLocale(h.default.locale))&&void 0!==n?n:"en";c?c.number=a:c={number:a};return 1===a||-1<m.indexOf(l)?b.default.substitute(d.single,c):1!==a&&-1<q.indexOf(l)?b.default.substitute(d.multiple,c):b.default.substitute(d.unknown,c)};f.stripCultureFormat=function(d,a){return(null===d||void 0===d?0:d.length)&&(null===a||void 0===a?0:a.length)&&(a=d.indexOf("-"+a),-1<a)?d.substring(0,a):d};f.getRootLocale=function(d){if(null===d||void 0===d?0:d.length){d=d.split("-")[0];if(null===d||void 0===
d?0:d.length)d=d.toLowerCase();return d}return d};f.getLocaleFormat=function(d){if(null===d||void 0===d?0:d.length)if(d=d.split("-"),1<d.length)return d[1].toLowerCase()};f.getTrialLocale=function(d){var a=["pt-br","pt-pt","zh-cn","zh-hk","zh-tw"];return-1<(null===d||void 0===d?void 0:d.indexOf("-"))&&-1===a.indexOf(d)?this.getRootLocale(d):d};f.getActualCulture=function(d,a){var c,n=null!==(c=null===d||void 0===d?void 0:d.toLowerCase())&&void 0!==c?c:"",m=n.split("-");if(1<m.length){if(c=a.filter(function(q){return q.culture===
n}).shift())return n;c=a.filter(function(q){return q.culture===m[0]}).shift();if(null===c||void 0===c?0:c.cultureFormats){if(a=c.cultureFormats.filter(function(q){return q.format===m[1]}).shift())return c.culture}else if(c)return c.culture}return d};f.getSelectedFormat=function(d,a){return a.filter(function(c){return c.format===d}).shift()};f.getPercentString=function(d){var a=h.default.locale.toLowerCase();return"ar"===a?"%"+100*d:d.toLocaleString(a,{style:"percent"})};return f}()})},"arcgisonline/sharing/dijit/Troubleshoot":function(){define(["dojo",
"dijit","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!dijit/_Widget,dijit/_Templated,dijit/layout/ContentPane,arcgisonline/sharing/util,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/pages/dijit/PasswordStrength"],function(k,g,p){k.provide("arcgisonline.sharing.dijit.Troubleshoot");k.require("dijit._Widget");k.require("dijit._Templated");k.require("dijit.layout.ContentPane");k.require("arcgisonline.sharing.util");k.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");
k.require("arcgisonline.pages.dijit.PasswordStrength");k.requireLocalization("arcgisonline","arcgisonline");k.declare("arcgisonline.sharing.dijit.Troubleshoot",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv dojoAttachPoint\x3d"containerNode" class\x3d"esriItemLinks troubleshoot"\x3e\r\n        \x3cdiv class\x3d"subnav"\x3e\r\n          \x3cdiv class\x3d"container"\x3e\r\n            \x3ch1 class\x3d"padding-leader-half padding-trailer-half text-white"\x3e${i18n.troubleshootTitle}\x3c/h1\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"respond"\x3e\r\n        \x3cp id\x3d"instructions"\x3e${i18n.instructions}\x3c/p\x3e\r\n         \x3cdiv data-dojo-attach-point\x3d"_stackContainer" class\x3d"newStyles"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"forgotUsername" class\x3d"contentPane"\x3e\r\n              \x3ch2\x3e${i18n.forgotUsername}\x3c/h2\x3e\r\n              \x3cp\x3e${!i18n.forgotUsernameInstructions}\x3c/p\x3e\r\n              \x3clabel class\x3d"esriFloatLeading" for\x3d"email"\x3e${i18n.emailLabel}\x26nbsp;\x3c/label\x3e\r\n              \x3cinput id\x3d"email" data-dojo-attach-point\x3d"_email" name\x3d"email" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n              \x3cbr /\x3e\r\n              \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-event\x3d"onClick:_submitEmail" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.send}\x3c/button\x3e\r\n              \x3cbr/\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"forgotPassword" class\x3d"contentPane"\x3e\r\n              \x3ch2\x3e${i18n.forgotPassword}\x3c/h2\x3e\r\n              \x3cp\x3e${!i18n.forgotPasswordInstructions}\x3c/p\x3e\r\n              \x3clabel class\x3d"esriFloatLeading" for\x3d"username"\x3e${i18n.usernameLabel}\x26nbsp;\x3c/label\x3e\r\n              \x3cinput id\x3d"username" name\x3d"userName" data-dojo-attach-point\x3d"_userName" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n              \x3cbr /\x3e\r\n              \x3cbutton data-dojo-attach-event\x3d"onClick:_submitUsername" data-dojo-type\x3d"dijit/form/Button" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.customRoles.continueLabel}\x3c/button\x3e\r\n              \x3cbr /\x3e\r\n          \x3c/div\x3e\r\n         \x3cdiv class\x3d"contentPane newStyles" dojoAttachPoint\x3d"changePassword" style\x3d"display:none;"\x3e\r\n             \x3ch2\x3e${i18n.resetPassword}\x3c/h2\x3e\r\n             \x3cp dojoAttachPoint\x3d"_securityQuestionInstructions" class\x3d"securityQuestion"\x3e${i18n.securityQuestionInstructions}\x3c/p\x3e\r\n             \x3clabel class\x3d"securityQuestion esriFloatLeading" dojoAttachPoint\x3d"_securityQuestion"\x3e\x3c/label\x3e\r\n             \x3cinput dojoAttachPoint\x3d"_securityAnswer" name\x3d"answer" dojoType\x3d"dijit.form.ValidationTextBox" trim\x3d"true" class\x3d"ieFix securityQuestion" /\x3e\r\n             \x3cdiv class\x3d"prompt securityQuestion"\x3e${i18n.securityQuestionPrompt}\x3c/div\x3e\r\n             \x3cdiv class\x3d"portal-only" style\x3d"display:none;"\x3e\r\n                 \x3cbr/\x3e\r\n                 \x3cp\x3e${i18n.enterNewPassword}\x3c/p\x3e\r\n                 \x3cdiv class\x3d"password-1"\x3e\r\n                     \x3cspan\x3e\x3clabel for\x3d"password"\x3e${i18n.newPasswordLabel}\x3c/label\x3e\r\n                      \x3cinput id\x3d"password" dojoAttachPoint\x3d"_newPassword" name\x3d"password" dojoAttachEvent\x3d"onKeyUp:isValidPassword" class\x3d"required" dojoType\x3d"dijit.form.TextBox" type\x3d"password" trim\x3d"true"\x3e\r\n                      \x3cdiv class\x3d"strength-meter"\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_strengthMeter"\x3e\x3c/div\x3e\r\n                        \x3cdiv class\x3d"input-error-message" data-dojo-attach-point\x3d"_passwordError"\x3e\x3c/div\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/span\x3e\r\n                 \x3c/div\x3e\r\n                 \x3cbr /\x3e\r\n                 \x3cdiv class\x3d"password-2"\x3e\r\n                     \x3clabel class\x3d"left"\x3e${i18n.reenterPasswordLabel}\x3c/label\x3e\r\n                     \x3cinput name\x3d"verify" dojoAttachPoint\x3d"_verifyPassword" type\x3d"password" dojotype\x3d"dijit.form.ValidationTextBox" trim\x3d"true"/\x3e\r\n                 \x3c/div\x3e\r\n             \x3c/div\x3e\r\n             \x3cbutton dojoAttachEvent\x3d"onClick:_submitReset" dojoType\x3d"dijit.form.Button" class\x3d"calcite blue esriFloatLeading indentBtn" style\x3d"margin-left: 205px;"\x3e${i18n.mosaicRulePanel.resetLabel}\x3c/button\x3e\r\n         \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"mfaHelp" class\x3d"contentPane"\x3e\r\n             \x3cbr /\x3e\r\n             \x3ch2\x3e${i18n.mfaHelpMsg}\x3c/h2\x3e\r\n             \x3cp\x3e${!i18n.mfaHelpInstructions}\x3c/p\x3e\r\n             \x3clabel class\x3d"esriFloatLeading" for\x3d"username"\x3e${i18n.usernameLabel}\x26nbsp;\x3c/label\x3e\r\n             \x3cinput id\x3d"mfa_username" name\x3d"userName" data-dojo-attach-point\x3d"_mfaUserName" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n             \x3cbr /\x3e\r\n             \x3cbutton data-dojo-attach-event\x3d"onClick:_submitMfaUsername" data-dojo-type\x3d"dijit/form/Button" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.customRoles.continueLabel}\x3c/button\x3e\r\n             \x3cbr /\x3e\r\n          \x3c/div\x3e\r\n         \x3cdiv class\x3d"contentPane newStyles" dojoAttachPoint\x3d"disableMfa" style\x3d"display:none;clear:both;"\x3e\r\n             \x3cbr /\x3e\r\n             \x3ch2\x3e${i18n.mfaSecurityQuestionTitle}\x3c/h2\x3e\r\n             \x3cp class\x3d"securityQuestion"\x3e${i18n.mfaSecurityQuestionMsg}\x3c/p\x3e\r\n             \x3clabel class\x3d"mfaSecurityQuestion esriFloatLeading" dojoAttachPoint\x3d"_mfaSecurityQuestion"\x3e\x3c/label\x3e\r\n             \x3cinput dojoAttachPoint\x3d"_mfaSecurityAnswer" name\x3d"answer" dojoType\x3d"dijit.form.ValidationTextBox" trim\x3d"true" class\x3d"ieFix securityQuestion" /\x3e\r\n             \x3cdiv class\x3d"prompt mfaSecurityQuestion"\x3e${i18n.securityQuestionPrompt}\x3c/div\x3e\r\n             \x3cbutton dojoAttachEvent\x3d"onClick:_submitMfaReset" dojoType\x3d"dijit.form.Button" class\x3d"calcite blue esriFloatLeading indentBtn" style\x3d"margin-left: 205px;"\x3e${i18n.send}\x3c/button\x3e\r\n         \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"register" title\x3d"${i18n.links.register}" style\x3d"display:none;"\x3e\r\n            \x3cp class\x3d"marginless"\x3e\x3cb\x3e${i18n.signInWidget.agsTrial}\x3c/b\x3e\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsSubscriptionInfo}\x3c/p\x3e\r\n            \x3ca class\x3d"calcite btn small blue" href\x3d"/about/free-trial.html?origin\x3darcgis"\x3e${i18n.signInWidget.ags30DayTrial}\x3c/a\x3e\x3cbr/\x3e\r\n            \x3cp\x3e\x3cb\x3e${i18n.signInWidget.agsNoTrial}\x3c/b\x3e\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsCreatePersonalMsg}.\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsHavePersonal}\x3c/p\x3e\r\n            \x3ca id\x3d"registerBtn" class\x3d"calcite btn small light"\x3e${i18n.signInWidget.agsRegisterPersonalBtn}\x3c/a\x3e\x3cbr/\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsCreatePersonal}\x3c/p\x3e\r\n            \x3ca id\x3d"createBtn" class\x3d"calcite btn small light"\x3e${i18n.signInWidget.agsCreatePersonalBtn}\x3c/a\x3e\r\n          \x3c/div\x3e\r\n          \x3cbr /\x3e\r\n          \x3cp data-dojo-attach-point\x3d"gotoStart" class\x3d"indent notstart" style\x3d"display:none;"\x3e${i18n.otherQuestions}\x26nbsp;\x26nbsp;\x3ca target\x3d"_blank" data-dojo-attach-event\x3d"onclick:_troubleshoot"\x3e${i18n.seeTroubleshooting}\x3c/a\x3e\x3c/p\x3e\r\n      \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3cbr /\x3e\r\n\x3c/div\x3e\r\n',
baseClass:"esriTroubleshoot",_util:arcgisonline.sharing.util,_account:arcgisonline.sharing.geow.Account,postMixInProperties:function(){this.inherited(arguments);k.mixin(this,k.queryToObject(window.location.search.slice(1)));if(this.returnUrl){var b=window.location.host.split(".").slice(-2).join(".")+"/";-1===this.returnUrl.indexOf(b)&&-1===this.returnUrl.indexOf("arcgis.com/")&&-1===this.returnUrl.indexOf("esri.com/")&&(this.returnUrl=null)}this.i18n=k.mixin({},k.i18n.getLocalization("arcgisonline",
"arcgisonline").common);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").troubleshoot);k.mixin(this.i18n,{customRoles:k.i18n.getLocalization("arcgisonline","arcgisonline").customRoles});k.mixin(this.i18n,{mosaicRulePanel:k.i18n.getLocalization("arcgisonline","arcgisonline").mosaicRulePanel});k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").newUser);k.mixin(this.i18n,{signInWidget:k.i18n.getLocalization("arcgisonline","arcgisonline").signInWidget});this.i18n.errors=
k.mixin(k.i18n.getLocalization("arcgisonline","arcgisonline").common.errors,k.i18n.getLocalization("arcgisonline","arcgisonline").troubleshoot.errors,k.i18n.getLocalization("arcgisonline","arcgisonline").newUser.errors);this.i18n.questions=k.mixin(k.i18n.getLocalization("arcgisonline","arcgisonline").securityQuestions,{0:this.i18n.questions.question0})},startup:function(){this.inherited(arguments);this._connects=[];esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;this._errorDlg=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
this._svcUrl=esriGeowConfig.restBaseUrl+(esriGeowConfig.restBaseUrl.lastIndexOf("/")===esriGeowConfig.restBaseUrl.length-1?"":"/");this._communityUrl=this._svcUrl+"community/";this._userUrl=this._communityUrl+"users/";this._requestParams={f:"json"};this._createStrengthMeter();this.connect(k.byId("registerBtn"),"onclick",k.hitch(this,function(){window.location=esriGeowConfig.signup}));this.connect(k.byId("createBtn"),"onclick",k.hitch(this,function(){window.location=esriGeowConfig.createAccount}));
this.connect(this._stackContainer,"onClick",k.hitch(this,function(){k.style(this.changePassword,"display","none")}));this._account.getSelf(k.hitch(this,function(b){this.portalSelf=b;this._initHelpMgr();this._troubleshoot()}))},destroy:function(){this.inherited(arguments);k.forEach(this._connects,k.disconnect)},_initHelpMgr:function(){var b=arcgisonline.sharing.dijit.HelpManager.prototype.statics.getInstance(),h=setInterval(k.hitch(this,function(){if(b.isLoaded())if(clearInterval(h),esriGeowConfig&&
esriGeowConfig.self&&esriGeowConfig.self.isPortal)k.query(".helpLink").forEach(esri.hide),k.query("#instructions").forEach(function(d){k.style(d,"visibility","hidden")});else{var f=b.getHelpUrl("120000466");k.query(".helpLink").attr("href",f)}}),200)},_createStrengthMeter:function(){this._account.getSelf(function(b){this._strengthMeter=new arcgisonline.pages.dijit.PasswordStrength({portal:esriGeowConfig.self},this._strengthMeter);this._strengthMeter.update()}.bind(this))},isValidPassword:function(){var b=
this._newPassword.get("value");return this._strengthMeter.update(b).then(function(h){h=h.isValid;this._showInvalidPasswordError(h);return h}.bind(this))},_showInvalidPasswordError:function(b){b?k.addClass(this._passwordError,"hide"):(k.attr(this._passwordError,"innerHTML",this.i18n.passwordHintText),k.removeClass(this._passwordError,"hide"))},_switchPane:function(b){},_forgotPassword:function(){k.attr(this._forgotPasswordTitle,"innerHTML",this.i18n.forgotPassword);this._switchPane(this.forgotPassword);
this._userName.focus()},_changePassword:function(){k.attr(this._forgotPasswordTitle,"innerHTML",this.i18n.resetPassword);this._switchPane(this.forgotPassword);this._userName.focus()},_forgotUsername:function(){this._switchPane(this.forgotUsername);this._email.focus()},_troubleshoot:function(){var b=this.portalSelf||{};!1===esriGeowConfig.showForgotUsername&&this._stackContainer.removeChild(this.forgotUsername);this.isPortal=b&&b.isPortal;b&&(b.isPortal||b.urlKey)&&(this._stackContainer.removeChild(this.register),
this.isPortal&&(k.query(".portal-only").forEach(esri.show),k.attr(this._securityQuestionInstructions,"innerHTML",this.i18n.securityQuestionInstructionsNoEmail),this._stackContainer.removeChild(this.mfaHelp)));this._clear();this._securityQuestionIdx=-1;this._switchPane(this._start)},_redirectToSignin:function(){window.location=this.returnUrl||"signin.html"},_submitEmail:function(b){b.preventDefault();if(!this._checkRequired([this._email]))return b=this._communityUrl+"forgotUsername",this._disable(!0),
this._request(b,{email:this._getCleanString(this._email)}).then(k.hitch(this,function(){this._redirectToSignin()}))},_submitUsername:function(b){b.preventDefault();this._newPassword.set("value","");this._verifyPassword.set("value","");if(!this._checkRequired([this._userName]))return b=this._userUrl+this._getCleanString(this._userName)+"/forgotPassword",this._disable(!0),this._request(b,{}).then(k.hitch(this,function(h){h=h||{};"arcgis"===h.provider?(this._securityQuestionIdx=(-1===h.securityQuestionIdx?
0:h.securityQuestionIdx)||0,k.attr(this._securityQuestion,"innerHTML",this.i18n.questions[h.securityQuestionIdx]),this._securityQuestionIdx||this._showError(this.i18n.errors[this.isPortal?"noSecurityPortal":"noSecurity"]),k.query(".securityQuestion",this.domNode).style("display",""),k.style(this.changePassword,"display",this._securityQuestionIdx?"":"none"),this._securityAnswer.focus()):"enterprise"===h.provider?this._showError(this.i18n.errors.administrator):(this._isEcas=!0,k.query(".securityQuestion",
this.domNode).style("display","none"),k.style(this.changePassword,"display",""))}))},_getCleanString:function(b){b=b.get("value")||"";return(new DOMParser).parseFromString(b,"text/html").body.textContent||""},_submitMfaUsername:function(b){b.preventDefault();if(!this._checkRequired([this._mfaUserName]))return b=this._userUrl+this._getCleanString(this._mfaUserName)+"/forgotPassword",this._disable(!0),this._mfaUserNameCheck=!0,this._request(b,{}).then(k.hitch(this,function(h){h=h||{};this._securityQuestionIdx=
(-1===h.securityQuestionIdx?0:h.securityQuestionIdx)||0;k.attr(this._mfaSecurityQuestion,"innerHTML",this.i18n.questions[h.securityQuestionIdx]);this._securityQuestionIdx||this._showError(this.i18n.errors.noSecurity);k.query(".disableMfa",this.domNode).style("display","");k.style(this.disableMfa,"display",this._securityQuestionIdx?"":"none");this._mfaSecurityAnswer.focus()}))},_submitMfaReset:function(b){b.preventDefault();b={securityAnswer:this._getCleanString(this._mfaSecurityAnswer),securityQuestionIdx:this._securityQuestionIdx};
if(!this._checkRequired([this._mfaSecurityAnswer])){var h=this._util.getSecureUrl(this._userUrl)+this._mfaUserName.get("value")+"/disableMfaRequest";this._disable(!0);return this._request(h,b).then(k.hitch(this,function(f){var d=k.connect(this._errorDlg,"onHide",k.hitch(this,function(){d.remove();this._redirectToSignin()}));this._showError(this.i18n.errors.mfaEmailSent)}))}},_submitReset:function(b){b.preventDefault();var h={securityAnswer:this._getCleanString(this._securityAnswer),securityQuestionIdx:this._securityQuestionIdx};
if(this.isPortal){b=[this._newPassword,this._verifyPassword];this._isEcas||b.unshift(this._securityAnswer);if(this._checkRequired(b))return;if(this._newPassword.get("value")!==this._verifyPassword.get("value"))return this._verifyPassword.focus(),this._showError(this.i18n.errors.passwordsNotMatch);h.newPassword=this._newPassword.get("value")}else{b=[this._securityAnswer];if(this._checkRequired(b))return;h.email=!0}if(this.isPortal)this.isValidPassword().then(function(f){if(f)return this._makeResetRequest(h);
this._newPassword.focus();return!this._showError(k.mixin(this.i18n.errors.invalidPassword,{message:this.i18n.passwordHintText}))}.bind(this));else return this._makeResetRequest(h)},_makeResetRequest:function(b){var h=this._util.getSecureUrl(this._userUrl)+this._userName.get("value")+"/reset";this._disable(!0);return this._request(h,b).then(k.hitch(this,function(f){if(this.isPortal)this._redirectToSignin();else{var d=k.connect(this._errorDlg,"onHide",k.hitch(this,function(){d.remove();this._redirectToSignin()}));
this._showError(this.i18n.errors.emailSent)}}))},_disable:function(b){k.query(".esriTroubleshoot .dijitTextBox, .esriTroubleshoot .dijitButton").map(g.byNode).forEach(function(h){h.set("disabled",b)})},_clear:function(){k.query(".esriTroubleshoot .dijitTextBox").map(g.byNode).forEach(function(b){b.set("value","")})},_checkRequired:function(b){return(b=k.filter(b,k.hitch(this,function(h){return this._isEmpty(h)})))&&b.length?(b[0].focus(),this._showError(this.i18n.errors.required[b[0].name])):!1},
_isEmpty:function(b){b=b.get("value");return(this.trim?/^\s*$/:/^$/).test(b)},_request:function(b,h){return this._util.request({url:b,content:h},{usePost:!0}).then(k.hitch(this,function(f){this._mfaUserNameCheck=!1;this._disable(!1);return f.error?this._showError(f.error):f}),k.hitch(this,function(f){this._disable(!1);f&&"COM_0018"===f.messageCode&&this._userName?(f=this._mfaUserNameCheck?this._getCleanString(this._mfaUserName):this._getCleanString(this._userName),f={message:esri.substitute({username:f},
this.i18n.errors.COM_0018)}):f&&"COM_0049"===f.messageCode?f={message:this.i18n.errors.COM_0049.message}:f&&"COM_1037"===f.messageCode?f={message:this.i18n.errors.COM_1037}:f&&"COM_1059"===f.messageCode?f={message:this.i18n.errors.COM_1059}:f&&"COM_1055"===f.messageCode?f={message:this.i18n.errors.COM_1055}:f&&"DB_0003"===f.messageCode?f={message:this.i18n.errors.DB_0003}:f&&"DB_0002"===f.messageCode&&(f={message:this.i18n.errors.DB_0002});this._showError(f);this._mfaUserNameCheck=!1;throw f;}))},
_showError:function(b){b.message=b.message&&b.message.replace(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,"")||"";b.message=this._util.stripHTML(b.message);b=b.error||b||{};b.code=b.code||0;b=k.mixin(k.mixin({},this.i18n.errors.error),b);this._errorDlg.show(b);return!0}})})},"arcgisonline/sharing/dijit/dialog/ExportDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_WidgetBase,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,dijit/form/Button,dijit/form/TextBox,dijit/layout/BorderContainer,dijit/layout/ContentPane,dijit/form/RadioButton,dojo/data/ItemFileWriteStore,arcgisonline/pages/utils/categories,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/SaveItem,arcgisonline/sharing/geow/Folder,arcgisonline/sharing/util,esri/Evented"],
function(k,g,p){k.provide("arcgisonline.sharing.dijit.dialog.ExportDlg");k.require("dijit.Dialog");k.require("dijit._WidgetBase");k.require("dijit._TemplatedMixin");k.require("dijit._WidgetsInTemplateMixin");k.require("dijit.form.Button");k.require("dijit.form.TextBox");k.require("dijit.layout.BorderContainer");k.require("dijit.layout.ContentPane");k.require("dijit.form.RadioButton");k.require("dojo.data.ItemFileWriteStore");k.require("arcgisonline.pages.utils.categories");k.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");
k.require("arcgisonline.sharing.dijit.ComboBox");k.require("arcgisonline.sharing.dijit.SaveItem");k.require("arcgisonline.sharing.geow.Folder");k.require("arcgisonline.sharing.util");k.require("esri.Evented");k.declare("arcgisonline.sharing.dijit.dialog.ExportDlg",[g._WidgetBase,g._TemplatedMixin,g._WidgetsInTemplateMixin,esri.Evented],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"exportDialog" id\x3d"export-dialog" title\x3d"${i18n.exportDialogTitle}" execute\x3d""\x3e\r\n    \x3ccalcite-notice data-dojo-attach-point\x3d"staleData" icon width\x3d"auto" color\x3d"red" class\x3d"leader-half trailer-half text-constrain"\x3e\r\n      \x3cdiv slot\x3d"notice-title"\x3e${i18n.staleData}\x3c/div\x3e\r\n      \x3cdiv slot\x3d"notice-message"\x3e${i18n.waitToExport}\x3c/div\x3e\r\n    \x3c/calcite-notice\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemForm" data-dojo-type\x3d"arcgisonline/sharing/dijit/SaveItem"\x3e\x3c/div\x3e\r\n    \x3cfieldset data-dojo-attach-point\x3d"_featureCollectionDiv" class\x3d"featureCollectionOnly hide"\x3e\r\n      \x3clabel\x3e\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"generalizeChk" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-props\x3d"checked:false" name\x3d"generalize" /\x3e${i18n.generalize}\x3c/label\x3e\r\n      \x3clabel\x3e\x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" name\x3d"generalize" /\x3e${i18n.keepOrig}\x3c/label\x3e\r\n    \x3c/fieldset\x3e\r\n\r\n    \x3cdiv class\x3d"esriFloatTrailing right"\x3e\r\n      \x3cspan dojoAttachPoint\x3d"exportingLabel" style\x3d"visibility:hidden;"\x3e${i18n.exportingLabel}\x3c/span\x3e\r\n      \x3cdiv class\x3d"cancel" data-dojo-attach-point\x3d"cancelBtn" data-dojo-attach-event\x3d"onClick:onCancel" data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"type:\'button\'"\x3e${i18n.cancel}\x3c/div\x3e\r\n      \x3cdiv class\x3d"primary" data-dojo-attach-point\x3d"exportBtn" data-dojo-attach-event\x3d"onClick:onExport" data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"type:\'button\'"\x3e${i18n.exportLabel}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
util:arcgisonline.sharing.util,folder:arcgisonline.sharing.geow.Folder,item:null,layerId:-1,init:!1,exportType:null,exportResponse:null,checkStatusInterval:null,checkingStatus:!1,statusCheckIntervalTime:4E3,saveItemForm:null,exportDialog:null,exportBtn:null,cancelBtn:null,i18n:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.ExportDlg);return this._instance}},onDone:function(){},postMixInProperties:function(){this.inherited(arguments);
this.i18n=k.i18n.getLocalization("arcgisonline","arcgisonline").common;k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").exportDlg);k.mixin(this.i18n,{generalize:k.i18n.getLocalization("arcgisonline","arcgisonline").addLayerFromFileDlg.generalize});k.mixin(this.i18n,{keepOrig:k.i18n.getLocalization("arcgisonline","arcgisonline").addLayerFromFileDlg.keepOrig});this._webMercatorValues={3857:1,102113:1,102100:1,900913:1}},postCreate:function(){this.inherited(arguments);this.init||
(this.init=!0)},startup:function(){this.inherited(arguments);esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esriGeowConfig.proxyUrl&&(esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyUrl)},destroy:function(){this._onSaveItemValidateHandle&&(this._onSaveItemValidateHandle.remove(),this._onSaveItemValidateHandle=null);this.exportDialog.destroyRecursive();this.exportDialog=null;this.inherited(arguments)},show:function(b,h,f){this._showDlg(b,h,f)},showShapefile:function(b,h){this._showDlg(b,
h,arcgisonline.sharing.dijit.dialog.ExportDlg.util.shapefileType)},showCSV:function(b,h){this._showDlg(b,h,arcgisonline.sharing.dijit.dialog.ExportDlg.util.csvType)},showFileGDB:function(b,h){this._showDlg(b,h,arcgisonline.sharing.dijit.dialog.ExportDlg.util.fileGDB)},showGeoJson:function(b,h){this._showDlg(b,h,arcgisonline.sharing.dijit.dialog.ExportDlg.util.geoJson)},showFeatureCollection:function(b,h){this._showDlg(b,h,arcgisonline.sharing.dijit.dialog.ExportDlg.util.featureCollection)},_showDlg:function(b,
h,f){this.clear();this.item=b;this._setDialogTitle(f);this._setLayerDetails(h);this._checkForStaleData(b,h);this._initTags();this._initCategories();this.exportDialog.show();this.own(k.connect(this.exportDialog,"onHide",k.hitch(this,function(){this.destroy()})))},_checkForStaleData:function(b,h){var f,d;b.layers&&b.layers.length&&"Feature Service"===b.type&&-1<b.typeKeywords.indexOf("Hosted Service")&&(h&&!h.length?d=h.editingInfo&&h.editingInfo.lastEditDate:b.layers.forEach(function(a){(f=a.editingInfo&&
a.editingInfo.lastEditDate)&&(!d||d<f)&&(d=f)}.bind(this)),b=Date.now()-6E5,d&&d>=b&&(this.staleData.active=!0))},_initTags:function(){this.saveItemForm.loadTags().then(k.hitch(this,function(){this.saveItemForm.set("tags","")}))},_initCategories:function(){this.saveItemForm.loadCategories(this.item.categories)},_setDialogTitle:function(b){this.exportType=b;arcgisonline.sharing.dijit.dialog.ExportDlg.util.shapefileType===this.exportType?this.exportDialog.set("title",this.i18n.exportDialogTitle+" "+
this.i18n.toShapefile):arcgisonline.sharing.dijit.dialog.ExportDlg.util.csvType===this.exportType?this.exportDialog.set("title",this.i18n.exportDialogTitle+" "+this.i18n.toCSV):arcgisonline.sharing.dijit.dialog.ExportDlg.util.fileGDB===this.exportType?this.exportDialog.set("title",this.i18n.exportDialogTitle+" "+this.i18n.toFileGDB):arcgisonline.sharing.dijit.dialog.ExportDlg.util.geoJson===this.exportType?this.exportDialog.set("title",this.i18n.exportDialogTitle+" "+this.i18n.toGeoJson):arcgisonline.sharing.dijit.dialog.ExportDlg.util.featureCollection===
this.exportType?this.exportDialog.set("title",this.i18n.exportDialogTitle+" "+this.i18n.toFeatureCollection):arcgisonline.sharing.dijit.dialog.ExportDlg.util.kmlType===this.exportType?this.exportDialog.set("title",this.i18n.exportDialogTitle+" "+this.i18n.toKML):arcgisonline.sharing.dijit.dialog.ExportDlg.util.excelType===this.exportType&&this.exportDialog.set("title",this.i18n.exportDialogTitle+" "+this.i18n.toExcel)},_setLayerDetails:function(b){this._isTableLayer=this._isWebMercator=!1;b&&esri._isDefined(b.id)?
(this.layerId=b.id,this._layers=[b],this.saveItemForm.set("title",b.name),this._isWebMercator=b.extent&&b.extent.spatialReference&&b.extent.spatialReference.wkid in this._webMercatorValues,this._extent=b.extent):b&&b.length&&(this._layers=b,this._isWebMercator=b[0].extent&&b[0].extent.spatialReference&&b[0].extent.spatialReference.wkid in this._webMercatorValues,this._isTableLayer=k.every(b,function(h){return"Table"===h.type}),this._extent=b[0].extent,this.saveItemForm.set("title",1===b.length?b[0].name:
this.item.title));this._isWebMercator&&!this._isTableLayer&&this.exportType===arcgisonline.sharing.dijit.dialog.ExportDlg.util.featureCollection&&(k.removeClass(this._featureCollectionDiv,"hide"),this.generalizeChk.set("checked",!0))},clear:function(){this.exportDialog.set("title",this.i18n.exportDialogTitle);this.item=null;this.layerId=-1;this.checkStatusInterval=this.exportResponse=this.exportType=null;this.checkingStatus=!1;this.saveItemForm.set("title","");this.saveItemForm.set("tags","");this.saveItemForm.set("summary",
"");this.saveItemForm.set("requires",["title","tags"]);k.style(this.exportingLabel,"visibility","hidden");this.exportBtn.set("disabled",!0);this._onSaveItemValidateHandle=k.subscribe("onSaveItemValidate",k.hitch(this,this.validate));this.saveItemForm.hideRow("folder");k.query(".select2-container.select2-container-multi",this.saveItemForm.domNode).style({minWidth:"334px"});k.addClass(this._featureCollectionDiv,"hide");this.generalizeChk.set("checked",!1)},hide:function(){return this.exportDialog.hide()},
validate:function(b){b=this.saveItemForm.get("title");var h=this.saveItemForm.get("tags");this.exportBtn.set("disabled",!b||!h)},validates:function(){var b=this.saveItemForm.get("title"),h=this.saveItemForm.get("tags");return b&&h},setWait:function(){k.query("#export-dialog").style("cursor","wait");k.style(this.exportingLabel,"visibility","visible");this.exportBtn.set("disabled",!0)},unsetWait:function(){k.query("#export-dialog").style("cursor","default");k.style(this.exportingLabel,"visibility",
"hidden");this.exportBtn.set("disabled",!1)},exportItem:function(){if(this._moveFailed)this.updateItem(this._moveFailed.itemId,"/").then(k.hitch(this,function(c){this.unsetWait();this.onDone(c)}));else{this.setWait();var b=this.saveItemForm.get("title"),h=this.generalizeChk.get("checked"),f={maxAllowableOffset:1,quantizationParameters:{tolerance:1}},d=arcgisonline.sharing.dijit.dialog.ExportDlg.util.shapefileType;arcgisonline.sharing.dijit.dialog.ExportDlg.util.csvType==this.exportType?d=arcgisonline.sharing.dijit.dialog.ExportDlg.util.csvType:
arcgisonline.sharing.dijit.dialog.ExportDlg.util.fileGDB==this.exportType?d=arcgisonline.sharing.dijit.dialog.ExportDlg.util.fileGDB:arcgisonline.sharing.dijit.dialog.ExportDlg.util.geoJson==this.exportType?d=arcgisonline.sharing.dijit.dialog.ExportDlg.util.geoJson:arcgisonline.sharing.dijit.dialog.ExportDlg.util.featureCollection==this.exportType?d=arcgisonline.sharing.dijit.dialog.ExportDlg.util.featureCollection:arcgisonline.sharing.dijit.dialog.ExportDlg.util.kmlType==this.exportType?d="kml":
arcgisonline.sharing.dijit.dialog.ExportDlg.util.excelType==this.exportType&&(d="excel");var a=k.map(this._layers,k.hitch(this,function(c){return h?k.mixin({id:c.id},f):{id:c.id}}));b={itemId:this.item.id,title:b,exportFormat:d,exportParameters:-1<this.layerId?{layers:a}:h?f:null};this.item.isOwner&&this.item.isDataView&&(b.exportParameters=k.mixin(b.exportParameters||{},{enforceFieldVisibility:!0}));b.exportParameters&&(b.exportParameters=JSON.stringify(b.exportParameters));d=this.util.getUser();
this.util.request({url:esriGeowConfig.restBaseUrl+"content/users/"+d.email+"/export",content:b},{usePost:!0}).then(k.hitch(this,this.handleExport),k.hitch(this,this.displayError))}},handleExport:function(b){!b||b.code||b.message?this.displayError(b):(this.exportResponse=b,this.checkStatusInterval=setInterval(k.hitch(this,this.checkStatus),this.statusCheckIntervalTime))},checkStatus:function(){if(this.exportResponse&&!this.checkingStatus){var b={jobId:this.exportResponse.jobId,jobType:"export"},h=
this.util.getUser();h=esriGeowConfig.restBaseUrl+"content/users/"+h.email+"/items/"+this.exportResponse.exportItemId+"/status";this.checkingStatus=!0;this.util.request({url:h,content:b}).then(k.hitch(this,function(f){this.handleStatusCheck(f);this.checkingStatus=!1}),k.hitch(this,function(f){this.displayError(f);this.checkingStatus=!1}))}},handleStatusCheck:function(b){b.status&&("completed"===b.status?(clearInterval(this.checkStatusInterval),this.updateExportedItemDetails(b)):"failed"===b.status&&
(clearInterval(this.checkStatusInterval),this.updateExportedItemDetailsAndFail(b)))},updateExportedItemDetailsAndFail:function(b){this.getItemDetails(this.exportResponse.exportItemId).then(k.hitch(this,function(h){var f=[],d=esriGeowConfig.self.hasCategorySchema&&this.saveItemForm.get("categories")||[];0<d.length&&f.push(arcgisonline.pages.utils.categories.setItemCategories([h.id],d));f.push(this.updateItem(h.id,h.ownerFolder));k.promise.all(f).then(k.hitch(this,function(){this.unsetWait();this.displayFailure(b.statusMessage)}))}))},
updateExportedItemDetails:function(b){this.getItemDetails(b.itemId).then(k.hitch(this,function(h){var f=[],d=esriGeowConfig.self.hasCategorySchema&&this.saveItemForm.get("categories")||[];0<d.length&&f.push(arcgisonline.pages.utils.categories.setItemCategories([h.id],d));f.push(this.updateItem(h.id,h.ownerFolder));k.promise.all(f).then(k.hitch(this,function(){this.unsetWait();this.onDone(b)}))}))},moveItem:function(b,h){var f=new k.Deferred,d=this.util.getUser();d=esriGeowConfig.restBaseUrl+"content/users/"+
d.email+"/items/"+b+"/move";var a={folder:h||"/"};this._moveFailed=null;h&&"/"!==h&&""!==h?this.util.request({url:d,content:a},{usePost:!0}).then(k.hitch(this,function(c){f.resolve(c)}),k.hitch(this,function(c){if(c&&"CONT_0011"===c.messageCode){var n=this.saveItemForm.get("title");n=k.string.substitute(this.i18n.duplicateFound,{type:this.exportType,title:n});arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:n});this._moveFailed=
k.mixin(c,{itemId:b,folderId:h});this.unsetWait()}})):f.resolve({itemId:b});return f},updateItem:function(b,h){var f=this.saveItemForm.get("title"),d=this.saveItemForm.get("tags"),a=this.saveItemForm.get("summary"),c=this.saveItemForm.get("folderId"),n=esriGeowConfig.restBaseUrl+"content/items/"+this.exportResponse.exportItemId+"/data",m=this.util.getUser();m=esriGeowConfig.restBaseUrl+"content/users/"+m.email;h&&0<h.length&&(m+="/"+h);m+="/items/"+this.exportResponse.exportItemId+"/update";h={title:f,
tags:d,snippet:a};this._moveFailed||(h=k.mixin(h,{folderId:c}));arcgisonline.sharing.dijit.dialog.ExportDlg.util.kmlType==this.exportType&&(h.url=n);return this.util.request({url:m,content:h},{usePost:!0}).then(k.hitch(this,"moveItem",b,c))},getItemDetails:function(b){return this.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+b})},goToItem:function(b){this.hide().then(k.hitch(this,function(){this.unsetWait();window.location=esriGeowConfig.baseUrl+"item.html?id\x3d"+b}))},checkTitle:function(){var b=
this.saveItemForm.get("title"),h=this.saveItemForm.get("folderId"),f=arcgisonline.sharing.dijit.dialog.ExportDlg.util[this.exportType]||this.exportType,d=this.util.getUser().username;return this.util.request({url:esriGeowConfig.restBaseUrl+"search",content:{q:'title:"'+b+'" AND type:"'+f+'" AND owner:"'+d+'" AND ownerfolder:"'+(h&&"/"!==h?h:"root")+'"'}})},displayFailure:function(b){if(b)try{var h=k.json.parse(b)}catch(d){h=b}var f=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
f.onOkClick=k.hitch(this,function(d){d.hide();this.onCancel()},f);h.message&&(b=h.message);f.show({title:this.i18n.errorTitle,message:b})},displayError:function(b){if(b){var h=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();h.onOkClick=k.hitch(this,function(f){f.hide();this.onCancel()},h);b.code&&b.message?h.show({title:this.i18n.errorTitle,message:b.message}):h.show({title:this.i18n.errorTitle,message:b})}},onChooseTags:function(){arcgisonline.sharing.dijit.dialog.TagsDlg.prototype.statics.getInstance().show()},
onExport:function(){this.validates()&&this.checkTitle().then(k.hitch(this,function(b){0<b.total?(b=this.saveItemForm.get("title"),b=k.string.substitute(this.i18n.duplicateFound,{type:arcgisonline.sharing.dijit.dialog.ExportDlg.util[this.exportType]||this.exportType,title:b}),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorTitle,message:b})):this.exportItem()}))},onCancel:function(b){b&&b.preventDefault();this.hide();this.destroy()}});arcgisonline.sharing.dijit.dialog.ExportDlg.util=
{shapefileType:"Shapefile",csvType:"CSV",fileGDB:"File Geodatabase",geoJson:"GeoJson",featureCollection:"Feature Collection",kmlType:"KML",excelType:"Excel",CSV:"CSV Collection",KML:"KML Collection",Excel:"Microsoft Excel",requiredBorder:"1px dotted orangered",normalBorder:"1px solid #bbb"}})},"arcgisonline/sharing/dijit/SaveItem":function(){define("require exports tslib ../../esriGeowConfig ../../pages/pageUtil ../../pages/utils/arrays ../../pages/utils/dom ../../pages/dijit/CategoryPicker ../util ../geow/Folder ../../tsutils/declareDecorator dijit/_TemplatedMixin dijit/_WidgetBase dijit/_WidgetsInTemplateMixin dojo/aspect dojo/cookie dojo/Deferred dojo/i18n!../../nls/arcgisonline dojo/on dojo/query dojo/topic dojo/_base/lang dojo/data/ItemFileWriteStore dojo/text!./templates/SaveItem.html".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C){b=p.__importDefault(b);h=p.__importDefault(h);f=p.__importDefault(f);d=p.__importDefault(d);a=p.__importDefault(a);c=p.__importDefault(c);n=p.__importDefault(n);m=p.__importDefault(m);q=p.__importDefault(q);l=p.__importDefault(l);e=p.__importDefault(e);t=p.__importDefault(t);x=p.__importDefault(x);r=p.__importDefault(r);w=p.__importDefault(w);u=p.__importDefault(u);v=p.__importDefault(v);y=p.__importDefault(y);z=p.__importDefault(z);B=p.__importDefault(B);
return function(){function E(){this.declaredClass="arcgisonline.sharing.dijit.SaveItem";this.widgetsInTemplate=!0;this.templateString=C;this.baseClass="esriAGOSaveItemForm";this.init=!1;this.folders={}}E.prototype.postMixInProperties=function(){this.i18n=z.default.mixin(w.default.common,w.default.saveItem)};E.prototype.postCreate=function(){this.inherited(arguments);this.init||(this._getFolders(),this.init=!0)};E.prototype.startup=function(){this.inherited(arguments);this._loadConnections()};E.prototype.hideRow=
function(D){v.default(".save-item-"+D+"-row").forEach(function(G){d.default.hideNode(G)})};E.prototype.loadTags=function(D){var G=this,H=c.default.getUser();D&&(H=D);return c.default.loadUserTags(H.username).then(function(N){var O=G.saveItemTags.domNode,S=G._validate.bind(G);G.saveItemTags.set("knownTags",N);G.own(u.default(O,"blur",S),h.default.registerKeystrokeHandler(O,S),t.default.after(G.saveItemTags,"validate",S))})};E.prototype.loadCategories=function(D){var G=this,H=new r.default,N=v.default(".categories-container",
this.domNode);b.default.self.hasCategorySchema?c.default.request({url:b.default.restBaseUrl+"portals/self/categorySchema"}).then(function(O){G._categories=new a.default({categories:D||[],schema:O.categorySchema},G.saveItemCategories);G._categories.startup();d.default.showNodes(N);H.resolve()},function(){d.default.hideNodes(N);H.resolve()}):(d.default.hideNodes(N),H.resolve());return H};E.prototype._loadConnections=function(){var D=this._validate.bind(this);this.own(u.default(this.saveItemTitle,"change",
D),u.default(this.saveItemSummary,"change",D),h.default.registerKeystrokeHandler(this.saveItemTitle,D),h.default.registerKeystrokeHandler(this.saveItemSummary,D))};E.prototype._validate=function(){if(!this._beingDestroyed){var D=!0,G=this.saveItemTitle.get("value"),H=this.saveItemTags.get("tags"),N=this.saveItemSummary.get("value");null===this.requires?D=!!(G&&H&&N):(f.default.includes(this.requires,"title")&&(D=D&&!!G),f.default.includes(this.requires,"tags")&&(D=D&&0!==H.length),f.default.includes(this.requires,
"summary")&&(D=D&&!!N));y.default.publish("onSaveItemValidate",[D])}};E.prototype._getFolders=function(){var D=this,G=c.default.getUser();if(null!==G){var H=new B.default({url:null,data:{identifier:"name",items:[]}});H.newItem({name:G.email,id:""});this.saveItemFolder.set("store",H);this.saveItemFolder.set("value",G.email);n.default.getFolders(function(N){var O=null;if(x.default("ESRI_Content")){var S=c.default.getCookie("ESRI_Content");S.folderId&&(O=S.folderId)}D.foldersJson=N.folders;N.folders.forEach(function(da,
J){H.newItem({name:da.title,id:da.id});D.folders["id"+da.id]=da.title.replace(/"/g,'\\"');O===da.id&&(D.saveItemFolder.set("value",da.title),D.folderId=O,D.folderName=da.title)});H.save({})},function(N){})}};E.prototype._onFolderChange=function(D){var G=this;this.saveItemFolder.get("store").fetch({onComplete:function(H){H.forEach(function(N){N.name[0]===D&&(G.folderId=N.id[0],G.folderName=N.name[0])})}})};E.prototype._setTitleAttr=function(D){this.saveItemTitle.set("value",D)};E.prototype._getTitleAttr=
function(){return this.saveItemTitle.get("value")};E.prototype._setTagsAttr=function(D){this.saveItemTags.set("tags",D)};E.prototype._getTagsAttr=function(){return this.saveItemTags.get("tags")};E.prototype._setCategoriesAttr=function(D){var G=this;D&&D.forEach(function(H){G._categories.addCategory(H)})};E.prototype._getCategoriesAttr=function(){return this._categories.getCategories(!0)};E.prototype._setSummaryAttr=function(D){this.saveItemSummary.set("value",D)};E.prototype._getSummaryAttr=function(){return this.saveItemSummary.get("value")};
E.prototype._setFolderAttr=function(D){var G=this;this.saveItemFolder.get("store").fetch({onComplete:function(H){H.forEach(function(N){N.name[0]===D&&(G.folderId=N.id[0],G.folderName=N.name[0],G.saveItemFolder.set("value",G.folderName))})}})};E.prototype._getFolderAttr=function(){return this.folderName};E.prototype._setFolderIdAttr=function(D){var G=this;this.saveItemFolder.get("store").fetch({onComplete:function(H){H.forEach(function(N){N.id[0]===D&&(G.folderId=N.id[0],G.folderName=N.name[0],G.saveItemFolder.set("value",
N.name[0]))})}})};E.prototype._getFolderIdAttr=function(){return this.folderId};E.prototype._setRequiresAttr=function(D){this.requires=D?D:null};E.prototype._setTitlePlaceHolderAttr=function(D){this.saveItemTitle.set("placeHolder",D)};E.prototype._setTagsPlaceHolderAttr=function(D){this.saveItemTitle.set("placeHolder",D)};E.prototype._setSummaryPlaceHolderAttr=function(D){this.saveItemSummary.set("placeHolder",D)};return E=p.__decorate([m.default(l.default,q.default,e.default)],E)}()})},"arcgisonline/sharing/dijit/dialog/InvitationsDlg":function(){define("require esri/declare esri/Evented esri/lang dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/query dojo/string dojo/topic dojo/mouse dijit/a11yclick dojo/promise/all dojo/date/locale dojo/store/Memory dijit/Tooltip dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../util ../../../pages/pageUtil ../../../pages/utils/formatters ../../../pages/utils/icons ../Grid ./ConfirmDialog ./GeneralDlg dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/InvitationsDlg.html dojo/text!./templates/InvitationsDlgGroup.html".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da){var J=g("arcgisonline.sharing.dijit.dialog.InvitationsDlg",[v,y,z,p],{basePath:k.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriInvitationsDlg",widgetsInTemplate:!0,templateString:S,invitations:null,groupsUser:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=h.mixin({},O.common);h.mixin(this.i18n,O.invitationsDlg);h.mixin(this.i18n,O.invitationsGrid)},postCreate:function(){this.loadConnections()},
show:function(M,K){this.clearStore();K&&(K.username||K.email)&&(this.groupsUser=K);this.invitations=M;this.getGroupInfos();this._dialog.show()},update:function(M){this.clearStore();this.invitations=M;this.getGroupInfos();this._dialog.show()},getGroupInfos:function(){var M=B.getUser(),K=[];if(null!==M){var R=this.groupsUser&&this.groupsUser.username?this.groupsUser.username:this.groupsUser&&this.groupsUser.email?this.groupsUser.email:M.email;for(M=0;M<this.invitations.length;M++)K.push(B.request({url:esriGeowConfig.restBaseUrl+
"community/users/"+R+"/invitations/"+this.invitations[M].groupId}));e(K).then(function(X){f.forEach(X,function(W,I){this.invitations[I].fromUsername=W.fromUsername.username;this.invitations[I].fromUserFullname=W.fromUsername.fullname;this.invitations[I].groupTitle=W.group.title;this.invitations[I].groupOwner=W.group.owner;this.invitations[I].groupIsPrivate="private"===W.group.access;this.invitations[I].groupAccess=W.group.access;this.invitations[I].groupDescription=W.group.description;this.invitations[I].groupThumbnail=
W.group.thumbnail;this.invitations[I].leavingDisallowed=W.group.leavingDisallowed;this.groupsUser&&(this.invitations[I].asUser=R)}.bind(this));var Q=this._invitationsGrid._grid.store;f.forEach(this.invitations,function(W){Q.put(W)}.bind(this));this.refresh()}.bind(this))}},loadConnections:function(){this.own(c(".jevent").on("click",function(M){M&&M instanceof Event&&M.preventDefault()}),a(this._closeBtn,"click",function(){this._dialog.hide()}.bind(this)),m.subscribe("onInvitationAccept",this.onInvitationAccept.bind(this)),
m.subscribe("onInvitationDecline",this.onInvitationDecline.bind(this)))},createGrid:function(){this._invitationsGrid=new G({id:"invitationsGrid",columns:this.getInvitationGridColumns(),noDataMessage:this.i18n.noGroupInvites,showLoadingMessage:!1,showHeader:!1,showFooter:!1,selectionMode:"none",rowsPerPage:5,className:"invitations-grid",store:new x({idProperty:"id",label:"groupTitle",data:[]}),sort:[{attribute:"received",descending:!1}]},this._invitationsGridContainer);this._invitationsGrid.startup()},
clearStore:function(){this._invitationsGrid||this.createGrid();var M=this._invitationsGrid&&this._invitationsGrid._grid&&this._invitationsGrid._grid.store||void 0;M&&f.forEach(h.clone(M.query()),function(K){M.remove(K.id)})},getInvitationGridColumns:function(){return{groupTitle:{label:this.i18n.groupName,sortable:!1,renderCell:function(M){var K=!1;this.groupsUser&&(this.groupsUser.privileges&&-1<this.groupsUser.privileges.indexOf("portal:admin:viewGroups")?K=!0:this.groupsUser.privileges&&-1<this.groupsUser.privileges.indexOf("portal:user:viewOrgGroups")&&
"private"!==M.groupAccess?K=!0:"public"===M.groupAccess&&(K=!0));var R=M.groupThumbnail?esriGeowConfig.restBaseUrl+"community/groups/"+M.groupId+"/info/"+M.groupThumbnail+"?token\x3d"+B.getToken():"",X=t.format(new Date(M.received),{selector:"date",formatLength:"long"});X=n.substitute(O.GroupWidget.invitedEventDescription,{fullName:M.fromUserFullname,fullDate:X});K={i18n:O,icons:D,id:M.groupId,title:M.groupTitle,thumbnail:M.groupThumbnail,thumbnailUrl:R,notificationSummary:X,fillColor:"#"+M.groupId.substr(M.groupId.length-
6),useLetter:M.groupTitle.charAt(0)&&M.groupTitle.charAt(0).match(/^\w+$/),isPrivate:!K};K=d.toDom(n.substitute(da,K,null,{hide:E.hide,show:E.show,firstChar:E.firstChar,stripHTML:E.stripHTML}));R=c(".js-accept-invitation",K).shift();X=c(".js-decline-invitation",K).shift();var Q=M.asUser?M.asUser:null,W=M.leavingDisallowed?this.confirmLeavingDisallowed.bind(this,M,Q):this.acceptInvitation.bind(this,M,Q);M=this.declineInvitation.bind(this,M,Q);this.own(l(R,W),l(X,M));return K}.bind(this)}}},confirmLeavingDisallowed:function(M,
K){var R=O.invitationsDlg.leavingDisabled,X=C.createSpecifiedDialog(H,{class:"general-dialog",title:O.invitationsDlg.joinGroup,buttonOkLabel:O.invitationsDlg.joinGroup,style:{height:"auto"}});X.setContent(R);X.show().then(function(Q){"onOk"===Q&&(this.acceptInvitation(M,K),X.hide())}.bind(this))},acceptInvitation:function(M,K){var R=B.getUser(),X=this._invitationsGrid._grid.store,Q=M.groupId;R&&B.request({url:esriGeowConfig.restBaseUrl+"community/users/"+(K?K:R.email)+"/invitations/"+Q+"/accept",
content:{}},{usePost:!0}).then(function(W){X.remove(M.id);m.publish("onInvitationAccept",{})}.bind(this),function(W){W=B.getUser();C.createSpecifiedDialog(N).show({title:this.i18n.errorTitle,message:W&&W.orgId?this.i18n.acceptFailure:this.i18n.acceptFailurePublic})}.bind(this))},declineInvitation:function(M,K){var R=B.getUser(),X=M.groupId,Q=this._invitationsGrid._grid.store;R&&B.request({url:esriGeowConfig.restBaseUrl+"community/users/"+(K?K:R.email)+"/invitations/"+X+"/decline"},{usePost:!0}).then(function(){Q.remove(M.id);
m.publish("onInvitationDecline",{})}.bind(this))},onInvitationAccept:function(){0===this._invitationsGrid._grid.store.query().length?this.hide():this.refresh()},onInvitationDecline:function(){0===this._invitationsGrid._grid.store.query().length?this.hide():this.refresh()},hide:function(){this._dialog.hide()},refresh:function(){if(this._invitationsGrid._grid&&this._invitationsGrid._grid._started){var M=this._invitationsGrid._grid._currentPage||1,K=this._invitationsGrid._grid.store?this._invitationsGrid._grid.store.query().length:
0;a.once(this._invitationsGrid._grid,"dgrid-refresh-complete",function(R){R.grid._currentPage!==M&&0<K&&R.grid.gotoPage(M)});this._invitationsGrid._grid.resize();this._invitationsGrid._grid.refresh()}}});J.prototype.statics={getInstance:function(){this._instance||(this._instance=new J);return this._instance}};return J})},"arcgisonline/sharing/dijit/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/string dojo/_base/array dojo/date/locale dojo/on dojo/dom esri/lang dojo/aspect dijit/_WidgetBase dojo/_base/window dijit/TooltipDialog dijit/popup dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/extensions/ColumnResizer dgrid/Keyboard ./_RefreshMixin ./Rating dojo/query dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/dom-construct dojo/when dojo/store/Memory dgrid/Selection dgrid/selector dojo/store/Observable put-selector/put dgrid/util/mouse dgrid/util/touch arcgisonline/sharing/util ../../pages/utils/keys arcgisonline/sharing/geow/Content dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da,J,M,K,R,X,Q,W,I,T,Y,ca){esri.i18nBundle=ca;return k("arcgisonline.sharing.dijit.Grid",[n],{postMixInProperties:function(){this.inherited(arguments);this._util=I;this._content=Y;this._supportedViews=["gallery","details","table"];this._favorites={};this._portalUser=this._util.getUser();this._galleryTemplate=this._galleryTemplate||"\x3cdiv style\x3d'opacity:0;' class\x3d'grid-item gallery-view'\x3e${item:_formatThumbnail}\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e${item:_formatItemTypeIcon}\x3c/div\x3e";
this._detailsTemplate=this._detailsTemplate||'\x3cdiv style\x3d\'opacity:0;\' class\x3d\'grid-item detail-view\'\x3e${item:_formatThumbnail}\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e\x3cdiv class\x3d"rating-system"\x3e\x3cdiv data-dojo-type\x3d\'arcgisonline/sharing/dijit/Rating\' data-dojo-props\x3d\'numStars:5,value:${item.avgRating},disabled:true\'\x3e\x3c/div\x3e\x26nbsp;\x3cspan\x3e(${item.numRatings})\x3c/span\x3e\x3c/div\x3e${item:_formatItemTypeIcon}\x3cp class\x3d"grid-item-type"\x3e${item:_formatType}\x3c/p\x3e\x3cp class\x3d"grid-item-desc"\x3e${item.snippet}\x3c/p\x3e${item:_formatPremiumContentIcon}\x3cspan class\x3d"openItem" id\x3d"openItem"\x3e\x3c/span\x3e\x3ca href\x3d"item.html?id\x3d${item.id}" class\x3d"calcite btn small primary details-button"\x3e${i18n.gallery.details}\x3c/a\x3e\x3c/div\x3e';
this._itemPopupTemplate=this._itemPopupTemplate||'\x3cdiv class\x3d"grid-item-hover"\x3e\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e\x3cspan id\x3d\'openItem\'\x3e\x3c/span\x3e\x3ca href\x3d"item.html?id\x3d${item.id}" class\x3d"calcite btn small primary details-button"\x3e${i18n.details}\x3c/a\x3e\x3cp class\x3d"item-hover-type"\x3e${item:_formatItemTypeIcon}${item:_formatType} by\x26nbsp;${item.owner:_formatOwnerLink}\x3c/p\x3e\x3cp class\x3d"item-hover-desc"\x3e${item.snippet}\x3c/p\x3e${item:_formatPremiumContentIcon}\x3cdiv class\x3d"rating-system"\x3e\x3cdiv data-dojo-type\x3d\'arcgisonline/sharing/dijit/Rating\' data-dojo-props\x3d\'numStars:5,value:${item.avgRating},disabled:true\'\x3e\x3c/div\x3e\x26nbsp;\x3cspan\x3e(${item.numRatings})\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';
this._renderers=g.mixin(this._renderers||{},{gallery:g.hitch(this,function(V){V.snippet=V.snippet||"";var Z=X("div"),ja=new (k([n,e,t],{templateString:p.substitute(this._galleryTemplate,{item:V,i18n:ca.gallery},null,this)}));V.widget=ja;Z.appendChild(ja.domNode);return Z}),details:g.hitch(this,function(V){V.snippet=V.snippet||"";var Z=X("div"),ja=new (k([n,e,t],{templateString:p.substitute(this._detailsTemplate,{item:V,i18n:ca},null,this)})),la=new x({label:ca.gallery.open,className:"btn calcite primary",
dropDown:this._getOpenInMenu(V)},G(".openItem",Z)[0]);V.widget=ja;Z.appendChild(ja.domNode);G(".openItem",Z).replaceWith(la.domNode);0===la.dropDown.getChildren().length&&la.set("disabled",!0);return Z}),table:function(){return X("div",u.prototype.renderRow.apply(this,arguments))}})},buildRendering:function(){this.inherited(arguments);var V=k([u,y,v,B,M,E]),Z=this.columns||{title:{label:"title"},type:{label:"type"},modified:{label:"last modified"},access:{label:"sharing"}};this._view=this.view||"table";
this._query=this.query;this._sort=this.sort||[{attribute:"title",descending:!1}];this._queryOptions=this.queryOptions||{sort:this.sort};this._store=this.store||new J({data:[]});this._rowsPerPage=this.rowsPerPage||9;this._pagingLinks=this.pagingLinks?this.pagingLinks:3;this._showHeader=this.showHeader||!1;this._selectionMode=this.selectionMode||"extended";this._useTouchScroll=this.useTouchScroll||!1;this._grid=new V({columns:Z,renderRow:this._renderers[this._view],noDataMessage:this.noDataMessage||
"",showHeader:this._showHeader,store:this._store,query:this._query,showLoadingMessage:!1,firstLastArrows:this._pagingLinks,previousNextArrows:this._pagingLinks,rowsPerPage:this._rowsPerPage,pagingLinks:this._pagingLinks,allowSelectAll:!0,selectionMode:this._selectionMode,sort:this._sort},this.domNode);this._grid.startup()},postCreate:function(){this.inherited(arguments);this.own(this._grid.on("refresh",g.hitch(this,function(){this._grid.showFooter=this._grid._total>this._grid.rowsPerPage;this._onGridRefresh()})),
c.before(this._grid,"removeRow",g.hitch(this,function(V){V&&(V=this._grid.row(V),(V=(V.data||V).widget)&&V.destroyRecursive())})),this._grid.on(".fav-icon a:click",g.hitch(this,function(V){V.preventDefault();var Z=this._grid.row(V),ja=V.target.parentNode.parentNode.parentNode,la=H.contains(V.target.parentNode,"fav-off");V=this._content[la?"addToFavorites":"removeFromFavorites"](Z.data).then(g.hitch(this,function(){this._favorites[Z.data.id].id=la?Z.data.id:!1}));G(".fav-on",ja).style({display:la?
"":"none"});G(".fav-off",ja).style({display:la?"none":""});setTimeout(g.hitch(this,function(){G(".fav-on",ja).style({width:la?"200px":"24px"});G(".fav-off",ja).style({width:la?"24px":"200px"});setTimeout(g.hitch(this,function(){G(".fav-on, .fav-off").style({width:"24px"})}),2500)}),50);V.then(g.hitch(this,function(){}))})),this._grid.on(".fav-icon a:mouseout",g.hitch(this,function(V){N.set(V.target.parentNode,{width:"24px"})})));!esri.isTouchEnabled||"gallery"!==this._view&&"details"!==this._view?
"gallery"!==this._view&&"details"!==this._view||this.own(this._grid.on(Q.enterRow,g.hitch(this,function(V){if(V.relatedTarget&&!1===H.contains(V.relatedTarget,"dijitMenu")&&!1===H.contains(V.relatedTarget,"dijitReset")){var Z=this._grid.row(V),ja=G("img",Z.element)[0];clearTimeout(this._showPopupTimeout);ja&&(this._showPopupTimeout=setTimeout(g.hitch(this,function(){this._portalUser?this._isFavorite(Z.data.id).then(g.hitch(this,function(la){this._showPopup(Z.data,ja.parentNode)})):this._showPopup(Z.data,
ja)}),400))}})),this._grid.on(Q.leaveRow,g.hitch(this,function(V){V.relatedTarget&&!1===H.contains(V.relatedTarget,"dijitTooltipDialog")&&!1===H.contains(V.relatedTarget,"dijitTooltipConnector")&&(clearTimeout(this._showPopupTimeout),clearTimeout(this._closePopupTimeout),this._closePopupTimeout=setTimeout(g.hitch(this,function(){G(".fav-on, .fav-off",this.domNode).style("display","none").style("width","24px");this._closePopup()}),10))}))):this.own(this._grid.on(W.selector(".dgrid-content .dgrid-row",
W.tap),g.hitch(this,function(V){V.preventDefault();var Z=this._grid.row(V);this._portalUser?this._isFavorite(Z.data.id).then(g.hitch(this,function(ja){this._showPopup(Z.data,G("img",Z.element)[0].parentNode)})):this._showPopup(Z.data,G("img",Z.element)[0])})),this._grid.on(".dgrid-row:click",g.hitch(this,function(V){V.preventDefault();var Z=this._grid.row(V);this._portalUser?this._isFavorite(Z.data.id).then(g.hitch(this,function(ja){this._showPopup(Z.data,G("img",Z.element)[0].parentNode)})):this._showPopup(Z.data,
G("img",Z.element)[0])})))},_onGridRefresh:function(V){this.emit("onRefresh",{currentPage:this._grid._currentPage});this._pagingLinks&&(G(".dgrid-navigation",this._grid.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide"),G(".dgrid-pagination",this._grid.domNode)[0===this._grid._total?"addClass":"removeClass"]("hide"))},_getGridAttr:function(){return this._grid},_showPopup:function(V,Z){"details"===this._view?this._portalUser&&this._isFavorite(V.id).then(g.hitch(this,
function(ja){G(".fav-on",Z.parentNode).style("display",ja.id?"":"none");G(".fav-off",Z.parentNode).style("display",ja.id?"none":"")})):"gallery"===this._view&&V.id&&V.id!==this._popupId&&(this._portalUser&&this._isFavorite(V.id).then(g.hitch(this,function(ja){G(".fav-on",Z.parentNode).style("display",ja.id?"":"none");G(".fav-off",Z.parentNode).style("display",ja.id?"none":"")})),this._closePopup(),this._popupId=V.id,this._tooltip=new q({onMouseLeave:g.hitch(this,"_closePopup"),content:new (k([n,e,
t],{templateString:p.substitute(this._itemPopupTemplate,{item:V,i18n:ca.gallery},null,this)}))}),l.open({popup:this._tooltip,around:Z,orient:["after-centered","before-centered"]}),this._popupButton=new x({label:ca.gallery.open,className:"calcite btn small primary",dropDown:this._getOpenInMenu(V)}),G("#openItem").replaceWith(this._popupButton.domNode),0===this._popupButton.dropDown.getChildren().length&&this._popupButton.set("disabled",!0))},_closePopup:function(V){V&&V.relatedTarget&&(!0===H.contains(V.relatedTarget,
"dijitBackgroundIframe")||!0===H.contains(V.relatedTarget,"dijitMenu")||!0===H.contains(V.relatedTarget,"dijitReset"))||!this._tooltip||(l.close(this._tooltip),this._popupConnect&&this._popupConnect.remove(),this._popupButton&&this._popupButton.destroyRecursive(),this._tooltip.destroyRecursive(),this._popupId=this._tooltip=null)},_isFavorite:function(V){return da(this._favorites[V]||this._searchItems('(group:"'+this._portalUser.favGroupId+'" AND id:"'+V+'")').then(g.hitch(this,function(Z){this._favorites[V]=
Z.results[0]||{id:!1};return this._favorites[V]})))},_searchItems:function(V){return this._util.request({url:esriGeowConfig.restBaseUrl+"search",content:{q:V,f:"json"}})},refresh:function(){this._grid&&(this._grid.set("query",this._query,this._queryOptions),G(".dgrid-row",this._grid.domNode).attr("tabindex","0"),this.own(f(this._grid.domNode.querySelector(".dgrid-content"),"keyup",function(V){var Z=V.target;Z.classList.contains("dgrid-row")&&V.keyCode===T.ENTER&&("single"===this._grid.selectionMode&&
this._grid.clearSelection(),this._grid.select(Z))}.bind(this))))},gotoPage:function(V){this._grid.query=this._query;this._grid.queryOptions=this._queryOptions;this._grid._sort=this._queryOptions.sort;this._grid.gotoPage(V)},_formatItemTitle:function(V){return V.title||V.name||""},_formatType:function(V){return this._content.changeTypename({type:V.type,typeKeywords:V.typeKeywords},!1)||V.type},_formatLargeThumbnail:function(V){return V?"\x3cimg class\x3d'grid-item-thumb' alt\x3d'' src\x3d'"+V+"'\x3e":
"\x3cimg class\x3d'grid-item-thumb' alt\x3d'' src\x3d'"+this._util.getStaticImagesUrl()+"/desktopapp.png'\x3e"},_getDefaultThumbnail:function(V){var Z=this._util.getStaticImagesUrl();return"web mapping application"==V?Z+"/webapp.png":"mobile application"==V?Z+"/mobileapp.png":"workforce project"===V?Z+"/workforceproject.png":"hub initiative"===V?Z+"/hubinitiative.png":"hub page"===V?Z+"/hubpage.png":"hub site application"===V?Z+"/hubsite.png":"dashboard"===V?Z+"/opsdashboard.png":"geoprocessing service"===
V&&esriGeowConfig.self&&esriGeowConfig.self.isPortal?Z+"/webtool.png":"web scene"===V||"scene service"===V?Z+"/scene.png":"ortho mapping project"===V?Z+"/orthomappingproject.png":"ortho mapping template"===V?Z+"/orthomappingtemplate.png":Z+"/desktopapp.png"},_formatThumbnail:function(V){var Z=V.thumbnailUrl||this._getDefaultThumbnail(V.type&&V.type.toLowerCase()),ja=this._util.getHomePageGalleryLinkInfo(V),la=-1<dojo.indexOf(V.typeKeywords,"Web AppBuilder for ArcGIS");la=esriGeowConfig.self&&esriGeowConfig.self.isPortal&&
la||"Application"===V.type||"Web Mapping Application"===V.type&&!la||"Mobile Application"===V.type||"Document Link"===V.type;var ba="Application"===V.type||"Web Mapping Application"===V.type||"Mobile Application"===V.type||"Document Link"===V.type||"CityEngine Web Scene"===V.type||"Dashboard"===V.type;V='\x3ca href\x3d"'+(esri.isTouchEnabled?"#":la?V.url||"item.html?id\x3d"+V.id:ja&&ja.href&&ja.href.replace(/"/g,"'")||"item.html?id\x3d"+V.id)+'" target\x3d"'+(ba?"_blank":"")+'"\x3e\x3cimg class\x3d"grid-item-thumb" alt\x3d"" src\x3d"'+
Z+'" /\x3e\x3c/a\x3e';Z=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom();Z=!Z||Z&&esriGeowConfig.userRole.canShareItemToGroup();ja='\x3cdiv class\x3d"gallery-img"\x3e\x3cdiv class\x3d"fav-icon"\x3e\x3ca href\x3d"#"\x3e\x3cdiv class\x3d"fav-on" style\x3d"display:none;"\x3e\x3cdiv class\x3d"star-on"\x3e\x3c/div\x3e\x3cp id\x3d"addString"\x3e'+ca.gallery.addFavorite+'\x3c/p\x3e\x3c/div\x3e\x3c/a\x3e\x3ca href\x3d"#"\x3e\x3cdiv class\x3d"fav-off" style\x3d"display:none;"\x3e\x3cdiv class\x3d"star-off"\x3e\x3c/div\x3e\x3cp id\x3d"remString"\x3e'+
ca.gallery.removeFavorite+"\x3c/p\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e"+V+"\x3c/div\x3e";return Z&&this._portalUser?ja:V},_formatItemTypeIcon:function(V){return"\x3cimg class\x3d'grid-item-icon' alt\x3d'' src\x3d'"+this._content._getItemIconUrl(V)+"'\x3e"},_formatPremiumContentIcon:function(V){var Z=V.isPremiumContent,ja=V.getTypeInfo(),la=esriGeowConfig.self&&esriGeowConfig.self.isPortal?"portal":"";V=-1<b.indexOf(V.typeKeywords,"Requires Credits");return Z?'\x3cp class\x3d"grid-item-type" title\x3d"'+
(V?ca.common["premiumcontentcreditstitle"+la]:ca.common["premiumcontenttitle"+la])+"\"\x3e\x3cimg class\x3d'grid-premium-icon' alt\x3d'' src\x3d'"+ja.premiumIconUrl+"'\x3e"+(V?ca.common.premiumcontent:ca.common.subscriptioncontent)+"\x3c/p\x3e":""},_formatDate:function(V){!1===V instanceof Date&&(V=new Date(V));return V?h.format(V,{selector:"date",datePattern:"MMMM yyy"}):""},_formatOwnerLink:function(V){return'\x3ca href\x3d"user.html?user\x3d'+V+'"\x3e'+V+"\x3c/a\x3e"},_getOpenInMenu:function(V){V=
this._util.getItemOpenLinkObjects(V);var Z;var ja=new r({autoFocus:!0,_destroyOnRemove:!0,showTitle:!1});b.forEach(V,function(la){Z=new w({label:la.label,onClick:function(){la.onClick()}});ja.addChild(Z)});ja.startup();return ja},_setViewAttr:function(V){this._view=V=-1===b.indexOf(this._supportedViews,V)?this._view:V;this._grid&&(this._grid.renderRow=this._renderers[V],X(this._grid.domNode,"!table!gallery!details."+V),this._grid.set("showHeader","table"===this._view))},_setStoreAttr:function(V){this._store=
V},_setQueryAttr:function(V,Z){this._query=V||this._query;this._queryOptions=Z||this._queryOptions},_setItemsAttr:function(V){(this._store=this._store||new R(new J({data:V,identifier:"id",label:"id"})),this._store.setData)?this._store.setData(V):this._store=new R(new J({data:V}));this.set("store",this._store);this.set("view",this._view)}})})},"arcgisonline/sharing/dijit/Rating":function(){define("dojo/_base/declare dojox/form/Rating dojo/dom-attr dojo/dom-construct dojo/string ../../pages/utils/icons dojo/i18n!../../nls/arcgisonline".split(" "),
function(k,g,p,b,h,f,d){return k([g],{constructor:function(a){k.safeMixin(this,a)},postCreate:function(){this.inherited(arguments);var a=h.substitute(d.common.ratingMsg2,{stars:this.params.value});p.set(this.domNode,"aria-label",a);p.set(this.domNode,"tabindex",0);[].slice.call(this.domNode.querySelectorAll(".dojoxRatingInput")).forEach(function(c){b.place(f["star-f"]["16"],c,"after");b.place(f.star["16"],c,"after")})},_onMouse:function(){this.get("disabled")||this.inherited(arguments)},onStarClick:function(){this.get("disabled")||
this.inherited(arguments)},_setValueAttr:function(a){a=Math.round(a);this.inherited(arguments)}})})},"dojox/form/Rating":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-attr dojo/dom-class dojo/mouse dojo/on dojo/string dojo/query dijit/form/_FormWidget".split(" "),function(k,g,p,b,h,f,d,a,c){return k("dojox.form.Rating",c,{templateString:null,numStars:3,value:0,buildRendering:function(n){for(var m='\x3clabel class\x3d"dojoxRatingStar dijitInline ${hidden}"\x3e\x3cspan class\x3d"dojoxRatingLabel"\x3e${value} stars\x3c/span\x3e\x3cinput type\x3d"radio" name\x3d"rating-'+
Math.random().toString(36).substring(2)+'" value\x3d"${value}" dojoAttachPoint\x3d"focusNode" class\x3d"dojoxRatingInput"\x3e\x3c/label\x3e',q='\x3cdiv dojoAttachPoint\x3d"domNode" class\x3d"dojoxRating dijitInline"\x3e\x3cdiv data-dojo-attach-point\x3d"list"\x3e'+d.substitute(m,{value:0,hidden:"dojoxRatingHidden"})+"${stars}\x3c/div\x3e\x3c/div\x3e",l="",e=0;e<this.numStars;e++)l+=d.substitute(m,{value:e+1,hidden:""});this.templateString=d.substitute(q,{stars:l});this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._renderStars(this.value);this.own(f(this.list,f.selector(".dojoxRatingStar","mouseover"),g.hitch(this,"_onMouse")),f(this.list,f.selector(".dojoxRatingStar","click"),g.hitch(this,"_onClick")),f(this.list,f.selector(".dojoxRatingInput","change"),g.hitch(this,"onStarChange")),f(this.list,h.leave,g.hitch(this,function(){this._renderStars(this.value)})))},_onMouse:function(n){var m=+p.get(n.target.querySelector("input"),"value");this._renderStars(m,!0);this.onMouseOver(n,m)},_onClick:function(n){if("LABEL"===
n.target.tagName){var m=+p.get(n.target.querySelector("input"),"value");n.target.value=m;this.onStarClick(n,m);m==this.value&&(n.preventDefault(),this.onStarChange(n))}},_renderStars:function(n,m){a(".dojoxRatingStar",this.domNode).forEach(function(q,l){l>n?(b.remove(q,"dojoxRatingStarHover"),b.remove(q,"dojoxRatingStarChecked")):(b.remove(q,"dojoxRatingStar"+(m?"Checked":"Hover")),b.add(q,"dojoxRatingStar"+(m?"Hover":"Checked")))})},onStarChange:function(n){n=+p.get(n.target,"value");this.setAttribute("value",
n==this.value?0:n);this._renderStars(this.value);this.onChange(this.value)},onStarClick:function(n,m){},onMouseOver:function(){},setAttribute:function(n,m){this.set(n,m)},_setValueAttr:function(n){this._set("value",n);this._renderStars(n);var m=a("input[type\x3dradio]",this.domNode)[n];m&&(m.checked=!0);this.onChange(n)}})})},"arcgisonline/pages/utils/keys":function(){define(["require","exports"],function(k,g){Object.defineProperty(g,"__esModule",{value:!0});g.DOWN=g.RIGHT=g.UP=g.LEFT=g.TAB=g.SPACEBAR=
g.ENTER=g.ESCAPE=void 0;g.ESCAPE=27;g.ENTER=13;g.SPACEBAR=32;g.TAB=9;g.LEFT=37;g.UP=38;g.RIGHT=39;g.DOWN=40;g.default={ESCAPE:g.ESCAPE,ENTER:g.ENTER,TAB:g.TAB,UP:g.UP,DOWN:g.DOWN,LEFT:g.LEFT,RIGHT:g.RIGHT,SPACEBAR:g.SPACEBAR}})},"arcgisonline/sharing/dijit/dialog/JoinGroupDlg":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dijit/a11yclick dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../util ../../../pages/utils/dom dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/JoinGroupDlg.html".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t){var x=g("arcgisonline.sharing.dijit.dialog.JoinGroupDlg",[c,n,m],{declaredClass:"arcgisonline.sharing.dijit.dialog.JoinGroupDlg",basePath:k.toUrl("arcgisonline/sharing/dijit/dialog"),templateString:t,widgetsInTemplate:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n=p.mixin(e.common,e.joinGroupDlg)},postCreate:function(){this.inherited(arguments);this._loadConnections()},show:function(r,w,u){this.groupId=r;this.leavingDisallowed=w;u&&(this.successHandler=
u);this.leavingDisallowed&&l.showNode(this._administrativeGroup);this._dialog.show()},hide:function(r){r&&r.preventDefault();this._dialog.hide()},_loadConnections:function(){this.own(f(this._okBtn,p.hitch(this,"_submitRequest")),f(this._cancelBtn,p.hitch(this,"hide")))},_submitRequest:function(r){r&&r.preventDefault();var w=q.request({url:esriGeowConfig.restBaseUrl+"community/groups/"+this.groupId+"/join"},{usePost:!0}).then(dojo.hitch(this,function(u,v){this.hide();this.successHandler&&this.successHandler(u,
v)}),dojo.hitch(this,function(u){if(!w.canceled){var v=u.message;u.messageCode&&"COM_1082"===u.messageCode?v=this.i18n.levelOneSharedUpdateCapabilities:-1<v.indexOf("You have already applied to join this group.")?v=this.i18n.alreadyRequested+"\x3cbr\x3e"+this.i18n.applicationConsidered:-1<v.indexOf("Unable to apply to join group:")?v=this.i18n.cannotAccept:-1<v.indexOf(" is by invitation only.")&&(v=this.i18n.byInviteOnly);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.joinGroupError,
message:v})}this.hide()}))}});x.prototype.statics={_instance:null,getInstance:function(){null==this._instance&&(this._instance=new x);return this._instance}};return x})},"arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,dijit/form/Button,dijit/form/RadioButton,arcgisonline/sharing/util,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg"],
function(k,g,p){k.provide("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg");k.require("dijit.Dialog");k.require("dijit._Widget");k.require("dijit._Templated");k.require("dijit.form.Button");k.require("dijit.form.RadioButton");k.require("arcgisonline.sharing.util");k.require("arcgisonline.sharing.geow.Geow");k.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");k.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");k.declare("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg",
[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit.Dialog" id\x3d"manage-subscription-dialog" data-dojo-attach-point\x3d"_manageSubscriptionDlg" title\x3d"${i18n.manageSubscriptionTitle}" execute\x3d"" style\x3d"width:400px;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_upgradeSubscriptionDiv" style\x3d"display:none;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_inUSDiv"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_outsideUSDiv"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_manageSubscriptionDiv" style\x3d"display:none;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_manageSubscriptionContainer"\x3e\r\n        \x3cp\x3e${i18n.manageSubscriptionDesc}\x3c/p\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" type\x3d"radio" name\x3d"manageOption" data-dojo-attach-point\x3d"_upgradeRadioBtn" id\x3d"upgrade-radio-button" value\x3d"upgrade" checked\x3d"true"\x3e\r\n        \x3cspan\x3e\x3clabel for\x3d"upgrade-radio-button"\x3e\x3cb\x3e${i18n.upgradeOption}\x3c/b\x3e\x3c/label\x3e\x3c/span\x3e\x3cbr/\x3e\r\n        \x3cdiv class\x3d"esriLeadingMargin15"\x3e${i18n.upgradeDesc}\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_convertOptionDiv"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" type\x3d"radio" name\x3d"manageOption" data-dojo-attach-point\x3d"_convertRadioBtn" id\x3d"convert-radio-button" value\x3d"convert"\x3e\r\n          \x3cspan\x3e\x3clabel for\x3d"convert-radio-button"\x3e\x3cb\x3e${i18n.convertOption}\x3c/b\x3e\x3c/label\x3e\x3c/span\x3e\x3cbr/\x3e\r\n          \x3cdiv class\x3d"esriLeadingMargin15"\x3e${i18n.convertDesc}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_evalSubscriptionContainer" style\x3d"display: none;"\x3e\r\n        \x3cp\x3e${i18n.upgradeOption} ${i18n.upgradeDesc}\x3c/p\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_purchaseInUSDiv"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_purchaseOutsideUSDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_convertSubscriptionDiv" style\x3d"display:none;"\x3e\r\n      \x3cp\x3e${i18n.convertSubscriptionDesc}\x3c/p\x3e\r\n      \x3cp\x3e\x3cb\x3e${i18n.deleteHostedMsg}\x3c/b\x3e\x3cbr/\x3e${i18n.notAvailableMsg}\x3c/p\x3e\r\n      \x3cdiv\x3e\x3cb\x3e${i18n.importantMsg}\x3c/b\x3e\x3cdiv data-dojo-attach-point\x3d"_importantMsgDiv"\x3e\x3c/div\x3e\x3c/div\x3e\r\n      \x3cp\x3e\x3cb\x3e${i18n.intendToUpgradeMsg}\x3c/b\x3e\x3c/p\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_buttonDiv" class\x3d"esriFloatTrailing"\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_okBtn" data-dojo-attach-event\x3d"onClick:onCancel" class\x3d"jevent cancel" type\x3d"button" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.ok}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_nextBtn" data-dojo-attach-event\x3d"onClick:onNext" class\x3d"jevent primary" type\x3d"button" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.next}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_convertBtn" data-dojo-attach-event\x3d"onClick:onConvert" class\x3d"jevent primary" type\x3d"button" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.convertLabel}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" data-dojo-attach-event\x3d"onClick:onCancel" class\x3d"jevent cancel" type\x3d"button" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
util:arcgisonline.sharing.util,geow:arcgisonline.sharing.geow.Geow,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg);return this._instance}},_converting:!1,_choiceDlg:null,_selfResource:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=k.i18n.getLocalization("arcgisonline","arcgisonline").common;k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").manageSubscriptionDlg)},
postCreate:function(){this.inherited(arguments);this._dialog=this._manageSubscriptionDlg;this.loadConnections()},show:function(b){this.selfResource=b;this._showManageView()},showManage:function(b){this.selfResource=b;this.clear();this._showManageView();this._manageSubscriptionDlg.show()},showUpgrade:function(b){this.selfResource=b;this.clear();this._showUpgradeView();this._manageSubscriptionDlg.show()},_showUpgradeView:function(){this._manageSubscriptionDlg.set("title",this.i18n.upgradeSubscriptionTitle);
"Trial"!==this.selfResource.subscriptionInfo.type&&"Trial Press"!==this.selfResource.subscriptionInfo.type&&"Evaluation"!==this.selfResource.subscriptionInfo.type||this._manageSubscriptionDlg.set("title",this.i18n.manageSubscriptionTitle);k.attr(this._inUSDiv,"innerHTML",esri.substitute({officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.upgradeInsideUS));k.attr(this._outsideUSDiv,
"innerHTML",esri.substitute({officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.upgradeOutsideUS));k.style(this._manageSubscriptionDiv,"display","none");k.style(this._convertSubscriptionDiv,"display","none");k.style(this._nextBtn.domNode,"display","none");k.style(this._convertBtn.domNode,"display","none");k.style(this._cancelBtn.domNode,"display","none");"active"!==
this.selfResource.subscriptionInfo.state||"Trial"!==this.selfResource.subscriptionInfo.type&&"Trial Press"!==this.selfResource.subscriptionInfo.type&&"Evaluation"!==this.selfResource.subscriptionInfo.type||this._manageSubscriptionDlg.set("title",this.i18n.manageSubscriptionTitle);k.style(this._upgradeSubscriptionDiv,"display","");k.style(this._okBtn.domNode,"display","")},_showManageView:function(){this._manageSubscriptionDlg.set("title",this.i18n.manageSubscriptionTitle);k.style(this._upgradeSubscriptionDiv,
"display","none");k.style(this._convertSubscriptionDiv,"display","none");k.style(this._okBtn.domNode,"display","none");k.style(this._convertBtn.domNode,"display","none");this.selfResource.subscriptionInfo&&"Evaluation"===this.selfResource.subscriptionInfo.type?(k.style(this._convertOptionDiv,"display","none"),k.style(this._manageSubscriptionContainer,"display","none"),k.style(this._evalSubscriptionContainer,"display",""),k.attr(this._purchaseInUSDiv,"innerHTML",esri.substitute({officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',
officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.upgradeInsideUS)),k.attr(this._purchaseOutsideUSDiv,"innerHTML",esri.substitute({officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.upgradeOutsideUS)),k.style(this._okBtn.domNode,"display",""),k.style(this._nextBtn.domNode,"display","none"),k.style(this._cancelBtn.domNode,"display","none")):(k.style(this._nextBtn.domNode,
"display",""),k.style(this._cancelBtn.domNode,"display",""));k.style(this._manageSubscriptionDiv,"display","")},_showConvertView:function(){this._manageSubscriptionDlg.set("title",this.i18n.convertToPersonalTitle);k.attr(this._importantMsgDiv,"innerHTML",esri.substitute({helpLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"'+(this.selfResource.helpBase+this.selfResource.helpMap.m["120000592"])+'"\x3e',helpLinkEnd:"\x3c/a\x3e"},this.i18n.completeDetailsWithLinkMsg));
k.style(this._upgradeSubscriptionDiv,"display","none");k.style(this._manageSubscriptionDiv,"display","none");k.style(this._okBtn.domNode,"display","none");k.style(this._nextBtn.domNode,"display","none");k.style(this._convertSubscriptionDiv,"display","");k.style(this._convertBtn.domNode,"display","");k.style(this._cancelBtn.domNode,"display","")},loadConnections:function(){k.query(".jevent").connect("onclick",function(b){b.preventDefault()})},clear:function(){this._converting=!1;this._choiceDlg=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();
this._manageSubscriptionDlg.set("title","");k.style(this._upgradeSubscriptionDiv,"display","none");k.style(this._manageSubscriptionDiv,"display","none");k.style(this._convertSubscriptionDiv,"display","none");k.style(this._convertOptionDiv,"display","");k.style(this._manageSubscriptionContainer,"display","");k.style(this._evalSubscriptionContainer,"display","none");this._upgradeRadioBtn.set("checked",!0)},hide:function(){this._manageSubscriptionDlg.hide()},onNext:function(b){this._convertRadioBtn.get("checked")?
this._showConvertView():this._showUpgradeView()},onConvert:function(b){this._converting||(b={title:this.i18n.convertToPersonalTitle,message:this.i18n.noReturnMsg,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:k.hitch(this,this.doConvert)},this._choiceDlg.show(b))},doConvert:function(){if(!this._converting&&esriGeowConfig.self&&esriGeowConfig.self.id){this._converting=!0;this._convertBtn.set("disabled",!0);var b=esriGeowConfig.baseUrl.replace(location.host,esriGeowConfig.self.portalHostname)+
esriGeowConfig.signin;b=b.replace("http:","https:");this.util.request({url:esriGeowConfig.restBaseUrl+"portals/self/convert",content:{target:"personal",timeout:12E4}},{usePost:!0}).then(k.hitch(this,function(h){this.geow.signout(b)}),k.hitch(this,function(h){this._converting=!1;this._convertBtn.set("disabled",!1);var f=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();f.onOkClick=k.hitch(this,function(){f.hide();this._manageSubscriptionDlg.hide()});f.show({title:this.i18n.errorTitle,
message:this.i18n.unableToConvert})}))}},onCancel:function(b){g.byId("manage-subscription-dialog").hide()},onHide:function(){}})})},"arcgisonline/sharing/dijit/dialog/ManageTilesDlg":function(){define("require esri/declare esri/Evented esri/config esri/lang esri/request dojo/_base/lang dojo/on dojo/query dojo/sniff dojo/topic dojo/json dijit/a11yclick dojo/number dojo/string dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dojo/store/Memory dojo/store/Observable dgrid/OnDemandGrid dgrid/selector dgrid/Selection dgrid/extensions/DijitRegistry esri/geometry/Extent esri/geometry/webMercatorUtils ../../../map/core/projectExtent ../../../map/utils/clipOnHorizon ../DefineExtent ./GeneralDlg ./ChoiceDlg ../../../pages/pageUtil ../../../pages/utils/arrays ../../../pages/utils/dom ../../../pages/serviceUtil ../../util calcite-web/js/calcite-web dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ManageTilesDlg.html".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da,J,M,K,R,X,Q,W,I,T,Y,ca,V,Z){var ja=g(null,{showFooter:!0,buildRendering:function(){this.inherited(arguments);var ba=this.summaryAreaNode=u.create("div",{className:"summary-row",role:"row",style:{overflow:"hidden"}},this.footerNode);this.on("scroll",function(){ba.scrollLeft=this.getScrollPosition().x}.bind(this));this.summary&&this._setSummary(this.summary)},_updateColumns:function(){this.inherited(arguments);this.summary&&this._setSummary(this.summary)},
_renderSummaryCell:function(ba,ka,qa){ka.appendChild(document.createTextNode(ba[qa.field]||""))},_setSummary:function(ba){var ka=this.summaryTableNode;this.summary=ba;ka&&u.destroy(ka);ka=this.summaryTableNode=this.createRowCells("td",this._renderSummaryCell.bind(this,ba));this.summaryAreaNode.appendChild(ka);this._started&&this.resize()}}),la=g("arcgisonline.sharing.dijit.dialog.ManageTilesDlg",[y,z,B],{declaredClass:"arcgisonline.sharing.dijit.dialog.ManageTilesDlg",templateString:Z,widgetsInTemplate:!0,
basePath:k.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriManageTiles",PROCESSING:"PROCESSING",SUBMITTED:"SUBMITTED",DEFAULT_TILE_WIDTH:256,DEFAULT_TILE_HEIGHT:256,TIME_TO_NEXT_UPDATE:1E4,TABS:{LEVELS:"levels",EXTENT:"extent"},_noSourceData:!1,_isSourceTilePackage:!1,_isVisible:!1,_isProcessing:!1,_wasProcessing:!1,_allTilesComplete:!1,_createClicked:!1,_tab:"levels",postMixInProperties:function(){this.inherited(arguments);this.i18n=d.mixin({},V.common);this.i18n=d.mixin(this.i18n,V.manageTilesDlg)},
postCreate:function(){this.inherited(arguments);b.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esriGeowConfig.proxyUrl&&(b.defaults.io.proxyUrl=esriGeowConfig.proxyUrl);var ba=this.hide.bind(this);this.own(l(this._buildButton,this._createClick.bind(this)),l(this._cancelButton,this._cancelClick.bind(this)),l(this._closeButton,ba),l(this.dialog.closeButtonNode,ba),l(this._levelsTab,this._levelsTabClick.bind(this)),l(this._extentTab,this._extentTabClick.bind(this)))},destroy:function(){this.inherited(arguments);
this._defineExtent&&this._defineExtent.destroy()},setServerTokens:function(ba,ka,qa){this._hostedServer=ba;this._serverToken=ka;this._adminServerToken=qa},displayTabs:function(ba){this._mustDisplayTabs=ba},show:function(ba,ka,qa,wa){ka=this._handleServiceInfo.bind(this,ka);ca.tabs();this._setFlags();this.item=ba;this._isSourceTilePackage=!(!qa||!qa.tilePackage);this._isSourceServiceDefinition=!(!qa||!qa.serviceDefinition);this._isSourceTilePackage?(r.set(this._buildButton,"innerHTML",this.i18n.publishButton),
r.set(this.dialog,"title",this.i18n.publishButton),this._canShowTabs=!1):this._isPortal?this._canShowTabs=!1:(r.set(this.dialog,"title",this.i18n.buildTitle),this._canShowTabs=!(!esriGeowConfig.tilesOnDemandEnabled||!this._mustDisplayTabs));this._showTabs(this._canShowTabs);wa?ka(wa):(ba=this._isPortal?f({url:this.item.url,content:{f:"json",token:this._serverToken}}):Y.request({url:this.item.url}),ba.then(ka,ka))},showNoSource:function(ba,ka){this._noSourceData=!0;this.show(ba,ka,!1)},hide:function(){this._noSourceData=
!1;this.dialog.hide();(this._createClicked||this._wasProcessing)&&m.publish("manage-tiles/update",{tileInfoChanged:!0});this._isVisible=this._wasProcessing=this._createClicked=!1},_showTabs:function(ba){I.showHide(this._tabNav,ba);c(".tab-contents").forEach(function(ka){w[ba?"remove":"add"](ka,"no-border")})},_setFlags:function(){this._isPortal=Y.isPortal();this._roleCanPublishTiles=(this._roleCanCreateItem=esriGeowConfig.userRole.canCreateItem())&&esriGeowConfig.userRole.canPublishTiles();this._createClicked=
this._allTilesComplete=this._wasProcessing=this._isProcessing=this._isVisible=this._isSourceTilePackage=this._noSourceData=!1;this._refreshTilesEnabled=!this._isPortal&&esriGeowConfig.tilesOnDemandEnabled},_handleServiceInfo:function(ba,ka){!ka||ka.code||ka.message||(this._serviceFullExtent=ka.fullExtent,this._serviceTileInfo=ka.tileInfo,this._serviceTileInfo.width=this._serviceTileInfo.width||this.DEFAULT_TILE_WIDTH,this._serviceTileInfo.height=this._serviceTileInfo.height||this.DEFAULT_TILE_HEIGHT,
this.serviceMinScale=ka.minScale?ka.minScale:this._serviceTileInfo.lods[0].scale,this.serviceMaxScale=ka.maxScale?ka.maxScale:this._serviceTileInfo.lods[this._serviceTileInfo.lods.length-1].scale,this.serviceMinLOD=h.isDefined(ka.minLOD)?ka.minLOD:void 0,this.serviceMaxLOD=h.isDefined(ka.maxLOD)?ka.maxLOD:void 0,this.dialog.show(),this._isVisible=!0,this._updateStatus(ba))},_handleReportCacheStatus:function(ba){ba&&ba.results&&!ba.message?(ba=ba.results[0],ba.serviceName=this._lastTileStatus.serviceName,
ba.type=this._lastTileStatus.type,ba.lodInfos=ba.value.lodInfos,ba.cacheExecutionStatus=ba.value.cacheExecutionStatus,ba.minScale=this._lastTileStatus.minScale,ba.maxScale=this._lastTileStatus.maxScale,this._updateStatus(ba)):this._updateStatus(ba)},_getStatus:function(){var ba=this;if(this._isVisible)if(ba._isPortal){var ka=ba._handleReportCacheStatus.bind(ba),qa=ba.item.url.indexOf("/services/")+10,wa=ba.item.url.indexOf("/"+ba._lastTileStatus.serviceName+"/")+1;qa=ba.item.url.substring(qa,wa)+
ba._lastTileStatus.serviceName+":"+ba._lastTileStatus.type;var za=T.adjustHostedServerForProtocol(ba._hostedServer.url)+"/rest/services/System/ReportingTools/GPServer/ReportCacheStatus/execute",Fa={service_url:qa,report_mode:"esriCacheStatus",f:"json",token:ba._serverToken,job_id:ba._jobId,ts:(new Date).getTime()};ba._jobId?f({url:za,content:Fa}).then(ka,ka):(qa={service_url:qa,report_mode:"esriJobSummary",f:"json",token:ba._serverToken,ts:(new Date).getTime()},f({url:za,content:qa}).then(function(Ba){Ba&&
Ba.results&&Ba.results[0]&&Ba.results[0].value.esriJobStatus&&Ba.results[0].value.esriJobStatus[0]&&(ba._jobId=Ba.results[0].value.esriJobStatus[0].cancelJobID,Fa.job_id=ba._jobId);f({url:za,content:Fa}).then(ka,ka)}))}else qa=ba.item.url.replace("/rest/","/rest/admin/"),wa=ba._updateStatus.bind(ba),Y.request({url:qa,content:{ts:(new Date).getTime()}}).then(wa,wa)},_updateStatus:function(ba){if(this._isVisible&&(!ba||"Error"!==ba.name||"Unknown runtime error"!==ba.message)){this._lastTileStatus=ba;
this._lastTileStatus.minScale=this._lastTileStatus.minScale||this.serviceMinScale;this._lastTileStatus.maxScale=this._lastTileStatus.maxScale||this.serviceMaxScale;this._lastTileStatus.minLOD=this._lastTileStatus.minLOD||this.serviceMinLOD||void 0;this._lastTileStatus.maxLOD=this._lastTileStatus.maxLOD||this.serviceMaxLOD||void 0;if(this._isProcessing=ba.cacheExecutionStatus===this.PROCESSING||ba.cacheExecutionStatus===this.SUBMITTED)this._wasProcessing=!0,setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE);
this._refreshUI()}},_refreshUI:function(){this._updateData();this._grid?this._updateGrid():this._createGrid();this._updateTotals();this._updateExtent();this._updateDescription();this._updateButtons();this._updateMessage();this._updateTabs()},_updateExtent:function(){if(this._defineExtent&&this._defineExtent._started&&!this._updatedExtent){var ba=[[],[]],ka;4326!==this._serviceFullExtent.spatialReference.wkid&&(ka=da.webMercatorToGeographic(new S(this._serviceFullExtent)));ba[1][1]=parseFloat(ka.ymax);
ba[0][0]=parseFloat(ka.xmin);ba[1][0]=parseFloat(ka.xmax);ba[0][1]=parseFloat(ka.ymin);this._defineExtent.set("extent",ba)}},_updateTabs:function(){this._isProcessing?(this._canShowTabs&&(w.remove(this._extentTab,"is-active"),w.remove(this._extentSection,"is-active"),w.add(this._levelsTab,"is-active"),w.add(this._levelsSection,"is-active")),this._showTabs(!1)):this._showTabs(this._canShowTabs)},_updateButtons:function(){this._roleCanPublishTiles?this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled?
(this._hideButtons(),this._isProcessing&&this._isPortal&&this._jobId?this._showCancel():this._hideCancel()):(this._showButtons(),this._hideCancel()):this._hideButtons()},_updateMessage:function(){this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled||(this._noSourceData?r.set(this._messageDiv,"innerHTML",this.i18n._noSourceData):r.set(this._messageDiv,"innerHTML",this._isSourceTilePackage?this.i18n.selectTilesPublish:this.i18n.selectTiles+"\x3cbr\x3e"+this.i18n.adjustVisibleRange))},
_updateData:function(){var ba=this.i18n.totals,ka=this._lastTileStatus;this._gridStore=new D(new E({data:this._getTileStatusData(),identifier:"id"}));this._gridStore.getTotals||(this._gridStore.getTotals=function(){var wa={},za=0,Fa=0,Ba=0;this.data.forEach(function(ra){za+=parseInt(ra.created,10);Fa+=parseInt(ra.expected,10);Ba+=ra.storageSize?parseInt(ra.storageSize,10):0});var Ca=e.round(za/Fa*100,2)||0;Ca=100<Ca?100:Ca;wa.selected="";wa.scaleLevel=ba;wa.created=e.format(za);wa.expected=e.format(Fa);
wa.pctComplete=String(Ca);wa.storageSize=Q.sizeInMB(ka&&ka.size||Ba);return wa});if(this._noSourceData)I.hideNode(this._scalesSelectedSpan);else{var qa=t.substitute(this.i18n.scalesSelected,{scales:0});r.set(this._scalesSelectedSpan,"innerHTML",qa)}},_getTileStatusData:function(){var ba=this,ka=[],qa=0,wa=0,za,Fa,Ba,Ca;ba._serviceTileInfo.lods.forEach(function(ra){Math.floor(ra.scale)<=ba._lastTileStatus.minScale&&Math.ceil(ra.scale)>=ba._lastTileStatus.maxScale&&(za=Q.calculateExpectedTiles(ba._serviceTileInfo,
ba._serviceFullExtent,ra),ka.push({id:ra.level,selected:!1,scaleLevel:"1:"+e.format(Math.round(ra.scale),{pattern:"#,###,###,##0"}),scale:ra.scale,created:0,expected:za,pctComplete:0,storageSize:0}))});ba._lastTileStatus&&ba._lastTileStatus.lodInfos&&0<ba._lastTileStatus.lodInfos.length&&ba._lastTileStatus.lodInfos.forEach(function(ra){for(Ca=0;Ca<ka.length;Ca++)if(ka[Ca]&&ka[Ca].id===ra.levelID){Fa=Math.round(ra.tileCount/ra.expectedTileCount*100);100<Fa&&(Fa=100);ba._isPortal&&ra.pct&&(Fa=ra.pct);
Ba=ka[Ca];Ba.created=ra.tileCount;Ba.expected=ra.expectedTileCount;Ba.pctComplete=Fa;Ba.storageSize=ra.tilesSize?ra.tilesSize:0;break}});ka.forEach(function(ra){qa+=ra.created;wa+=ra.expected});ba._allTilesComplete=qa===wa;ba._disableButtons();return ka},_updateTotals:function(){var ba=this,ka=ba._grid.on("dgrid-refresh-complete",function(){ba._scrollNode&&ba._currentScrollPos&&(ba._scrollNode.scrollTop=ba._currentScrollPos);ka.remove()});ba._scrollPos&&(ba._currentScrollPos=ba._scrollPos);ba._grid.set("summary",
ba._gridStore.getTotals());ba._grid.resize();ba._grid.refresh()},_updateDescription:function(){r.set(this._dialogDescription,"innerHTML","\x3cstrong\x3e"+(this._isProcessing?this._isSourceTilePackage?this.i18n.jobStatusPublishing:this.i18n.jobStatus:this.i18n.noJobStatus)+"\x3c/strong\x3e\x3cbr/\x3e")},_hideButtons:function(){I.hideNodes(c("div.messageContainer"));I.hideNodes(c("div.selected-scales-container"));I.hideNode(this._buildButton)},_showButtons:function(){I.showNode(this._buildButton);I.showNodes(c("div.selected-scales-container"));
I.showNodes(c("div.messageContainer"))},_hideCancel:function(){I.hideNode(this._cancelButton)},_showCancel:function(){I.showNode(this._cancelButton)},_updateGrid:function(){this._grid.set("columns",this._getGridLayout());this._grid.set("store",this._gridStore)},_createGrid:function(){this._grid=new (g([G,O,N,ja]))({id:"scaleGrid",columns:this._getGridLayout(),showLoadingMessage:!1,showFooter:!0,noDataMessage:"",selectionMode:"none",gridScope:this,allowSelectAll:!0,store:this._gridStore,sort:[{attribute:"id",
descending:!1}]},this._gridContainer);this._grid.startup();this.own(this._grid.on(".dgrid-header-row .field-selected:click",function(ba){this._toggleAll("INPUT"===ba.target.tagName?ba.target:ba.target.childNodes[0])}.bind(this)));this.own(this._grid.on(".dgrid-row .field-selected:click",function(ba){ba="INPUT"===ba.target.tagName?ba.target:ba.target.childNodes[0];var ka=ba.parentNode.parentNode.parentNode.parentNode.id;ka=ka.substring(ka.indexOf("scaleGrid-row-")+14);this._toggleScale(ba,ka)}.bind(this)));
this.own(this._grid.on("scroll",function(ba){this._scrollPos=(this._scrollNode=ba&&ba.scrollTarget||null)&&this._scrollNode.scrollTop||0}.bind(this)))},_getGridLayout:function(){var ba=[];this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled||this._noSourceData||!this._roleCanPublishTiles||ba.push(H({field:"selected",sortable:!1,selectorType:"checkbox"}));ba.push({field:"scaleLevel",label:this.i18n.grid.scaleLevel,sortable:!1,formatter:this._contentFormatter});ba.push({field:"created",
label:this._isSourceTilePackage?this.i18n.grid.tilesPublished:this.i18n.grid.tilesCreated,sortable:!1,formatter:this._tilesFormatter});ba.push({field:"expected",label:this.i18n.grid.totalTiles,sortable:!1,formatter:this._tilesFormatter});ba.push({field:"pctComplete",label:this.i18n.grid.percentComplete,sortable:!1,formatter:this._contentFormatter});ba.push({field:"storageSize",label:this.i18n.grid.storageSize,sortable:!1,formatter:this._sizeFormatter});return ba},_levelsTabClick:function(){this._tab=
this.TABS.LEVELS;this._updateMessage();this._checkToggled()},_extentTabClick:function(){var ba=[[],[]],ka;this._tab=this.TABS.EXTENT;this._defineExtent||(this._defineExtent=new K({id:"defineExtent"},this._extentContainer),this._defineExtent.startup(),4326!==this._serviceFullExtent.spatialReference.wkid&&(ka=da.webMercatorToGeographic(new S(this._serviceFullExtent))),ba[1][1]=parseFloat(ka.ymax),ba[0][0]=parseFloat(ka.xmin),ba[1][0]=parseFloat(ka.xmax),ba[0][1]=parseFloat(ka.ymin),this._defineExtent.set("extent",
ba),this.own(m.subscribe("define-extent/change",this._onExtentChange.bind(this))));r.set(this._messageDiv,"innerHTML",this.i18n.defineExtent);this._checkToggled()},_onExtentChange:function(ba){this._serviceFullExtent.spatialReference.wkid===ba.spatialReference.wkid?this._updatedExtent=ba:J(ba,this._serviceFullExtent.spatialReference,function(ka){ka&&ka.length&&(ka=ka.shift());this._updatedExtent=M(ka)}.bind(this),null,this._defineExtent.map);this._checkToggled()},_calculateIntersection:function(ba,
ka){ba=new S(ba);ka=new S(ka);return(ka=ba.intersects(ka))?ka.toJson():null},_cancelClick:function(){var ba=this;I.disableNode(ba._cancelButton,!0);var ka=function(qa){h.isDefined(qa.error)&&(Q.createSpecifiedDialog(R).show({title:ba.i18n.errorTitle,message:ba.i18n.cantCancelJob}),ba._cancelButton.set("disabled",!1))};f({url:ba._hostedServer.adminUrl+"/rest/services/System/CachingControllers/GPServer/Manage%20Map%20Cache%20Tiles/jobs/"+ba._jobId+"/cancel",content:{f:"json",token:ba._adminServerToken}},
{usePost:!0}).then(ka,ka)},_checkCredits:function(ba){var ka=new v,qa=esriGeowConfig.restBaseUrl+"portals/self/cost";ba={generatedTileCount:ba};this._isPortal||this._isSourceTilePackage?ka.resolve():Y.request({url:qa,content:ba}).then(function(wa){ka.resolve(wa)},function(){ka.resolve()});return ka},_createClick:function(){var ba=this._getAvgTileSize(this._serviceTileInfo),ka=0,qa=0,wa=0,za=[],Fa=[],Ba,Ca,ra,Va,Sa=0,Ra=0,Ta;this._grid.store.query().forEach(function(ya){Ca=parseInt(ya.created,10);
ra=parseInt(ya.expected,10);Va=parseInt(ya.storageSize,10);!0===ya.selected&&(Ba=parseInt(ya.expected,10)-parseInt(ya.created,10),0<Ba&&(this._isPortal?za.push(""+ya.scale):za.push(ya.id)),esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?Sa=(Ta=this._calculateIntersection(this._updatedExtent,this._serviceFullExtent))?Sa+Q.calculateExpectedTiles(this._serviceTileInfo,Ta,this._serviceTileInfo.lods[ya.id]):Sa+0:Sa+=Ca<=ra?Ca:ra,Ra+=ra);qa+=Ca;wa+=Va}.bind(this));Fa=this._grid.store.query().filter(function(ya){return!0===
ya.selected}.bind(this));var Wa=esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?q.stringify(this._updatedExtent):this._serviceFullExtent.xmin+","+this._serviceFullExtent.ymin+","+this._serviceFullExtent.xmax+","+this._serviceFullExtent.ymax;if(0<za.length){ka=esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?Sa:Ra-Sa;var La=this._formatSizeWithUnits((0<wa&&0<qa?wa/qa:ba)*ka),$a=this._isPortal?za.join(";"):za.join(",");this._checkCredits(ka).then(function(ya){var Xa=
"\x3cp\x3e"+t.substitute(this._isSourceTilePackage?this.i18n.aboutToPublish:this.i18n.aboutToCreate,{tiles:ka,storage:La})+"\x3c/p\x3e",bb=!1;!this._isPortal&&!this._isSourceTilePackage&&h.isDefined(ya.transactionCreditCost)&&h.isDefined(ya.availableCredits)&&(ya.transactionCreditCost>ya.availableCredits?bb=!0:Xa+="\x3cp\x3e"+t.substitute(this.i18n.aboutToCreateCost,{credits:e.format(ya.transactionCreditCost),creditsLeft:e.format(ya.availableCredits)})+"\x3c/p\x3e");Xa+="\x3cp\x3e"+(this._isSourceTilePackage?
this.i18n.reallyPublishTiles:this.i18n.reallyCreateTiles)+"\x3c/p\x3e";!this._isPortal&&bb?Q.createSpecifiedDialog(R).show({title:this.i18n.notice,message:this.i18n.notEnoughCredits}):(ya={title:this._isSourceTilePackage?this.i18n.publishTiles:this.i18n.createTiles,message:Xa,choiceOneTitle:this._isSourceTilePackage?this.i18n.yesPublishTiles:this.i18n.yesCreateTiles,choiceTwoTitle:this._isSourceTilePackage?this.i18n.noPublishTiles:this.i18n.noCreateTiles},ya.choiceOneHandler=function(){this._createClicked=
!0;var cb=Fa.length&&Fa[0]||W.find(this._serviceTileInfo.lods,function(ia){return this.serviceMinScale===ia.scale}),ab=Fa.length&&Fa[Fa.length-1]||W.find(this._serviceTileInfo.lods,function(ia){return this.serviceMaxScale===ia.scale}),Ua=h.isDefined(this.serviceMinLOD)||h.isDefined(this.serviceMaxLOD),db=Ua&&cb&&cb.id<this.serviceMinLOD;Ua=Ua&&ab&&ab.id>this.serviceMaxLOD;var A=this._isSourceServiceDefinition&&(db||Ua);if(this._isPortal){I.disableNode(this._cancelButton,!1);var F=this.item.url.indexOf("/services/")+
10,L=this.item.url.indexOf(this._lastTileStatus.serviceName);F=this.item.url.substring(F,L);var U=this._hostedServer.adminUrl+"/rest/services/System/CachingControllers/GPServer/Manage%20Map%20Cache%20Tiles/submitJob",P={f:"json",token:this._adminServerToken,service_url:F+this._lastTileStatus.serviceName+":"+this._lastTileStatus.type,constraining_extent:Wa,levels:$a,update_mode:"RECREATE_ALL_TILES",thread_count:-1},aa=function(ia){ia.code&&ia.message?Q.createSpecifiedDialog(R).show({title:this.i18n.errorTitle,
message:ia.message}):(this._jobId=ia.jobId,this._isProcessing=!0,this._isVisible&&(this._updatedExtent=void 0,this._refreshUI(),setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE)))}.bind(this);A?(A={},db&&(A.minLOD=cb.id),Ua&&(A.maxLOD=ab.id),Y.request({url:ea.replace("/updateTiles","/edit"),content:{serviceDefinition:JSON.stringify(A)}},{usePost:!0}).then(function(ia){f({url:U,content:P},{usePost:!0}).then(aa,aa)},function(ia){})):f({url:U,content:P},{usePost:!0}).then(aa,aa)}else{var ea=
this.item.url.replace("/rest/","/rest/admin/")+"/updateTiles";9>=n("ie")&&(F=ea.indexOf("admin/services/"),L=ea.indexOf("/MapServer"),ea=ea.substring(0,F+15)+encodeURIComponent(ea.substring(F+15,L))+ea.substring(L));var fa={levels:$a,extent:Wa},ha=function(ia){if(ia.code&&ia.message){var ma=ia.message;ia.message&&-1<ia.message.toLowerCase().indexOf("credit")?ma=this.i18n.notEnoughCredits:ia.message&&-1<ia.message.toLowerCase().indexOf("invalid extent")&&(ma=this.i18n.invalidExtent);Q.createSpecifiedDialog(R).show({title:this.i18n.errorTitle,
message:ma})}else this._isProcessing=!0,this._isVisible&&(this._updatedExtent=void 0,this._refreshUI(),setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE))}.bind(this);A?(A={},db&&(A.minLOD=cb.id),Ua&&(A.maxLOD=ab.id),Y.request({url:ea.replace("/updateTiles","/edit"),content:{serviceDefinition:JSON.stringify(A)}},{usePost:!0}).then(function(ia){Y.request({url:ea,content:fa},{usePost:!0}).then(ha,ha)},function(ia){})):Y.request({url:ea,content:fa},{usePost:!0}).then(ha,ha)}}.bind(this),
ya.choiceTwoHandler=function(){}.bind(this),this._createChoiceDlg().show(ya))}.bind(this))}},_createChoiceDlg:function(){if(x.byId("choice-dialog"))var ba=X.prototype.statics.getInstance();else ba=new X,a.once(ba._dialog,"hide",function(){ba._dialog.destroyRecursive();ba.destroyRecursive()});return ba},_contentFormatter:function(ba){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+ba+"\x3c/span\x3e"},_tilesFormatter:function(ba){var ka="esriContentTypeName";ba&&1E10<=ba&&(ka="esriContentTypeNameSmall");
return'\x3cspan class\x3d"'+ka+'"\x3e'+e.format(ba)+"\x3c/span\x3e"},_sizeFormatter:function(ba){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+Q.sizeInMB(ba)+"\x3c/span\x3e"},_getAvgTileSize:function(ba){return 1E3*(ba.rows?ba.rows/10:25.6)},_formatSizeWithUnits:function(ba){var ka=ba,qa=" "+this.i18n.megabytes;1048567E3<ba?(ka=ba/1048567E3,qa=" "+this.i18n.gigabytes):0<ba&&(ka=ba/1048567);ka=Math.round(100*ka)/100;return e.format(ka)+qa},_enableButtons:function(ba,ka,qa){var wa=this._tab===
this.TABS.LEVELS?this.i18n.tilesToCreate:this.i18n.tilesToCreateInExtent,za=this.i18n.tilesToPublish,Fa=this.i18n.noTilesToCreate,Ba=this.i18n.noTilesToPublish,Ca="";ba!==ka?(ba=ka-ba,qa=this._formatSizeWithUnits(qa*ba),Ca=t.substitute(this._isSourceTilePackage?za:wa,{tiles:ba,storage:qa}),I.disableNode(this._buildButton,!1)):(Ca=t.substitute(this._isSourceTilePackage?Ba:Fa,{tiles:0}),I.disableNode(this._buildButton,!0));r.set(this._messageDiv,"innerHTML",Ca)},_disableButtons:function(){r.set(this._messageDiv,
"innerHTML",this._isSourceTilePackage?this.i18n.selectTilesPublish:this.i18n.selectTiles+"\x3cbr\x3e"+this.i18n.adjustVisibleRange);I.disableNode(this._buildButton,!0)},_setScalesSelected:function(ba){ba=t.substitute(this.i18n.scalesSelected,{scales:ba});this._scalesSelectedSpan&&r.set(this._scalesSelectedSpan,"innerHTML",ba)},_toggleAll:function(ba){if(ba){var ka=r.get(ba,"checked");this._grid&&this._grid.store&&(this._grid.store.query().forEach(function(qa){qa.selected=ka}),this._checkToggled())}},
_toggleScale:function(ba,ka){if(this._grid.store){if(ka=this._grid.store.query({id:ka}).shift())ka.selected=r.get(ba,"checked");this._checkToggled()}},_checkToggled:function(){var ba=this,ka=0,qa=0,wa=0,za=0,Fa=0,Ba;if(ba._grid.store)if(ba._grid.store.query().forEach(function(ra){var Va=parseInt(ra.created,10),Sa=parseInt(ra.expected,10),Ra=parseInt(ra.storageSize,10);ra.selected&&(ka++,esriGeowConfig.tilesOnDemandEnabled&&!ba._isPortal&&ba._updatedExtent?qa=(Ba=ba._calculateIntersection(ba._updatedExtent,
ba._serviceFullExtent))?qa+Q.calculateExpectedTiles(ba._serviceTileInfo,Ba,ba._serviceTileInfo.lods[ra.id]):qa+0:qa+=Va<=Sa?Va:Sa,wa+=Sa);za+=Va;Fa+=Ra}),ka){var Ca=0<Fa?Fa/za:ba._getAvgTileSize(ba._serviceTileInfo);esriGeowConfig.tilesOnDemandEnabled&&!ba._isPortal&&ba._updatedExtent?ba._enableButtons(wa-qa,wa,Ca):ba._enableButtons(qa,wa,Ca)}else ba._disableButtons();else ba._disableButtons();ba._setScalesSelected(ka)}});la.prototype.statics={getInstance:function(){this._instance||(this._instance=
new la);return this._instance}};return la})},"arcgisonline/pages/serviceUtil":function(){define("require exports tslib dojo/Deferred dojo/json dojo/promise/all dojo/sniff esri/lang esri/layers/FeatureLayer esri/request ./pageUtil ./utils/arrays arcgisonline/sharing/dijit/Role ../sharing/util ../esriGeowConfig".split(" "),function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t){b=p.__importDefault(b);h=p.__importDefault(h);f=p.__importDefault(f);d=p.__importDefault(d);a=p.__importDefault(a);c=p.__importDefault(c);
n=p.__importDefault(n);m=p.__importDefault(m);q=p.__importDefault(q);l=p.__importDefault(l);e=p.__importDefault(e);t=p.__importDefault(t);return function(){function x(){}x.getDateFields=function(r){return((null===r||void 0===r?void 0:r.fields)||[]).filter(function(w){return"esriFieldTypeDate"===(null===w||void 0===w?void 0:w.type)})};x.fetchServerToken=function(r,w){var u=r.portal;return(r=w||r.url)?e.default.request({url:e.default.getSecureUrl(u.portalUrl+"generateToken"),content:{serverUrl:r}},
{usePost:!0}).then(function(v){return v.token}):null};x.fetchItemAdminUrl=function(r,w){var u;return r.portal.isPortal?(null===w||void 0===w?0:w.adminUrl)&&w.url?this.getAdminUrl(r,w):r.url:(null===(u=r.url)||void 0===u?void 0:u.replace("/rest/","/rest/admin/"))||null};x.getAdminUrl=function(r,w){var u=r.url;w=u.replace(u.split("/rest/")[0],w.adminUrl);return r.isSDS?w.replace("/rest/","/rest/admin/"):w.replace("/rest/","/admin/").replace("/FeatureServer",".MapServer").replace("/MapServer",".MapServer").replace("/VectorTileServer",
".VectorTileServer").replace("/SceneServer",".SceneServer").replace("/ImageServer",".ImageServer")};x.fetchServiceLayers=function(r){return e.default.request({url:r+"/layers"}).then(function(w){return(null===w||void 0===w?void 0:w.layers)||[]})};x.renameServiceLayers=function(r,w){var u=new b.default,v=w.adminUrl+"/"+r.layerId;r={name:r.layerRename};"Map Service"===w.type?(v+="/edit",w={layerDefinition:JSON.stringify(r)}):(v+="/updateDefinition",w={updateDefinition:JSON.stringify(r),async:!1});e.default.request({url:v,
content:w},{usePost:!0}).then(function(){return u.resolve()},function(y){return u.reject(y)});return u};x.updateServiceDefinition=function(r){var w=r.layerId,u=r.item;r=r.definition;var v=new b.default;e.default.request({url:u.adminUrl+"/"+w+"/updateDefinition",content:{updateDefinition:JSON.stringify(r),async:!1}},{usePost:!0}).then(function(){return v.resolve()},function(y){return v.reject(y)});return v};x.queryGeocodeCounts=function(r){var w=[],u=r.url,v={where:"1\x3d1",returnCountOnly:!0},y=r.reviewTable,
z=u+"/"+(r.layers||[])[0].id+"/query",B=new b.default;r.canUpdate&&r.isHostedService&&r.hasGeocodeReviewTable?(w.push(e.default.request({url:z,content:v})),y&&(r=u+"/"+y.id+"/query",w.push(e.default.request({url:r,content:v}))),f.default(w).then(function(C){var E=(null===C||void 0===C?void 0:C.length)&&C[0].count||0;B.resolve({successful:E,total:E+(1<(null===C||void 0===C?void 0:C.length)&&C[1].count||0)})},function(C){B.resolve(null)})):B.resolve(null);return B};x.adjustHostedServerForProtocol=function(r){return"https:"===
location.protocol?r.replace("http:","https:").replace(":6080",":6443"):r.replace("https:","http:").replace(":6443",":6080")};x.checkForResources=function(r){var w=r.itemUrl+"/resources/styles/root.json";"Vector Tile Service"!==r.type||a.default.isDefined(r.hasResources)?(w=new b.default,w.resolve(!!r.hasResources)):w=e.default.request({url:w}).then(function(){return!0},function(){return!1});return w};x.setFeatureServiceScaleRanges=function(r){var w=this,u=new b.default,v=r.url,y=r.sourceData||{},
z=r.featureLayers||[];!r.numViews&&r.isHostedService&&"Feature Service"===r.type&&"Service Definition"!==y.type?f.default(z.map(function(B){return w.setScaleRange(v+"/"+B.id,r,B.id)})).then(function(){return u.resolve(!0)}):u.resolve(!0);return u};x.setScaleRange=function(r,w,u){var v=new b.default,y=new c.default(r);r=w.adminUrl;u=a.default.isDefined(u)?"/"+u:"";var z=""+r+u+"/updateDefinition";y.addPlugin("esri/plugins/FeatureLayerStatistics").then(function(){y.statisticsPlugin.getSuggestedScaleRange().then(function(B){B=
{updateDefinition:h.default.stringify({maxScale:B.maxScale||0,minScale:B.relaxedMinScale||0})};e.default.request({url:z,content:B},{usePost:!0}).then(function(){return v.resolve(w)},function(){return v.resolve(w)})},function(B){v.resolve(w)})});return v};x.getSuggestedScaleRange=function(r){var w=new b.default,u=new c.default(r);u.addPlugin("esri/plugins/FeatureLayerStatistics").then(function(){u.statisticsPlugin.getSuggestedScaleRange({sampleSize:100,forPublishingTiles:!0}).then(function(v){return w.resolve(v)},
function(v){w.resolve(null)})},function(v){w.resolve(null)});return w};x.encodeServiceName=function(r,w){if(d.default("ie")||d.default("trident")||d.default("edge")){var u=r.indexOf("admin/services/Hosted/");w=e.default.isPortal()&&!w?-1<r.indexOf(".MapServer")?r.indexOf(".MapServer"):-1<r.indexOf(".VectorTileServer")?r.indexOf(".VectorTileServer"):r.indexOf("/SceneServer"):r.indexOf("/FeatureServer");0<u&&(r=r.substring(0,u+22)+encodeURIComponent(r.substring(u+22,w))+r.substring(w))}return r};x.fetchPartialUpdateScenePublishingCredits=
function(r,w,u){var v=new b.default,y=(r.adminServiceInfo||{}).layers||[],z=w.serviceInfo||{},B=z.layers||[];r=r.url+"/extractChanges";var C={returnIdsOnly:!0,returnInserts:!0,returnUpdates:!0,returnDeletes:!0,layers:[],layerServerGens:[],async:!1,dataFormat:"json"},E={},D={textured:0,untextured:0},G=(w.portal||{}).portalUrl+"portals/self/usageCost",H={name:z.name,etype:"tilegencnt",stype:"scene"},N;u.forEach(function(O){var S;C.layers.push(O.id);(N=q.default.find(y,function(J){return J.id===O.id}))||
1!==y.length||(N=y[0]);if(N){var da=O.id;da!==N.id&&(da=N.id);N.isTextured=!(null===(S=null===N||void 0===N?void 0:N.multiPatchInfo)||void 0===S||!S.hasTexture);E[da]=N}});B.forEach(function(O){-1<C.layers.indexOf(O.id)&&O.serviceUpdateTimeStamp&&C.layerServerGens.push({id:O.id,serverGen:O.serviceUpdateTimeStamp.lastUpdate})});e.default.request({url:r,content:p.__assign(p.__assign({},C),{layers:JSON.stringify(C.layers),layerServerGens:JSON.stringify(C.layerServerGens)})},{usePost:!0}).then(function(O){(null===
O||void 0===O?0:O.edits)?(Object.keys(O.edits).forEach(function(S){S=O.edits[S];var da=S.objectIds;D[E[S.id].isTextured?"textured":"untextured"]+=da.adds.length+da.updates.length+da.deletes.length}),f.default({textured:0<D.textured?e.default.request({url:G,content:p.__assign({num:D.textured,task:"textured"},H)}):null,untextured:0<D.untextured?e.default.request({url:G,content:p.__assign({num:D.untextured,task:"nontextured"},H)}):null}).then(function(S){var da,J;S=((null===(da=null===S||void 0===S?
void 0:S.textured)||void 0===da?void 0:da.credits)||0)+((null===(J=null===S||void 0===S?void 0:S.untextured)||void 0===J?void 0:J.credits)||0);v.resolve(S)},function(){v.resolve(0)})):v.resolve(0)},function(O){v.resolve(0)});return v};x.fetchScenePublishingCredits=function(r,w,u){var v=new b.default,y=r.adminServiceInfo||{},z=y.layers||[],B=r.url+"/query",C={},E={},D={textured:0,untextured:0},G=(r.portal||{}).portalUrl+"portals/self/usageCost",H={name:y.name,etype:"tilegencnt",stype:"scene"},N;w.length&&
u?z.forEach(function(O){var S;O.isTextured=!(null===(S=null===O||void 0===O?void 0:O.multiPatchInfo)||void 0===S||!S.hasTexture);E[O.id]=O;C[O.id]="1\x3d1"}):w.forEach(function(O){var S;(N=q.default.find(z,function(J){return J.id===O.id}))||1!==z.length||(N=z[0]);if(N){var da=O.id;da!==N.id&&(da=N.id);N.isTextured=!(null===(S=null===N||void 0===N?void 0:N.multiPatchInfo)||void 0===S||!S.hasTexture);E[da]=N;C[da]="1\x3d1"}});e.default.request({url:B,content:p.__assign(p.__assign({},{}),{layerDefs:JSON.stringify(C),
returnCountOnly:!0})}).then(function(O){(null===O||void 0===O?0:O.layers)?(O.layers.forEach(function(S){D[E[S.id].isTextured?"textured":"untextured"]+=S.count}),f.default({textured:0<D.textured?e.default.request({url:G,content:p.__assign({num:D.textured,task:"textured"},H)}):null,untextured:0<D.untextured?e.default.request({url:G,content:p.__assign({num:D.untextured,task:"nontextured"},H)}):null}).then(function(S){var da,J;S=((null===(da=null===S||void 0===S?void 0:S.textured)||void 0===da?void 0:
da.credits)||0)+((null===(J=null===S||void 0===S?void 0:S.untextured)||void 0===J?void 0:J.credits)||0);v.resolve(S)},function(){v.resolve(0)})):v.resolve(0)},function(){v.resolve(0)});return v};x.findManagedDataStoreItems=function(r){r+="/admin/data/findItems";return e.default.request({url:r,content:{managed:!0}},{useProxy:e.default.shouldUseProxy(r)})};x.isBackedBySDS=function(r){var w,u=new b.default,v=(null===(w=null===t.default||void 0===t.default?void 0:t.default.self)||void 0===w?void 0:w.user)||
{};w=new l.default({portalUser:v});var y=!1,z;v&&(w.isBasedOnAdmin()||w.isBasedOnPublisher())&&r&&!m.default.isEmptyObject(r)?this.findManagedDataStoreItems(r.adminUrl).then(function(B){z=((null===B||void 0===B?void 0:B.items)||B||[]).filter(function(C){var E;return"arcgis data store"===(null===(E=null===C||void 0===C?void 0:C.provider)||void 0===E?void 0:E.toLowerCase())});y=!(null===z||void 0===z||!z.length);u.resolve(y)},function(){u.resolve(y)}):u.resolve(y);return u};x.isImageManagementTask=
function(r){if(!r||-1===r.indexOf("RasterAnalysisTools")||-1===r.indexOf("GPServer/"))return!1;r=r.slice(r.indexOf("GPServer/")+9);-1<r.indexOf("/")&&(r=r.slice(0,r.indexOf("/")));var w="buildfootprints buildoverview calculatestatistics definenodata computecolorcorrection computeseamlines".split(" ");return r&&-1<w.indexOf(r.toLowerCase())};x.getBackingDataStoreInfo=function(r){var w,u=new b.default,v=(null===(w=null===t.default||void 0===t.default?void 0:t.default.self)||void 0===w?void 0:w.user)||
{};w=new l.default({portalUser:v});var y=!0,z=!1,B;v&&(w.isBasedOnAdmin()||w.isBasedOnPublisher())&&r&&!m.default.isEmptyObject(r)?this.findManagedDataStoreItems(r.adminUrl).then(function(C){B=((null===C||void 0===C?void 0:C.items)||C||[]).filter(function(E){var D;return"arcgis data store"===(null===(D=null===E||void 0===E?void 0:E.provider)||void 0===D?void 0:D.toLowerCase())});y=0===((null===C||void 0===C?void 0:C.items)||C||[]).length;z=!(null===B||void 0===B||!B.length);u.resolve({isSDS:z,none:y})},
function(){u.resolve({isSDS:z,none:y})}):u.resolve({isSDS:z,none:y});return u};x.cacheMaxAgeCheck=function(r,w){var u;if(!r.ignoreCache&&r.layers&&"Feature Service"===r.type&&r.isHostedService&&0<(null===(u=null===w||void 0===w?void 0:w.adminServiceInfo)||void 0===u?void 0:u.cacheMaxAge)&&(r.ignoreCache=function(){var y=this;this.ignoreCacheFlagTimestamp=(new Date).getTime();var z=function(B){B.content=B.content||{};B.content._ts=y.ignoreCacheFlagTimestamp;return B};this.ignoreCacheFlag||(n.default.setRequestPreCallback(z),
this.ignoreCacheFlag=!0)},r.layers)){var v=0;r.layers.forEach(function(y){var z;(null===(z=y.editingInfo)||void 0===z?0:z.lastEditDate)&&v<y.editingInfo.lastEditDate&&(v=y.editingInfo.lastEditDate)});0<v&&((new Date).getTime()-v)/1E3<w.adminServiceInfo.cacheMaxAge&&r.ignoreCache()}};x.isServiceProxy=function(r){var w=(r||"").toLowerCase();r=-1<w.indexOf("/servers/")&&-1<w.indexOf("/rest/services/");var u=t.default.self.isPortal&&-1<w.indexOf(t.default.self.portalHostname);w=!t.default.self.isPortal&&
-1<w.indexOf(".arcgis.com");return r&&(u||w)};return x}()})},"calcite-web/js/calcite-web":function(){(function(k,g){"object"===typeof exports&&"undefined"!==typeof module?module.exports=g():"function"===typeof define&&define.amd?define(g):k.calcite=g()})(this,function(){function k(I,T){for(;T;T=T.parentNode){var Y=T&&T.getAttribute&&T.getAttribute("class")||"";Y=(new RegExp("(\\s|^)"+I+"(\\s|$)")).test(Y);if(1===T.nodeType&&Y)break}return T}function g(I){return Array.isArray(I)?I:Array.prototype.slice.call(I)}
function p(I,T){I=(T||document).querySelectorAll(I);return g(I)}function b(I,T){return(new RegExp("(\\s|^)"+T+"(\\s|$)")).test(I.getAttribute("class"))}function h(I,T){T.split(" ").forEach(function(Y){if(!b(I,Y)){var ca=I.getAttribute("class")||"";I.setAttribute("class",ca+" "+Y)}})}function f(I,T){T.split(" ").forEach(function(Y){var ca=(I.getAttribute("class")||"").replace(new RegExp("(\\s|^)"+Y+"(\\s|$)","g"),"$2");b(I,Y)&&I.setAttribute("class",ca)})}function d(I){I=g(I);I.forEach(function(T){f(T,
"is-active")})}function a(I,T){d(I);h(T,"is-active")}function c(I,T,Y){if(I.addEventListener)return I.addEventListener(T,Y,!1);if(I.attachEvent)return I.attachEvent("on"+T,Y)}function n(I,T,Y){if(I.removeEventListener)return I.removeEventListener(T,Y,!1);if(I.detachEvent)return I.detachEvent("on"+T,Y)}function m(I){if(I.preventDefault)return I.preventDefault();I.returnValue&&(I.returnValue=!1)}function q(I){I=I||window.event;if(I.stopPropagation)return I.stopPropagation();I.cancelBubble&&(I.cancelBubble=
!0)}function l(){}function e(I){for(var T="",Y=0;Y<I;Y++)T+=(65536*(1+Math.random())|0).toString(16).substring(1);return T}function t(I){if(!I)throw new TypeError("Invalid argument `value` has no value.");this.value=t.EMPTY;I&&I instanceof t?this.value=I.toString():I&&"[object String]"===Object.prototype.toString.call(I)&&t.isGuid(I)&&(this.value=I);this.equals=function(T){return t.isGuid(T)&&this.value===T};this.isEmpty=function(){return this.value===t.EMPTY};this.toString=function(){return this.value};
this.toJSON=function(){return this.value}}function x(I){q(I);I=k("accordion-section",I.target||I.srcElement);R.emit("accordion:toggle",{node:I})}function r(I){var T=I.node;b(T,"is-active")?f(T,"is-active"):h(T,"is-active");(I=I.node.querySelector(".accordion-title"))&&(I.getAttribute("aria-expanded")?I.removeAttribute("aria-expanded"):I.setAttribute("aria-expanded","true"))}function w(I){13!==I.keyCode&&32!==I.keyCode||!b(I.target||I.srcElement,"accordion-title")||(m(I),q(I),x(I))}function u(I){var T=
p(".js-accordion");I?v(I.node):T.forEach(function(Y){v(Y)})}function v(I){I.setAttribute("aria-live","polite");I.setAttribute("role","tablist");g(I.children).forEach(function(T){var Y=T.querySelector(".accordion-title"),ca=T.querySelector(".accordion-content"),V=ca.id||t.raw();ca.id=V;Y.setAttribute("role","tab");Y.setAttribute("tabindex","0");Y.setAttribute("aria-controls",V);b(T,"is-active")&&Y.setAttribute("aria-expanded","true");var Z=!1;K.accordions.forEach(function(ja){ja.target===Y&&"click"===
ja.event&&ja.fn===x&&(Z=!0)});Z||(K.accordions.push({target:Y,event:"click",fn:x}),K.accordions.push({target:T,event:"keydown",fn:w}),c(Y,"click",x),c(T,"keydown",w))})}function y(){Q||(R.on("accordion:bind",u),R.on("accordion:toggle",r),Q=!0);R.emit("accordion:bind")}function z(I){n(document.body,"click",z);p(".js-dropdown").forEach(function(T){f(T,"is-active")});p(".js-dropdown-toggle").forEach(function(T){T.setAttribute("aria-expanded","false")});n(document,"keydown",E);n(document.body,"focusin",
B)}function B(I){I.target&&!k("js-dropdown",I.target)&&R.emit("dropdown:close")}function C(I){if(I){var T=b(I.node,"is-active");R.emit("dropdown:close");T||(h(I.node,"is-active"),I.target&&I.target.setAttribute("aria-expanded","true"),c(document,"keydown",E));b(I.node,"is-active")&&(c(document.body,"click",z),c(document.body,"focusin",B))}}function E(I){40===I.keyCode|38===I.keyCode&&I.preventDefault()}function D(I){p(".js-dropdown-toggle").forEach(function(T){var Y=!1;K.dropdowns.forEach(function(ca){ca.target===
T&&"click"===ca.event&&ca.fn===S&&(Y=!0)});Y||(K.dropdowns.push({target:T,event:"click",fn:S}),c(T,"click",S))})}function G(){var I=document.querySelector(".js-dropdown.is-active");return I?I:!1}function H(I){var T=I.links.indexOf(document.activeElement);-1===T?T=I.forward?0:I.links.length-1:I.forward?(T+=1,T===I.links.length&&(T=0)):(--T,-1===T&&(T=I.links.length-1));I.links[T].focus()}function N(){var I=G();I&&(I=p(".dropdown-link",I).filter(function(T){return null!==T.offsetParent}),R.emit("dropdown:focus",
{links:I,forward:!0}))}function O(){var I=G();I&&(I=p(".dropdown-link",I).filter(function(T){return null!==T.offsetParent}),R.emit("dropdown:focus",{links:I,forward:!1}))}function S(I){m(I);q(I);var T=k("js-dropdown",I.target);R.emit("dropdown:toggle",{node:T,target:I.target})}function da(){W||(R.on("dropdown:toggle",C),R.on("dropdown:close",z),R.on("keyboard:escape",z),R.on("keyboard:arrow:down",N),R.on("keyboard:arrow:up",O),R.on("dropdown:focus",H),W=!0);D()}function J(){R.on("scrolling:at",function(T){I.forEach(function(Y){var ca=
Y.element;b(Y.element,"is-sticky")&&(ca=Y.element.getAttribute("data-sticky-id"),ca=document.querySelector('.js-shim[data-sticky-id\x3d"'+ca+'"]'));if(ca){var V=ca.getAttribute("data-top")||0;Y.top=ca.offsetTop-parseInt(V,0)}Y.top<T?R.emit("sticky:stick",Y):R.emit("sticky:unstick",Y)})});R.on("sticky:stick",function(T){var Y=T.element.getAttribute("data-sticky-id"),ca=document.querySelector('.js-shim[data-sticky-id\x3d"'+Y+'"]');Y&&ca&&(h(T.element,"is-sticky"),ca.style.display="")});R.on("sticky:unstick",
function(T){var Y=T.element.getAttribute("data-sticky-id"),ca=document.querySelector('.js-shim[data-sticky-id\x3d"'+Y+'"]');Y&&ca&&(f(T.element,"is-sticky"),ca.style.display="none")});var I=p(".js-sticky").map(function(T){var Y=T.offsetTop,ca=T.getAttribute("data-top")||0;T.style.top=ca+"px";if(!T.getAttribute("data-sticky-id")){var V=t.raw();T.setAttribute("data-sticky-id",V);var Z=T.parentNode,ja=T.cloneNode("deep");h(ja,"js-shim");f(ja,"js-sticky");ja.setAttribute("data-sticky-id",V);ja.style.visibility=
"hidden";ja.style.display="none";Z.insertBefore(ja,T)}return{top:Y-parseInt(ca,0),element:T}})}function M(){function I(V){var Z=V.getAttribute("data-tab");if(Z)return Z;Z=t.raw();V.setAttribute("data-tab",Z);return Z}function T(V){var Z=V.target;b(Z,"js-tab")||(Z=V.currentTarget);V=k("js-tab-group",Z);var ja=I(V);return{parent:V,id:ja,active:Z}}function Y(V){V.preventDefault();V=T(V);R.emit("tabs:active",V)}function ca(V){var Z=T(V);if(13===V.keyCode||32===V.keyCode)V.preventDefault(),R.emit("tabs:active",
Z);if(39===V.keyCode||37===V.keyCode){var ja=g(Z.parent.querySelectorAll(".js-tab")),la=ja.indexOf(document.activeElement);-1<la&&b(document.activeElement,"js-tab")&&(Z=ja[la+1]||ja[0],ja=ja[la-1]||ja[ja.length-1],(39===V.keyCode?Z:ja).focus())}}R.on("tabs:bind",function(){var V=p(".js-tab"),Z=p(".js-tab-group"),ja=p(".js-tab-section");Z.forEach(function(la){la.setAttribute("aria-live","polite");I(la);la.children[0].setAttribute("role","tablist");la=la.querySelectorAll(".js-tab");for(var ba=100/la.length,
ka=0;ka<la.length;ka++)la[ka].style.maxWidth=ba+"%"});V.forEach(function(la){la.setAttribute("aria-expanded","false");la.setAttribute("role","tab");la.setAttribute("tabindex","0");c(la,"click",Y);c(la,"keydown",ca)});ja.forEach(function(la){la.setAttribute("role","tabpanel");b(la,"is-active")?la.setAttribute("aria-expanded",!0):la.setAttribute("aria-expanded",!1)})});R.on("tabs:active",function(V){var Z=V.parent,ja=g(Z.querySelectorAll(".js-tab"));V=V.active;Z=g(Z.querySelectorAll(".js-tab-section"));
var la=ja.indexOf(V);la=Z[la];ja.forEach(function(ba){ba.setAttribute("aria-expanded",!1)});V.setAttribute("aria-expanded",!0);a(ja,V);Z.forEach(function(ba){ba.setAttribute("aria-expanded",!1)});la.setAttribute("aria-expanded",!0);a(Z,la);V.focus()});R.emit("tabs:bind")}var K={dropdowns:[],accordions:[],modals:[]};l.prototype={on:function(I,T,Y){var ca=this.e||(this.e={});(ca[I]||(ca[I]=[])).push({fn:T,ctx:Y});return this},once:function(I,T,Y){function ca(){V.off(I,ca);T.apply(Y,arguments)}var V=
this;ca._=T;return this.on(I,ca,Y)},emit:function(I){var T=[].slice.call(arguments,1),Y=((this.e||(this.e={}))[I]||[]).slice(),ca=0,V=Y.length;for(ca;ca<V;ca++)Y[ca].fn.apply(Y[ca].ctx,T);return this},off:function(I,T){var Y=this.e||(this.e={}),ca=Y[I],V=[];if(ca&&T)for(var Z=0,ja=ca.length;Z<ja;Z++)ca[Z].fn!==T&&ca[Z].fn._!==T&&V.push(ca[Z]);V.length?Y[I]=V:delete Y[I];return this}};var R=new l,X=/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/i;t.EMPTY="00000000-0000-0000-0000-000000000000";
t.isGuid=function(I){return I&&(I instanceof t||X.test(I.toString()))};t.create=function(){return new t([e(2),e(1),e(1),e(1),e(3)].join("-"))};t.raw=function(){return[e(2),e(1),e(1),e(1),e(3)].join("-")};var Q=!1,W=!1;c(document,"keyup",function(I){27===I.keyCode?R.emit("keyboard:escape"):13===I.keyCode?R.emit("keyboard:return"):32===I.keyCode?R.emit("keyboard:space"):38===I.keyCode?R.emit("keyboard:arrow:up"):40===I.keyCode?R.emit("keyboard:arrow:down"):37===I.keyCode?R.emit("keyboard:arrow:left"):
39===I.keyCode&&R.emit("keyboard:arrow:right")});c(window,"scroll",function(I,T,Y){var ca,V,Z;var ja=function(){ca=!1;V&&(Z.apply(Y,V),V=!1)};return Z=function(){ca?V=arguments:(I.apply(Y,arguments),setTimeout(ja,T),ca=!0)}}(function(){R.emit("scrolling:at",window.pageYOffset)},100));return{bus:R,accordion:y,dropdown:da,sticky:J,tabs:M,init:function(){[y,da,J,M].forEach(function(I){I()})}}})},"arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg":function(){define("require esri/declare esri/Evented dojo/_base/lang dojo/_base/array dojo/on dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojo/query dojo/string dojo/topic dojo/date/locale dojo/store/Memory dijit/a11yclick dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../../esriGeowConfig ../../../pages/utils/icons ../../util ../Grid ./GeneralDlg dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/dialog/templates/MembershipRequestsDlg.html".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H){var N=g("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg",[u,v,y,p],{baseClass:"esriMembershipRequestsDlg",widgetsInTemplate:!0,templateString:H,groupId:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=b.mixin({},G.common);b.mixin(this.i18n,G.membershipRequestsDlg);b.mixin(this.i18n,G.groupMembershipRequestsGrid);b.mixin(this.i18n,{error:G.inviteUsersDlg.error})},postCreate:function(){this.loadConnections()},
loadConnections:function(){this.own(m(".jevent").on("click",function(O){O.preventDefault()}),x(this._closeBtn,b.hitch(this,function(){this._dialog.hide()})),l.subscribe("onApplicationAccept",b.hitch(this,"onApplicationApprove")),l.subscribe("onApplicationDecline",b.hitch(this,"onApplicationDecline")))},show:function(O){this.groupId=O;this.clearStore();this.requestApplications();this._dialog.show()},approveApplication:function(O,S){var da=C.getUser(),J=this._requestsGrid._grid.store;da&&C.request({url:z.restBaseUrl+
"community/groups/"+this.groupId+"/applications/"+S+"/accept"},{usePost:!0}).then(b.hitch(this,function(){J.remove(O.id);l.publish("onApplicationAccept",{})}),b.hitch(this,function(){var M=new D;f.once(M._dialog,"hide",function(){M._dialog.destroyRecursive();M.destroyRecursive()});M.show({title:this.i18n.errorTitle,message:q.substitute(this.i18n.error.unableToAddPrivs,{user:S})});J.remove(O.id);l.publish("onApplicationAccept",{})}))},declineApplication:function(O,S){var da=C.getUser(),J=this._requestsGrid._grid.store;
da&&C.request({url:z.restBaseUrl+"community/groups/"+this.groupId+"/applications/"+S+"/decline"},{usePost:!0}).then(b.hitch(this,function(){J.remove(O.id);l.publish("onApplicationDecline",{})}))},onApplicationApprove:function(){0===this._requestsGrid._grid.store.query().length?this.hide():this.refresh()},onApplicationDecline:function(){0===this._requestsGrid._grid.store.query().length?this.hide():this.refresh()},requestApplications:function(){var O=this._requestsGrid._grid.store;return C.request({url:z.restBaseUrl+
"community/groups/"+this.groupId+"/applications"}).then(b.hitch(this,function(S){S.applications&&(h.forEach(S.applications,function(da,J){da.id=J;O.put(da)}),this.refresh())}))},clearStore:function(){this._requestsGrid||this.createGrid();var O=this._requestsGrid&&this._requestsGrid._grid&&this._requestsGrid._grid.store||void 0;O&&h.forEach(b.clone(O.query()),function(S){O.remove(S.id)})},createGrid:function(){this._requestsGrid=new E({id:"requestsGrid",columns:this.getRequestGridColumns(),noDataMessage:this.i18n.noMembershipRequests,
showLoadingMessage:!1,showHeader:!1,showFooter:!1,selectionMode:"none",rowsPerPage:5,className:"requests-grid",store:new t({idProperty:"id",label:"fullname",data:[]}),sort:[{attribute:"received",descending:!1}]},this._requestsGridContainer);this._requestsGrid.startup();m(".dgrid-status").forEach(function(O){O.tabIndex=-1;a.add(O,"left")})},getRequestGridColumns:function(){return{fullname:{label:" ",sortable:!1,formatter:b.hitch(this,function(O){return O})},username:{label:" ",sortable:!1,formatter:b.hitch(this,
function(O){return O})},received:{label:" ",sortable:!1,formatter:b.hitch(this,function(O){O=new Date(parseFloat(O));return e.format(O,{selector:"date",formatLength:"long"})})},yourResponse:{label:" ",sortable:!1,renderCell:b.hitch(this,function(O){var S=O.username,da=c.create("div",{className:"esriFloatTrailing"}),J=c.create("button",{innerHTML:"\x3cspan class\x3d'text-green'\x3e"+B.inline.check["16"]+"\x3c/span\x3e"+this.i18n.approve,className:"btn-link btn-link-off-black clickable margin-right-1"},
da),M=c.create("button",{innerHTML:"\x3cspan class\x3d'text-red'\x3e"+B.inline["minus-circle"]["16"]+"\x3c/span\x3e"+this.i18n.decline,className:"btn-link btn-link-off-black clickable"},da);this.own(x(J,b.hitch(this,"approveApplication",O,S)),x(M,b.hitch(this,"declineApplication",O,S)));return da})}}},hide:function(){this._dialog.hide()},refresh:function(){if(this._requestsGrid._grid&&this._requestsGrid._grid._started){var O=this._requestsGrid._grid._currentPage||1,S=this._requestsGrid._grid.store?
this._requestsGrid._grid.store.query().length:0;f.once(this._requestsGrid._grid,"dgrid-refresh-complete",function(da){da.grid._currentPage!==O&&0<S&&da.grid.gotoPage(O)});this._requestsGrid._grid.resize();this._requestsGrid._grid.refresh()}}});N.prototype.statics={getInstance:function(){this._instance||(this._instance=new N);return this._instance}};return N})},"arcgisonline/sharing/dijit/dialog/RendererDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Dialog,arcgisonline/sharing/dijit/dialog/SymbolDlg"],
function(k,g,p){k.provide("arcgisonline.sharing.dijit.dialog.RendererDlg");k.require("dijit._Widget");k.require("dijit._Templated");k.require("dijit.Dialog");k.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");k.declare("arcgisonline.sharing.dijit.dialog.RendererDlg",[g._Widget,g._Templated],{util:arcgisonline.sharing.util,folder:arcgisonline.sharing.geow.Folder,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"renderer-dialog" title\x3d"${i18n.rendererDlgTitle}" execute\x3d""\x3e\r\n  \t\r\n    \x3cdiv\x3e\r\n      \x3ctable cellspacing\x3d"10" width\x3d"100%"\x3e\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\x3ctd\x3e\r\n        \x3clabel\x3e${i18n.labelLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"rendererLabel" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" required\x3d"true" style\x3d"width:100%; padding:2px;"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\x3c/tr\x3e\r\n      \x3ctr\x3e\x3ctd\x3e\r\n        \x3clabel\x3e${i18n.valueLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\x3ctd\x3e\r\n        \x3clabel id\x3d"renderer-value"\x3e\x3c/label\x3e\r\n      \x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\x3c/table\x3e\r\n      \x3cdiv\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" dojoAttachPoint\x3d"_rendererSymbolUpdateButton" class\x3d"default esriFloatLeading" dojoAttachEvent\x3d"onClick:_onRendererSymbolUpdateButtonClick"\x3e\r\n          \x3cspan\x3e${i18n.changeSymbolBtn}\x3c/span\x3e\r\n        \x3c/button\x3e\r\n        \x3cbutton dojoAttachEvent\x3d"onClick:_onCancelClick" dojoAttachPoint\x3d"rendererCancelBtn" class\x3d"jevent cancel esriFloatTrailing" type\x3d"cancel" dojotype\x3d"dijit.form.Button"\x3e\r\n          ${i18n.cancel}\r\n        \x3c/button\x3e\r\n        \x3cbutton dojoAttachEvent\x3d"onClick:_onOkClick" dojoAttachPoint\x3d"rendererOkBtn" class\x3d"jevent primary esriFloatTrailing" dojotype\x3d"dijit.form.Button"\x3e\r\n          ${i18n.ok}\r\n        \x3c/button\x3e\r\n\t\t\t\x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both;"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t\t\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,symbol:null,onRendererSymbolChangeHandler:null,onRendererSymbolChangeCancelHandler:null,applyRendererEditsHandler:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.RendererDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=k.clone(k.i18n.getLocalization("arcgisonline","arcgisonline").common);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").rendererPanel);
k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").rendererDlg)},postCreate:function(){this.loadConnections()},show:function(b){this.symbol=esri.symbol.fromJson(b.symbol.toJson());null===b.value?k.byId("renderer-value").innerHTML=this.i18n.other:k.byId("renderer-value").innerHTML=b.value;this.rendererLabel.set("value",b.label);this.applyRendererEditsHandler=k.subscribe("applyRendererEdits",k.hitch(this,"_onApplyEdits"));g.byId("renderer-dialog").show()},loadConnections:function(){k.query(".jevent").connect("onclick",
function(b){b.preventDefault()})},_onCancelClick:function(){k.publish("onRendererItemChange",[null,null]);g.byId("renderer-dialog").hide()},hide:function(){this.onRendererSymbolChangeHandler&&(k.unsubscribe(this.onRendererSymbolChangeHandler),k.unsubscribe(this.onRendererSymbolChangeCancelHandler));this.applyRendererEditsHandler&&k.unsubscribe(this.applyRendererEditsHandler);this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1);g.byId("renderer-dialog").hide()},
_onRendererSymbolUpdateButtonClick:function(b){this.onRendererSymbolChangeHandler&&(k.unsubscribe(this.onRendererSymbolChangeHandler),k.unsubscribe(this.onRendererSymbolChangeCancelHandler));this.onRendererSymbolChangeHandler=k.subscribe("onSymbolChange",k.hitch(this,"_onRendererSymbolChange"));this.onRendererSymbolChangeCancelHandler=k.subscribe("onSymbolChangeCancel",k.hitch(this,function(){this.onRendererSymbolChangeHandler&&(k.unsubscribe(this.onRendererSymbolChangeHandler),k.unsubscribe(this.onRendererSymbolChangeCancelHandler));
this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1)}));this.rendererCancelBtn.set("disabled",!0);this._rendererSymbolUpdateButton.set("disabled",!0);arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.symbol,{applyHandler:k.hitch(this,"_onApplyEdits"),okHandler:k.hitch(this,function(h){this._rendererSymbolUpdateButton.set("disabled",!1);this.symbol=h;k.publish("onRendererItemChange",[h,this.rendererLabel.get("value")]);
k.publish("saveRenderer",[])})})},_onRendererSymbolChange:function(b){this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1);var h=b.toJson();"esriPMS"!=b.type||0!=h.url.length&&"http://"!=h.url||(b=esri.symbol.fromJson(this.markerJson));this.symbol=b},_onOkClick:function(b){b.preventDefault();k.publish("onRendererItemChange",[esri.symbol.fromJson(this.symbol.toJson()),this.rendererLabel.get("value")]);this.hide()},_onApplyEdits:function(b){k.publish("onRendererItemChange",
[b,this.rendererLabel.get("value")]);k.publish("saveRenderer",[])},onKeyDown:function(b){if(window.event)var h=b.keyCode;else b.which&&(h=b.which);13==h&&this._onOkClick(b)}})})},"arcgisonline/sharing/dijit/dialog/SymbolDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/SymbolOptions"],function(k,g,p){k.provide("arcgisonline.sharing.dijit.dialog.SymbolDlg");k.require("dijit.Dialog");k.require("dijit._Widget");k.require("dijit._Templated");
k.require("arcgisonline.sharing.dijit.SymbolOptions");k.declare("arcgisonline.sharing.dijit.dialog.SymbolDlg",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"symbol-dialog" title\x3d"${i18n.symbolDlgTitle}" execute\x3d""\x3e\r\n\t  \x3cdiv id\x3d"symbol-dialog-symboloptions" dojotype\x3d"arcgisonline.sharing.dijit.SymbolOptions" dojoAttachPoint\x3d"symbolOptions"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cbutton dojoAttachPoint\x3d"cancelButton" dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3cbutton id\x3d"symbol-dialog-apply" dojoAttachPoint\x3d"applyButton" dojoAttachEvent\x3d"onClick:onApplyClick" class\x3d"jevent cancel esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.apply}\x3c/button\x3e\r\n  \t  \x3cbutton id\x3d"symbol-dialog-done" dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both;"\x3e\r\n    \x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,applyHandler:null,okHandler:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SymbolDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=k.clone(k.i18n.getLocalization("arcgisonline","arcgisonline").common);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").symbolDlg)},show:function(b,h){this.cancelButton.set("disabled",!1);var f=b.getLayer();if(b.symbol)this.symbolOptions.symbol=
esri.symbol.fromJson(b.symbol.toJson());else{var d=f.renderer.getSymbol(b);this.symbolOptions.symbol=esri.symbol.fromJson(d.toJson())}for(d=0;d<f.types.length;d++)if(f.types[d].id==b.attributes.TYPEID&&f.types[d].templates&&0<f.types[d].templates.length){this.symbolOptions.template=f.types[d].templates[0];break}h?(this.symbolOptions.endSize=h.endSize,this.symbolOptions.showEndSize=0<h.endSize?!0:!1,this.symbolOptions.showNoBgColor=h.showNoBgColor,this.applyHandler=h.applyHandler,this.okHandler=h.okHandler):
(this.symbolOptions.endSize=0,this.symbolOptions.showEndSize=!1,this.symbolOptions.showNoBgColor=!1,this.okHandler=this.applyHandler=null);this.symbolOptions.init(h?h.noPreDefSymbols:null);g.byId("symbol-dialog").show()},showSymbol:function(b,h){this.cancelButton.set("disabled",!1);this.symbolOptions.symbol=esri.symbol.fromJson(b.toJson());this.symbolOptions.symbol.color||(this.symbolOptions.symbol.color=new k.Color([255,255,255,0]));h?(this.symbolOptions.endSize=h.endSize,this.symbolOptions.showEndSize=
0<h.endSize?!0:!1,this.symbolOptions.showNoBgColor=h.showNoBgColor,this.applyHandler=h.applyHandler,this.okHandler=h.okHandler):(this.symbolOptions.endSize=0,this.symbolOptions.showEndSize=!1,this.symbolOptions.showNoBgColor=!1,this.okHandler=this.applyHandler=null);this.symbolOptions.init(h?h.noPreDefSymbols:null);g.byId("symbol-dialog").show()},hide:function(){this.symbolOptions.hide();g.byId("symbol-dialog").hide()},onDoneClick:function(b){"picturemarkersymbol"===this.symbolOptions.symbol.type&&
8>this.symbolOptions.symbol.url.length||setTimeout(k.hitch(this,function(){var h=0;this.symbolOptions.urlChangesNotApplied&&(h=6E3);setTimeout(k.hitch(this,function(){if(this.okHandler){var f=this.symbolOptions.symbol.toJson();"esriPMS"!=this.symbolOptions.symbol.type||0!=f.url.length&&"http://"!=f.url||(this.symbolOptions.symbol=this.getMarkerJson());this.okHandler(esri.symbol.fromJson(this.symbolOptions.symbol.toJson()))}else this.symbolOptions.showEndSize?k.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson()),
this.symbolOptions.endSize]):k.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson())]),setTimeout(k.hitch(this,function(){k.publish("applyRendererEdits",[])}),500);this.hide()}),h)}),100)},onApplyClick:function(b){"picturemarkersymbol"===this.symbolOptions.symbol.type&&8>this.symbolOptions.symbol.url.length||setTimeout(k.hitch(this,function(){var h=0;this.symbolOptions.urlChangesNotApplied&&(h=6E3);setTimeout(k.hitch(this,function(){if(this.applyHandler){var f=this.symbolOptions.symbol.toJson();
"esriPMS"!=this.symbolOptions.symbol.type&&"picturemarkersymbol"!=this.symbolOptions.symbol.type||0!=f.url.length&&"http://"!=f.url||(this.symbolOptions.symbol=this.getMarkerJson());this.applyHandler(esri.symbol.fromJson(this.symbolOptions.symbol.toJson()));this.cancelButton.set("disabled",!0)}else this.symbolOptions.showEndSize?k.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson()),this.symbolOptions.endSize]):k.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson())]),
setTimeout(k.hitch(this,function(){k.publish("applyRendererEdits",[]);this.cancelButton.set("disabled",!0)}),500)}),h)}),100)},onCancelClick:function(b){k.publish("onSymbolChangeCancel",[]);this.hide()}})})},"arcgisonline/sharing/dijit/SymbolOptions":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/ColorPalette,dijit/form/HorizontalSlider,arcgisonline/sharing/dijit/dialog/ImgDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/util"],function(k,
g,p){k.provide("arcgisonline.sharing.dijit.SymbolOptions");k.require("dijit._Widget");k.require("dijit._Templated");k.require("dijit.ColorPalette");k.require("dijit.form.HorizontalSlider");k.require("arcgisonline.sharing.dijit.dialog.ImgDlg");k.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");k.require("arcgisonline.sharing.util");k.declare("arcgisonline.sharing.dijit.SymbolOptions",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv\x3e\r\n  \x3ctable class\x3d"symbolDialogTable"\x3e\r\n   \x3ctbody\x3e\r\n    \x3ctr\x3e \r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv\x3e\x3clabel\x3e${i18n.previewLabel}\x3c/label\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd colspan\x3d"2" valign\x3d"middle" align\x3d"left"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolImage" style\x3d"height:100%; vertical-align:middle;"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e   \r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e \r\n      \x3ctd colspan\x3d"3" valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolSmallTemplatePicker" style\x3d"display:none;"\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolSimpleMarkerTemplatePickerDiv" class\x3d"symbolTemplatePicker" style\x3d"height:50px; width:350px;"\x3e\r\n            \x3cdiv id\x3d"${id}_symbolSimpleMarkerTemplatePicker"\x3e\x3c/div\x3e  \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolFullTemplatePicker" style\x3d"display:none;"\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolClassesDiv" style\x3d"width:355px;line-height:normal;"\x3e\r\n            \x3cselect dojoAttachPoint\x3d"symbolColorClasses" style\x3d"width:355px;margin:0;" dojoType\x3d"arcgisonline.sharing.dijit.ComboBox"\x3e\r\n            \x3c/select\x3e       \r\n          \x3c/div\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolClassesTemplatePickerDiv" class\x3d"symbolTemplatePicker" style\x3d"height:130px; width:350px;"\x3e\r\n            \x3cdiv id\x3d"${id}_symbolClassesTemplatePicker" \x3e\x3c/div\x3e  \r\n          \x3c/div\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolAddImageDiv" class\x3d"esriItemLinks" style\x3d"line-height:20px;"\x3e\r\n            \x3cA dojoAttachPoint\x3d"symbolAddImage" href\x3d"JavaScript:void(0);"\x3e${i18n.addImage}\x3c/A\x3e  \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e   \r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolSizeRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel dojoAttachPoint\x3d"symbolSizeLabel"\x3e${i18n.symbolSizeLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolSize" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"120" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolSizeInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolEndSizeRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel\x3e${i18n.symbolEndSizeLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolEndSize" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"120" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolEndSizeInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolBackgroundColorRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.colorLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\x3cdiv dojoAttachPoint\x3d"symbolBackgroundColor" class\x3d"symbolColorBox"\x3e\x3c/div\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolLinePatternRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.patternLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\r\n        \x3cdiv\x3e\r\n          \x3cselect dojoAttachPoint\x3d"symbolLinePatternSelect" id\x3d"symbolLinePatternSelect" dojoType\x3d"dijit.form.Select" class\x3d"symbolLinePatternSelect"\x3e\r\n          \x3c/select\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolTransparencyRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.transparencyLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd width\x3d"125" valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolTransparency" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" style\x3d"line-height:normal;margin-top:7px;" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"0" maximum\x3d"1" value\x3d"0" discretevalues\x3d"0.01" \x3e\r\n          \x3cdiv dojoType\x3d"dijit.form.HorizontalRule" container\x3d"bottomDecoration" count\x3d"2" style\x3d"height:5px;"\x3e\x3c/div\x3e\r\n          \x3col dojoType\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"font-size:0.8em;"\x3e\r\n            \x3cli\x3e0\x3c/li\x3e\x3cli\x3e100%\x3c/li\x3e\r\n          \x3c/ol\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolTransparencyInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e%\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolOutlineColorRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.outlineColorLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\x3cdiv dojoAttachPoint\x3d"symbolOutlineColor" class\x3d"symbolColorBox"\x3e\x3c/div\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolWidthRow"\x3e \r\n      \x3ctd\x3e\x3clabel dojoAttachPoint\x3d"symbolWidthLabel" \x3e${i18n.outlineWidthLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolWidth" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"0" maximum\x3d"18" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolWidthInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolEndWidthRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel\x3e${i18n.symbolEndWidthLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolEndWidth" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"18" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolEndWidthInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n   \x3c/tbody\x3e\r\n  \x3c/table\x3e                \r\n\r\n  \x3cimg id\x3d"${id}_testImage" style\x3d"position:absolute;top:0;left:-3000px"/\x3e\r\n\r\n  \x3cdiv dojoAttachPoint\x3d"symbolColorTooltip" dojotype\x3d"dijit.TooltipDialog" title\x3d"" style\x3d"display:none; width:265px;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing"\x3e\x3cA class\x3d"symbolColorPaletteClose" dojoAttachPoint\x3d"symbolColorTooltipClose" href\x3d"JavaScript:void(0);" title\x3d"${i18n.close}"\x3e\x3c/A\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"symbolColorPalette" style\x3d"margin-top: 7px;" dojotype\x3d"dijit.ColorPalette" palette\x3d"7x10" dojoAttachEvent\x3d"onChange:onColorSelection"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \r\n\x3c/div\x3e\r\n',
i18n:null,symbol:null,template:null,colorPicker:"",savedSimpleMarkerSymbol:null,savedPictureMarkerSymbol:null,eventHandlers:null,testImageHandler:null,symbolListItems:null,symbolClassesTemplatePicker:null,simpleMarkerTemplatePicker:null,templatePickerOnSelectionChangeHandler:null,simpleMarkerTemplatePickerOnSelectionChangeHandler:null,templatePickerSymbolClass:null,symbolClassStore:null,urlChangesNotApplied:!1,cachedImages:[],onImageChangeHandler:null,showEndSize:!1,showNoBgColor:!1,endSize:0,simpleMarkerSymbols:[{name:"Circle",
type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",
color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],markerJson:{type:"esriPMS",url:"/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII\x3d",
contentType:"image/png",width:15,height:15},postMixInProperties:function(){this.inherited(arguments);this.i18n=k.clone(k.i18n.getLocalization("arcgisonline","arcgisonline").common);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").imgDlg);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").symbolDlg)},postCreate:function(){this.symbolLinePatternSelect._getMenuItemForOption=
function(b){if(b.value||b.label){var h=k.hitch(this,"_setValueAttr",b);b=new g.MenuItem({option:b,label:b.label||this.emptyLabel,onClick:h,ownerDocument:this.ownerDocument,dir:this.dir,disabled:b.disabled||!1,iconClass:b.iconClass});b.focusNode.setAttribute("role","option");return b}return new g.MenuSeparator({ownerDocument:this.ownerDocument})};this.symbolLinePatternSelect.addOption({value:"solid",iconClass:"symbolLinePatternSolid"});this.symbolLinePatternSelect.addOption({value:"dot",iconClass:"symbolLinePatternDot"});
this.symbolLinePatternSelect.addOption({value:"dash",iconClass:"symbolLinePatternDash"});this.symbolLinePatternSelect.addOption({value:"dashdot",iconClass:"symbolLinePatternDashDot"});this.symbolLinePatternSelect.addOption({value:"dashdotdot",iconClass:"symbolLinePatternDashDotDot"});this._symbolCloseIcon&&k.attr(this._symbolCloseIcon,"src",arcgisonline.sharing.util.relativeToExplicitUrl("images/close.gif"));k.connect(this.symbolLinePatternSelect,"onChange",k.hitch(this,"onPatternChange"));this.loadConnections()},
init:function(b){this.savedPictureMarkerSymbol=this.savedSimpleMarkerSymbol=null;if(this.symbol){if(!b||"picturemarkersymbol"!==this.symbol.type&&"simplemarkersymbol"!==this.symbol.type)if(b)k.style(this.symbolFullTemplatePicker,"display","none"),k.style(this.symbolSmallTemplatePicker,"display","none");else if(k.style(this.symbolSmallTemplatePicker,"display","none"),k.style(this.symbolFullTemplatePicker,"display","block"),this.symbolListItems)if(this.templatePickerSymbolClass!==this.symbol.type&&
("simplemarkersymbol"!==this.templatePickerSymbolClass&&"picturemarkersymbol"!==this.templatePickerSymbolClass||"picturemarkersymbol"!==this.symbol.type&&"simplemarkersymbol"!==this.symbol.type)){if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)for(b=0;b<this.symbolListItems.length;b++){var h=this.symbolListItems[b];if(-1<h.typeKeywordsString.indexOf("marker")&&-1<h.typeKeywordsString.indexOf("default")){this.symbolColorClasses.set("value",h.title);break}}this.getSymbolListData(!0)}else this.getSymbolListData();
else this.getSymbolListGroup();else k.style(this.symbolFullTemplatePicker,"display","none"),k.style(this.symbolSmallTemplatePicker,"display","block"),setTimeout(k.hitch(this,function(){this.createSimpleMarkerTemplatePicker()}),0);this.updateUI();this.enableEvents();this.symbolClassesTemplatePicker&&this.symbolClassesTemplatePicker.clearSelection();this.simpleMarkerTemplatePicker&&this.simpleMarkerTemplatePicker.clearSelection()}},hide:function(){this.disableEvents();g.popup.close(this.symbolColorTooltip);
this.destroySymbolClassesTemplatePicker();this.destroySimpleMarkerTemplatePicker()},loadConnections:function(){k.query(".jevent").connect("onclick",function(b){b.preventDefault()});k.connect(this.symbolColorTooltipClose,"onclick",k.hitch(this,function(b){b.preventDefault();g.popup.close(this.symbolColorTooltip)}));k.connect(this.symbolBackgroundColor,"onclick",this,"onBackgroundColorClick");k.connect(this.symbolOutlineColor,"onclick",this,"onOutlineColorClick");k.connect(this.symbolAddImage,"onclick",
this,"onAddImage")},updateUI:function(){this.symbolImage.innerHTML="";if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)k.style(this.symbolClassesDiv,"display","block"),k.style(this.symbolClassesTemplatePickerDiv,"display","block"),k.style(this.symbolSizeRow,"display",""),this.symbolSizeLabel.innerHTML=this.i18n.symbolSizeLabel,k.style(this.symbolEndSizeRow,"display","none"),k.style(this.symbolEndWidthRow,"display","none"),k.style(this.symbolAddImageDiv,"display",
""),"simplemarkersymbol"===this.symbol.type?(k.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),k.style(this.symbolLinePatternRow,"display","none"),k.style(this.symbolOutlineColorRow,"display",""),k.style(this.symbolWidthRow,"display",""),this.symbolWidthLabel.innerHTML=this.i18n.outlineWidthLabel,k.style(this.symbolTransparencyRow,"display",""),this.symbolSize.set("value",this.symbol.size,!1),this.symbolSizeInput.set("value",Math.round(this.symbol.size),!1),this.showEndSize&&
(this.symbolSizeLabel.innerHTML=this.i18n.symbolStartSizeLabel,this.symbolEndSize.set("value",this.endSize,!1),this.symbolEndSizeInput.set("value",Math.round(this.endSize),!1),k.style(this.symbolEndSizeRow,"display","")),k.style(this.symbolBackgroundColor,"background",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),k.style(this.symbolOutlineColor,"background",
this.symbol.outline.color.toHex()),this.symbolWidth.set("value",this.symbol.outline.width,!1),this.symbolWidthInput.set("value",Math.round(this.symbol.outline.width),!1)):"picturemarkersymbol"===this.symbol.type&&(k.style(this.symbolBackgroundColorRow,"display","none"),k.style(this.symbolLinePatternRow,"display","none"),k.style(this.symbolOutlineColorRow,"display","none"),k.style(this.symbolWidthRow,"display","none"),k.style(this.symbolTransparencyRow,"display","none"),this.symbolSize.set("value",
this.symbol.width,!1),this.symbolSizeInput.set("value",Math.round(this.symbol.width),!1),this.showEndSize&&(this.symbolSizeLabel.innerHTML=this.i18n.symbolStartSizeLabel,this.symbolEndSize.set("value",this.endSize,!1),this.symbolEndSizeInput.set("value",Math.round(this.endSize),!1),k.style(this.symbolEndSizeRow,"display","")));else if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)k.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),k.style(this.symbolAddImageDiv,
"display","none"),k.style(this.symbolClassesDiv,"display","none"),k.style(this.symbolClassesTemplatePickerDiv,"display","block"),k.style(this.symbolSizeRow,"display","none"),k.style(this.symbolTransparencyRow,"display",""),k.style(this.symbolEndSizeRow,"display","none"),this.setLinePattern(),k.style(this.symbolLinePatternRow,"display",""),this.symbolTransparency.set("disabled",!1),this.symbolTransparencyInput.set("disabled",!1),k.style(this.symbolOutlineColorRow,"display","none"),k.style(this.symbolWidthRow,
"display",""),this.symbolWidthLabel.innerHTML=this.i18n.symbolWidthLabel,k.style(this.symbolEndWidthRow,"display","none"),k.style(this.symbolBackgroundColor,"background",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),this.symbolWidth.set("value",this.symbol.width,!1),this.symbolWidthInput.set("value",Math.round(this.symbol.width),!1),this.showEndSize&&
(this.symbolWidthLabel.innerHTML=this.i18n.symbolStartWidthLabel,this.symbolEndWidth.set("value",this.endSize,!1),this.symbolEndWidthInput.set("value",Math.round(this.endSize),!1),k.style(this.symbolEndWidthRow,"display","")),this.onPatternChange();else if("simplefillsymbol"===this.symbol.type||"picturefillsymbol"===this.symbol.type)k.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),k.style(this.symbolAddImageDiv,"display","none"),k.style(this.symbolClassesDiv,"display",
"none"),k.style(this.symbolClassesTemplatePickerDiv,"display","block"),k.style(this.symbolSizeRow,"display","none"),k.style(this.symbolTransparencyRow,"display",""),k.style(this.symbolEndSizeRow,"display","none"),k.style(this.symbolEndWidthRow,"display","none"),k.style(this.symbolLinePatternRow,"display","none"),k.style(this.symbolOutlineColorRow,"display",""),k.style(this.symbolWidthRow,"display",""),k.style(this.symbolEndWidthRow,"display","none"),this.symbolWidthLabel.innerHTML=this.i18n.outlineWidthLabel,
this.symbolTransparency.set("disabled",!1),this.symbolTransparencyInput.set("disabled",!1),k.style(this.symbolBackgroundColor,"backgroundColor",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),k.style(this.symbolOutlineColor,"backgroundColor",this.symbol.outline.color.toHex()),this.symbolWidth.set("value",this.symbol.outline.width,!1),this.symbolWidthInput.set("value",
Math.round(this.symbol.outline.width),!1);this._drawSymbol()},enableEvents:function(){this.eventHandlers=[];this.eventHandlers.push(k.connect(this.symbolSize,"onChange",this,"onSizeChange"));this.eventHandlers.push(k.connect(this.symbolSize._movable,"onMoveStop",this,"onSizeChange"));this.eventHandlers.push(k.connect(this.symbolSizeInput,"onChange",this,"onSizeChangeByInput"));this.eventHandlers.push(k.connect(this.symbolEndSize,"onChange",this,"onEndSizeChange"));this.eventHandlers.push(k.connect(this.symbolEndSize._movable,
"onMoveStop",this,"onEndSizeChange"));this.eventHandlers.push(k.connect(this.symbolEndSizeInput,"onChange",this,"onEndSizeChangeByInput"));this.eventHandlers.push(k.connect(this.symbolTransparency,"onChange",this,"onTransparencyChange"));this.eventHandlers.push(k.connect(this.symbolTransparency._movable,"onMoveStop",this,"onTransparencyChange"));this.eventHandlers.push(k.connect(this.symbolTransparencyInput,"onChange",this,"onTransparencyChangeByInput"));this.eventHandlers.push(k.connect(this.symbolWidth,
"onChange",this,"onWidthChange"));this.eventHandlers.push(k.connect(this.symbolWidth._movable,"onMoveStop",this,"onWidthChange"));this.eventHandlers.push(k.connect(this.symbolWidthInput,"onChange",this,"onWidthChangeByInput"));this.eventHandlers.push(k.connect(this.symbolEndWidth,"onChange",this,"onEndWidthChange"));this.eventHandlers.push(k.connect(this.symbolEndWidth._movable,"onMoveStop",this,"onEndWidthChange"));this.eventHandlers.push(k.connect(this.symbolEndWidthInput,"onChange",this,"onEndWidthChangeByInput"));
this.eventHandlers.push(k.connect(this.symbolLinePatternSelect,"onChange",k.hitch(this,"onSymbolLinePatternChange")));this.eventHandlers.push(k.connect(this.symbolColorClasses,"onChange",this,"onSymbolListChange"))},disableEvents:function(){this.eventHandlers&&(k.forEach(this.eventHandlers,function(b){k.disconnect(b)}),this.eventHandlers=null)},onPatternChange:function(){k.removeClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternSolid symbolLinePatternDot symbolLinePatternDash symbolLinePatternDashDot symbolLinePatternDashDotDot");
"solid"==this.symbolLinePatternSelect.get("value")?k.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternSolid"):"dot"==this.symbolLinePatternSelect.get("value")?k.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDot"):"dash"==this.symbolLinePatternSelect.get("value")?k.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDash"):"dashdot"==this.symbolLinePatternSelect.get("value")?k.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDashDot"):
"dashdotdot"==this.symbolLinePatternSelect.get("value")&&k.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDashDotDot")},onBackgroundColorClick:function(b){this.colorPicker="background";g.popup.open({popup:this.symbolColorTooltip,around:b.target})},onOutlineColorClick:function(b){this.colorPicker="outline";g.popup.open({popup:this.symbolColorTooltip,around:b.target})},onColorSelection:function(b){g.popup.close(this.symbolColorTooltip);b=(new k.Color(b)).toRgba();"background"===
this.colorPicker||"simplelinesymbol"===this.symbol.type?(b[3]=this.symbol.color.toRgba()[3],this.symbol.color.setColor(b)):this.symbol.outline.color.setColor(b);this.updateUI()},onTransparencyChange:function(b){b=this.symbol.color.toRgba();var h=this.symbolTransparency.getValue();h=k.number.round(h,2);b[3]=1-h;this.symbol.color.setColor(b);this.updateUI()},onTransparencyChangeByInput:function(b){isNaN(b)?this.symbolTransparencyInput.set("value",Math.round(100*this.symbolTransparency.getValue()),!1):
(b=Math.round(b),0>b||100<b?this.symbolTransparencyInput.set("value",Math.round(100*this.symbolTransparency.getValue()),!1):this.symbolTransparency.set("value",b/100,!1))},onWidthChange:function(b){if(!isNaN(b)){var h=this.symbolWidth.getValue();h=Math.round(h);"simplefillsymbol"===this.symbol.type||"simplemarkersymbol"===this.symbol.type?this.symbol.outline.width!=b&&(this.symbol.outline.setWidth(h),this.symbol.outline.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID),b=this.symbol.outline.color.toRgba(),
b[3]=1,this.symbol.outline.color.setColor(b),this.updateUI()):this.symbol.width!=b&&(this.symbol.setWidth(h),this.updateUI())}},onWidthChangeByInput:function(b){isNaN(b)?this.symbolWidthInput.set("value",this.symbolWidth.getValue(),!1):(b=Math.round(b),0>b||18<b?this.symbolWidthInput.set("value",this.symbolWidth.getValue(),!1):this.symbolWidth.set("value",b,!0))},onEndWidthChange:function(b){isNaN(b)||(b=this.symbolEndWidth.getValue(),b=Math.round(b),b<this.symbolWidthInput.getValue()?this.symbolEndWidth.set("value",
this.symbolEndWidthInput.getValue(),!1):(this.symbolEndWidthInput.set("value",b,!1),this.endSize=b))},onEndWidthChangeByInput:function(b){isNaN(b)?this.symbolEndWidthInput.set("value",Math.round(this.symbolEndWidth.getValue()),!1):(b=Math.round(b),1>b||120<b||b<this.symbolWidth.getValue()?this.symbolEndWidthInput.set("value",Math.round(this.symbolEndWidth.getValue()),!1):(this.symbolEndWidth.set("value",b,!1),this.endSize=b))},onSizeChange:function(b){if(!isNaN(b)){b=this.symbol.width;var h=this.symbolSize.getValue();
h=Math.round(h);if(b!=h)if(this.showEndSize&&h>this.symbolEndSizeInput.getValue())this.symbolSize.set("value",this.symbolSizeInput.getValue(),!1);else{if("picturemarkersymbol"===this.symbol.type){this.symbol.setHeight(this.symbol.height/this.symbol.width*h);this.symbol.setWidth(h);if(!this.symbol.url||"http://"===this.symbol.url||-1==this.symbol.url.indexOf("http://")&&-1==this.symbol.url.indexOf("data:"))return;if(this.symbol.xoffset||this.symbol.yoffset)h=this.symbol.width,b=h/b,this.symbol.setOffset(Math.round(this.symbol.xoffset*
b),Math.round(this.symbol.yoffset*b))}else this.symbol.setSize(h);this.updateUI()}}},onSizeChangeByInput:function(b){isNaN(b)?this.symbolSizeInput.set("value",Math.round(this.symbolSize.getValue()),!1):(b=Math.round(b),1>b||120<b||this.showEndSize&&b>this.symbolEndSize.getValue()?this.symbolSizeInput.set("value",Math.round(this.symbolSize.getValue()),!1):this.symbolSize.set("value",b,!0))},onEndSizeChange:function(b){isNaN(b)||(b=this.symbolEndSize.getValue(),b=Math.round(b),b<this.symbolSizeInput.getValue()?
this.symbolEndSize.set("value",this.symbolEndSizeInput.getValue(),!1):(this.symbolEndSizeInput.set("value",b,!1),this.endSize=b))},onEndSizeChangeByInput:function(b){isNaN(b)?this.symbolEndSizeInput.set("value",Math.round(this.symbolEndSize.getValue()),!1):(b=Math.round(b),1>b||120<b||b<this.symbolSize.getValue()?this.symbolEndSizeInput.set("value",Math.round(this.symbolEndSize.getValue()),!1):(this.symbolEndSize.set("value",b,!1),this.endSize=b))},onUrlChange:function(b){if(b&&!(10>b.length)&&0===
b.indexOf("http")){this.urlChangesNotApplied=!0;for(var h=function(c){clearTimeout(a);a=null;var n=k.style(k.byId(this.id+"_testImage"),"width"),m=k.style(k.byId(this.id+"_testImage"),"height");c.w&&c.h&&(n=c.w,m=c.h);1==n&&1==m?(this.urlChangesNotApplied=!1,this.updateUI(),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl})):(0===n&&(n=40),0===m&&(m=n),c.w&&c.h||this.cachedImages.push({url:b,w:n,h:m}),
this.symbol=new esri.symbol.PictureMarkerSymbol,this.symbol.setWidth(Math.min(120,n)),this.symbolSize.set("value",this.symbol.width,!1),this.symbol.setHeight(m/n*this.symbol.width),this.symbol.setUrl(b),this.updateUI(),this.urlChangesNotApplied=!1)},f=0;f<this.cachedImages.length;f++){var d=this.cachedImages[f];if(d.url==b){k.hitch(this,h)(d);return}}this.testImageHandler&&k.disconnect(this.testImageHandler);this.testImageHandler=k.connect(k.byId(this.id+"_testImage"),"onload",this,h,{});var a=setTimeout(k.hitch(this,
function(){clearTimeout(a);a=null;this.urlChangesNotApplied=!1;arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl})}),5E3);k.byId(this.id+"_testImage").src=b}},onAddImage:function(b){this.onImageChangeHandler&&k.unsubscribe(this.onImageChangeHandler);this.onImageChangeHandler=k.subscribe("onUrlChange",k.hitch(this,"onUrlChange"));arcgisonline.sharing.dijit.dialog.ImgDlg.prototype.statics.getInstance().show()},
onSymbolLinePatternChange:function(){if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type){switch(this.symbolLinePatternSelect.getValue()){case "dot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DOT);break;case "dash":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASH);break;case "dashdot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT);break;case "dashdotdot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT);
break;default:this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID)}this.updateUI()}},getSymbolListGroup:function(){arcgisonline.sharing.geow.Community.searchGroups(esriGeowConfig.symbolSetsGroupQuery,k.hitch(this,function(b,h){b&&b.results&&0<b.results.length&&this.getSymbolListItems(b.results[0].id)}),k.hitch(this,function(b,h){}))},getSymbolListItems:function(b){b=esriGeowConfig.restBaseUrl+"search?num\x3d20\x26q\x3dgroup:"+b+' AND type:"Symbol Set"';b="vml"===p.gfx.renderer?b+' AND -typekeywords:"by value"':
b+' AND ((typekeywords:"by value" AND typekeywords:"marker") OR typekeywords:"fill" OR typekeywords:"line")';arcgisonline.sharing.util.getJson(b,k.hitch(this,function(h,f){h.results&&0<h.results.length&&(this.symbolListItems=h.results,this.symbolListItems.sort(function(d,a){return d.title==a.title?0:d.title<a.title?-1:1}),k.forEach(this.symbolListItems,function(d,a){d.typeKeywordsString=d.typeKeywords.toString();-1<d.typeKeywordsString.indexOf("default")&&-1<d.typeKeywordsString.indexOf("marker")&&
(a=this.symbolListItems.splice(a,1),0<a.length&&(this.symbolListItems.splice(0,0,a[0]),this.symbolColorClasses.set("value",d.title)))},this),this.symbolClassStore=new k.data.ItemFileWriteStore({data:{identifier:"id",items:[]}}),k.forEach(this.symbolListItems,function(d){-1<d.typeKeywordsString.indexOf("marker")&&(this.symbolClassStore.newItem({name:d.title,id:d.id}),this.symbolColorClasses.set("store",this.symbolClassStore))},this),this.getSymbolListData(!0))}),k.hitch(this,function(h,f){}))},getSymbolListData:function(b){this.destroySymbolClassesTemplatePicker();
k.forEach(this.symbolListItems,function(h){if(("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)&&-1<h.typeKeywordsString.indexOf("marker")||("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)&&-1<h.typeKeywordsString.indexOf("line")||("simplefillsymbol"===this.symbol.type||"picturefillsymbol"===this.symbol.type)&&-1<h.typeKeywordsString.indexOf("fill"))h.data?"simplemarkersymbol"!==this.symbol.type&&"picturemarkersymbol"!==this.symbol.type?
this.processSymbolListData(h):this.symbolColorClasses.get("value")==h.title&&this.processSymbolListData(h):arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"/content/items/"+h.id+"/data",k.hitch(this,function(f,d,a){d&&0<d.length&&(f.data=d,"simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type?(b&&-1<f.typeKeywordsString.indexOf("default")||!b)&&this.processSymbolListData(f):this.processSymbolListData(f))},h),k.hitch(this,function(f,d){}))},this)},processSymbolListData:function(b){setTimeout(k.hitch(this,
function(){this.createSymbolListTemplatePicker(b.data)}),0)},createSymbolListTemplatePicker:function(b){b=k.map(b,function(h){var f={};f.symbol=esri.symbol.fromJson(h);f.description=h.name;return f},this);this.symbolClassesTemplatePicker||(this.symbolClassesTemplatePicker=new esri.dijit.editing.TemplatePicker({items:b,rows:"auto",columns:"auto",_assumedCellWidth:40,grouping:!1,style:"position: relative; width: 100%; height: 120px;"},this.id+"_symbolClassesTemplatePicker"),this.symbolClassesTemplatePicker.startup(),
this.templatePickerSymbolClass=this.symbol.type,this.templatePickerOnSelectionChangeHandler=k.connect(this.symbolClassesTemplatePicker,"onSelectionChange",this,function(){var h=this.symbolClassesTemplatePicker.getSelected();if(h){var f=this.symbol;this.symbol=esri.symbol.fromJson(h.item.symbol.toJson());if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)"simplemarkersymbol"===this.symbol.type?this.symbol.size="simplemarkersymbol"===f.type?f.size:f.width:"simplemarkersymbol"===
f.type?(this.symbol.xoffset&&(this.symbol.xoffset=f.size/(this.symbol.width/this.symbol.xoffset)),this.symbol.yoffset&&(this.symbol.yoffset=this.symbol.height/this.symbol.width*f.size/(this.symbol.height/this.symbol.yoffset)),this.symbol.height=this.symbol.height/this.symbol.width*f.size,this.symbol.width=f.size):(this.symbol.xoffset&&(this.symbol.xoffset=f.width/(this.symbol.width/this.symbol.xoffset)),this.symbol.yoffset&&(this.symbol.yoffset=this.symbol.height/this.symbol.width*f.width/(this.symbol.height/
this.symbol.yoffset)),this.symbol.height=this.symbol.height/this.symbol.width*f.width,this.symbol.width=f.width);(this.symbol.width||this.symbol.size)>=this.endSize&&(this.endSize=(this.symbol.width?this.symbol.width:this.symbol.size)+("simplelinesymbol"==this.symbol.type?10:20),this.symbolEndSize.set("value",this.endSize,!1));this.updateUI()}}))},destroySymbolClassesTemplatePicker:function(){this.symbolClassesTemplatePicker&&(k.disconnect(this.templatePickerOnSelectionChangeHandler),this.symbolClassesTemplatePicker.destroy(),
this.symbolClassesTemplatePicker=null,k.byId("symbolClassesTemplatePicker")||k.create("div",{id:this.id+"_symbolClassesTemplatePicker"},this.symbolClassesTemplatePickerDiv))},onSymbolListChange:function(b){if(b){this.destroySymbolClassesTemplatePicker();for(var h=null,f=0;f<this.symbolListItems.length;f++)this.symbolListItems[f].title==b&&(h=this.symbolListItems[f]);h&&h.data&&setTimeout(k.hitch(this,function(){this.createSymbolListTemplatePicker(h.data)}),0)}},createSimpleMarkerTemplatePicker:function(){var b=
k.map(this.simpleMarkerSymbols,function(h){var f={};f.symbol=esri.symbol.fromJson(h);f.description=h.name;return f},this);this.simpleMarkerTemplatePicker||(this.simpleMarkerTemplatePicker=new esri.dijit.editing.TemplatePicker({items:b,rows:"auto",columns:"auto",_assumedCellWidth:40,grouping:!1,style:"position: relative; width: 100%; height: 45px;"},this.id+"_symbolSimpleMarkerTemplatePicker"),this.simpleMarkerTemplatePicker.startup(),this.simpleMarkerTemplatePickerOnSelectionChangeHandler=k.connect(this.simpleMarkerTemplatePicker,
"onSelectionChange",this,function(){var h=this.simpleMarkerTemplatePicker.getSelected();h&&(this.symbol=esri.symbol.fromJson(h.item.symbol.toJson()),this.updateUI())}))},destroySimpleMarkerTemplatePicker:function(){this.simpleMarkerTemplatePicker&&(k.disconnect(this.simpleMarkerTemplatePickerOnSelectionChangeHandler),this.simpleMarkerTemplatePicker.destroy(),this.simpleMarkerTemplatePicker=null,k.byId(this.id+"_symbolSimpleMarkerTemplatePicker")||k.create("div",{id:this.id+"_symbolSimpleMarkerTemplatePicker"},
this.symbolSimpleMarkerTemplatePickerDiv))},getSymbolUrl:function(){var b=this.symbol.url;0!==b.indexOf("http://")&&this.symbol.imageData&&0<this.symbol.imageData.length&&(b=this.symbol.imageData);return b},setLinePattern:function(){switch(this.symbol.style){case esri.symbol.SimpleLineSymbol.STYLE_DOT:this.symbolLinePatternSelect.set("value","dot",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASH:this.symbolLinePatternSelect.set("value","dash",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASHDOT:this.symbolLinePatternSelect.set("value",
"dashdot",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT:this.symbolLinePatternSelect.set("value","dashdotdot",!1);break;default:this.symbolLinePatternSelect.set("value","solid",!1)}},getMarkerJson:function(){var b=this.markerJson;b.url=arcgisonline.sharing.util.getRedSphereUrl();return b},_drawSymbol:function(){var b=this.symbolImage,h=this.symbol,f=this.template,d=80,a=30;if("simplemarkersymbol"===h.type)a=d=Math.min(h.size+12,125);else if("picturemarkersymbol"===h.type){if(!this.symbol.url||
"http://"===h.url||-1==h.url.indexOf("http://")&&-1==h.url.indexOf("https://")&&-1==h.url.indexOf("data:"))return;a=d=Math.min(Math.max(h.width,h.height),125)}else if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)d=190,a=20;b=p.gfx.createSurface(b,d,a);if("vml"===p.gfx.renderer){var c=b.getEventSource();k.style(c,"position","relative");k.style(c.parentNode,"position","relative")}h=this._getDrawingToolShape(h,f)||esri.symbol.getShapeDescriptors(h);try{var n=b.createShape(h.defaultShape).setFill(h.fill).setStroke(h.stroke)}catch(m){b.clear();
b.destroy();return}h=b.getDimensions();h={dx:h.width/2,dy:h.height/2};c=n.getBoundingBox();f=c.width;c=c.height;if(f>d||c>a)d=((d<a?d:a)-5)/(f>c?f:c),k.mixin(h,{xx:d,yy:d});n.applyTransform(h);return b},_getDrawingToolShape:function(b,h){if("simplelinesymbol"==b.type||"cartographiclinesymbol"==b.type)return h={type:"path",path:"M -90,0 L 90,0 E"},{defaultShape:h,fill:null,stroke:b.getStroke()};switch(h?h.drawingTool||null:null){case "esriFeatureEditToolArrow":h={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};
break;case "esriFeatureEditToolTriangle":h={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":h={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":h={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":h={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:h,fill:b.getFill(),stroke:b.getStroke()}},_repaintItems:function(){k.forEach(this._surfaceItems,
function(b){this._repaint(b)},this)},_repaint:function(b){b.getStroke&&b.setStroke&&b.setStroke(b.getStroke());b.getFill&&b.setFill&&b.setFill(b.getFill());b.children&&k.isArray(b.children)&&k.forEach(b.children,this._repaint,this)}})})},"arcgisonline/sharing/dijit/dialog/ImgDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(k,g,p){k.provide("arcgisonline.sharing.dijit.dialog.ImgDlg");k.require("dijit.Dialog");
k.require("dijit._Widget");k.require("dijit._Templated");k.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");k.declare("arcgisonline.sharing.dijit.dialog.ImgDlg",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"image-dialog" title\x3d"${i18n.imgDlgTitle}" execute\x3d""\x3e\r\n    \x3cdiv\x3e\r\n      \x3cdiv style\x3d"line-height:17px;padding-top:10px;padding-right:10px;"\x3e\x3cspan\x3e${i18n.specifyImage}\x3c/span\x3e\x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3clabel style\x3d"line-height:12px;"\x3e${i18n.urlLabel}\x3c/label\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"urlInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" value\x3d"http://" style\x3d"width:330px;" dir\x3d"ltr"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv style\x3d"line-height:17px;padding-top:10px;padding-right:10px;"\x3e\x3cspan\x3e${i18n.imgDetailMessage}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t  \x3cbr /\x3e\x26nbsp;  \r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n\t  \x3cbr /\x3e\x26nbsp; \r\n\t\t\x3cbr/\x3e \r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.ImgDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=k.i18n.getLocalization("arcgisonline","arcgisonline").common;k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").imgDlg)},postCreate:function(){this.loadConnections()},
show:function(b){g.byId("image-dialog").show()},hide:function(){this.urlInput.setValue("http://");g.byId("image-dialog").hide()},loadConnections:function(){k.query(".jevent").connect("onclick",function(b){b.preventDefault()})},onDoneClick:function(b){b=this.urlInput.getValue();10>b.length?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl}):(0!==b.indexOf("http")&&(b="http://"+b),k.publish("onUrlChange",
[b]),this.hide())},onCancelClick:function(b){k.publish("onUrlChange",[]);this.hide()}})})},"arcgisonline/sharing/dijit/dialog/SetIdentityProviderDlg":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-attr dojo/number dojo/promise/all dojo/sniff dojo/string dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/a11yclick dijit/Dialog dijit/form/Button dijit/form/CheckBox dijit/form/SimpleTextarea dijit/form/TextBox esri/lang ../../../pages/pageUtil ../../../pages/utils/arrays ../../../pages/utils/dom ../../../pages/utils/tooltips ../../util ../_LevelAwareMixin ./GeneralDlg ../../geow/Roles ../../geow/Licenses dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/SetIdentityProviderDlg.html".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S){var da=g([m,q,l,D.default],{declaredClass:"arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg",templateString:S,widgetsInTemplate:!0,basePath:k.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriAGOSetIdentityProviderDlg orgDlg",SIGN_UP_MODE_AUTOMATIC:"Automatic",SIGN_UP_MODE_INVITE:"Invitation",BINDING_TYPE_REDIRECT:"HTTP_REDIRECT",BINDING_TYPE_POST:"HTTP_POST",orgAdminRole:"org_admin",orgPublisherRole:"org_publisher",
orgUserRole:"org_user",_currentIDP:null,_isEditing:!1,_roles:[],_tooltips:[],postMixInProperties:function(){this.inherited(arguments);this.i18n=p.mixin(O.common,O.myOrganization);p.mixin(this.i18n,O.setIdentityProviderDlg);p.mixin(this.i18n,{adminRoleName:O.organizationInvite.userRoles.admin})},postCreate:function(){this.inherited(arguments);this._loadConnections();this._setupTooltips();this._licensesAPI=new N;this._rolesAPI=new H},show:function(J,M){this._isFederation=v.isDefined(J)&&J.isFederation;
this._isPortal=E.isPortal();this._defaultUserType=M;this._setupRoleFlags();this.clear();d({rolesResult:this._canManageRoles?this.getRoles():null,userTypesResult:this._canAccessLicenses?this.getUserTypes():null,signedProviderResult:this.getSignedProviderMetadataInfo()}).then(function(){this._dialog.set("title",this._isFederation?this.i18n.setFederationOfIdentityProvidersTitle:this.i18n.setIdentityProviderTitle);this._configureFormForIdentityProviderType();var K=/:\d*\//g;K=this._isPortal?esriGeowConfig.self.portalHostname.replace(K,
".").replace("/","."):esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl;this._entityIDInput&&this._entityIDInput.set("value",K);this._dialog.show()}.bind(this))},getSignedProviderMetadataInfo:function(){var J=new b,M=E.getSecureUrl(esriGeowConfig.restBaseUrl)+"portals/self/sp";E.request({url:M}).then(function(K){this._signedServiceProviderUrl=K&&K.signedServiceProviderUrl?K.signedServiceProviderUrl:"";J.resolve()}.bind(this),function(){this._signedServiceProviderUrl="";J.resolve("")}.bind(this));
return J},getUserTypes:function(){var J=new b;this._licensesAPI.getLicenseTypes().then(function(M){this._userTypes=M.userLicenseTypes.filter(function(K){return 0<K.maxUsers});J.resolve()}.bind(this));return J},getRoles:function(){var J=new b;this._rolesAPI.getAllRoles(!0).then(function(M){this._roles=M;this._viewerRole=this._localizeViewerRole(this._roles);this._viewerEditRole=this._localizeViewerEditRole(this._roles);J.resolve()}.bind(this));return J},_localizeViewerRole:function(J){if(J)for(var M=
0;M<J.length;M++)if(J[M]&&J[M].id===this.SYSTEM_ROLES.VIEWER)return J[M].name=this.i18n.viewerRoleName,J[M]},_localizeViewerEditRole:function(J){if(J)for(var M=0;M<J.length;M++)if(J[M]&&J[M].id===this.SYSTEM_ROLES.DATA_EDITOR)return J[M].name=this.i18n.viewerEditRoleName,J[M]},_coreRoleSelected:function(J){return z.includes([this.orgUserRole,this.orgPublisherRole,this.orgAdminRole],J)},_hasAdminPrivileges:function(J){if(J&&J.privileges)for(var M=0;M<J.privileges.length;M++){var K=J.privileges[M];
if(-1<K.indexOf(":admin"))return!0}return!1},edit:function(J,M){this._setupRoleFlags();this.clear();this._isFederation=J.isFederation;this._currentIDP=J;this._isPortal=E.isPortal();this._isEditing=!0;this._defaultUserType=M;M=/:\d*\//g;var K=this._isPortal?esriGeowConfig.self.portalHostname.replace(M,".").replace("/","."):esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl,R=esriGeowConfig.self.creditAssignments&&"enabled"===esriGeowConfig.self.creditAssignments;d({rolesResult:this._canManageRoles?
this.getRoles():null,userTypesResult:this._canAccessLicenses?this.getUserTypes():null,signedProviderResult:this.getSignedProviderMetadataInfo()}).then(function(){if(v.isDefined(J)){this._configureFormForIdentityProviderType();this._dialog.set("title",this._isFederation?this.i18n.editFederationOfIdentityProvidersTitle:this.i18n.editIdentityProviderTitle);this._nameInput.set("value",v.isDefined(J.name)?J.name:"");this._encryptionSupported.set("value",v.isDefined(J.encryptionSupported)?J.encryptionSupported:
!1);this._signedRequestSupported.set("value",v.isDefined(J.supportSignedRequest)?J.supportSignedRequest:!1);this._signUsingSHA256.set("value",v.isDefined(J.useSHA256)?J.useSHA256:!1);B.showHide(this._sha256Container,v.isDefined(J.supportSignedRequest)&&J.supportSignedRequest);this._loginUrlInput.set("value",v.isDefined(J.bindingUrl)?J.bindingUrl:"");this._loginUrlPostInput.set("value",v.isDefined(J.bindingPostUrl)?J.bindingPostUrl:"");this._logoutUrlInput.set("value",v.isDefined(J.logoutUrl)?J.logoutUrl:
"");this._certificateInput.set("value",v.isDefined(J.certificate)?J.certificate:"");this._logoutRequestSupported.set("value",v.isDefined(J.supportsLogoutRequest)?J.supportsLogoutRequest:!1);this._updateProfile.set("value",v.isDefined(J.updateProfileAtSignin)?J.updateProfileAtSignin:!1);this._updateGroups.set("checked",v.isDefined(J.updateGroupsAtSignin)?J.updateGroupsAtSignin:!1);this._federationDiscoveryServiceUrl.set("value",v.isDefined(J.discoveryServiceUrl)?J.discoveryServiceUrl:"");this._metadataAggregateUrl.set("value",
v.isDefined(J.metadataServiceUrl)?J.metadataServiceUrl:"");this._aggregatedMetadataCertificate.set("value",v.isDefined(J.certificate)?J.certificate:"");var X=!!(this._canAccessLicenses&&J.userLicenseType||this._canManageRoles&&J.roleId||this._canManageCredits&&R&&v.isDefined(J.userCreditAssignment)&&-1<J.userCreditAssignment||J.groups&&0<J.groups.length||J.userType);K=v.isDefined(J.entityId)&&""!==J.entityId?J.entityId:K;this._entityIDInput.set("value",K);v.isDefined(J.signUpMode)&&(J.signUpMode===
this.SIGN_UP_MODE_AUTOMATIC?(this._automaticOption.set("checked",!0),B.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses),this._canManageRoles&&B.showHide(this._roleOptions,!this._isPortal),this._canManageCredits&&B.showHide(this._creditOptions,!(this._isPortal||!R)),B.showHide(this._groupOptions,!this._isPortal),B.showHide(this._esriAccessOptions,!this._isPortal),B.showNode(this._automaticDefaults),B.showNode(this._toConfigureDefaults)):J.signUpMode===this.SIGN_UP_MODE_INVITE&&
(this._inviteOption.set("checked",!0),B.hideNodes([this._automaticDefaults,this._toConfigureDefaults])));if(this._canAccessLicenses)if(J.userLicenseType){var Q=z.find(this._userTypes,function(W){return W.id===J.userLicenseType},this);Q?h.set(this._userTypeDefault,"innerHTML",Q.name):h.set(this._userTypeDefault,"innerHTML",this.i18n.notSet)}else h.set(this._userTypeDefault,"innerHTML",this.i18n.notSet);this._canManageRoles&&(J.roleId?(Q=z.find(this._roles,function(W){return W.id===J.roleId},this))?
h.set(this._roleDefault,"innerHTML",Q.name):this._coreRoleSelected(J.roleId)?J.roleId===this.orgUserRole?h.set(this._roleDefault,"innerHTML",this.i18n.userRoleName):J.roleId===this.orgPublisherRole?h.set(this._roleDefault,"innerHTML",this.i18n.publisherRoleName):J.roleId===this.orgAdminRole&&h.set(this._roleDefault,"innerHTML",this.i18n.adminRoleName):h.set(this._roleDefault,"innerHTML",this.i18n.notSet):h.set(this._roleDefault,"innerHTML",this.i18n.notSet));R?v.isDefined(J.userCreditAssignment)?
-1<J.userCreditAssignment?h.set(this._creditsDefault,"innerHTML",f.format(parseInt(J.userCreditAssignment,10))):h.set(this._creditsDefault,"innerHTML",this.i18n.notSet):h.set(this._creditsDefault,"innerHTML",this.i18n.notSet):B.hideNode(this._creditOptions);v.isDefined(J.groups)&&0<J.groups.length?this._fetchSelectedGroups(J.groups):(this._selectedGroups=[],this._toggleGroups());v.isDefined(J.userType)&&("both"===J.userType?h.set(this._esriAccessDefault,"innerHTML",this.i18n.esriAccessEnabled):h.set(this._esriAccessDefault,
"innerHTML",this.i18n.esriAccessDisabled));B.showHide(this._automaticDefaults,X);this._parametersOption.set("checked",!0);this.showParametersInputs();v.isDefined(J.logoutUrl)&&0<J.logoutUrl.length||v.isDefined(J.userIdAttribute)&&0<J.userIdAttribute.length?this.showAdvancedSettings():this.hideAdvancedSettings()}else this._entityIDInput.set("value",K),this._encryptionSupported.set("value",!1),this._signedRequestSupported.set("value",!1),this._signUsingSHA256.set("value",!1),B.hideNode(this._sha256Container),
this._logoutRequestSupported.set("value",!1),this._updateGroups.set("checked",!1),B.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses);this._setBtn.set("label",this.i18n.updateIdentityProviderLabel);this._dialog.show()}.bind(this))},_configureFormForIdentityProviderType:function(){B.showHide(this._metadataSourceContainer,!this._isFederation);B.showHide(this._updateGroupsContainer,!this._isFederation);B.showHide(this._logoutUrlContainer,!this._isFederation);this._certificateInput.set("disabled",
this._isFederation?!0:!1);B.showHide(this._federationDiscoveryServiceContainer,this._isFederation);B.showHide(this._metadataAggregateUrlContainer,this._isFederation);B.showHide(this._aggregatedMetadataCertificateContainer,this._isFederation);this._aggregatedMetadataCertificate.set("disabled",this._isFederation?!1:!0);var J=!!this._signedServiceProviderUrl;h.set(this._signedProviderMetadataUrl,"href",this._signedServiceProviderUrl);h.set(this._signedProviderMetadataUrl,"textContent",this._signedServiceProviderUrl);
B.showHide(this._providerMetadataDownloadContainer,J)},_fetchSelectedGroups:function(J){var M=esriGeowConfig.restBaseUrl+"community/groups",K;J&&0<J.length?(J.forEach(function(R){K=K?K+(" OR id:"+R):"id:"+R}),K?(J="orgid:"+esriGeowConfig.self.id+" AND ("+K+") AND -provider:enterprise",y.fetchAllResources(M,{q:J},"results").then(function(R){this._selectedGroups=this._selectedGroups.concat(R);this._toggleGroups()}.bind(this),function(R){this._selectedGroups=[];this._toggleGroups()}.bind(this))):(this._selectedGroups=
[],this._toggleGroups())):(this._selectedGroups=[],this._toggleGroups())},_toggleGroups:function(){var J=p.clone(this._selectedGroups),M=this._selectedGroups&&0<this._selectedGroups.length,K=M?J.splice(0,3).map(function(X){return X.title}):[],R=M?J.map(function(X){return X.title}):[];M?(B.showNode(this._hasGroupDefaults),B.hideNode(this._noGroupDefaults)):(B.hideNode(this._hasGroupDefaults),B.showNode(this._noGroupDefaults));h.set(this._groupListContainer,"innerHTML",K.join(", "));B.showHide(this._groupListContainer,
M);B.showHide(this._otherLinkContainer,0<J.length);0<J.length&&(this._otherLinkTooltip&&this._otherLinkTooltip.destroyRecursive(),this._otherLinkTooltip=C.createTooltip(this.id+"-other-link",R.join(",\x3cbr\x3e"),200,400))},_setupTooltips:function(){this._tooltips&&0===this._tooltips.length&&this._tooltips.push(C.createTooltip(this.id+"-noLimitTooltip-"+this.baseClass,this.i18n.orgLimit,200,300))},clear:function(){this._dialog.set("title",this.i18n.setIdentityProviderTitle);var J=E.isPortal()||!1===
esriGeowConfig.isMultiTenant;J?(h.set(this._description,"innerHTML",this.i18n.setIdentityProviderDescPortal),this._logoutUrlInput.set("title",this.i18n.logoutUrlTooltipPortal),h.set(this._inviteOptionLabel,"innerHTML",this.i18n.onAddOption)):(h.set(this._description,"innerHTML",this.i18n.setIdentityProviderDesc),this._logoutUrlInput.set("title",this.i18n.logoutUrlTooltip),h.set(this._inviteOptionLabel,"innerHTML",this.i18n.onInviteOption));this._nameInput.set("placeHolder",this._isFederation?this.i18n.federationNamePlaceholder:
this.i18n.namePlaceHolder);this._bindingUrlInput.set("placeHolder",this.i18n.metadataUrlPlaceHolder);this._loginUrlInput.set("placeHolder",this.i18n.parametersUrlPlaceHolder);this._loginUrlPostInput.set("placeHolder",this.i18n.parametersUrlPostPlaceHolder);this._logoutUrlInput.set("placeHolder",this.i18n.logoutUrlPlaceHolder);this._entityIDInput.set("placeHolder","");this._federationDiscoveryServiceUrl.set("placeHolder",this.i18n.federationDiscoveryServiceUrlPlaceholder);this._metadataAggregateUrl.set("placeHolder",
this.i18n.metadataAggregateUrlPlaceholder);this._inviteOption.set("checked",!0);B.hideNodes([this._automaticDefaults,this._toConfigureDefaults]);h.set(this._userTypeDefault,"innerHTML",this.i18n.notSet);h.set(this._roleDefault,"innerHTML",this.i18n.notSet);h.set(this._creditsDefault,"innerHTML",this.i18n.notSet);h.set(this._esriAccessDefault,"innerHTML",this.i18n.notSet);h.set(this._groupListContainer,"innerHTML",this.i18n.notSet);J||(this._selectedGroups=[],this._toggleGroups());this._metadataUrlOption.set("checked",
!0);this.showMetadataUrlInputs();this.hideAdvancedSettings();this._nameInput.set("value","");this._bindingUrlInput.set("value","");h.set(this._metadataFileInput,"value","");this._encryptionSupported.set("value",!1);this._signedRequestSupported.set("value",!1);B.hideNode(this._sha256Container);this._signUsingSHA256.set("value",!1);this._logoutRequestSupported.set("value",!1);this._loginUrlInput.set("value","");this._loginUrlPostInput.set("value","");this._certificateInput.set("value","");h.set(this._certificateFileInput,
"value","");this._logoutUrlInput.set("value","");this._updateProfile.set("value","");this._updateGroups.set("checked",!1);this._federationDiscoveryServiceUrl.set("value","");this._metadataAggregateUrl.set("value","");this._aggregatedMetadataCertificate.set("value","");h.set(this._signUpMode,"value","");h.set(this._bindingType,"value","");this._setBtn.set("disabled",!1);this._selectedUserType=this._currentIDP=null;this._isEditing=!1;this._roles=[];this._userTypes=[];this._selectedGroups=[]},_setupRoleFlags:function(){var J=
!!esriGeowConfig.userRole;this._canAccessLicenses=(this._isAdmin=J&&esriGeowConfig.userRole.isAdmin())||J&&(esriGeowConfig.userRole.canManageLicenses()||esriGeowConfig.userRole.canInviteUsers()||esriGeowConfig.userRole.canManageRoles());this._canManageCredits=this._isAdmin||J&&esriGeowConfig.userRole.canManageCredits();this._canManageRoles=this._isAdmin||J&&esriGeowConfig.userRole.canManageRoles()},_loadConnections:function(){this.own(e(this._metadataUrlOption,this.onMetadataUrlOption.bind(this)),
e(this._metadataFileOption,this.onMetadataFileOption.bind(this)),e(this._parametersOption,this.onParametersOption.bind(this)),e(this._setBtn,this.onSetProvider.bind(this)),e(this._cancelBtn,this.onCancel.bind(this)),e(this._signedRequestSupported,this.onSignedRequestSupported.bind(this)))},hide:function(){this._dialog.hide()},showMetadataUrlInputs:function(){B.hideNodes([this._metadataFileInputs,this._parametersInputs]);B.showNode(this._metadataUrlInputs);h.set(this._bindingType,"value","")},showMetadataFileInputs:function(){B.hideNodes([this._metadataUrlInputs,
this._parametersInputs]);B.showNode(this._metadataFileInputs);h.set(this._bindingType,"value","")},showParametersInputs:function(){B.hideNodes([this._metadataUrlInputs,this._metadataFileInputs]);B.showNode(this._parametersInputs)},showAdvancedSettings:function(){h.set(this._toggleAdvancedSettings,"innerHTML",this.i18n.hideAdvancedSettings);B.showNode(this._advancedSettings);this._showingAdvancedSettings=!0},hideAdvancedSettings:function(){h.set(this._toggleAdvancedSettings,"innerHTML",this.i18n.showAdvancedSettings);
B.hideNode(this._advancedSettings);this._showingAdvancedSettings=!1},validParameters:function(){var J=this.i18n.noticeLabel,M=this._nameInput.get("value");if(!v.isDefined(M)||0===M.length)return y.createSpecifiedDialog(G).show({title:J,message:this.i18n.errors.nameRequired}),!1;if(!this._isFederation){M=this._metadataUrlOption.get("checked");var K=this._bindingUrlInput.get("value");if(M&&(!v.isDefined(K)||0===K.length))return y.createSpecifiedDialog(G).show({title:J,message:this.i18n.errors.metadataUrlMustBeSet}),
!1;M=this._metadataFileOption.get("checked");K=h.get(this._metadataFileInput,"value");if(M&&(!v.isDefined(K)||0===K.length))return dlg.show({title:J,message:this.i18n.errors.metadataFileMustBeSet}),!1;if(this._parametersOption.get("checked")){M=this._loginUrlInput.get("value");if(!v.isDefined(M)||0===M.length)return y.createSpecifiedDialog(G).show({title:J,message:this.i18n.errors.loginUrlMustBeSet}),!1;M=this._loginUrlPostInput.get("value");if(!v.isDefined(M)||0===M.length)return y.createSpecifiedDialog(G).show({title:J,
message:this.i18n.errors.loginUrlPostMustBeSet}),!1;M=this._certificateInput.get("value");if(!v.isDefined(M)||0===M.length)return y.createSpecifiedDialog(G).show({title:J,message:this.i18n.errors.certificateMustBeSet}),!1}}return!0},onAutomaticClicked:function(){var J=esriGeowConfig.self.creditAssignments&&"enabled"===esriGeowConfig.self.creditAssignments,M=!(!this._currentIDP||!(this._canAccessLicenses&&this._currentIDP.userLicenseType||this._canManageRoles&&this._currentIDP.roleId||this._canManageCredits&&
J&&v.isDefined(this._currentIDP.userCreditAssignment)&&-1<this._currentIDP.userCreditAssignment||this._currentIDP.groups&&0<this._currentIDP.groups.length||this._currentIDP.userType));!this._isPortal||this._defaultUserType&&"none"!==this._defaultUserType?(B.showHide(this._automaticDefaults,M),B.showNode(this._toConfigureDefaults),this._canManageRoles&&B.showHide(this._roleOptions,!this._isPortal),this._canManageCredits&&B.showHide(this._creditOptions,!(this._isPortal||!J)),B.showHide(this._groupOptions,
!this._isPortal),B.showHide(this._hasGroupDefaults,this._selectedGroups&&0<this._selectedGroups.length),B.showHide(this._noGroupDefaults,!(this._selectedGroups&&0<this._selectedGroups.length)),B.showHide(this._esriAccessOptions,!this._isPortal),B.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses)):(y.createSpecifiedDialog(G).show({title:this.i18n.errorLabel,message:this.i18n.mustHaveDefaultUserType}),setTimeout(function(){this._automaticOption.setChecked(!1);this._inviteOption.setChecked(!0)}.bind(this)))},
onInvitationClicked:function(){B.hideNodes([this._automaticDefaults,this._toConfigureDefaults])},onMetadataUrlOption:function(){this.showMetadataUrlInputs()},onMetadataFileOption:function(){this.showMetadataFileInputs()},onParametersOption:function(){this.showParametersInputs()},onToggleAdvancedSettings:function(){this._showingAdvancedSettings?this.hideAdvancedSettings():this.showAdvancedSettings()},onSetProvider:function(J){J&&J.preventDefault();this._setBtn.set("disabled",!0);this.validParameters()?
(9>a("ie")&&(this._form.encoding="multipart/form-data"),this._automaticOption.get("checked")?h.set(this._signUpMode,"value",this.SIGN_UP_MODE_AUTOMATIC):h.set(this._signUpMode,"value",this.SIGN_UP_MODE_INVITE),h.set(this._supportEncryption,"value",this._encryptionSupported.get("checked")),h.set(this._supportSignedRequest,"value",this._signedRequestSupported.get("checked")),h.set(this._useSHA256,"value",this._signedRequestSupported.get("checked")&&this._signUsingSHA256.get("checked")),h.set(this._supportsLogoutRequest,
"value",this._logoutRequestSupported.get("checked")),h.set(this._updateProfileAtSignIn,"value",this._updateProfile.get("checked")),h.set(this._updateGroupsAtSignIn,"value",this._updateGroups.get("checked")),this._metadataUrlOption.get("checked")?(h.set(this._metadataFileInput,"value",""),this._loginUrlInput.set("value",""),h.set(this._bindingType,"value",""),this._certificateInput.set("value",""),h.set(this._certificateFileInput,"value","")):this._metadataFileOption.get("checked")?(this._bindingUrlInput.set("value",
""),this._loginUrlInput.set("value",""),h.set(this._bindingType,"value",""),this._certificateInput.set("value",""),h.set(this._certificateFileInput,"value","")):(this._bindingUrlInput.set("value",""),h.set(this._metadataFileInput,"value",""),h.set(this._bindingType,"value",this.BINDING_TYPE_REDIRECT)),J=esriGeowConfig.restBaseUrl+"portals/self/idp/",this._isEditing?(J+=(this._isFederation?"federation/":"")+this._currentIDP.id+"/update",h.set(this._clearEmptyFields,"value",!0)):(J+=(this._isFederation?
"federation/":"")+"register",h.set(this._clearEmptyFields,"value",!1)),E.request({url:J,form:this._form},{usePost:!0}).then(function(M){v.isDefined(M)&&!v.isDefined(M.error)&&(this._setBtn.set("disabled",!1),n.publish("setIdentityProvider",[]),this.hide())}.bind(this),function(M){if(v.isDefined(M.messageCode)){var K=this.i18n.errors[M.messageCode];v.isDefined(M.details)&&v.isDefined(M.details[0])&&(K=c.substitute(K,{details:M.details[0]}))}else K=this._isEditing?this.i18n.errors.unableToUpdateIdentityProvider:
this.i18n.errors.unableToSetIdentityProvider;y.createSpecifiedDialog(G).show({title:this.i18n.errorLabel,message:K});this._setBtn.set("disabled",!1)}.bind(this))):this._setBtn.set("disabled",!1)},onSignedRequestSupported:function(){this._signedRequestSupported.get("checked")?B.showNode(this._sha256Container):(this._signUsingSHA256.set("checked",!1),B.hideNode(this._sha256Container))},onSubmit:function(){return!1},onCancel:function(J){J&&J.preventDefault();this.hide()},onHide:function(){}});da.prototype.statics=
{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new da);return this._instance}};return da})},"arcgisonline/sharing/dijit/dialog/SharingDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/ShareOptions"],function(k,g,p){k.provide("arcgisonline.sharing.dijit.dialog.SharingDlg");k.require("dijit.Dialog");k.require("dijit._Widget");k.require("dijit._Templated");k.require("arcgisonline.sharing.dijit.ShareOptions");
k.declare("arcgisonline.sharing.dijit.dialog.SharingDlg",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_shareDialog" id\x3d"share-dialog" title\x3d"${i18n.sharingDlgTitle}" execute\x3d""\x3e\r\n    \x3clabel class\x3d"trailer-half share-title"\x3e${i18n.shareItemsLabel}\x3c/label\x3e\r\n    \x3cdiv dojotype\x3d"arcgisonline.sharing.dijit.ShareOptions" dojoAttachPoint\x3d"_shareOptions"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cp class\x3d"trailer-half font-size--1"\x3e\r\n        ${i18n.settingsMsg}\r\n      \x3c/p\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_shareNoGroupsDiv" style\x3d"display:none;" class\x3d"alert alert-yellow trailer-half is-active"\x3e\r\n        ${i18n.notAMemberMsg}\r\n      \x3c/div\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_shareOwnerNoneDiv" style\x3d"display:none;" class\x3d"alert alert-yellow trailer-half is-active"\x3e\r\n        ${i18n.notOwnerMsg}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_editableLayerMsg" class\x3d"label-yellow hide js-sharing-help"\x3e\r\n        ${i18n.layerIsEditable} \x3ca href\x3d"${_helpLink}" target\x3d"_blank"\x3e${i18n.learnHow}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_premiumContentMsg" class\x3d"label-yellow hide js-premium-help"\x3e\r\n      ${i18n.premiumLayerMsg} \x3ca href\x3d"${_helpLinkPremium}" target\x3d"_blank"\x3e${i18n.premiumLayerMsgLearnMore}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right clearfix share-action-bar leader-half" style\x3d"padding-bottom:1em;"\x3e\r\n      \x3cspan class\x3d"disabled padding-right-1" style\x3d"display:none;"\x3e${i18n.sharingItems}\x3c/span\x3e\r\n      \x3cbutton id\x3d"button_share-cancel" class\x3d"jevent cancel" type\x3d"cancel" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCancelClick"\x3e\r\n        ${i18n.cancel}\r\n      \x3c/button\x3e\r\n      \x3cbutton class\x3d"jevent primary" dojotype\x3d"dijit.form.Button"  dojoAttachEvent\x3d"onClick:_handleOkResponse"\x3e\r\n        ${i18n.ok}\r\n      \x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,_shareDialog:null,_shareOptions:null,_shareNoGroupsDiv:null,_shareOwnerNoneDiv:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SharingDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=k.i18n.getLocalization("arcgisonline","arcgisonline").common;k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").sharingDlg);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline",
"arcgisonline").shareCheckDlg);k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").shareMapDlg);this._helpLink=esriGeowConfig.helpBase+esriGeowConfig.helpMap["120001067"];this._helpLinkPremium=esriGeowConfig.helpBase+esriGeowConfig.helpMap["120001307"];this._handles=[]},postCreate:function(){this.loadConnections()},destroy:function(){k.forEach(this._handles,"item.remove();");this._shareDialog.destroyRecursive();this._shareDialog=null;this.inherited(arguments)},_setDisabledAttr:function(b){k.forEach(g.registry.findWidgets(this._shareDialog.domNode),
function(h){h.set("disabled",b)});k.query("input").forEach(function(h){k.attr(h,"disabled",b)});k.query(".disabled").forEach(function(h){k.style(h,"display",b?"":"none")})},loadConnections:function(){k.connect(this._shareDialog,"hide",k.hitch(this,function(b){(b=b&&b.target)&&k.hasClass(b,"dijitDialogCloseIcon")&&(this.isCancelled=!0);this.set("disabled",!1);this._shareOptions.clear()}));this._handles.push(k.subscribe("shareOptionsSetup",k.hitch(this,function(){this._shareDialog.show()})));this._handles.push(k.subscribe("onShareUpdate",
k.hitch(this,function(b){this.set("disabled",!1);b&&b.length&&"string"!==typeof b||this._shareDialog.hide()})));this._handles.push(k.subscribe("doesNotOwnGroups",k.hitch(this,function(){k.style(this._shareOwnerNoneDiv,"display","block")})));this._handles.push(k.subscribe("notMemberOfAnyGroups",k.hitch(this,function(){k.style(this._shareNoGroupsDiv,"display","block")})))},_handleOkResponse:function(b){b.preventDefault();this.set("disabled",!0);this._shareOptions.share(b)},_handleCancelClick:function(b){b.preventDefault();
this.isCancelled=!0;this._shareDialog.hide()},hide:function(){this._shareDialog.hide()},show:function(b,h,f,d){this._shareOptions.show(b,h,f,d)},showAdmin:function(b,h,f,d){this._shareOptions.showAdmin(b,h,f,d)},showGroups:function(b,h){this._shareOptions.showGroups(b,h)}})})},"arcgisonline/sharing/dijit/dialog/TagsDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Dialog,dijit/form/MultiSelect,dijit/form/SimpleTextarea,arcgisonline/sharing/geow/Content"],
function(k,g,p){k.provide("arcgisonline.sharing.dijit.dialog.TagsDlg");k.require("dijit._Widget");k.require("dijit._Templated");k.require("dijit.Dialog");k.require("dijit.form.MultiSelect");k.require("dijit.form.SimpleTextarea");k.require("arcgisonline.sharing.geow.Content");k.declare("arcgisonline.sharing.dijit.dialog.TagsDlg",[g._Widget,g._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_tagsDialog" dojoAttachPoint\x3d"onHide:clear" title\x3d"${i18n.tagDlgTitle}" class\x3d"tagsForm"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_tagsErrorDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv dojoAttachPoint\x3d"_contentTagsDiv" style\x3d"display:block;"\x3e\r\n\t\t\x3clabel \x3e${i18n.selectTag}\x3c/label\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t    \x3cselect dojoAttachPoint\x3d"_tagsSelect" dojoType\x3d"dijit.form.MultiSelect" style\x3d"width:100%;height:150px;"\x3e\x3c/select\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"_cancelBtn" dojotype\x3d"dijit.form.Button" class\x3d"cancel" dojoAttachEvent\x3d"onClick:_handleCancelClick" style\x3d"float:right;"\x3e${i18n.cancel}\x3c/div\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"_submitBtn" dojotype\x3d"dijit.form.Button" class\x3d"primary" type\x3d"submit" dojoAttachEvent\x3d"onClick:getSelectedTags" style\x3d"float:right;"\x3e${i18n.useSelected}\x3c/div\x3e  \r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv dojoAttachPoint\x3d"_contentNoTagsDiv" style\x3d"display:none;"\x3e\r\n\t\t\x3clabel\x3e${i18n.tagsNotAvailable}\x3c/label\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cdiv id\x3d"button_tags-ok" dojoAttachPoint\x3d"_okBtn" dojotype\x3d"dijit.form.Button" class\x3d"primary" dojoAttachEvent\x3d"onClick:_handleCancelClick" style\x3d"float:right;"\x3e${i18n.ok}\x3c/div\x3e\r\n\t\t\x3cbr/\x3e\r\n\t\t\x3cbr/\x3e\r\n\t\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
_tagsDialog:null,_contentTagsDiv:null,_contentNoTagsDiv:null,_tagsSelect:null,i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TagsDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=k.i18n.getLocalization("arcgisonline","arcgisonline").common;k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").tagsDlg)},postCreate:function(){},_handleCancelClick:function(b){b.preventDefault();
this._tagsDialog.hide()},clear:function(){this._tagsSelect.reset();k.style(this._contentTagsDiv,"display","none");k.style(this._contentNoTagsDiv,"display","none")},hide:function(){this._tagsDialog.hide()},show:function(b){this.clear();var h=arcgisonline.sharing.util.getUser(),f=esriGeowConfig.restBaseUrl+"community/users/";f=b&&(b.username||b.email)?f+(b.username?b.username:b.email):f+h.email;arcgisonline.sharing.util.getJson(f+"/tags",k.hitch(this,this._handleTagResponse),k.hitch(this,this._handleError));
this._tagsDialog.show()},_handleTagResponse:function(b){0==b.tags.length?k.style(this._contentNoTagsDiv,"display",""):(k.style(this._contentTagsDiv,"display",""),k.empty(this._tagsSelect.domNode),k.forEach(b.tags,function(h){k.create("option",{innerHTML:h.tag,value:h.tag},this._tagsSelect.domNode)},this))},_handleError:function(b){},getSelectedTags:function(b){b.preventDefault();b=[];b=this._tagsSelect.get("value");k.publish("onSelectedTagsUpdate",[b.toString()])}})})},"arcgisonline/sharing/dijit/dialog/UpdateItemDlg":function(){define(["dojo",
"dijit","dojox","dojo/require!dijit/form/SimpleTextarea,dijit/form/TextBox,dijit/form/CheckBox,dijit/form/Button,dijit/InlineEditBox,dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/pages/pageUtil,arcgisonline/pages/utils/dom,arcgisonline/pages/dijit/UploadProgressBar,arcgisonline/sharing/util,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Content,arcgisonline/sharing/geow/Item,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,dojo/promise/all,dojo/number"],
function(k,g,p){k.provide("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");k.require("dijit.form.SimpleTextarea");k.require("dijit.form.TextBox");k.require("dijit.form.CheckBox");k.require("dijit.form.Button");k.require("dijit.InlineEditBox");k.require("dijit.Dialog");k.require("dijit._Widget");k.require("dijit._Templated");k.require("arcgisonline.pages.pageUtil");k.require("arcgisonline.pages.utils.dom");k.require("arcgisonline.pages.dijit.UploadProgressBar");k.require("arcgisonline.sharing.util");
k.require("arcgisonline.sharing.geow.Community");k.require("arcgisonline.sharing.geow.Content");k.require("arcgisonline.sharing.geow.Item");k.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");k.require("arcgisonline.sharing.dijit.dialog.TagsDlg");k.require("dojo.promise.all");k.require("dojo.number");k.declare("arcgisonline.sharing.dijit.dialog.UpdateItemDlg",[g._Widget,g._Templated],{util:arcgisonline.sharing.util,community:arcgisonline.sharing.geow.Community,content:arcgisonline.sharing.geow.Content,
itemAPI:arcgisonline.sharing.geow.Item,pageUtil:arcgisonline.pages.pageUtil,domUtil:arcgisonline.pages.utils.dom,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_updateItemDialog" title\x3d"${i18n.updateItem}" dojoAttachEvent\x3d"hide:clear" execute\x3d"" class\x3d"update-item-dlg"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_errorDiv"\x3e\x3c/div\x3e\r\n    \x3cform dojoAttachPoint\x3d"_updateItemForm" enctype\x3d"multipart/form-data"\x3e\r\n      \x3cdiv dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemFolderInput" type\x3d"hidden" value\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"id" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemIdInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"name" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemNameInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"title" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTitleInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"tags" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTagsInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"type" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTypeInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"typeKeywords" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemKeywordsInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"description" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateDescriptionInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"snippet" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateSnippetInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"accessInformation" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateAccessInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"licenseInfo" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateLicenseInfoInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"extent" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateExtentInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"overwrite" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateOverwriteInput" type\x3d"hidden" value\x3d"true"\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"async" dojotype\x3d"dijit.form.TextBox" type\x3d"hidden" dojoAttachPoint\x3d"_updateAsyncInput" value\x3d"true"\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv\x3e\x3clabel class\x3d"font-size--1" dojoAttachPoint\x3d"_replaceUpdateVerLabel"\x3e${i18n.replaceUpdatedVersionMsg}\x3c/label\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv style\x3d"padding-top:4px;margin-bottom:1.0em;"\x3e\r\n        \x3clabel class\x3d"esriFloatLeading esriTrailingMargin2" style\x3d"margin-top:6px;" for\x3d"update-item-file"\x3e${i18n.itemLabel}\x3c/label\x3e\r\n        \x3cinput type\x3d"file" dojoAttachPoint\x3d"_updateItemFile" id\x3d"update-item-file" name\x3d"file" size\x3d"40" class\x3d"esriFileInput"\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"overwrite_section" class\x3d"hide" style\x3d"padding-top:4px;margin-bottom:1.0em;"\x3e\r\n        \x3cinput id\x3d"overwriteService" type\x3d"checkbox" name\x3d"overwriteService" dojotype\x3d"dijit.form.CheckBox" checked\x3d"checked" dojoAttachPoint\x3d"_overwriteService"/\x3e\r\n        \x3clabel id\x3d"overwriteServiceLbl" for\x3d"overwriteService"\x3e${i18n.overwriteService} ${i18n.keepFieldsSame}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"update-item-keepdescription" style\x3d"width:100%;display:none;"\x3e\r\n        \x3cdiv style\x3d"padding-bottom:5px; padding-top:2px;"\x3e\r\n          \x3clabel\x3e${i18n.updateItemDescription}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"line-height:23px"\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"useDescription" dojotype\x3d"dijit.form.RadioButton" checked\x3d"checked" dojoAttachPoint\x3d"_useDescKeepRadio" id\x3d"useDescription:keep"/\x3e\r\n          \x3clabel for\x3d"useDescription:keep"\x3e${i18n.keepExistingProperties}\x3c/label\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"useDescription" dojotype\x3d"dijit.form.RadioButton" dojoAttachPoint\x3d"_useDescUpdateRadio" id\x3d"useDescription:update"/\x3e\r\n          \x3clabel for\x3d"useDescription:update"\x3e${i18n.useUploadedProperties}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"leader-half trailer-half flex"\x3e\r\n        \x3cdiv class\x3d"flex flex-1"\x3e\r\n          \x3cspan data-dojo-attach-point\x3d"_waitingSpan" class\x3d"hide flex-column-justify-center"\x3e${i18n.uploadingItem}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_uploadProgressBar"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCancel" dojoAttachPoint\x3d"_cancelBtn" id\x3d"button_update-item-cancel" class\x3d"jevent cancel margin-right-half" type\x3d"cancel"\x3e${i18n.cancel}\x3c/button\x3e\r\n        \x3cbutton id\x3d"button_update-item" type\x3d"button" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:uploadItem" class\x3d"primary" dojoAttachPoint\x3d"_updateItemBtn"\x3e${i18n.updateItem}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
item:null,admin:null,i18n:null,_replaceUpdateVerLabel:null,_updateItemDialog:null,_updateItemForm:null,_updateItemBtn:null,_cancelBtn:null,_waitingSpan:null,_useDescUpdateRadio:null,_useDescKeepRadio:null,_updateItemFile:null,_errorDiv:null,_updateItemFolderInput:null,_updateItemIdInput:null,_updateItemNameInput:null,_updateItemTitleInout:null,_updateItemTagsInput:null,_updateItemTypeInput:null,_updateItemKeywordsInput:null,_updateDescriptonInput:null,_updateSnippetInput:null,_updateAccessInput:null,
_updateLicenseInfoInput:null,_updateExtentInput:null,_updateOverwriteInput:null,_updateAsyncInput:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.UpdateItemDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=k.i18n.getLocalization("arcgisonline","arcgisonline").common;k.mixin(this.i18n,k.i18n.getLocalization("arcgisonline","arcgisonline").updateItemDlg);k.mixin(this.i18n,{updating:k.i18n.getLocalization("arcgisonline",
"arcgisonline").addItemFrm.updating})},postCreate:function(){},show:function(b,h){var f={Shapefile:1,"File Geodatabase":1,GeoJson:1,CSV:1,"Microsoft Excel":1},d=b&&b.publishParameters&&"address"===b.publishParameters.locationType;this.item=b;h&&null!==this.adminUser&&(this.admin=h);"Layer Package"==b.type&&k.style(k.byId("update-item-keepdescription"),"display","block");"Vector Tile Service"===b.type?(k.attr(this._replaceUpdateVerLabel,"innerHTML",this.i18n.overwriteStyle),this._updateItemDialog.set("title",
this.i18n.updateStyle),this._updateItemBtn.set("label",this.i18n.updateStyle)):(this.itemName=this.item.sourceData&&this.item.sourceData.name||this.item.name,k.attr(this._replaceUpdateVerLabel,"innerHTML",k.string.substitute(this.i18n.replaceUpdatedVersionMsg,[this.itemName])));b&&b.type in f&&b.relatedService?this._overwriteService.set("checked",!1):b&&b.sourceData?(this._updateItemDialog.set("title",this.i18n.updateFeatures),this._updateItemBtn.set("label",this.i18n.updateFeatures),h=k.string.substitute(d?
this.i18n.overwriteServiceWithCreditsMsg:this.i18n.overwriteServiceMsg,[b.title,b.sourceData.name]),k.attr(this._replaceUpdateVerLabel,"innerHTML",h)):this._overwriteService.set("checked",!1);b&&b.sourceData&&(esri.hide(this._overwriteService.domNode),k.attr("overwriteServiceLbl","innerHTML",this.i18n.keepFieldsSame),k.removeClass("overwrite_section","hide"));this._updateItemDialog.show();this._uploadProgressBar=new arcgisonline.pages.dijit.UploadProgressBar({},this._uploadProgressBar);this._uploadProgressBar.startup();
this._uploadProgressBar.hide()},clear:function(){this._updateItemFile.value="";this._useDescKeepRadio.set("checked",!0);this._useDescUpdateRadio.set("checked",!1);this._overwriteService.set("checked",!0)},_handleCancel:function(b){b.preventDefault();this._updateItemDialog.hide()},hide:function(){this._disable(!1);this._updateItemDialog.hide()},uploadItem:function(b){b.preventDefault();if(0===this._updateItemFile.value.length)return arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorLabel,
message:this.i18n.error.providePath}),!1;b=this._fetchItem(this.item).then(k.hitch(this,"loadFile"));if(this.item.sourceData||this.item.relatedService&&this._overwriteService.get("checked"))k.attr(this._waitingSpan,"innerHTML",this.i18n.updating),b=b.then(k.hitch(this,"_updateServiceData",this.item.sourceData||this.item)).then(k.hitch(this,"_resetServiceTitle",this.item));return b.then(k.hitch(this,function(h){h&&!h.success&&h.error&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,
message:h.error.message||this.i18n.error.errorWhileUpdate});h&&h.serviceItemId?(this._disable(!1),this._updateItemDialog.hide(),window.location="item.html?id\x3d"+h.serviceItemId+(h.jobId?"\x26jobid\x3d"+h.jobId:"")):k.publish("itemData/update",[""]);return!0}),k.hitch(this,function(h){k.isObject(h)&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,message:h.message||this.i18n.error.errorWhileUpdate});this._disable(!1)}))},_updateServiceData:function(b){var h=
new k.Deferred;this._checkStatus(b,500,k.hitch(this,function(f){var d=esriGeowConfig.restBaseUrl+"content/users/"+f.owner+"/publish",a,c,n={itemid:f.id,filetype:{"file geodatabase":"filegeodatabase",shapefile:"shapefile",geojson:"geojson",csv:"CSV","microsoft excel":"excel"}[f.type.toLowerCase()],overwrite:!0,publishParameters:k.json.stringify({name:this.item.title?this.item.title.replace(/ /g,"_"):f.title.replace(/ /g,"_")})};k.attr(this._waitingSpan,"innerHTML",this.i18n.updating);k.promise.all([this._fetchPublishParameters(this.item),
this._fetchServiceInfo(this.item.relatedService||this.item)]).then(k.hitch(this,function(m){a=m[1];(c=m[0])&&"CSV"===f.type?(m=k.mixin(k.mixin({},a.layers&&a.layers[0]),{fields:c.layerInfo.fields}),n.publishParameters=k.mixin(c,{layerInfo:m,name:c.name||f.title.replace(/ /g,"_")})):c&&"Microsoft Excel"===f.type?(n.publishParameters=this._generateExcelOverwritePublishParameters(c,a),a=null):n.publishParameters={name:f.title?f.title.replace(/ /g,"_"):this.item.title.replace(/ /g,"_")};n.publishParameters=
a?k.json.stringify(k.mixin(n.publishParameters,a)):n.publishParameters;return this.util.request({url:d,content:n},{usePost:!0}).then(k.hitch(this,function(q){h.resolve(q&&q.services&&q.services[0]||{serviceItemId:f.id})}),k.hitch(this,function(q){h.reject(q)}))}))}));return h},_generateExcelOverwritePublishParameters:function(b,h){h.name=b.name;h.sourceSR=b.sourceSR;h.targetSR=b.targetSR;for(var f=0;f<h.tables.length;f++)"Review"!=h.tables[f].name&&(h.layers[h.layers.length]=h.tables[f]);for(f=0;f<
h.layers.length;f++)h.layers[f].excelSheetId=b.layers[f].excelSheetId,h.layers[f].locationType=b.layers[f].locationType,h.layers[f].latitudeFieldName=b.layers[f].latitudeFieldName,h.layers[f].longitudeFieldName=b.layers[f].longitudeFieldName,h.layers[f].geocodeServiceUrl=b.layers[f].geocodeServiceUrl,h.layers[f].sourceLocale=b.layers[f].sourceLocale,h.layers[f].sourceCountry=b.layers[f].sourceCountry,h.layers[f].standardizedFieldNames=b.layers[f].standardizedFieldNames,h.layers[f].addressFields=b.layers[f].addressFields;
return JSON.stringify(h)},_resetServiceTitle:function(b,h){var f=new k.Deferred,d=this.util.getUser(),a=b.title||"",c=b.folderId||b.ownerFolder;d=esriGeowConfig.restBaseUrl+"content/users/"+(b.owner||d.email)+"/"+(c?c+"/":"")+"items/"+b.id+"/update";b=-1!==b.typeKeywords.indexOf("Involved Lookup")?{title:a,typeKeywords:b.typeKeywords.toString()+",showUnmatchedAddresses"}:{title:a};this.util.request({url:d,content:b},{usePost:!0}).then(k.hitch(this,function(){f.resolve(h)}),k.hitch(this,function(){f.resolve(h)}));
return f},_fetchServiceInfo:function(b){b=b.url;var h={addToken:(this.util.isHostedService(b)||this.util.isAgolService(b))&&!1!==esriGeowConfig.isMultiTenant},f=new k.Deferred,d;k.promise.all([this.util.request({url:b},h),this.util.request({url:b+"/layers"},h)]).then(k.hitch(this,function(a){var c={},n=a&&1<a.length&&a[1],m=n&&n.layers;n=n&&n.tables;m&&m.length&&(k.forEach(m,function(q){delete q.fields}),c.layers=m);n&&n.length&&(c.tables=n);d=k.mixin(a[0],c);f.resolve(d)}));return f},_fetchPublishParameters:function(b){var h=
esriGeowConfig.restBaseUrl+"content/items/"+b.id+"/info/publishParameters.json";b.publishParameters?(h=new k.Deferred,h.resolve(b.publishParameters)):!b.sourceData||"CSV"!==b.sourceData.type&&"Microsoft Excel"!==b.sourceData.type?(h=new k.Deferred,h.resolve(!1)):h=this.util.request({url:h}).then(k.hitch(this,function(f){return f}));return h},_fetchItem:function(b){if(b.sourceData)var h=this.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+b.sourceData.id}).then(k.hitch(this,function(f){f.folderId=
f.ownerFolder;return f}));else h=new k.Deferred,h.resolve(b);return h},loadFile:function(b){var h=new k.Deferred,f=this._updateItemFile.value,d=f.lastIndexOf("\\"),a=b.type;-1<d&&(f=f.substring(d+1,f.length));f=f.replace(/ /g,"_");if("Vector Tile Service"!==b.type&&this.itemName!=f)return b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.errorLabel,message:k.string.substitute(this.i18n.error.sameFileName,[this.itemName])}),this._updateItemFile.value=
"",h.reject(!0),h;if("Vector Tile Service"===b.type){d=/(?:\.([^.]+))?$/;var c=f.replace(/^.*(\\|\/|:)/,"");if("json"!==(f?d.exec(c)[1].toLowerCase():""))return b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.errorLabel,message:this.i18n.error.invalidStyleFileExtension}),this._updateItemFile.value="",h.reject(!0),h}this._disable(!0);f=!0;"Layer Package"==a&&(f=k.byId("useDescription:keep").checked);this._updateItemNameInput.set("value",this.itemName);
this._updateItemTitleInput.set("value",b.title);this._updateItemTagsInput.set("value",b.tags);this._updateItemTypeInput.set("value",a);this._updateItemKeywordsInput.set("value",b.typeKeywords);this._updateAccessInput.set("value",b.accessInformation);this._updateLicenseInfoInput.set("value",b.licenseInfo);this._updateItemFolderInput.set("value",b.folderId);f?(this._updateDescriptionInput.set("value",b.description),this._updateSnippetInput.set("value",b.snippet),this._updateExtentInput.set("value",
b.extent)):(this._updateDescriptionInput.set("value",""),this._updateSnippetInput.set("value",""),this._updateExtentInput.set("value",""));var n=function(m,q){!m.success||"completed"!==m.status&&m.status?(q=this.i18n.error.errorWhileUpdate,m&&m.error&&m.error.message&&(q=m.error.message),-1<q.indexOf("The request size is greater than the max allowed of 1024MB")&&(q=this.i18n.error.exceedFileSizeLimit),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,
message:q}),h.reject(!0)):h.resolve(!0)};a=function(m){this._disable(!1);h.reject(m)};b&&"Vector Tile Service"===b.type?this._updateItemResource(b,this._updateItemForm).then(k.hitch(this,n),k.hitch(this,a)):(this._uploadProgressBar.reset(),this._uploadProgressBar.show(),this.itemAPI.update.call(this.itemAPI,b,this._updateItemForm,this._updateItemFile.files[0]).then(function(m){this._uploadProgressBar.hide();n(m)}.bind(this),a.bind(this)));return h},_updateItemResource:function(b,h){var f=this.util.getUser(),
d=b.folderId||b.ownerFolder;b={url:esriGeowConfig.restBaseUrl+"content/users/"+(b.owner||f.email)+"/"+(d?d+"/":"")+"/items/"+b.id+"/updateResources",form:h,content:{resourcesPrefix:"styles",filename:"root.json"}};k.query("input",h).forEach(k.hitch(this,function(a){a&&"file"!==a.name&&k.attr(a,"name","")}));return this.util.request(b,{usePost:!0}).then(k.hitch(this,function(a){return a}),k.hitch(this,function(a){throw{message:this.i18n.error.invalidStyleFile};}))},_checkStatus:function(b,h,f){this.util.request({url:esriGeowConfig.restBaseUrl+
"content/users/"+b.owner+(b.ownerFolder&&"/"!==b.ownerFolder?"/"+b.ownerFolder:"")+"/items/"+b.id+"/status"}).then(k.hitch(this,function(d){d=d||{status:"failed"};"completed"===d.status?f(b):(h=(h||500)+250,setTimeout(k.hitch(this,function(){this._checkStatus(b,h,f)}),h))}))},_disable:function(b){this._updateItemBtn.set("disabled",b);this._cancelBtn.set("disabled",b);this.domUtil.showHide(this._waitingSpan,b);k.style(this._waitingSpan,"display",b?"inline-block":"none")}})})},"arcgisonline/pages/dijit/UploadProgressBar":function(){define("require exports tslib dojo/topic dojo/text!./UploadProgressBar/UploadProgressBar.html dojo/i18n!../../nls/arcgisonline dijit/_TemplatedMixin dijit/_WidgetBase ../utils/dom ../utils/culture ../../tsutils/declareDecorator".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m){b=p.__importDefault(b);h=p.__importDefault(h);f=p.__importDefault(f);d=p.__importDefault(d);a=p.__importDefault(a);c=p.__importDefault(c);n=p.__importDefault(n);m=p.__importDefault(m);return function(){function q(l,e){this.templateString=h.default;this.i18n=f.default}q.prototype.startup=function(){this.inherited(arguments);this.own(b.default.subscribe("item/upload-progress-update",this._onProgressUpdate.bind(this)))};q.prototype.hide=function(){c.default.hideNode(this.domNode)};
q.prototype.show=function(){c.default.showNode(this.domNode)};q.prototype.reset=function(){this._uploadPercentLabel.textContent=this._uploadProgressFill.style.width="0%";this._uploadPercentLabel.innerHTML=n.default.getPercentString(0);this._uploadProgressFill.style.width="0%"};q.prototype._onProgressUpdate=function(l){this._uploadProgressFill.classList[100===l?"add":"remove"]("upload-progress-bar__fill--full");this._uploadPercentLabel.innerHTML=n.default.getPercentString(l/100);this._uploadProgressFill.style.width=
l+"%"};return q=p.__decorate([m.default(a.default,d.default)],q)}()})},"arcgisonline/sharing/geow/Item":function(){define("esri/request dojo/_base/lang dojo/Deferred dojo/dom-construct dojo/dom-form dojo/topic dojo/promise/all arcgisonline/esriGeowConfig arcgisonline/sharing/util".split(" "),function(k,g,p,b,h,f,d,a,c){return{addItem:function(n,m,q){return this._action(n,m,q,"addItem")},update:function(n,m,q){return this._action(n,m,q,"update")},_action:function(n,m,q,l){if(c.getUser())return l=this._getActionItemUrl(n,
l),n=5242880<q.size?this._multiPartAction(l,m,q,n):this._postForm(l,m)},_multiPartAction:function(n,m,q,l){function e(u){w.reject(u)}function t(u){u.isMultipart=!0;w.resolve(u)}function x(u){this._commitItem(l,m).then(t.bind(this),e.bind(this))}function r(u){this._cancelItem(l);e.call(this,u)}var w=new p;this._startMultipartRequest(n,l.fileName?l.fileName:q.name).then(function(u){u.success?(l.id=u.id,this._addItemParts(l,q).then(x.bind(this),r.bind(this))):e.call(this,u.error)}.bind(this),e);return w},
_postForm:function(n,m){return c.request({url:n,form:m,timeout:0},{usePost:!0})},_startMultipartRequest:function(n,m){return c.request({url:n,content:{multipart:!0,filename:m,async:!0}},{usePost:!0})},_addItemParts:function(n,m){function q(){if(0===v.length)r.resolve();else{var E=v.splice(0,y);d(E.map(function(D){var G=new p;return this._addPartWithRetries(n,D.partData,D.formData,1,l,u,G)}.bind(this))).then(q.bind(this),function(D){r.reject(D)})}}var l=m.size,e=5242880,t=0,x=Math.ceil(l/e),r=new p,
w=n.fileName?n.fileName:m.name,u={},v=[],y=a.multiPartBatchSize||10;1E4<x&&(e=Math.ceil(l/1E4),x=Math.ceil(l/e));for(;t<x;){var z=t*e;z=m.slice(z,z+e);var B={partNum:t+1},C=b.create("form",{enctype:"multipart/form-data"});C=new FormData(C);C.append("partNum",B.partNum);C.append("streamdata",!0);C.append("f","json");C.append("token",c.getToken());C.append("file",z,w);v.push({partData:B,formData:C});t++}this.pendingRequests=[];f.subscribe("cancel-item-upload",function(){this.pendingRequests.forEach(function(E){E&&
!E.isFulfilled()&&E.cancel()})}.bind(this));q.call(this);return r},_addPartWithRetries:function(n,m,q,l,e,t,x){var r=this._getActionItemUrl(n,"addPart");r=k({url:r,form:q,timeout:0},{returnProgress:!0,disableIdentityLookup:!0}).then(function(w){w.success?x.resolve(w):x.reject(w.error)},function(w){l++;"Request canceled"!==w.message&&7>=l?this._addPartWithRetries(n,m,q,l,e,t,x):x.reject(w)}.bind(this),function(w){w.loaded&&"upload"===w.transferType&&(t[m.partNum.toString()]=w.loaded,w=Object.keys(t).reduce(function(u,
v){return u+t[v]},0),f.publish("item/upload-progress-update",Math.floor(w/e*100)))});this.pendingRequests.push(r);return x},_commitItem:function(n,m){var q=this._getActionItemUrl(n,"commit");n=m instanceof FormData?{title:n.fileName,type:n.fileType}:g.mixin({},h.toObject(m));return c.request({url:q,content:n},{usePost:!0})},_cancelItem:function(n){n=this._getActionItemUrl(n,"cancel");return c.request({url:n},{usePost:!0})},_getUserUrl:function(n){var m=c.getUser();m=m.username||m.email;return a.restBaseUrl+
"content/users/"+(n.owner||m)},_getActionItemUrl:function(n,m){var q=this._getUserUrl(n);n.folderId&&(q=q+"/"+n.folderId);return q="addItem"===m?q+"/addItem":q+"/items/"+n.id+"/"+m}}})},"arcgisonline/sharing/dijit/_GalleryFiltersMixin":function(){define(["dojo/_base/declare"],function(){return{rootNodes:{organization:{all:{},maps:{},layers:{},scenes:{},applications:{},tools:{},files:{}},maps:{all:{},imagery:{tags:["imagery"]},basemaps:{tags:["basemap"]},historical:{tags:["historical"]},demographics:{tags:"demographics"},
landscape:{tags:"landscape"},oceans:{tags:"oceans"},earth:{tags:["earth observations"]},urban:{tags:["urban"]},transportation:{tags:["transportation"]},boundariesplaces:{tags:["boundaries"]},storymaps:{tags:["story maps","story map"]}},apps:{configurable:{typekeywords:["Configurable"]},readytouse:{typekeywords:["Ready To Use"]},appbuilder:{typekeywords:["Web AppBuilder for ArcGIS"]}}},imagery:{basemapimagery:{parent:"imagery"},multiimagery:{parent:"imagery"},temporalimagery:{parent:"imagery"},eventimagery:{parent:"imagery"}},
basemaps:{esribasemaps:{parent:"basemaps"},partnerbasemaps:{parent:"basemaps"},userbasemaps:{parent:"basemaps"}},demographics:{income:{parent:"demographics"},spending:{parent:"demographics"},population:{parent:"demographics"},business:{parent:"demographics"},atrisk:{parent:"demographics"}},landscape:{agriculture:{parent:"landscape"},climate:{parent:"landscape"},ecology:{parent:"landscape"},biology:{parent:"landscape"},disturbance:{parent:"landscape"},elevation:{parent:"landscape"},landcover:{parent:"landscape"},
hazards:{parent:"landscape"},soils:{parent:"landscape"},subsurface:{parent:"landscape"},water:{parent:"landscape"}},urban:{threed:{parent:"urban"},movement:{parent:"urban"},parcels:{parent:"urban"},people:{parent:"urban"},planning:{parent:"urban"},publicFilter:{parent:"urban"},work:{parent:"urban"}},transportation:{accessibility:{parent:"transportation"},infrastructure:{parent:"transportation"},logistics:{parent:"transportation"},traffic:{parent:"transportation"},transit:{parent:"transportation"}},
boundariesplaces:{boundaries:{parent:"boundariesplaces"},places:{parent:"boundariesplaces"}},maps:{webmaps:{parent:"maps"},mapfiles:{parent:"maps"}},layers:{weblayers:{parent:"layers"},layerfiles:{parent:"layers"}},applications:{web:{parent:"applications"},mobile:{parent:"applications"},desktop:{parent:"applications"}},weblayers:{features:{parent:"weblayers"},tiles:{parent:"weblayers"},mapimage:{parent:"weblayers"},imagery:{parent:"weblayers"},scenelayers:{parent:"weblayers"},tables:{parent:"weblayers"}},
readytouse:{web:{parent:"readytouse"},ios:{parent:"readytouse"},android:{parent:"readytouse"},windows:{parent:"readytouse"},desktop:{parent:"readytouse"}},configurable:{narrate:{parent:"configurable"},collect:{parent:"configurable"},compare:{parent:"configurable"},"3dscene":{parent:"configurable"},analyze:{parent:"configurable"},present:{parent:"configurable"},social:{parent:"configurable"},local:{parent:"configurable"},route:{parent:"configurable"},showcase:{parent:"configurable"}},files:{document:{parent:"files"},
image:{parent:"files"},pdf:{parent:"files"}},tools:{locators:{parent:"tools"},geodatabase:{parent:"tools"},geometric:{parent:"tools"},geoprocessing:{parent:"tools"},network:{parent:"tools"}},"imagery-root":{tags:["imagery"]},"imagery-basemapimagery":{tags:["baseimagery"]},"imagery-multiimagery":{tags:["multispectral"]},"imagery-temporalimagery":{tags:["temporal"]},"imagery-eventimagery":{tags:["event_imagery"]},"basemaps-root":{tags:["basemap"]},"basemaps-esribasemaps":{tags:["esri_basemap"]},"basemaps-partnerbasemaps":{tags:["partner_basemap"]},
"basemaps-userbasemaps":{tags:["user_basemap"]},"historical-root":{tags:["historical"]},"demographics-root":{tags:["demographics"]},"demographics-income":{tags:["income"]},"demographics-spending":{tags:["spending","behaviors"]},"demographics-population":{tags:["population","housing"]},"demographics-segmentation":{tags:["segmentation"]},"demographics-business":{tags:["business","jobs"]},"demographics-atrisk":{tags:["at risk","poverty"]},"landscape-root":{tags:["landscape"]},"landscape-agriculture":{tags:["agriculture"]},
"landscape-climate":{tags:["climate","weather"]},"landscape-ecology":{tags:["ecology"]},"landscape-biology":{tags:["species"]},"landscape-disturbance":{tags:["disturbance"]},"landscape-elevation":{tags:["elevation"]},"landscape-landcover":{tags:["landcover"]},"landscape-hazards":{tags:["hazards"]},"landscape-soils":{tags:["soils","geology"]},"landscape-subsurface":{tags:["subsurface"]},"landscape-water":{tags:["water"]},"oceans-root":{tags:["oceans"]},"earth-root":{tags:["earth observations"]},"urban-root":{tags:["urban"]},
"urban-threed":{tags:["3D"]},"urban-movement":{tags:["movement"]},"urban-parcels":{tags:["parcels"]},"urban-people":{tags:["people"]},"urban-planning":{tags:["planning"]},"urban-publicFilter":{tags:["public"]},"urban-work":{tags:["work"]},"transportation-root":{tags:["transportation"]},"transportation-accessibility":{tags:["accessibility"]},"transportation-infrastructure":{tags:["infrastructure"]},"transportation-logistics":{tags:["logistics"]},"transportation-traffic":{tags:["traffic"]},"transportation-transit":{tags:["transit"]},
"boundariesplaces-root":{tags:["boundaries"]},"boundariesplaces-boundaries":{tags:["boundaries"]},"boundariesplaces-places":{tags:["places"]},"storymaps-root":{tags:["story maps","story map"]},"scenes-root":{tags:["scenes"]},"readytouse-root":{typekeywords:["Ready To Use"]},"configurable-root":{typekeywords:["Configurable"]},"appbuilder-root":{typekeywords:["Web AppBuilder for ArcGIS"]},"readytouse-web":{typekeywords:["Web Mapping Application"]},"readytouse-ios":{typekeywords:["ArcGIS for iPhone"]},
"readytouse-android":{typekeywords:["ArcGIS for Android"]},"readytouse-windows":{typekeywords:["ArcGIS for Windows Phone"]},"readytouse-desktop":{typekeywords:["Application","Desktop Application"]},"configurable-narrate":{typekeywords:["story"]},"configurable-collect":{typekeywords:["collect"]},"configurable-compare":{typekeywords:["compare"]},"configurable-3dscene":{typekeywords:["3Dscene"]},"configurable-analyze":{typekeywords:["summarize"]},"configurable-present":{typekeywords:["gallery"]},"configurable-social":{typekeywords:["social"]},
"configurable-local":{typekeywords:["local"]},"configurable-route":{typekeywords:["route"]},"configurable-showcase":{typekeywords:["showcase"]},mappings:{"demographics-behaviors":{mappedCategory:"demographics-spending"},"demographics-segmentation":{mappedCategory:"demographics"},"landscape-oceans":{mappedCategory:"oceans"}}}})},"arcgisonline/sharing/dijit/dialog/AdvancedOfflineOptionsDlg":function(){define("dojo/_base/declare dojo/on dojo/dom-attr dojo/query dojo/dom dojo/dom-style dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/dom-construct dojo/string dojo/_base/window dojo/promise/all dojo/when dojo/Deferred dojo/_base/array dojo/cookie dojo/dom-class dojo/json dijit/registry dijit/form/Select dijit/form/CheckBox ./ConfirmDialog dijit/focus dojo/_base/event dojo/keys ./_CreateItemUtilMixin dojo/topic esri/Evented esri/arcgis/Portal ../../geow/Account ../../geow/Content ../../util dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),
function(k,g,p,b,h,f,d,a,c,n,m,q,l,e,t,x,r,w,u,v,y,z,B,C,E,D,G,H,N,O,S,da,J,M,K){return k("arcgisonline.sharing.dijit.dialog.AdvancedOfflineOptionsDlg",[a,c,n,O],{baseClass:"esriAdvancedOfflineOptionsDlg",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"main"\x3e\x3ch2\x3e${i18n.advancedOfflineOptionsDlg.editableLayersTitle}\x3c/h2\x3e\x3cp class\x3d"" data-dojo-attach-point\x3d"_editMessage"\x3e${i18n.advancedOfflineOptionsDlg.editMessage}\x3c/p\x3e\x3cdiv class\x3d"edit"\x3e\x3clabel class\x3d"esriLeadingMargin1 trailer-0 editFeatures"\x3e\x3cinput class\x3d"" data-dojo-attach-point\x3d"editFeatures" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editFeatures}\x26nbsp;\x3c/label\x3e\x3cbr /\x3e\x3clabel class\x3d"esriLeadingMargin26 editAttachments padding-left-2"\x3e\x3cinput class\x3d"editAttachments" data-dojo-attach-point\x3d"editAttachments" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true, disabled:false\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editAttachments}\x26nbsp;\x3c/label\x3e\x3c/div\x3e\x3ch2\x3e${i18n.advancedOfflineOptionsDlg.readOnlyLayersTitle}\x3c/h2\x3e\x3cp class\x3d"" data-dojo-attach-point\x3d"_readOnlyMessage"\x3e${i18n.advancedOfflineOptionsDlg.readOnlyMessage}\x3c/p\x3e\x3cdiv class\x3d"readonly"\x3e\x3clabel class\x3d"esriLeadingMargin1 "\x3e\x3cinput class\x3d"" data-dojo-attach-point\x3d"downloadAttachments" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editAttachments}\x26nbsp;\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
onDone:function(){},postMixInProperties:function(){this.inherited(arguments);this.i18n=d.mixin({},K);this._portalUser=(this._portal=esriGeowConfig.portal||esriGeowConfig.self)&&(this._portal.user||this._portal.getPortalUser())},postCreate:function(){this.inherited(arguments);da.getSelf(d.hitch(this,function(R){this._loadConnections();this.set("item",this.data)}))},destroy:function(){this._errorDlg&&(this._errorDlg.destroyRecursive(),this._errorDlg=null);this.inherited(arguments);this._portalUser=
this._portal=null},showModal:function(){var R=new x,X=new C({title:K.advancedOfflineOptionsDlg.title,buttonOk:K.common.ok,buttonCancel:K.common.cancel,style:{width:"475px",height:"auto"},className:"esriAdvancedOptions"}),Q=b(".dijitDialogTitle",X.domNode).shift(),W,I=this._portal.helpMap.m["120000899"];I=m.create("a",{className:"esriHelpIcon",title:K.common.help,href:this._portal.helpBase+(I?I:""),target:"_blank"});m.place(I,Q,"last");X.setContent(this.domNode);X.show().then(d.hitch(this,function(T){"onOk"===
T&&this._supportsAdvancedSyncOptions&&(this.set("disabled",!0,K.advancedOfflineOptionsDlg.pleaseWait),W=this.get("offlineProperties"),this._webMap=d.mixin(this._webMap,{applicationProperties:d.mixin(this._webMap.applicationProperties||{},W)}));X.hide().then(d.hitch(this,function(){R.resolve(this._webMap)}))}));return R},_loadConnections:function(){this.own(g(this.editFeatures,"click",d.hitch(this,function(){this.editFeatures.get("checked")?(b(".editAttachments").removeClass("disabled"),this.editAttachments.set("disabled",
!1)):(b(".editAttachments").addClass("disabled"),this.editAttachments.set("checked",!1),this.editAttachments.set("disabled",!0))})))},_setItemAttr:function(R){this._item=R.portal?R:new S.PortalItem(d.mixin({},R,{portal:this._portal}));R=this._item.itemData?d.clone(this._item.itemData):{};this._item.updatedOffline&&(R.applicationProperties||(R.applicationProperties={}),R.applicationProperties.offline=d.clone(this._item.updatedOffline));this.set("webmap",R)},_setWebmapAttr:function(R){this._webMap=
R||{};this._mapSupportsAdvancedSyncOptions(R).then(d.hitch(this,function(X){(this._supportsAdvancedSyncOptions=X)?this.set("offlineProperties",this._webMap.applicationProperties&&this._webMap.applicationProperties.offline||{}):(b(".dijitCheckBox",this.domNode).map(y.byNode).forEach(function(Q){Q.set("disabled",!0)}),b("label").addClass("disabled"))}))},_setOfflinePropertiesAttr:function(R){var X=R||{},Q=X.editableLayers,W=X.readonlyLayers;X=!Q||Q.download&&("featuresAndAttachments"===Q.download||
"features"===Q.download);Q=!Q||Q.sync&&"syncFeaturesAndAttachments"===Q.sync;W=!W||W.downloadAttachments;this._offlineProperties=R||{};this.editFeatures.set("checked",X);this.editAttachments.set("disabled",!X);b(".editAttachments")[X?"removeClass":"addClass"]("disabled");this.editAttachments.set("checked",Q);this.downloadAttachments.set("checked",W)},_getOfflinePropertiesAttr:function(){var R=this._offlineProperties||{},X=this.editFeatures.get("checked"),Q=this.editAttachments.get("checked"),W=this.downloadAttachments.get("checked");
X||Q?X&&Q?R=d.mixin(R,{editableLayers:{download:"featuresAndAttachments",sync:"syncFeaturesAndAttachments"}}):X&&!Q&&(R=d.mixin(R,{editableLayers:{download:"features",sync:"syncFeaturesUploadAttachments"}})):R=d.mixin(R,{editableLayers:{download:"none",sync:"uploadFeaturesAndAttachments"}});R=d.mixin(R,{readonlyLayers:{downloadAttachments:W}});return d.mixin({},{offline:R})},_setDisabledAttr:function(R,X){this.set("readOnly",R,X)},_setReadOnlyAttr:function(R,X,Q){b(".dijit",this.domNode).map(y.byNode).forEach(function(W){W.set("disabled",
R)});b("a",this.domNode)[R?"addClass":"removeClass"]("disabledLink");b("label, p, span, h2, .hint",this.domNode)[R?"addClass":"removeClass"]("disabled");R&&X&&N.publish("/dlg/busyMessage",X);N.publish("/esri/disable",R,X)},_mapSupportsAdvancedSyncOptions:function(R){var X=new x,Q=R.operationalLayers||[],W={},I=[];if(R&&R.applicationProperties&&R.applicationProperties.offline)X.resolve(!0);else{r.forEach(Q,function(Y){T=Y.url&&Y.url.replace(/(\/\d+)+$/g,"");W[T]=T});for(var T in W)W.hasOwnProperty(T)&&
W[T]&&I.push(M.request({url:W[T]},{addToken:!1}).then(function(Y){return Y&&Y.syncCapabilities&&Y.syncCapabilities.supportsAttachmentsSyncDirection},function(Y){return!1}));e(I).then(function(Y){X.resolve(r.every(Y,"return item;"))})}return X},_showError:function(R){R=d.mixin(d.mixin({},K.publishWizard.errors.error),R);this._errorDlg=this._errorDlg||new C({showCancel:!1,style:{width:"400px",height:"auto"}});this._errorDlg.show(R).then(d.hitch(this,function(){this.set("disabled",!1);this._errorDlg.hide()}));
return!1}})})},"arcgisonline/sharing/dijit/dialog/getWFSConfig":function(){define(["dojo/_base/array","esri/renderers/SimpleRenderer","esri/symbols/jsonUtils","arcgisonline/map/popup/getDefaultPopupInfo"],function(k,g,p,b){function h(c){var n,m=c.fields,q=c.selectedLayer||{},l;m&&m.length&&(l=k.filter(m,function(e){return"esriFieldTypeGeometry"!==e.type}))&&l.length&&(n=b({name:q.title,fields:m},!1,c));return n}var f={type:"esriSMS",style:"esriSMSCircle",color:[34,114,162,128],size:6,outline:{color:[34,
114,162,255],width:1}},d={type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:2},a={type:"esriSFS",style:"esriSFSSolid",color:[227,139,79,204],outline:{type:"esriSLS",style:"esriSLSSolid",color:[255,255,255,255],width:.75}};return function(c){var n=c.geometryType,m=c.toJson(),q=m.url,l=m.mode;m={version:m.version,name:m.name,wfsNamespace:c.layerNamespace,featureUrl:c.getFeatureUrl,supportedSpatialReferences:c.spatialReferences};var e;"esriGeometryPoint"===n?e=new g(p.fromJson(f)):"esriGeometryPolyline"===
n?e=new g(p.fromJson(d)):"esriGeometryPolygon"===n&&(e=new g(p.fromJson(a)));e=e.toJson();return{url:q,mode:l,wfsInfo:m,layerDefinition:{geometryType:n,drawingInfo:{renderer:e},spatialReference:{wkid:4326},fields:c.fields},popupInfo:h(c)}}})},"arcgisonline/map/popup/getDefaultPopupInfo":function(){define(["./isImageServiceLayer","./isTiledImageServiceLayer","dojo/_base/array","dojo/_base/lang"],function(k,g,p,b){return function(h,f,d){f=h.displayField;f=h.name+(f&&f.length?": {"+f+"}":"");var a=h.fields,
c=!1,n=!1,m=!1;if(k(d)||g(d))a=d.getCustomRasterFields({rasterAttributeTableFieldPrefix:"Raster."}),m=0>p.indexOf(["F32","F64"],d.pixelType),d&&d.capabilities&&(n=(c=d.capabilities&&-1<d.capabilities.toLowerCase().indexOf("catalog")||d.fields&&0<d.fields.length)&&("esriImageServiceDataTypeVector-UV"===d.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===d.serviceDataType));var q={esriFieldTypeDouble:1,esriFieldTypeSingle:1},l={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},e={esriFieldTypeDate:1},
t=",";h.editFieldsInfo&&(h.editFieldsInfo.creatorField&&(t+=h.editFieldsInfo.creatorField+","),h.editFieldsInfo.creationDateField&&(t+=h.editFieldsInfo.creationDateField+","),h.editFieldsInfo.editorField&&(t+=h.editFieldsInfo.editorField+","),h.editFieldsInfo.editDateField&&(t+=h.editFieldsInfo.editDateField+","),t=t.toLowerCase());a=p.map(a,b.hitch(this,function(x,r){r="esriFieldTypeOID"!==x.type&&"esriFieldTypeGlobalID"!==x.type&&"esriFieldTypeGeometry"!==x.type;var w=null,u=x.editable&&"esriFieldTypeOID"!==
x.type&&"esriFieldTypeGlobalID"!==x.type;if(r){var v=x.name.toLowerCase(),y=t+"stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";c&&(y+="raster.itempixelvalue,",n&&(y+="raster.magnitude,raster.direction,"));if(-1<y.indexOf(","+v+",")||-1<v.indexOf("shape")||-1<v.indexOf("perimeter")||-1<v.indexOf("objectid")||-1<v.indexOf("raster.servicepixelvalue.")||v.indexOf("_i")==v.length-2)r=!1;x.type in l?w={places:0,digitSeparator:!0}:x.type in q?w={places:m&&(-1<v.indexOf("raster.servicepixelvalue")||
-1<v.indexOf("raster.itempixelvalue"))?0:2,digitSeparator:!0}:x.type in e&&(10<=h.currentVersion||d&&10<=d.version)&&(w={dateFormat:"longMonthDayYear"})}u=u?-1===t.indexOf(","+x.name.toLowerCase()+","):u;return b.mixin({},{fieldName:x.name,label:x.alias,isEditable:u,tooltip:"",visible:r,format:w,stringFieldOption:"textbox"})}));f={title:f,fieldInfos:a,description:null,showAttachments:!0,mediaInfos:[]};k(d)?(f.layerOptions={},f.layerOptions.showNoDataRecords=!0,f.layerOptions.returnTopmostRaster=!0):
g(d)&&(f.layerOptions={},f.layerOptions.showNoDataRecords=!0);return f}})},"arcgisonline/map/popup/isImageServiceLayer":function(){define(["esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISImageServiceVectorLayer"],function(k,g){return function(p){return p instanceof esri.layers.ArcGISImageServiceLayer||p instanceof esri.layers.ArcGISImageServiceVectorLayer}})},"arcgisonline/map/popup/isTiledImageServiceLayer":function(){define(["esri/layers/RasterXLayer"],function(k){return function(g){return g instanceof
esri.layers.RasterXLayer}})},"arcgisonline/sharing/dijit/dialog/getWMTSConfig":function(){define("dojo/Deferred dojo/json dojo/_base/array dojo/_base/lang esri/renderers/SimpleRenderer esri/symbols/jsonUtils esri/SpatialReference esri/geometry/Extent arcgisonline/map/core/sameSpatialReference arcgisonline/map/core/projectExtent".split(" "),function(k,g,p,b,h,f,d,a,c,n){function m(l){var e=new k;q(l.selectedLayer.gcsExtent,l.selectedTileInfo.fullExtent).then(function(t){e.resolve(t&&t.toJson())});
return e}function q(l,e){var t=new k;e=e.spatialReference||new d({wkid:4326});handler=b.hitch(this,function(x){t.resolve(x&&x.length&&x[0]&&x[0].type&&"extent"===x[0].type?x[0]:null)});n(l,e,handler,handler);return t}return function(l){var e=new k,t=l.selectedLayer||{},x=l.selectedTileInfo||{},r;m(l).then(b.hitch(this,function(w){var u=l.selectedLayer;var v=l.selectedTileInfo,y=-1<dojo.indexOf(u.formats,"image/png")?"image/png":u.formats[0];l.resourceUrls=u.resourceUrls;u=l.getTileUrlTemplate({identifier:u.identifier,
tileMatrixSet:v.tileMatrixSet,format:y});(v=l.copyright)&&"none"!==v.toLowerCase()?180<v.length&&(v=v.substring(0,180)+".."):v="";y=w||l.selectedTileInfo.fullExtent;var z=l.selectedTileInfo.tileInfo||{};if(96!==z.dpi){for(var B=0;B<z.lods.length;B++){var C=z.lods[B];C.scale=96*C.scale/z.dpi}z.dpi=96}z=z.toJson();r={templateUrl:u,copyright:v,fullExtent:y,tileInfo:z,wmtsInfo:{url:l.wmtsUrl,layerIdentifier:t.identifier,tileMatrixSet:x.tileMatrixSet}};e.resolve({wmtsConfig:r,fullExtent:w})}));return e}})},
"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:esri/dijit/templates/OverviewMap.html":'\x3cdiv class\x3d"esriOverviewMap"\x3e\r\n  \x3cdiv class\x3d"ovwContainer" dojoattachpoint\x3d"_body" style\x3d"width: ${width}px; height: ${height}px;"\x3e\r\n    \x3cdiv id\x3d"${id}-map" style\x3d"width: 100%; height: 100%;"\x3e\r\n      \x3cdiv class\x3d"ovwHighlight" dojoattachpoint\x3d"_focusDiv" title\x3d"${NLS_drag}" style\x3d"border: 1px solid ${color}; background-color: ${color};"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwController" title\x3d"${NLS_show}" dojoattachpoint\x3d"_controllerDiv" dojoattachevent\x3d"onclick: _visibilityHandler"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwMaximizer" title\x3d"${NLS_maximize}" dojoattachpoint\x3d"_maximizerDiv" dojoattachevent\x3d"onclick: _maximizeHandler"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/TimeSlider.html":'   \x3cdiv class\x3d"esriTimeSlider"\x3e\r\n   \x3ctable width\x3d"100%" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\r\n   \x3ctr\x3e\r\n   \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPlayButton" dojoAttachEvent\x3d"onClick:_onPlay" dojoAttachPoint\x3d"playPauseBtn" type\x3d"button"\x3e${NLS_play}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"center" valign\x3d"middle" width\x3d"80%" class\x3d"tsTmp"\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle" width\x3d"30"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPrevButton" dojoAttachEvent\x3d"onClick:_onPrev" dojoAttachPoint\x3d"previousBtn" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsNextButton" dojoAttachEvent\x3d"onClick:_onNext" dojoAttachPoint\x3d"nextBtn" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\x3c/td\x3e\r\n   \x3c/tr\x3e    \r\n   \x3c/table\x3e\r\n   \x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_vertical.html":'\x3cdiv class\x3d"esriMdSliderVertical esriMdSliderPassive"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableVertical" data-dojo-attach-point\x3d"mdSliderTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderInfoCellVertical"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo" class\x3d"esriMdSliderInfo"\x3e\r\n          \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderCellVertical" data-dojo-attach-point\x3d"mdSliderCell"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr  class\x3d"esriMdSliderPlayButtonRow"  data-dojo-attach-point\x3d"playPauseBtnRow"\x3e\r\n      \x3ctd class\x3d"esriMdSliderPrevButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPrevButton\'" data-dojo-attach-event\x3d"onClick:decrement" data-dojo-attach-point\x3d"prevBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_previous}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderPlayButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderNextButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsNextButton\'" data-dojo-attach-event\x3d"onClick:increment" data-dojo-attach-point\x3d"nextBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_next}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_horizontal.html":'\x3cdiv class\x3d"esriMdSliderHorizontal"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableHorizontal"\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol class\x3d"esriMdSliderHorizontalCol1"\x3e\r\n      \x3ccol\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"esriMdSliderDimensionInfoCellHorizontal" colspan\x3d"2"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" \r\n                                               data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button" title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderCellHorizontal" data-dojo-attach-point\x3d"mdSliderCell"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/HomeButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_homeNode" title\x3d"${_i18n.widgets.homeButton.home.title}" role\x3d"button" class\x3d"${_css.home}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.homeButton.home.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\r\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\r\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\r\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\t\x3c/div\x3e\r\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/templates/OrganizationSetup.html":'\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-attach-point\x3d"containerNode"\x3e\r\n  \x3cdiv  class\x3d"esriFloatLeading" style\x3d"width:780px; clear:both; padding-left:10px;"\x3e${i18n.thankYou}\x3c/div\x3e\r\n\r\n  \x3cdiv style\x3d"width:780px; clear:both; margin-top:2em; padding-left:10px;" class\x3d"esriFloatLeading"\x3e\r\n\r\n    \x3ctable\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.orgName}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_orgNameImg" src\x3d"" alt\x3d"${i18n.orgName}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${i18n.orgNameDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel\x3e\r\n              \x3cinput class\x3d"orgTextBox" data-dojo-attach-point\x3d"_nameTextBox" data-dojo-type\x3d"dijit/form/TextBox" type\x3d"text" data-dojo-props\x3d"trim:true"\x3e\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.orgAbbr}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_orgAbbrImg" src\x3d"" alt\x3d"${i18n.orgAbbr}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${!i18n.orgAbbrDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3cinput class\x3d"orgTextBox" id\x3d"urlKeyTextBox" data-dojo-attach-point\x3d"_urlKeyTextBox" data-dojo-type\x3d"dijit/form/TextBox" type\x3d"text" data-dojo-props\x3d"trim:true"\x3e\r\n            \x3clabel for\x3d"urlKeyTextBox" data-dojo-attach-point\x3d"_urlKeyStatusLabel" style\x3d"vertical-align:middle; width:125px;"\x3e\x3c/label\x3e\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            ${i18n.sampleOrgUrl}\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_sampleUrlTextBox"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.languageSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_languageImg" src\x3d"" alt\x3d"${i18n.languageSetting}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${i18n.languageDesc} ${i18n.browserDefaultAGOL}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel\x3e${i18n.languageLabel} \x3cselect class\x3d"orgComboBox" data-dojo-attach-point\x3d"_languageSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\'"\x3e\x3c/select\x3e\x3c/label\x3e\r\n\r\n            \x3cdiv class\x3d"hide" data-dojo-attach-point\x3d"_languageFormatContainer"\x3e\r\n              \x3cbr\x3e\r\n              \x3clabel\x3e\r\n                \x3cstrong\x3e${i18n.numDateFormat}\x3c/strong\x3e \x3cspan id\x3d"languageFormatTooltip"\x3e\x3ca data-dojo-attach-point\x3d"_languageFormatHelpLink" href\x3d"" target\x3d"_blank"\x3e\x3cimg class\x3d"help-icon" data-dojo-attach-point\x3d"_languageFormatImg" src\x3d"" alt\x3d"${i18n.learnNumDateFormat}"\x3e\x3c/a\x3e\x3c/span\x3e\r\n                \x3cbr\x3e\r\n                \x3cselect class\x3d"orgComboBox leader-half" data-dojo-attach-point\x3d"_languageFormatSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\',required:false"\x3e\x3c/select\x3e\r\n              \x3c/label\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.regionSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_regionImg" src\x3d"" alt\x3d"${i18n.regionSetting}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${!i18n.regionDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel for\x3d"regionSelect"\x3e${i18n.regionLabel}\x3c/label\x3e \x3cselect id\x3d"regionSelect" name\x3d"regionSelect" class\x3d"orgComboBox" data-dojo-attach-point\x3d"_regionSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\'"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr class\x3d"hide"\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.security}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"hide"\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_securityImg" src\x3d"" alt\x3d"${i18n.security}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            \x3cinput id\x3d"sslCheckBox" name\x3d"sslCheckBox" data-dojo-attach-point\x3d"_sslCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkBox"\x3e\r\n            \x3clabel for\x3d"sslCheckBox" data-dojo-attach-point\x3d"_sslCheckBoxLabel"\x3e\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.link}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd class\x3d"titleColumn"\x3e\r\n                \x3cimg data-dojo-attach-point\x3d"_linkImg" src\x3d"" alt\x3d"${i18n.link}"\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3clabel\x3e${i18n.linkDesc}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd class\x3d"valignTop" style\x3d"width:15em;"\x3e\r\n                      \x3cinput data-dojo-attach-point\x3d"_linkCheckBox" id\x3d"linkCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkbox"\x3e\r\n                      \x3clabel data-dojo-attach-point\x3d"_linkTooltip" id\x3d"linkTooltip" for\x3d"linkCheckBox"\x3e\x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd class\x3d"valignTop"\x3e\r\n                      \x3clabel\x3e\r\n                        \x3cinput class\x3d"orgTextBox" data-dojo-attach-point\x3d"_link" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true" type\x3d"text" style\x3d"width:25em;"\x3e\x3c/div\x3e\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.usageTrackingSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd class\x3d"titleColumn"\x3e\r\n                \x3cimg data-dojo-attach-point\x3d"_usageTrackingImg" src\x3d"" alt\x3d"${i18n.usageTrackingSetting}"\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3clabel\x3e${i18n.usageTrackingDesc}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd class\x3d"valignTop white-space-no-wrap" style\x3d"width:15em;"\x3e\r\n                      \x3clabel\x3e\r\n                        \x3cinput data-dojo-attach-point\x3d"_usageTrackingCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkbox"\x3e\r\n                        ${i18n.allowArcgisOnlineToCollectInfo}\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_saveBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"calcite blue" data-dojo-props\x3d"iconClass:\'esriSaveIcon\'"\x3e${i18n.saveContinue}\x3c/button\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_signOutBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"calcite transparent" data-dojo-props\x3d"iconClass:\'esriOpenIcon\'"\x3e${i18n.signOut}\x3c/button\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/templates/SaveItem.html":'\x3cdiv class\x3d"${baseClass}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-textbox"\x3e\r\n    ${i18n.titleLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemTitle"\r\n         data-dojo-type\x3d"dijit/form/TextBox"\r\n         placeHolder\x3d"${i18n.defaultTextTitle}" trim\x3d"true"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half clearfix"\x3e\r\n    ${i18n.tagsLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemTags"\r\n         data-dojo-type\x3d"esri/dijit/Tags"\r\n         data-dojo-props\x3d"minWidth:\'100%\',maxWidth:\'100%\'"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3cdiv class\x3d"categories-container"\x3e\r\n    \x3clabel class\x3d"calcite-web-label trailer-0 clearfix categories-container"\r\n      data-dojo-attach-point\x3d"saveItemCategoriesContainer"\r\n      for\x3d"saveItemCategoryPicker"\x3e\r\n      ${i18n.categoriesLabel}\r\n    \x3c/label\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemCategories" id\x3d"saveItemCategoryPicker"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-textbox"\x3e\r\n    ${i18n.summaryLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemSummary"\r\n         data-dojo-type\x3d"dijit/form/TextBox"\r\n         placeHolder\x3d"${i18n.defaultTextSummary}" maxlength\x3d"250" trim\x3d"true"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-select" for\x3d"itemFolderComboBox"\x3e\r\n    ${i18n.saveInFolderLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemFolder"\r\n         data-dojo-type\x3d"arcgisonline.sharing.dijit.ComboBox"\r\n         data-dojo-attach-event\x3d"onChange:_onFolderChange"\r\n         id\x3d"itemFolderComboBox"\x3e\x3c/div\x3e\r\n  \x3c/label\x3e\r\n\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/InvitationsDlg.html":'\x3cdiv\x3e\r\n  \t\x3cdiv data-dojo-type\x3d"dijit/Dialog" class\x3d"${baseClass} invitations-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.invitationsDlgTitle}"\x3e\r\n      \x3cdiv class\x3d"trailer-half"\x3e${i18n.invitationMsg}\x3c/div\x3e\r\n      \x3cdiv class\x3d"${baseClass} invitations-container padding-leader-quarter"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_invitationsGridContainer"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"clearfix"\x3e\r\n        \x3cdiv class\x3d"esriFloatTrailing right" style\x3d"padding-top:1rem; padding-bottom:5px;"\x3e\r\n          \x3cbutton data-dojo-attach-point\x3d"_closeBtn" class\x3d"jevent primary" data-dojo-type\x3d"dijit/form/Button" tabIndex\x3d"1"\x3e${i18n.close}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n  \t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/InvitationsDlgGroup.html":'\x3cdiv class\x3d"avenir-regular"\x3e\r\n  \x3cdiv class\x3d"panel panel-white panel-no-padding padding-leader-half padding-trailer-quarter padding-left-1 padding-right-1 border-bottom-clear"\x3e\r\n    \x3cdiv class\x3d"left"\x3e\r\n      \x3cdiv class\x3d"inline-block  ${isPrivate:show}"\x3e\r\n        \x3ca href\x3d"group.html?id\x3d${id}" class\x3d"card-image-small display-block margin-right-1 margin-left-0 group-card-thumbnail" title\x3d"${i18n.GroupsWidget.viewGroupDetails}"\x3e\r\n          \x3cimg src\x3d"${thumbnailUrl}" alt\x3d"${title}" class\x3d"${thumbnail:hide}"\x3e\r\n          \x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"65" height\x3d"65" viewBox\x3d"0 0 65 65" class\x3d"${thumbnail:show}"\x3e\r\n            \x3cpath fill\x3d"${fillColor}" d\x3d"M0 0h65v65H0z"/\x3e\r\n            \x3cpath fill\x3d"#ccc" d\x3d"M0 0h65v65H0z" fill-opacity\x3d"0.8"/\x3e\r\n            \x3cpath class\x3d"${useLetter:show}" fill\x3d"#FFF" d\x3d"M24.25 15.625a6.875 6.875 0 1 0-.008 13.75 6.875 6.875 0 0 0 .008-13.75zm0 11c-2.272 0-4.125-1.851-4.125-4.125s1.848-4.125 4.125-4.125c2.279 0 4.125 1.846 4.125 4.125s-1.846 4.125-4.125 4.125zm3.118 16.5H14.774c.596-4.641 4.647-8.25 9.473-8.25 2.855 0 5.426 1.283 7.188 3.316a15.168 15.168 0 0 1 2.311-1.518 12.22 12.22 0 0 0-9.496-4.549c-6.369 0-11.551 4.82-12.238 11l-.137 2.75h14.424a15.49 15.49 0 0 1 1.066-2.75h.003zm25.62 5.5c-.693-6.18-5.873-11-12.238-11s-11.545 4.82-12.238 11l-.137 2.75h24.75l-.137-2.75zm-21.711 0c.596-4.641 4.647-8.25 9.473-8.25a9.578 9.578 0 0 1 9.464 8.25H31.277zm9.473-27.5a6.875 6.875 0 1 0-.008 13.75c3.797.003 6.877-3.072 6.88-6.87s-3.072-6.877-6.869-6.88h-.003zm0 11c-2.271 0-4.125-1.851-4.125-4.125s1.848-4.125 4.125-4.125a4.125 4.125 0 0 1 0 8.25z"/\x3e\r\n            \x3ctext class\x3d"${useLetter:hide} font-size-4" x\x3d"50%" y\x3d"50%" fill\x3d"white" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e\r\n              \x3ctspan class\x3d"group-thumbnail-default-text" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e${title:firstChar}\x3c/tspan\x3e\r\n              \x3ctspan class\x3d"group-thumbnail-ie-text" y\x3d"70%" x\x3d"55%" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e${title:firstChar}\x3c/tspan\x3e\r\n            \x3c/text\x3e\r\n          \x3c/svg\x3e\r\n        \x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"inline-block  ${isPrivate:hide}"\x3e\r\n        \x3cdiv class\x3d"card-image-small display-block margin-right-1 margin-left-0 group-card-thumbnail"\x3e\r\n          \x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"65" height\x3d"65" viewBox\x3d"0 0 65 65" class\x3d"${thumbnail:show}"\x3e\r\n            \x3cpath fill\x3d"#AAA" d\x3d"M0 0h65v65H0z"/\x3e\r\n            \x3cpath fill\x3d"#ccc" d\x3d"M0 0h65v65H0z" fill-opacity\x3d"0.8"/\x3e\r\n            \x3cpath fill\x3d"#FFF" d\x3d"M42.5 30.5h-20c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2v-14c0-1.1-.9-2-2-2zm0 16h-20v-14h20v14zm-14-20c0-2.205 1.794-4 4-4s4 1.795 4 4v4h2v-4c0-3.309-2.691-6-6-6s-6 2.691-6 6v4h2v-4zm-4 0c0-4.4 3.6-8 8-8s8 3.6 8 8v4h2v-4c0-5.514-4.486-10-10-10s-10 4.486-10 10v4h2v-4zm10 12v-2h-2v-2h-2v10h2v-2h2v-2h-2v-2h2z"/\x3e\r\n          \x3c/svg\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"group-card-content border-box right"\x3e\r\n      \x3ch4 class\x3d"trailer-0 leader-quarter font-size-1 full-width text-ellipsis margin-right-1 text-left"\x3e\r\n        \x3ca href\x3d"group.html?id\x3d${id}" title\x3d"${title}" class\x3d"text-ellipsis ${isPrivate:show}"\x3e${title:stripHTML}\x3c/a\x3e\r\n        \x3cspan class\x3d"text-ellipsis ${isPrivate:hide}" title\x3d"${title}"\x3e${title:stripHTML}\x3c/span\x3e\r\n      \x3c/h4\x3e\r\n      \x3cp class\x3d"trailer-0 text-left"\x3e${notificationSummary}\x3c/p\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"panel panel-no-padding padding-leader-quarter padding-trailer-quarter padding-left-quarter padding-right-quarter clearfix"\x3e\r\n    \x3cdiv class\x3d"right"\x3e\r\n      \x3cbutton class\x3d"js-accept-invitation btn btn-link btn-link-off-black margin-right-1 margin-left-0 inline-block"\x3e\x3cspan class\x3d"text-green"\x3e${icons.inline.check.16}\x3c/span\x3e${i18n.invitationsGrid.joinThisGroup}\x3c/button\x3e\r\n      \x3cbutton class\x3d"js-decline-invitation btn btn-link btn-link-off-black margin-right-1 margin-left-0 inline-block"\x3e\x3cspan class\x3d"text-red"\x3e${icons.inline.minus-circle.16}\x3c/span\x3e${i18n.invitationsGrid.decline}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/JoinGroupDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog" id\x3d"join_group-dialog" class\x3d"join-group-dialog" title\x3d"${i18n.joinGroupTitle}"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_joinGroupContent"\x3e\r\n      ${i18n.yourRequestForReview}\r\n      \x3cbr\x3e\r\n      ${i18n.youCanCheckStatus}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"hide leader-half" data-dojo-attach-point\x3d"_administrativeGroup"\x3e\r\n      ${i18n.leavingDisabled}\r\n    \x3c/div\x3e\r\n    \x3cbr\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing right leader-1"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_okBtn" class\x3d"btn btn-blue"\x3e${i18n.submitRequest}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"btn btn-clear"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ManageTilesDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"${baseClass} manage-tiles-dialog js-tab-group" data-dojo-type\x3d"dijit/Dialog"\r\n       data-dojo-attach-point\x3d"dialog" title\x3d"${i18n.dialogTitle}"\x3e\r\n    \x3cnav class\x3d"tab-nav" data-dojo-attach-point\x3d"_tabNav"\x3e\r\n      \x3ca class\x3d"tab-title js-tab is-active" data-dojo-attach-point\x3d"_levelsTab"\x3e${i18n.levelsTab}\x3c/a\x3e\r\n      \x3ca class\x3d"tab-title js-tab" data-dojo-attach-point\x3d"_extentTab"\x3e${i18n.extentTab}\x3c/a\x3e\r\n    \x3c/nav\x3e\r\n\r\n    \x3csection class\x3d"tab-contents"\x3e\r\n      \x3carticle class\x3d"tab-section js-tab-section is-active" data-dojo-attach-point\x3d"_levelsSection"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_dialogDescription"\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"selected-scales-container"\x3e\x3cspan data-dojo-attach-point\x3d"_scalesSelectedSpan"\x3e\x3c/span\x3e\x3cbr\x3e\x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"scaleContainer" data-dojo-attach-point\x3d"_gridContainer"\x3e\x3c/div\x3e\r\n      \x3c/article\x3e\r\n      \x3carticle class\x3d"tab-section js-tab-section" data-dojo-attach-point\x3d"_extentSection"\x3e\r\n        \x3c!-- Add Extent UI here --\x3e\r\n        \x3cdiv class\x3d"extentContainer hide" data-dojo-attach-point\x3d"_extentContainer"\x3e\x3c/div\x3e\r\n      \x3c/article\x3e\r\n    \x3c/section\x3e\r\n\r\n    \x3cdiv class\x3d"controlDiv clearfix" data-dojo-attach-point\x3d"_controlDiv"\x3e\r\n      \x3cdiv class\x3d"left messageContainer"\x3e\r\n        \x3cdiv class\x3d"message" data-dojo-attach-point\x3d"_messageDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"right buildContainer"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_buildButton" class\x3d"calcite secondary btn btn-blue"\x3e${i18n.buildButton}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelButton" class\x3d"calcite secondary btn btn-blue hide"\x3e${i18n.cancelButton}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_closeButton" class\x3d"calcite transparent btn btn-clear"\x3e${i18n.close}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/MembershipRequestsDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" class\x3d"${baseClass} membership-requests-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.membershipRequests}"\x3e\r\n    \x3cdiv class\x3d"membership-requests-label"\x3e${i18n.requestedMemberShip}\x3c/div\x3e\r\n    \x3cdiv class\x3d"${baseClass} requests-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_requestsGridContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right" style\x3d"padding-top:1rem;padding-bottom:5px;"\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_closeBtn" class\x3d"jevent primary" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.close}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\x26nbsp;\x3cbr/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/SetIdentityProviderDlg.html":'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv class\x3d"${baseClass}" data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog" id\x3d"set-identity-provider-dialog" title\x3d"${i18n.setIdentityProviderTitle}" execute\x3d""\x3e\r\n    \x3cform data-dojo-attach-point\x3d"_form" enctype\x3d"multipart/form-data" method\x3d"post" onsubmit\x3d"return false;"\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_signUpMode" name\x3d"signUpMode" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_bindingType" name\x3d"bindingType" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportEncryption" name\x3d"encryptionSupported" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportSignedRequest" name\x3d"supportSignedRequest" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_useSHA256" name\x3d"useSHA256" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportsLogoutRequest" name\x3d"supportsLogoutRequest" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_updateProfileAtSignIn" name\x3d"updateProfileAtSignin" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_updateGroupsAtSignIn" name\x3d"updateGroupsAtSignin" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_clearEmptyFields" name\x3d"clearEmptyFields" type\x3d"hidden" value\x3d"false"\x3e\r\n\r\n      \x3cdiv data-dojo-attach-point\x3d"_description"\x3e\x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3cspan\x3e${i18n.nameLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv name\x3d"name" data-dojo-attach-point\x3d"_nameInput" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n      \x3cbr\x3e\x3cbr\x3e\r\n\r\n      \x3cspan\x3e${i18n.signUpLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_signUpModeOptions"\x3e\r\n        \x3cdiv id\x3d"automatic-option" name\x3d"signUpModeOption" type\x3d"radio"\r\n             data-dojo-attach-point\x3d"_automaticOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n             data-dojo-attach-event\x3d"onClick:onAutomaticClicked"\x3e\x3c/div\x3e \x3clabel data-dojo-attach-point\x3d"_automaticOptionLabel" for\x3d"automatic-option"\x3e${i18n.automaticOption}\x3c/label\x3e\r\n        \x3cdiv id\x3d"invite-option" name\x3d"signUpModeOption" type\x3d"radio"\r\n             data-dojo-attach-point\x3d"_inviteOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n             data-dojo-attach-event\x3d"onClick:onInvitationClicked" data-dojo-props\x3d"checked:true"\x3e\x3c/div\x3e \x3clabel data-dojo-attach-point\x3d"_inviteOptionLabel" for\x3d"invite-option"\x3e${i18n.onInviteOption}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"leader-half" data-dojo-attach-point\x3d"_automaticDefaults"\x3e\r\n        ${i18n.membersGetValues}\r\n        \x3cdiv class\x3d"margin-left-1"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_levelOptions"\x3e${i18n.defaultLevel} \x3cspan data-dojo-attach-point\x3d"_userTypeDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_roleOptions"\x3e${i18n.roleAssigned} \x3cspan data-dojo-attach-point\x3d"_roleDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_creditOptions"\x3e${i18n.defaultCredits} \x3cspan data-dojo-attach-point\x3d"_creditsDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_esriAccessOptions"\x3e${i18n.defaultEsriAccess} \x3cspan data-dojo-attach-point\x3d"_esriAccessDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_groupOptions"\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_hasGroupDefaults"\x3e${i18n.groupsSelected}\r\n                \x3cdiv class\x3d"inline-block specified-group-list hide" data-dojo-attach-point\x3d"_groupListContainer"\x3e\x3c/div\x3e\r\n                \x3cspan class\x3d"esriItemLinks hide" data-dojo-attach-point\x3d"_otherLinkContainer"\x3e\x3ca id\x3d"${id}-other-link" data-dojo-attach-point\x3d"_otherLink"\x3e${i18n.otherLink}\x3c/a\x3e\x3c/span\x3e\r\n            \x3c/span\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_noGroupDefaults"\x3e${i18n.noGroupsSelected}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"leader-half" data-dojo-attach-point\x3d"_toConfigureDefaults"\x3e${i18n.toConfigureDefaults}\x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3c!-- start federation of identity provider fields --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_federationDiscoveryServiceContainer"\x3e\r\n        \x3cspan\x3e${i18n.federationDiscoveryServiceUrlLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_federationDiscoveryServiceUrl" name\x3d"discoveryServiceUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_metadataAggregateUrlContainer"\x3e\r\n        \x3cspan\x3e${i18n.metadataAggregateUrlLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_metadataAggregateUrl" name\x3d"metadataServiceUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_aggregatedMetadataCertificateContainer"\x3e\r\n        \x3cspan\x3e${i18n.aggregatedMetadataCertificateLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3ctextarea data-dojo-attach-point\x3d"_aggregatedMetadataCertificate" name\x3d"certificate" data-dojo-type\x3d"dijit/form/SimpleTextarea" data-dojo-props\x3d"rows:3"\r\n          title\x3d"${i18n.aggregatedMetadataCertificatePlaceholder}"\x3e\x3c/textarea\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3c!-- end federation of identity provider fields --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_metadataSourceContainer"\x3e\r\n        \x3cspan\x3e${i18n.sourceLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_sourceOptions"\x3e\r\n          \x3cdiv id\x3d"metadata-url-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_metadataUrlOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n            checked\x3d"true"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"metadata-url-option"\x3e${i18n.metadataUrlOption}\x3c/label\x3e\r\n          \x3cdiv id\x3d"metadata-file-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_metadataFileOption" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"metadata-file-option"\x3e${i18n.metadataFileOption}\x3c/label\x3e\r\n          \x3cdiv id\x3d"parameters-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_parametersOption" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"parameters-option"\x3e${i18n.parametersOption}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_sourceInputs"\x3e\r\n          \x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_metadataUrlInputs"\x3e\r\n            \x3cspan\x3e${i18n.metadataUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_bindingUrlInput" name\x3d"idpMetadataUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_metadataFileInputs"\x3e\r\n            \x3cspan\x3e${i18n.metadataFileLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cinput data-dojo-attach-point\x3d"_metadataFileInput" name\x3d"idpMetadataFile" type\x3d"file" title\x3d"${i18n.metadataFilePlaceHolder}"\r\n            /\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_parametersInputs"\x3e\r\n            \x3cspan\x3e${i18n.parametersUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_loginUrlInput" name\x3d"bindingUrl" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n            \x3cbr\x3e\r\n            \x3cbr\x3e\r\n            \x3cspan\x3e${i18n.parametersPostUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_loginUrlPostInput" name\x3d"postBindingUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n            \x3cbr\x3e\r\n            \x3cbr\x3e\r\n            \x3c!--\x3cspan"\x3e${i18n.parametersBindingTypeLabel}\x3c/span\x3e--\x3e\r\n            \x3c!--\x3cdiv id\x3d"binding-type-redirect-option" name\x3d"bindingTypeOptions" data-dojo-attach-point\x3d"_bindingTypeRedirect" type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_bindingTypeRedirectOption" checked\x3d"true"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.parametersBindingTypeRedirect}\x3c/label\x3e--\x3e\r\n            \x3c!--\x3cdiv id\x3d"binding-type-post-option" name\x3d"bindingTypeOptions" data-dojo-attach-point\x3d"_bindingTypePost" type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_bindingTypePostOption"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.parametersBindingTypePost}\x3c/label\x3e--\x3e\r\n            \x3c!--\x3cbr\x3e\x3cbr\x3e--\x3e\r\n            \x3cspan\x3e${i18n.parametersCertificateLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3ctextarea data-dojo-attach-point\x3d"_certificateInput" name\x3d"certificate" data-dojo-type\x3d"dijit/form/SimpleTextarea" data-dojo-props\x3d"rows:3"\r\n              title\x3d"${i18n.parametersCertificatePlaceHolder}"\x3e\x3c/textarea\x3e\r\n            \x3cdiv style\x3d"display:none;"\x3e\r\n              \x3cbr\x3e\r\n              \x3cspan\x3e${i18n.orLabel}\x3c/span\x3e\r\n              \x3cbr\x3e\r\n              \x3cbr\x3e\r\n              \x3cspan\x3e${i18n.parametersCertificateFileLabel}\x3c/span\x3e\r\n              \x3cbr\x3e\r\n              \x3cinput type\x3d"file" data-dojo-attach-point\x3d"_certificateFileInput" name\x3d"certificateFile" title\x3d"${i18n.parametersCertificateFilePlaceHolder}"\r\n              /\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\x3cdiv\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e--\x3e\r\n          \x3c!--\x3cinput type\x3d"checkbox" id\x3d"encryptionSupported" data-dojo-attach-point\x3d"_encryptionSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e--\x3e\r\n          \x3c!--\x3clabel for\x3d"encryptionSupported"\x3e${i18n.encryptionSupported}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3c/span\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e--\x3e\r\n          \x3c!--\x3cinput type\x3d"checkbox" id\x3d"supportSignedRequest" data-dojo-attach-point\x3d"_signedRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e--\x3e\r\n          \x3c!--\x3clabel for\x3d"supportSignedRequest"\x3e${i18n.supportSignedRequest}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3c/span\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n      \x3c!--\x3c/div\x3e\x3cbr\x3e--\x3e\r\n\r\n      \x3cspan class\x3d"esriItemLinks"\x3e\x3ca data-dojo-attach-point\x3d"_toggleAdvancedSettings" data-dojo-attach-event\x3d"onclick:onToggleAdvancedSettings"\x3e${i18n.showAdvancedSettings}\x3c/a\x3e\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv id\x3d"advancedSettings" data-dojo-attach-point\x3d"_advancedSettings"\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"encryptionSupported" data-dojo-attach-point\x3d"_encryptionSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"encryptionSupported"\x3e${i18n.encryptionSupported}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"supportSignedRequest" data-dojo-attach-point\x3d"_signedRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"supportSignedRequest"\x3e${i18n.supportSignedRequest}\x3c/label\x3e\x3cbr\x3e\r\n          \x3cspan class\x3d"esriLeadingMargin15" data-dojo-attach-point\x3d"_sha256Container"\x3e\r\n            \x3cinput type\x3d"checkbox" id\x3d"signUsingSHA256" data-dojo-attach-point\x3d"_signUsingSHA256" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n            \x3clabel for\x3d"signUsingSHA256"\x3e${i18n.signUsingSHA256}\x3c/label\x3e\x3cbr\x3e\r\n          \x3c/span\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"supportsLogoutRequest" data-dojo-attach-point\x3d"_logoutRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"supportsLogoutRequest"\x3e${i18n.propagateLogout}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3clabel\x3e\r\n            \x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"_updateProfile" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n            ${i18n.updateProfileAtSignIn}\r\n          \x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_updateGroupsContainer"\x3e\r\n          \x3cspan\x3e\r\n            \x3clabel\x3e\r\n              \x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"_updateGroups" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n              ${i18n.updateGroupsAtSignIn}\r\n            \x3c/label\x3e\r\n          \x3c/span\x3e\r\n          \x3cbr\x3e\x3cbr\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_logoutUrlContainer"\x3e\r\n          \x3cspan\x3e${i18n.logoutUrlLabel}\x3c/span\x3e\r\n          \x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_logoutUrlInput" name\x3d"logoutUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n          \x3clabel\x3e${i18n.optionalLabel}\x3c/label\x3e\r\n          \x3cbr\x3e\r\n          \x3cbr\x3e\r\n        \x3c/div\x3e\r\n        \x3cspan\x3e${i18n.entityIDLabel}\x3c/span\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_entityIDInput" name\x3d"entityId" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3c!--\x3cspan\x3e${i18n.userIdAttrLabel}\x3c/span\x3e\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cdiv data-dojo-attach-point\x3d"_userIdAttrInput" name\x3d"userIdAttribute" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true" title\x3d"${i18n.userIdAttrTooltip}"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.optionalLabel}\x3c/label\x3e--\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv data-dojo-attach-point\x3d"_providerMetadataDownloadContainer"\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e${i18n.downloadProviderMetadata}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"esriItemLinks signedMetadataUrl"\x3e\x3ca href\x3d"#" data-dojo-attach-point\x3d"_signedProviderMetadataUrl" target\x3d"_blank"\x3e\x3c/a\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cbr\x3e\x3cbr\x3e\r\n      \x3cdiv class\x3d"esriAlignTrailing" data-dojo-attach-point\x3d"_buttons"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_setBtn" class\x3d"primary" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.setIdentityProviderLabel}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"cancel" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/pages/dijit/UploadProgressBar/UploadProgressBar.html":'\x3cdiv class\x3d"upload-progress-bar flex-1 flex-column-justify-center margin-right-1 margin-left-half position-relative"\x3e\r\n  \x3cdiv class\x3d"progress-bar"\x3e\r\n    \x3cdiv class\x3d"progress-bar-fill" data-dojo-attach-point\x3d"_uploadProgressFill"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"font-size--3 upload-percent-label" data-dojo-attach-point\x3d"_uploadPercentLabel"\x3e0%\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"*now":function(k){k(['dojo/i18n!*preload*arcgisonline/nls/arcgisonline*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("arcgisonline/arcgisonline",["dojo","dijit","dojox","dojo/require!esri/main,dijit/_base,dijit/form/DropDownButton,dijit/form/ComboButton,dijit/form/ToggleButton,dijit/form/HorizontalSlider,dijit/form/VerticalSlider,dijit/form/HorizontalRule,dijit/form/VerticalRule,dijit/form/HorizontalRuleLabels,dijit/form/VerticalRuleLabels,esri/map,esri/dijit/editing/Editor,esri/dijit/editing/TemplatePicker,esri/dijit/InfoWindow,esri/dijit/OverviewMap,esri/dijit/Attribution,esri/dijit/Scalebar,esri/dijit/Legend,esri/dijit/TimeSlider,esri/dijit/MultidimensionalSlider,esri/dijit/BasemapGallery,esri/dijit/HomeButton,esri/dijit/LocateButton,esri/dijit/Popup,esri/layers/graphics,esri/layers/agstiled,esri/layers/agsdynamic,esri/layers/agsimageservice,esri/layers/CSVLayer,esri/layers/StreamLayer,esri/layers/KMLLayer,esri/layers/FeatureLayer,esri/layers/VectorTileLayer,esri/layers/osm,esri/SnappingManager,esri/tasks/geometry,esri/tasks/identify,esri/tasks/locator,esri/toolbars/draw,esri/virtualearth/VETiledLayer,esri/virtualearth/VEGeocoder,esri/dijit/Geocoder,dojo/dnd/Moveable,dojo/parser,arcgisonline/map/classBreaks,arcgisonline/map/dynLayer,arcgisonline/map/edit,arcgisonline/map/featColl,arcgisonline/map/fileImport,arcgisonline/map/geocode,arcgisonline/map/geocodeReview,arcgisonline/map/geoRSS,arcgisonline/map/itemData,arcgisonline/map/layer,arcgisonline/map/kml,arcgisonline/map/mapNotes,arcgisonline/map/mapUtil,arcgisonline/map/role,arcgisonline/map/print,arcgisonline/map/popup,arcgisonline/map/save_open,arcgisonline/map/symbol,arcgisonline/map/table,arcgisonline/map/thumbnail,arcgisonline/map/time,arcgisonline/map/multiDimensions,arcgisonline/map/vectorTile,arcgisonline/map/webTile,arcgisonline/map/wms,arcgisonline/map/dijit/About,arcgisonline/map/dijit/AddContent,arcgisonline/map/dijit/Directions,arcgisonline/map/dijit/Edit,arcgisonline/map/dijit/Geocode,arcgisonline/map/dijit/LeftPanel,arcgisonline/map/dijit/Legend,arcgisonline/map/dijit/ManageTemplates,arcgisonline/map/dijit/MosaicRule,arcgisonline/map/dijit/PopupBuilder,arcgisonline/map/dijit/RendererLabels,arcgisonline/map/dijit/DefineAOI,arcgisonline/map/dijit/RenderingRule,arcgisonline/map/dijit/StructuredPopupWidget,arcgisonline/map/dijit/TOC,arcgisonline/map/dijit/MultidimensionalFilter,arcgisonline/map/dijit/renderer/AttributeTransparency,arcgisonline/map/dijit/renderer/AttributeTransparencyDlg,arcgisonline/map/dijit/renderer/Color,arcgisonline/map/dijit/renderer/ColorGrid,arcgisonline/map/dijit/renderer/Gallery,arcgisonline/map/dijit/renderer/HeatMap,arcgisonline/map/dijit/renderer/MultiAttributes,arcgisonline/map/dijit/renderer/Simple,arcgisonline/map/dijit/renderer/Size,arcgisonline/map/dijit/renderer/SizeGrid,arcgisonline/map/dijit/renderer/SymbolStylerDlg,arcgisonline/map/dijit/renderer/UniqueValues,arcgisonline/map/dijit/renderer/UniqueValuesGrid,esri/tasks/RelationshipQuery,esri/tasks/StatisticDefinition,esri/tasks/PrintParameters,esri/tasks/LegendLayer,esri/tasks/GenerateRendererParameters,esri/tasks/ClassificationDefinition,esri/tasks/ClassBreaksDefinition,esri/tasks/UniqueValueDefinition,esri/tasks/ColorRamp,esri/tasks/AlgorithmicColorRamp,esri/tasks/MultipartColorRamp,esri/tasks/RouteTask,esri/tasks/RouteParameters,esri/tasks/RouteResult,esri/tasks/NAMessage,esri/tasks/NATypes,esri/tasks/DirectionsFeatureSet,esri/layers/wmts,esri/layers/WMTSLayer,esri/layers/WMTSLayerInfo,esri/dijit/Directions,dijit/layout/AccordionPane,dojox/data/QueryReadStore,arcgisonline/sharing/util,arcgisonline/sharing/utilShare,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/geow/MemberReadStore,arcgisonline/sharing/geow/QueryReadStore,arcgisonline/sharing/geow/TooltipQueryReadStore,dijit/Dialog,dijit/form/ComboBox,dijit/layout/TabContainer,arcgisonline/sharing/dijit/ArcGISOnlineServicesGrid,arcgisonline/sharing/dijit/ArcGISServerServicesGrid,arcgisonline/sharing/dijit/BasemapGallery,arcgisonline/sharing/dijit/BasemapGalleryGrid,arcgisonline/sharing/dijit/Button,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/DataGrid,arcgisonline/sharing/dijit/DropDownButton,arcgisonline/sharing/dijit/FeatureLayerQueryResult,arcgisonline/sharing/dijit/FeatureLayerQueryStore,arcgisonline/sharing/dijit/GoogleServicesGrid,arcgisonline/sharing/dijit/GroupMembershipRequestsGrid,arcgisonline/sharing/dijit/HelpManager,arcgisonline/sharing/dijit/OrganizationSetup,arcgisonline/sharing/dijit/Troubleshoot,arcgisonline/sharing/dijit/SingleFilter,arcgisonline/sharing/dijit/SingleInteractiveFilter,arcgisonline/sharing/dijit/dialog/AddLayerFromFileDlg,arcgisonline/sharing/dijit/dialog/AddLayerFromUrlDlg,arcgisonline/sharing/dijit/dialog/BrowseLayersDlg,arcgisonline/sharing/dijit/dialog/CsvLocationDlg,arcgisonline/sharing/dijit/dialog/DeleteWarningDlg,arcgisonline/sharing/dijit/dialog/ExportDlg,arcgisonline/sharing/dijit/dialog/ExtentDlg,arcgisonline/sharing/dijit/dialog/FeatureTemplateDlg,arcgisonline/sharing/dijit/dialog/FieldsDlg,arcgisonline/sharing/dijit/dialog/FilterDlg,arcgisonline/sharing/dijit/dialog/FeatureTypeDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/InvitationsDlg,arcgisonline/sharing/dijit/dialog/JoinGroupDlg,arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg,arcgisonline/sharing/dijit/dialog/ManageTilesDlg,arcgisonline/sharing/dijit/dialog/MapSettingsDlg,arcgisonline/sharing/dijit/dialog/MapNotesDlg,arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg,arcgisonline/sharing/dijit/dialog/MdSliderSettingsDlg,arcgisonline/sharing/dijit/dialog/OpenMapDlg,arcgisonline/sharing/dijit/dialog/OpenPresentationDlg,arcgisonline/sharing/dijit/dialog/QueryLayerDlg,arcgisonline/sharing/dijit/dialog/RenameDlg,arcgisonline/sharing/dijit/dialog/RendererDlg,arcgisonline/sharing/dijit/dialog/SaveWebMapDlg,arcgisonline/sharing/dijit/dialog/SetIdentityProviderDlg,arcgisonline/sharing/dijit/dialog/ShareCheckDlg,arcgisonline/sharing/dijit/dialog/SharingDlg,arcgisonline/sharing/dijit/dialog/ShareMapDlg,arcgisonline/sharing/dijit/dialog/SubscriptionStatusDlg,arcgisonline/sharing/dijit/dialog/SymbolDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,arcgisonline/sharing/dijit/dialog/TermsOfUseDlg,arcgisonline/sharing/dijit/dialog/TimeSettingsDlg,arcgisonline/sharing/dijit/dialog/UpdateItemDlg,arcgisonline/sharing/dijit/dialog/WaitingDlg,arcgisonline/sharing/dijit/_GalleryFiltersMixin,arcgisonline/sharing/dijit/Grid,arcgisonline/sharing/dijit/dialog/ItemPropertiesDlg,arcgisonline/sharing/dijit/dialog/BrowseItemsDlg,arcgisonline/sharing/dijit/dialog/_CreateItemUtilMixin,arcgisonline/sharing/dijit/dialog/ConfirmDialog,arcgisonline/sharing/dijit/dialog/AdvancedOfflineOptionsDlg,arcgisonline/sharing/dijit/dialog/getWFSConfig,arcgisonline/sharing/dijit/dialog/getWMTSConfig"],function(k,
g,p){k.provide("arcgisonline.main");k.require("esri.main");k.require("dijit._base");k.require("dijit.form.DropDownButton");k.require("dijit.form.ComboButton");k.require("dijit.form.ToggleButton");k.require("dijit.form.HorizontalSlider");k.require("dijit.form.VerticalSlider");k.require("dijit.form.HorizontalRule");k.require("dijit.form.VerticalRule");k.require("dijit.form.HorizontalRuleLabels");k.require("dijit.form.VerticalRuleLabels");k.require("esri.map");k.require("esri.dijit.editing.Editor");
k.require("esri.dijit.editing.TemplatePicker");k.require("esri.dijit.InfoWindow");k.require("esri.dijit.OverviewMap");k.require("esri.dijit.Attribution");k.require("esri.dijit.Scalebar");k.require("esri.dijit.Legend");k.require("esri.dijit.TimeSlider");k.require("esri.dijit.MultidimensionalSlider");k.require("esri.dijit.BasemapGallery");k.require("esri.dijit.HomeButton");k.require("esri.dijit.LocateButton");k.require("esri.dijit.Popup");k.require("esri.layers.graphics");k.require("esri.layers.agstiled");
k.require("esri.layers.agsdynamic");k.require("esri.layers.agsimageservice");k.require("esri.layers.CSVLayer");k.require("esri.layers.StreamLayer");k.require("esri.layers.KMLLayer");k.require("esri.layers.FeatureLayer");k.require("esri.layers.VectorTileLayer");k.require("esri.layers.osm");k.require("esri.SnappingManager");k.require("esri.tasks.geometry");k.require("esri.tasks.identify");k.require("esri.tasks.locator");k.require("esri.toolbars.draw");k.require("esri.virtualearth.VETiledLayer");k.require("esri.virtualearth.VEGeocoder");
k.require("esri.dijit.Geocoder");k.require("dojo.dnd.Moveable");k.require("dojo.parser");k.require("arcgisonline.map.classBreaks");k.require("arcgisonline.map.dynLayer");k.require("arcgisonline.map.edit");k.require("arcgisonline.map.featColl");k.require("arcgisonline.map.fileImport");k.require("arcgisonline.map.geocode");k.require("arcgisonline.map.geocodeReview");k.require("arcgisonline.map.geoRSS");k.require("arcgisonline.map.itemData");k.require("arcgisonline.map.layer");k.require("arcgisonline.map.kml");
k.require("arcgisonline.map.mapNotes");k.require("arcgisonline.map.mapUtil");k.require("arcgisonline.map.role");k.require("arcgisonline.map.print");k.require("arcgisonline.map.popup");k.require("arcgisonline.map.save_open");k.require("arcgisonline.map.symbol");k.require("arcgisonline.map.table");k.require("arcgisonline.map.thumbnail");k.require("arcgisonline.map.time");k.require("arcgisonline.map.multiDimensions");k.require("arcgisonline.map.vectorTile");k.require("arcgisonline.map.webTile");k.require("arcgisonline.map.wms");
k.require("arcgisonline.map.dijit.About");k.require("arcgisonline.map.dijit.AddContent");k.require("arcgisonline.map.dijit.Directions");k.require("arcgisonline.map.dijit.Edit");k.require("arcgisonline.map.dijit.Geocode");k.require("arcgisonline.map.dijit.LeftPanel");k.require("arcgisonline.map.dijit.Legend");k.require("arcgisonline.map.dijit.ManageTemplates");k.require("arcgisonline.map.dijit.MosaicRule");k.require("arcgisonline.map.dijit.PopupBuilder");k.require("arcgisonline.map.dijit.RendererLabels");
k.require("arcgisonline.map.dijit.DefineAOI");k.require("arcgisonline.map.dijit.RenderingRule");k.require("arcgisonline.map.dijit.StructuredPopupWidget");k.require("arcgisonline.map.dijit.TOC");k.require("arcgisonline.map.dijit.MultidimensionalFilter");k.require("arcgisonline.map.dijit.renderer.AttributeTransparency");k.require("arcgisonline.map.dijit.renderer.AttributeTransparencyDlg");k.require("arcgisonline.map.dijit.renderer.Color");k.require("arcgisonline.map.dijit.renderer.ColorGrid");k.require("arcgisonline.map.dijit.renderer.Gallery");
k.require("arcgisonline.map.dijit.renderer.HeatMap");k.require("arcgisonline.map.dijit.renderer.MultiAttributes");k.require("arcgisonline.map.dijit.renderer.Simple");k.require("arcgisonline.map.dijit.renderer.Size");k.require("arcgisonline.map.dijit.renderer.SizeGrid");k.require("arcgisonline.map.dijit.renderer.SymbolStylerDlg");k.require("arcgisonline.map.dijit.renderer.UniqueValues");k.require("arcgisonline.map.dijit.renderer.UniqueValuesGrid");k.require("esri.tasks.RelationshipQuery");k.require("esri.tasks.StatisticDefinition");
k.require("esri.tasks.PrintParameters");k.require("esri.tasks.LegendLayer");k.require("esri.tasks.GenerateRendererParameters");k.require("esri.tasks.ClassificationDefinition");k.require("esri.tasks.ClassBreaksDefinition");k.require("esri.tasks.UniqueValueDefinition");k.require("esri.tasks.ColorRamp");k.require("esri.tasks.AlgorithmicColorRamp");k.require("esri.tasks.MultipartColorRamp");k.require("esri.tasks.RouteTask");k.require("esri.tasks.RouteParameters");k.require("esri.tasks.RouteResult");k.require("esri.tasks.NAMessage");
k.require("esri.tasks.NATypes");k.require("esri.tasks.DirectionsFeatureSet");k.require("esri.layers.wmts");k.require("esri.layers.WMTSLayer");k.require("esri.layers.WMTSLayerInfo");k.require("esri.dijit.Directions");k.require("dijit.layout.AccordionPane");k.require("dojox.data.QueryReadStore");k.require("arcgisonline.sharing.util");k.require("arcgisonline.sharing.utilShare");k.require("arcgisonline.sharing.geow.Account");k.require("arcgisonline.sharing.geow.Community");k.require("arcgisonline.sharing.geow.Geow");
k.require("arcgisonline.sharing.geow.MemberReadStore");k.require("arcgisonline.sharing.geow.QueryReadStore");k.require("arcgisonline.sharing.geow.TooltipQueryReadStore");k.require("dijit.Dialog");k.require("dijit.form.ComboBox");k.require("dijit.layout.TabContainer");k.require("arcgisonline.sharing.dijit.ArcGISOnlineServicesGrid");k.require("arcgisonline.sharing.dijit.ArcGISServerServicesGrid");k.require("arcgisonline.sharing.dijit.BasemapGallery");k.require("arcgisonline.sharing.dijit.BasemapGalleryGrid");
k.require("arcgisonline.sharing.dijit.Button");k.require("arcgisonline.sharing.dijit.ComboBox");k.require("arcgisonline.sharing.dijit.DataGrid");k.require("arcgisonline.sharing.dijit.DropDownButton");k.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");k.require("arcgisonline.sharing.dijit.FeatureLayerQueryStore");k.require("arcgisonline.sharing.dijit.GoogleServicesGrid");k.require("arcgisonline.sharing.dijit.GroupMembershipRequestsGrid");k.require("arcgisonline.sharing.dijit.HelpManager");
k.require("arcgisonline.sharing.dijit.OrganizationSetup");k.require("arcgisonline.sharing.dijit.Troubleshoot");k.require("arcgisonline.sharing.dijit.SingleFilter");k.require("arcgisonline.sharing.dijit.SingleInteractiveFilter");k.require("arcgisonline.sharing.dijit.dialog.AddLayerFromFileDlg");k.require("arcgisonline.sharing.dijit.dialog.AddLayerFromUrlDlg");k.require("arcgisonline.sharing.dijit.dialog.BrowseLayersDlg");k.require("arcgisonline.sharing.dijit.dialog.CsvLocationDlg");k.require("arcgisonline.sharing.dijit.dialog.DeleteWarningDlg");
k.require("arcgisonline.sharing.dijit.dialog.ExportDlg");k.require("arcgisonline.sharing.dijit.dialog.ExtentDlg");k.require("arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg");k.require("arcgisonline.sharing.dijit.dialog.FieldsDlg");k.require("arcgisonline.sharing.dijit.dialog.FilterDlg");k.require("arcgisonline.sharing.dijit.dialog.FeatureTypeDlg");k.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");k.require("arcgisonline.sharing.dijit.dialog.InvitationsDlg");k.require("arcgisonline.sharing.dijit.dialog.JoinGroupDlg");
k.require("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg");k.require("arcgisonline.sharing.dijit.dialog.ManageTilesDlg");k.require("arcgisonline.sharing.dijit.dialog.MapSettingsDlg");k.require("arcgisonline.sharing.dijit.dialog.MapNotesDlg");k.require("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg");k.require("arcgisonline.sharing.dijit.dialog.MdSliderSettingsDlg");k.require("arcgisonline.sharing.dijit.dialog.OpenMapDlg");k.require("arcgisonline.sharing.dijit.dialog.OpenPresentationDlg");
k.require("arcgisonline.sharing.dijit.dialog.QueryLayerDlg");k.require("arcgisonline.sharing.dijit.dialog.RenameDlg");k.require("arcgisonline.sharing.dijit.dialog.RendererDlg");k.require("arcgisonline.sharing.dijit.dialog.SaveWebMapDlg");k.require("arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg");k.require("arcgisonline.sharing.dijit.dialog.ShareCheckDlg");k.require("arcgisonline.sharing.dijit.dialog.SharingDlg");k.require("arcgisonline.sharing.dijit.dialog.ShareMapDlg");k.require("arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg");
k.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");k.require("arcgisonline.sharing.dijit.dialog.TagsDlg");k.require("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg");k.require("arcgisonline.sharing.dijit.dialog.TimeSettingsDlg");k.require("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");k.require("arcgisonline.sharing.dijit.dialog.WaitingDlg");k.require("arcgisonline.sharing.dijit._GalleryFiltersMixin");k.require("arcgisonline.sharing.dijit.Grid");k.require("arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg");
k.require("arcgisonline.sharing.dijit.dialog.BrowseItemsDlg");k.require("arcgisonline.sharing.dijit.dialog._CreateItemUtilMixin");k.require("arcgisonline.sharing.dijit.dialog.ConfirmDialog");k.require("arcgisonline.sharing.dijit.dialog.AdvancedOfflineOptionsDlg");k.require("arcgisonline.sharing.dijit.dialog.getWFSConfig");k.require("arcgisonline.sharing.dijit.dialog.getWMTSConfig")});